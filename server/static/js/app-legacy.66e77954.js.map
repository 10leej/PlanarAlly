{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?7e02","webpack:///./src/game/ui/tools/tools.vue?b25d","webpack:///./src/core/components/colorpicker.vue?18cf","webpack:///./src/core/components/modals/prompt.vue?4d3c","webpack:///./src/game/ui/tools/tool.vue?ded4","webpack:///./src/game/game.vue?14bf","webpack:///./src/game/ui/selection/shapecontext.vue?e246","webpack:///./src/game/ui/selection/selection_info.vue?952a","webpack:///./src/game/ui/tools/draw.vue?32f8","webpack:///./src/game/ui/tools/createtoken_modal.vue?c5f9","webpack:///./src/game/ui/menu/asset_node.vue?81d8","webpack:///./src/auth/login.vue?4520","webpack:///./src/game/ui/note.vue?f360","webpack:///./src/game/ui/tools/filter.vue?0956","webpack:///./src/game/game.vue?6c2b","webpack:///./src/game/ui/dmsettings.vue?f1c9","webpack:///./src/game/ui/selection/edit_dialog.vue?f907","webpack:///./src/core/components/modals/modal.vue?e7a2","webpack:///./src/game/ui/tools/vision.vue?f77d","webpack:///./src/game/ui/menu/menu.vue?a2f9","webpack:///./src/assetManager/manager.vue?9f9f","webpack:///./src/core/components/contextmenu.vue?1724","webpack:///./src/game/ui/initiative/initiative.vue?cbcd","webpack:///./src/game/ui/tools/defaultcontext.vue?505b","webpack:///./src/core/components/accordion.vue?03a9","webpack:///./src/game/ui/labels.vue?e3db","webpack:///./src/App.vue?cb1c","webpack:///./src/App.vue","webpack:///./src/assetManager/manager.vue?8378","webpack:///./src/assetManager/contextMenu.vue?e269","webpack:///./src/core/components/contextmenu.vue?8f3e","webpack:///./src/core/components/contextmenu.vue","webpack:///./src/core/components/contextmenu.vue?dc0c","webpack:///./src/core/components/contextmenu.vue?d522","webpack:///./src/store.ts","webpack:///./src/assetManager/store.ts","webpack:///./src/assetManager/socket.ts","webpack:///./src/assetManager/contextMenu.vue","webpack:///./src/assetManager/contextMenu.vue?1573","webpack:///./src/assetManager/contextMenu.vue?0751","webpack:///./src/core/components/modals/confirm.vue?02c0","webpack:///./src/core/components/modals/modal.vue?2dbc","webpack:///./src/core/components/modals/modal.vue","webpack:///./src/core/components/modals/modal.vue?1864","webpack:///./src/core/components/modals/modal.vue?1323","webpack:///./src/core/components/modals/confirm.vue","webpack:///./src/core/components/modals/confirm.vue?4a6f","webpack:///./src/core/components/modals/confirm.vue?bc1d","webpack:///./src/core/components/modals/prompt.vue?1f74","webpack:///./src/core/components/modals/prompt.vue","webpack:///./src/core/components/modals/prompt.vue?0b1b","webpack:///./src/core/components/modals/prompt.vue?216a","webpack:///./src/core/utils.ts","webpack:///./src/assetManager/manager.vue","webpack:///./src/assetManager/manager.vue?c963","webpack:///./src/assetManager/manager.vue?2088","webpack:///./src/auth/login.vue?17ff","webpack:///./src/core/store.ts","webpack:///./src/auth/login.vue","webpack:///./src/auth/login.vue?fd88","webpack:///./src/auth/login.vue?78c2","webpack:///./src/auth/logout.ts","webpack:///./src/core/components/load.vue?fc44","webpack:///./src/core/components/load.vue","webpack:///./src/core/components/load.vue?077f","webpack:///./src/core/components/load.vue?4c80","webpack:///./src/dashboard/main.vue?8e8e","webpack:///./src/dashboard/main.vue","webpack:///./src/dashboard/main.vue?d634","webpack:///./src/dashboard/main.vue?e361","webpack:///./src/game/game.vue?89b8","webpack:///./src/game/api/socket.ts","webpack:///./src/game/event-bus.ts","webpack:///./src/game/geom.ts","webpack:///./src/game/api/utils.ts","webpack:///./src/game/units.ts","webpack:///./src/game/utils.ts","webpack:///./src/game/store.ts","webpack:///./src/game/layers/manager.ts","webpack:///./src/game/visibility/te/triag.ts","webpack:///./src/game/shapes/boundingrect.ts","webpack:///./src/game/comm/conversion/aura.ts","webpack:///./src/game/visibility/bvh/node.ts","webpack:///./src/game/visibility/bvh/bvh.ts","webpack:///./src/game/visibility/te/tds.ts","webpack:///./src/game/visibility/te/pa.ts","webpack:///./src/game/visibility/te/cdt.ts","webpack:///./src/game/visibility/store.ts","webpack:///./src/game/shapes/shape.ts","webpack:///./src/game/ui/tools/utils.ts","webpack:///./src/game/shapes/baserect.ts","webpack:///./src/game/shapes/asset.ts","webpack:///./src/game/shapes/circle.ts","webpack:///./src/game/shapes/circulartoken.ts","webpack:///./src/game/shapes/line.ts","webpack:///./src/game/shapes/rect.ts","webpack:///./src/game/shapes/text.ts","webpack:///./src/game/shapes/polygon.ts","webpack:///./src/game/shapes/utils.ts","webpack:///./src/game/layers/layer.ts","webpack:///./src/game/settings.ts","webpack:///./src/game/visibility/te/draw.ts","webpack:///./src/game/visibility/te/te.ts","webpack:///./src/game/layers/fow.ts","webpack:///./src/game/layers/fowplayers.ts","webpack:///./src/game/layers/grid.ts","webpack:///./src/game/layers/utils.ts","webpack:///./src/game/ui/annotation.ts","webpack:///./src/game/manager.ts","webpack:///./src/game/api/events.ts","webpack:///./src/game/ui/initiative/initiative.vue?eb72","webpack:///./src/game/ui/initiative/store.ts","webpack:///./src/game/ui/initiative/initiative.vue","webpack:///./src/game/ui/initiative/initiative.vue?0bb3","webpack:///./src/game/ui/initiative/initiative.vue?a078","webpack:///./src/game/ui/labels.vue?508d","webpack:///./src/game/ui/labels.vue","webpack:///./src/game/ui/labels.vue?6343","webpack:///./src/game/ui/labels.vue?ca40","webpack:///./src/game/ui/menu/menu.vue?bb41","webpack:///./src/core/components/colorpicker.vue?3c29","webpack:///./src/core/components/colorpicker.vue","webpack:///./src/core/components/colorpicker.vue?6ea9","webpack:///./src/core/components/colorpicker.vue?c520","webpack:///./src/game/ui/menu/asset_node.vue?fa0c","webpack:///./src/game/ui/menu/asset_node.vue","webpack:///./src/game/ui/menu/asset_node.vue?2445","webpack:///./src/game/ui/menu/asset_node.vue?5a19","webpack:///./src/game/ui/menu/menu.vue","webpack:///./src/game/ui/menu/menu.vue?f4af","webpack:///./src/game/ui/menu/menu.vue?b559","webpack:///./src/game/ui/note.vue?9be8","webpack:///./src/game/ui/note.vue","webpack:///./src/game/ui/note.vue?0f0b","webpack:///./src/game/ui/note.vue?6eea","webpack:///./src/game/ui/selection/selection_info.vue?ac05","webpack:///./src/game/ui/selection/edit_dialog.vue?e5af","webpack:///./src/game/ui/selection/edit_dialog.vue","webpack:///./src/game/ui/selection/edit_dialog.vue?d8af","webpack:///./src/game/ui/selection/edit_dialog.vue?92f4","webpack:///./src/game/ui/selection/selection_info.vue","webpack:///./src/game/ui/selection/selection_info.vue?bb7e","webpack:///./src/game/ui/selection/selection_info.vue?e401","webpack:///./src/game/ui/tools/tools.vue?c577","webpack:///./src/game/ui/selection/shapecontext.vue?dff9","webpack:///./src/game/ui/selection/shapecontext.vue","webpack:///./src/game/ui/selection/shapecontext.vue?ca08","webpack:///./src/game/ui/selection/shapecontext.vue?7262","webpack:///./src/game/ui/tools/createtoken_modal.vue?54a3","webpack:///./src/game/ui/tools/createtoken_modal.vue","webpack:///./src/game/ui/tools/createtoken_modal.vue?37bd","webpack:///./src/game/ui/tools/createtoken_modal.vue?3843","webpack:///./src/game/ui/tools/defaultcontext.vue?c4e3","webpack:///./src/game/ui/tools/defaultcontext.vue","webpack:///./src/game/ui/tools/defaultcontext.vue?ac6e","webpack:///./src/game/ui/tools/defaultcontext.vue?18ab","webpack:///./src/game/ui/tools/draw.vue?e04b","webpack:///./src/game/ui/tools/tool.vue?bbda","webpack:///./src/game/ui/tools/tool.vue","webpack:///./src/game/ui/tools/tool.vue?61de","webpack:///./src/game/ui/tools/tool.vue?f2ee","webpack:///./src/game/ui/tools/draw.vue","webpack:///./src/game/ui/tools/draw.vue?e0b2","webpack:///./src/game/ui/tools/draw.vue?6c97","webpack:///./src/game/ui/tools/filter.vue?c1fa","webpack:///./src/core/components/accordion.vue?1e4a","webpack:///./src/core/components/accordion.vue","webpack:///./src/core/components/accordion.vue?c2ac","webpack:///./src/core/components/accordion.vue?6e66","webpack:///./src/game/ui/tools/filter.vue","webpack:///./src/game/ui/tools/filter.vue?ebd0","webpack:///./src/game/ui/tools/filter.vue?b8e2","webpack:///./src/game/ui/tools/map.vue?ca77","webpack:///./src/game/ui/tools/map.vue","webpack:///./src/game/ui/tools/map.vue?181e","webpack:///./src/game/ui/tools/map.vue?44ee","webpack:///./src/game/ui/tools/pan.ts","webpack:///./src/game/ui/tools/select.vue","webpack:///./src/game/ui/tools/select.vue?365a","webpack:///./src/game/ui/tools/select.vue?6a5f","webpack:///./src/game/ui/tools/vision.vue?85cd","webpack:///./src/game/ui/tools/vision.vue","webpack:///./src/game/ui/tools/vision.vue?afb5","webpack:///./src/game/ui/tools/vision.vue?f45e","webpack:///./src/game/ui/tools/ping.ts","webpack:///./src/game/ui/tools/ruler.ts","webpack:///./src/game/ui/tools/tools.vue","webpack:///./src/game/ui/tools/tools.vue?3d6d","webpack:///./src/game/ui/tools/tools.vue?6b18","webpack:///./src/game/ui/dmsettings.vue?5e62","webpack:///./src/core/components/inputCopy.vue?776a","webpack:///./src/core/components/inputCopy.vue","webpack:///./src/core/components/inputCopy.vue?8607","webpack:///./src/core/components/inputCopy.vue?9668","webpack:///./src/game/ui/dmsettings.vue","webpack:///./src/game/ui/dmsettings.vue?f453","webpack:///./src/game/ui/dmsettings.vue?c9bc","webpack:///./src/game/events/keyboard.ts","webpack:///./src/game/events/mouse.ts","webpack:///./src/game/game.vue","webpack:///./src/game/game.vue?fb7e","webpack:///./src/game/game.vue?1caf","webpack:///./src/invitation/invitation.ts","webpack:///./src/router.ts","webpack:///./src/main.ts","webpack:///./src/dashboard/main.vue?06a1","webpack:///./src/game/ui/tools/filter.vue?28ea","webpack:///./src/core/components/inputCopy.vue?26e0","webpack:///./src/core/components/modals/confirm.vue?c099"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","_vm","this","_h","$createElement","_c","_self","attrs","ref","staticRenderFns","script","component","_v","on","$event","preventDefault","moveDrag","stopPropagation","stopDrag","currentFolder","_l","dir","_s","idMap","upload","createDirectory","staticClass","prepareUpload","path","changeDirectory","leaveDrag","parentFolder","staticStyle","_e","class","selected","includes","select","$refs","cm","open","startDrag","file","file_hash","firstSelectedFile","visible","left","top","close","rename","remove","style","$emit","_t","props","use","rootStore","Store","root","files","folders","Map","console","log","dynamic","store","namespaced","assetStore","socket","location","protocol","host","autoConnect","destination","href","setRoot","folder","clear","children","child","set","id","asset","event","inode","parent","pageX","pageY","$nextTick","$children","$el","focus","prompt","then","emit","$forceUpdate","confirm","sel","indexOf","clearSelected","$parent","components","ContextMenu","scopedSlots","_u","fn","dragStart","dragEnd","title","yes","no","deny","directives","rawName","expression","mask","dragOver","colour","positioned","offsetX","offsetY","screenX","screenY","dragging","updatePosition","_event","container","offsetWidth","offsetHeight","innerWidth","innerHeight","dataTransfer","setData","setDragImage","clientX","clientY","parseInt","display","Boolean","type","default","String","resolve","_ok","reject","Promise","Modal","question","domProps","_k","keyCode","submit","target","composing","answer","_value","uuidv4","replace","Math","random","v","toString","alphSort","a","b","toLowerCase","partition","arr","predicate","ret","forEach","calcFontScale","ctx","text","fontWidth","measureText","width","fontSize","Number","font","split","cos","atan","draggingSelection","nextFolder","pop","delete","shiftKey","inodes","start","end","ctrlKey","dropEffect","classList","contains","add","moveInode","document","getElementById","click","fls","undefined","CHUNK_SIZE","uuid","slices","ceil","size","fr","FileReader","readAsArrayBuffer","min","onload","directory","totalSlices","Prompt","ConfirmDialog","AssetContextMenu","beforeRouteEnter","to","from","next","connect","beforeRouteLeave","disconnect","focusin","focusout","login","username","_m","password","register","error","authenticated","initialized","auth","init","coreStore","post","_response","setUsername","setAuthenticated","$router","$route","query","redirect","catch","response","statusText","nextElementSibling","span","opacity","registerHooks","message","owned","joined","room","encodeURIComponent","createRoom","newSessionName","vm","err","mouseleave","zoom","ready","mousedown","mouseup","mousemove","contextmenu","drop","showUI","layers","layer","selectedLayer","selectLayer","IS_DM","FAKE_PLAYER","zoomDisplay","toFixed","model","callback","$$v","createConnection","route","io","opts","decodeURIComponent","params","creator","EventBus","x","y","vec","constructor","other","dimension","point","Point","GlobalPoint","Vector","pow","sqrt","squaredLength","scale","atan2","PI","origin","direction","tMax","Infinity","t1","t2","distance","p1","p2","maxT","abs","Ray","sendClientOptions","locationOptions","g2l","obj","z","gameStore","zoomFactor","panX","panY","g2lx","g2ly","g2lz","getUnitDistance","unitSize","gridSize","g2lr","l2g","multiply","l2gx","l2gy","l2gz","getMouse","e","getFogColour","opposite","tc","fowColour","setAlpha","fowOpacity","toRgbString","zoomValue","exp","selectedLayerIndex","boardInitialized","locations","assets","notes","isLocked","roomName","roomCreator","invitationCode","players","gridColour","rulerColour","unitSizeUnit","useGrid","fullFOW","fowLOS","locationName","annotations","ownedtokens","_activeTokens","drawTEContour","visionRangeMin","visionRangeMax","clipboard","clipboardPosition","labels","filterNoLabel","labelFilters","selectionHelperID","layerManager","invalidate","label","filters","updatedLayers","Set","UUIDMap","values","shape","getLayer","isDM","code","index","sync","note","newZoomDisplay","oldLoc","zoomLocation","newLoc","diff","subtract","getGridLayer","drawGrid","increase","unit_size","unit_size_unit","gridLayer","canvas","use_grid","invalidateLight","vision_min_range","max","vision_max_range","full_fow","fow_opacity","fow_los","actualNote","find","filter","position","tokens","token","player","playerId","halfScreen","screenTopLeft","height","interval","drawLoop","draw","requestAnimationFrame","playerEditable","selectable","addLayer","some","found","globalAlpha","clearSelection","selection","getSelection","isVisionLayer","lm","IntersectionType","topleft","w","h","topLeft","topRight","botRight","botLeft","vector","BoundingRect","xmin","xmax","ymin","ymax","botright","ray","invDir","dirIsNeg","txmin","getDiagCorner","txmax","tymin","tymax","hit","coreVisible","aurasFromServer","auras","aura","visionSource","vision_source","dim","aurasToServer","nPrimitives","bbox","first","firstPrimOffset","c1","c2","union","shapes","totalNodes","buildData","orderedPrims","nodes","offset","getBoundingBox","center","recursiveBuild","compact","node","strokeRect","createLeaf","centroidBbox","getMaxExtent","pMid","partitionedData","flattened","concat","mid","stopOnFirstHit","intersect","tMin","todoOffset","nodeNum","todo","inverse","dirIsNegative","intersectP","secondChildOffset","flatten","myOffset","secondOffset","linearNode","leafNode","primitivesOffset","cw","ccw","edgeInfo","va","vb","ec","valid","indv","indexV","ri","vertices","infinite","vi","orient","orientation","Sign","COLLINEAR","collinearBetween","q","cPQ","cQR","compare","EQUAL","SMALLER","LARGER","px","py","qx","qy","rx","ry","pqx","pqy","prx","pry","det","determinant","maxX","maxY","aprX","aprY","ZERO","eps","EPSILON","POSITIVE","NEGATIVE","a00","a01","a10","a11","hasInexactNegativeOrientation","sideOfOrientedCircle","perturb","isInfinite","sideOfOrientedCircleP","Error","p0","os","getOrientedSide","ON_ORIENTED_BOUNDARY","points","sort","reverse","ON_NEGATIVE_SIDE","xyEqual","xySmaller","xyCompare","qpx","qpy","rpx","rpy","tpx","tpy","tqx","tqy","rqx","rqy","maxx","maxy","arpx","arpy","atqx","atqy","atpx","atpy","arqx","arqy","ON_POSITIVE_SIDE","segSegDoIntersectCrossing","p3","p4","LEFT_TURN","RIGHT_TURN","segSegDoIntersectContained","intersection","pa","pb","pc","pd","getIntersectionType","intersectionType","POINT","NO_INTERSECTION","getLine","doIntersect","l1","l2","info","getIntersectionTypeLine","la","lb","denom","nom1","nom2","A1","A2","B1","B2","nextUp","MAX_VALUE","MIN_VALUE","ulp","circleLineIntersection","circleCenter","circleRadius","A","B","segmentRay","fromPoints","circleLineRay","dot","intersectionPoints","_INFINITE_VERTEX","LineFaceState","INFINITE","newPoint","neighbours","constraints","uid","Triangle","_counter","vertex","triangle","sign","LocateType","_point","_ri","tds","edge","_es","second","pos","triangles","associatedEdge","increment","tr","UNDEFINED","_tr","fc","ic","vt","vr","pqr","prev","VERTEX_VERTEX","VERTEX_EDGE","EDGE_VERTEX","indexT","ni","EDGE_EDGE","TriangulationTarget","_infinite","createVertex","addVertex","infiniteVertex","v0","v1","v2","n0","n1","n2","trig","t0","i0","i1","setAdjacency","deleteList","copy","neighbour","lfit","reorient","mirrorIndex","i2","deleteTriangle","createTriangle","vCW","vCCW","tri","bl","bli","ff","vv","g","insertInFace","flip","ei","collect","x1","y1","x2","y2","dist","insert","insertConstraintV","stack","markConstraint","intersectionInfo","findIntersectedFaces","triangulateHole","intersectedFaces","listAB","listBA","edges","triangulateHole2","propagatingFlipE","triangulateHalfHole","fl","conflictBoundaries","iN","iT","ind","ind1","ind2","iC","current","newlf","isConstrained","vaa","vbb","aa","bb","lfc","lf","rf","unshift","previousFace","currentVertex","done","vcc","vdd","pi","dilate","overlaps","removeConstrainedEdge","indf","locateInfo","locate","iLocate","insertb","loc","lt","li","flipAround","propagatingFlip","depth","isFlipable","maxDepth","e1","e2","eni","indn","eI","edgeSet","lessEdge","findIndex","ed","tt","ii","u","t3","i3","t4","i4","insertInConstrainedEdge","EDGE","insertc","updateConstraintsIncident","VERTEX","clearConstraintsIncident","updateConstraintsOpposite","cwi","ccwi","insertFirst","finiteVertex","insertSecond","OUTSIDE_AFFINE_HULL","insertOutsideAffineHull","OUTSIDE_CONVEX_HULL","insertOutsideConvexHull","insertInEdge","FACE","insertDimUp","conform","finiteEdge","COUNTERCLOCKWISE","insertOutsideConvexHull2","ccwlist","cwlist","th","marchLocate1D","marchLocate2D","iv","pqt","leftFirst","o0","o1","o2","sum","nTurns","PA_CDT","vision","movement","triangulate","partial","cdt","visibilityStore","visionBlockers","movementblockers","sh","visibleInCanvas","isClosed","insertConstraint","CDT","BV","freeze","visionMode","visionSources","vision_mode","VISION","MOVEMENT","context","state","commit","refPoint","fillColour","strokeColour","nameVisible","trackers","_owners","visionObstruction","movementObstruction","isToken","showHighlight","annotation","globalCompositeOperation","options","_refPoint","_canvas","delta","entries","idx","fromArray","normalize","skipLightUpdate","recalculate","self","obstructionIndex","update","recalculateVision","au","ls","blocksMovement","recalculateMovement","ownedBy","type_","draw_operator","movement_obstruction","vision_obstruction","owners","fill_colour","stroke_colour","name_visible","is_token","JSON","stringify","parse","strokeStyle","beginPath","innerRange","fillStyle","gradient","createRadialGradient","addColorStop","lastPath","fill","arc","warn","moveTo","lineTo","stroke","group","source","has_img","effects","oldLayer","newLayer","activeTokens","owner","oldValue","newValue","ownerIndex","addOwner","calculateDelta","ogSelBBox","newSelBBox","refine","movementBlocker","blocker","blockerBBox","intersectsWithInner","bCenter","sCenter","ux","uy","dx","dy","centerTriangle","asArray","checkTriangle","skip","endpoint","_cw","_ccw","ix","newDelta","assign","centerPoint","targetX","targetY","gs","mx","my","round","resizePoint","topright","botleft","img","src","getBaseDict","drawImage","radius","borderWidth","lineWidth","save","dest","textAlign","textBaseline","fontScale","setTransform","tinycolor","toHexString","fillText","restore","startPoint","endPoint","line_width","_centerPoint","fillRect","angle","translate","rotate","getLines","map","line","_resizePoint","lines","lineHeight","widths","allLines","maxWidth","targetLine","words","word","testLine","metrics","testWidth","openPolygon","_vertices","open_polygon","lineCap","lineJoin","minx","miny","createShapeFromDict","rect","circ","polygon","Image","startsWith","URL","pathname","fromDict","copyShapes","asDict","setClipboard","setClipboardPosition","screenCenter","pasteShapes","targetLayer","clip","oldTrackers","tracker","newTracker","oldAuras","newAura","addShape","deleteShapes","removeShape","cutShapes","selectionColor","selectionWidth","getContext","temporary","checkVisionSources","setMovementBlock","serverShape","lsI","lbI","mbI","anI","annotationIndex","ownedIndex","clearRect","doClear","ogOP","has","drawAuras","drawSelection","destinationIndex","oldIdx","drawPolygon","dl","closePath","drawPolygonL","xx","local","yy","angleSteps","drawAngleLines","drawFirstLightHit","skipPlayerFOW","skipLightFOW","tempFill","I","J","drl","constrained","drawPolygonT","logs","T","fromP","toP","po","computeVisibility","drawt","Q","rawOutput","expandEdge","right","fh","nfh","nIndex","rIndex","lIndex","nvh","rvh","lvh","re","le","ro","lo","raySegIntersection","CLOCKWISE","denominator","ua","DP","DPL","DPT","preFogShapes","virtualCanvas","createElement","vCtx","originalOperation","dctx","hasLayer","lcenter","alm","light","auraLength","auraCircle","firstPoint","lastArcAngle","Path2D","anglePoint","sin","lightRay","hitResult","updateAuraPath","preShape","ogComposite","visibilityPolygon","lCenter","lRadius","firstAngle","lastAngle","ixs","np","pLoc","npLoc","lastIx","circleHitAngle","maxLength","tokenId","_doClear","createLayer","layerInfo","zIndex","player_editable","appendChild","setGridSize","setShapes","dropAsset","image","getData","shown","annotationText","annotationRect","getMaxWidth","getMaxHeight","selectedTool","annotationManager","oldShape","redrawInitiative","setIsToken","redraw","localPos","increasePanX","increasePanY","gameManager","_error","router","setRoomName","setRoomCreator","setInvitationCode","setIsLocked","setPlayers","addPlayer","setDM","setGridColour","grid_colour","setFOWColour","fow_colour","setRulerColour","ruler_colour","setPanX","pan_x","setPanY","pan_y","setZoomDisplay","zoom_factor","active_layer","setLocationName","setUnitSize","setUnitSizeUnit","setUseGrid","setFullFOW","setFOWOpacity","setLineOfSight","setVisionRangeMin","setVisionRangeMax","setVisionMode","setCenterPosition","newNote","setAssets","locationInfo","setLocations","innerHTML","resetLayerInfo","reset","setBoardInitialized","moveShapeOrder","moveLayer","updateShape","shapeIds","shapeId","realShape","addLabel","setLabelVisibility","deleteLabel","setLabelFilters","fakeSetData","$store","game","updateOrder","initiative","$set","actor","currentActor","cursor","toggleHighlight","modifiers","notAllowed","owns","_n","syncInitiative","createEffect","getDefaultEffect","toggleOption","removeInitiative","effect","updateEffect","turns","roundCounter","visionLock","toggleVisionLock","cameraLock","setRound","updateTurn","nextTurn","inInitiative","initiativeStore","actorId","$on","setTurn","getActor","$off","off","setCurrentActor","setActiveTokens","setRoundCounter","order","show","option","effectIndex","syncEffect","draggable","search","category","selectLabel","toggleVisibility","newCategory","trim","newName","user","cat","keys","localeCompare","settings","rm","transition","settingsClick","createNote","openNote","openDmSettings","getCurrentLocation","changeLocation","createLocation","currentTarget","transparent","color","closePicker","updateColor","chromePicker","val","rgba","setPosition","disabled","newColor","getBoundingClientRect","bottom","toggle","showImage","hash","el","imageSource","querySelector","__files","computed","updateNote","calcHeight","removeNote","textarea","scrollHeight","openEditDialog","changeValue","maxvalue","refInFor","setToken","Array","isArray","_i","$$a","$$el","$$c","checked","$$i","setVisionBlocker","setMovementBlocker","updateOwner","gridColumnStart","removeOwner","removeTracker","updateAuraColour","updateAuraVisionSource","removeAura","removeLabel","openLabelManager","updateAnnotation","addEmpty","hadAnnotation","an","_colour","editDialog","ogValue","isNaN","tool","toolVisible","currentTool","getActiveLayer","getLayers","setLayer","setLocation","moveToBack","moveToFront","addInitiative","getInitiativeWord","deleteSelection","hasSingleShape","every","newLocation","once","_data","_options","getInitiativeRepr","borderColour","updatePreview","_newValue","_oldValue","bringPlayers","createToken","showInitiative","createtokendialog","detailRight","detailArrow","modeSelect","shapeSelect","showBorderColour","closedPolygon","hasBrushSize","brushSize","active","onMouseDown","onMouseUp","onMouseMove","onContextMenu","onDeselect","onSelect","defaultcontext","brushHelper","ruler","modes","addEventListener","onKeyUp","removeEventListener","defaultPrevented","onModeChange","fowLayer","normalLayer","setupBrush","clone","helperSize","pushBrushBack","lastPoint","altKey","resizeToGrid","finaliseShape","initalValues","updateSelection","toggleDisplay","toggleCategory","showArrow","item","toggleSelection","initialValues","updateCategory","overall","items","indeterminate","toggleUnlabeledFilter","f","accordion","xCount","yCount","panStart","mouse","SelectOperations","showContextMenu","Noop","deltaChanged","dragRay","selectionStartPoint","selectionHelper","setSelectionHelperId","selectionStack","globalMouse","getPointIndex","Resize","Drag","localRefPoint","GroupSelect","og","ogDelta","resize","updateCursor","body","it","snapToGrid","shapecontext","getPointOrientation","removeActiveToken","addActiveToken","ping","border","diffsign","xdiff","ydiff","xmid","ymid","tools","dmTools","tagName","targetTool","button","buttons","setActiveText","watch","handleClick","kickPlayer","refreshState","invitationUrl","refreshInviteCode","toggleSessionLock","deleteSession","fakePlayer","changeVisionMode","visibility","showPopup","popupString","navigator","writeText","categories","showRefreshState","firstElementChild","HTMLInputElement","setFakePlayer","InputCopyElement","HTMLTextAreaElement","onKeyDown","hasSelection","toggleUI","scrollZoom","deltaY","updateZoom","manager","throttledmoveSet","throttledmove","resizeWindow","setWidth","setHeight","sessionUrl","template","base","routes","meta","beforeEach","matched","record","setInitialized","config","productionTip","devtools","performance","app","render","App","$mount"],"mappings":"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","file":"static/js/app-legacy.66e77954.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tools.vue?vue&type=style&index=0&id=5132142a&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tools.vue?vue&type=style&index=0&id=5132142a&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./colorpicker.vue?vue&type=style&index=0&id=e45ccc1a&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./colorpicker.vue?vue&type=style&index=0&id=e45ccc1a&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./prompt.vue?vue&type=style&index=0&id=391b52fc&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./prompt.vue?vue&type=style&index=0&id=391b52fc&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tool.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tool.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./game.vue?vue&type=style&index=1&id=ec4a3cb8&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./game.vue?vue&type=style&index=1&id=ec4a3cb8&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./shapecontext.vue?vue&type=style&index=0&id=623db654&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./shapecontext.vue?vue&type=style&index=0&id=623db654&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection_info.vue?vue&type=style&index=0&id=394cb731&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection_info.vue?vue&type=style&index=0&id=394cb731&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./draw.vue?vue&type=style&index=0&id=790caf6c&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./draw.vue?vue&type=style&index=0&id=790caf6c&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./createtoken_modal.vue?vue&type=style&index=0&id=b67b425c&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./createtoken_modal.vue?vue&type=style&index=0&id=b67b425c&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./asset_node.vue?vue&type=style&index=0&id=03f9ac64&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./asset_node.vue?vue&type=style&index=0&id=03f9ac64&scoped=true&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=style&index=0&id=986db5b0&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=style&index=0&id=986db5b0&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./note.vue?vue&type=style&index=0&id=3f88adb2&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./note.vue?vue&type=style&index=0&id=3f88adb2&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./filter.vue?vue&type=style&index=1&id=75b63661&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./filter.vue?vue&type=style&index=1&id=75b63661&scoped=true&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./game.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./game.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./dmsettings.vue?vue&type=style&index=0&id=61114102&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./dmsettings.vue?vue&type=style&index=0&id=61114102&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./edit_dialog.vue?vue&type=style&index=0&id=637f8f89&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./edit_dialog.vue?vue&type=style&index=0&id=637f8f89&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./modal.vue?vue&type=style&index=0&id=2098e4f8&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./modal.vue?vue&type=style&index=0&id=2098e4f8&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./vision.vue?vue&type=style&index=0&id=f995dfd4&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./vision.vue?vue&type=style&index=0&id=f995dfd4&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./menu.vue?vue&type=style&index=0&id=5fbaa291&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./menu.vue?vue&type=style&index=0&id=5fbaa291&scoped=true&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./manager.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./manager.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./contextmenu.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./contextmenu.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./initiative.vue?vue&type=style&index=0&id=3f1843d1&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./initiative.vue?vue&type=style&index=0&id=3f1843d1&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./defaultcontext.vue?vue&type=style&index=0&id=5943a1f0&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./defaultcontext.vue?vue&type=style&index=0&id=5943a1f0&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./accordion.vue?vue&type=style&index=0&id=32e257d0&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./accordion.vue?vue&type=style&index=0&id=32e257d0&scoped=true&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./labels.vue?vue&type=style&index=0&id=3261513c&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./labels.vue?vue&type=style&index=0&id=3261513c&scoped=true&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('router-view',{ref:\"activeComponent\"})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=b8715fa6&\"\nvar script = {}\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"AssetManager\"}},[_c('div',{attrs:{\"id\":\"titlebar\"}},[_vm._v(\"Asset Manager\")]),_c('div',{attrs:{\"id\":\"main\"}},[_c('div',{attrs:{\"id\":\"assets\"},on:{\"dragover\":function($event){$event.preventDefault();return _vm.moveDrag($event)},\"drop\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.stopDrag($event, _vm.currentFolder)}}},[_c('div',{attrs:{\"id\":\"breadcrumbs\"}},[_c('div',[_vm._v(\"/\")]),_vm._l((_vm.path),function(dir){return _c('div',{key:dir},[_vm._v(_vm._s(_vm.idMap.get(dir).name))])})],2),_c('div',{attrs:{\"id\":\"actionbar\"}},[_c('input',{attrs:{\"id\":\"files\",\"type\":\"file\",\"multiple\":\"\",\"hidden\":\"\"},on:{\"change\":function($event){return _vm.upload()}}}),_c('div',{attrs:{\"title\":\"Create folder\"},on:{\"click\":_vm.createDirectory}},[_c('i',{staticClass:\"fas fa-plus-square\"})]),_c('div',{attrs:{\"title\":\"Upload files\"},on:{\"click\":_vm.prepareUpload}},[_c('i',{staticClass:\"fas fa-upload\"})])]),_c('div',{attrs:{\"id\":\"explorer\"}},[(_vm.path.length)?_c('div',{staticClass:\"inode folder\",on:{\"dblclick\":function($event){return _vm.changeDirectory(-1)},\"dragover\":function($event){$event.preventDefault();return _vm.moveDrag($event)},\"dragleave\":function($event){$event.preventDefault();return _vm.leaveDrag($event)},\"drop\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.stopDrag($event, _vm.parentFolder)}}},[_c('i',{staticClass:\"fas fa-folder\",staticStyle:{\"font-size\":\"50px\"}}),_c('div',{staticClass:\"title\"},[_vm._v(\"..\")])]):_vm._e(),_vm._l((_vm.folders),function(key){return _c('div',{key:key,staticClass:\"inode folder\",class:{ 'inode-selected': _vm.selected.includes(key) },attrs:{\"draggable\":\"true\"},on:{\"click\":function($event){return _vm.select($event, key)},\"dblclick\":function($event){return _vm.changeDirectory(key)},\"contextmenu\":function($event){$event.preventDefault();return _vm.$refs.cm.open($event, key)},\"dragstart\":function($event){return _vm.startDrag($event, key)},\"dragover\":function($event){$event.preventDefault();return _vm.moveDrag($event)},\"dragleave\":function($event){$event.preventDefault();return _vm.leaveDrag($event)},\"drop\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.stopDrag($event, key)}}},[_c('i',{staticClass:\"fas fa-folder\",staticStyle:{\"font-size\":\"50px\"}}),_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.idMap.get(key).name))])])}),_vm._l((_vm.files),function(file){return _c('div',{key:file,staticClass:\"inode file\",class:{ 'inode-selected': _vm.selected.includes(file) },attrs:{\"draggable\":\"true\"},on:{\"click\":function($event){return _vm.select($event, file)},\"contextmenu\":function($event){$event.preventDefault();return _vm.$refs.cm.open($event, file)},\"dragstart\":function($event){return _vm.startDrag($event, file)}}},[_c('img',{attrs:{\"src\":'/static/assets/' + _vm.idMap.get(file).file_hash,\"width\":\"50\"}}),_c('div',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.idMap.get(file).name))])])})],2)]),(_vm.firstSelectedFile)?_c('div',{attrs:{\"id\":\"asset-details\"}},[_c('div',{attrs:{\"id\":\"asset-detail-title\"}},[_vm._v(_vm._s(_vm.firstSelectedFile.name))]),_c('img',{attrs:{\"src\":'/static/assets/' + _vm.firstSelectedFile.file_hash}})]):_vm._e()]),_c('AssetContextMenu',{ref:\"cm\"}),_c('Prompt',{ref:\"prompt\"}),_c('ConfirmDialog',{ref:\"confirm\"})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContextMenu',{attrs:{\"visible\":_vm.visible,\"left\":_vm.left + 'px',\"top\":_vm.top + 'px'},on:{\"close\":_vm.close}},[_c('li',{on:{\"click\":_vm.rename}},[_vm._v(\"Rename\")]),_c('li',{on:{\"click\":_vm.remove}},[_vm._v(\"Remove\")])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.visible)?_c('div',{staticClass:\"ContextMenu\",style:({ left: _vm.left, top: _vm.top }),attrs:{\"tabindex\":\"-1\"},on:{\"blur\":function($event){return _vm.$emit('close')}}},[_c('ul',[_vm._t(\"default\")],2)]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\n@Component({\r\n    props: [\"visible\", \"left\", \"top\"],\r\n})\r\nexport default class ContextMenu extends Vue {}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./contextmenu.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./contextmenu.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./contextmenu.vue?vue&type=template&id=67c4d20e&\"\nimport script from \"./contextmenu.vue?vue&type=script&lang=ts&\"\nexport * from \"./contextmenu.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./contextmenu.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import Vue from \"vue\";\r\nimport Vuex from \"vuex\";\r\n\r\nimport { AssetState } from \"@/assetManager/store\";\r\nimport { CoreState } from \"@/core/store\";\r\nimport { GameState } from \"@/game/store\";\r\nimport { InitiativeState } from \"./game/ui/initiative/store\";\r\nimport { VisibilityState } from \"./game/visibility/store\";\r\n\r\nVue.use(Vuex);\r\n\r\nexport interface RootState {\r\n    assets: AssetState;\r\n    core: CoreState;\r\n    game: GameState;\r\n    initiative: InitiativeState;\r\n    visibility: VisibilityState;\r\n}\r\n\r\nexport const rootStore = new Vuex.Store<RootState>({});\r\n","// import Vuex from \"vuex\";\r\nimport { getModule, Module, Mutation, VuexModule } from \"vuex-module-decorators\";\r\n\r\nimport { Asset } from \"@/core/comm/types\";\r\nimport { rootStore } from \"@/store\";\r\n\r\nexport interface AssetState {\r\n    root: number;\r\n    files: number[];\r\n    folders: number[];\r\n    idMap: Map<number, Asset>;\r\n    selected: number[];\r\n}\r\n\r\n@Module({ dynamic: true, store: rootStore, name: \"assets\", namespaced: true })\r\nclass AssetStore extends VuexModule {\r\n    root = -1;\r\n    files: number[] = [];\r\n    folders: number[] = [];\r\n    idMap: Map<number, Asset> = new Map();\r\n    selected: number[] = [];\r\n\r\n    @Mutation\r\n    clear(): void {\r\n        this.folders = [];\r\n        this.files = [];\r\n    }\r\n\r\n    @Mutation\r\n    clearSelected(): void {\r\n        console.log(\"Cleared\");\r\n        this.selected = [];\r\n    }\r\n\r\n    @Mutation\r\n    setRoot(root: number): void {\r\n        this.root = root;\r\n    }\r\n}\r\n\r\nexport const assetStore = getModule(AssetStore);\r\n","import io from \"socket.io-client\";\r\n\r\nimport { Asset } from \"@/core/comm/types\";\r\nimport { assetStore } from \"./store\";\r\n\r\nexport const socket = io(location.protocol + \"//\" + location.host + \"/pa_assetmgmt\", { autoConnect: false });\r\n\r\n// export const socket = io.connect(location.protocol + \"//\" + location.host + \"/pa_assetmgmt\");\r\nsocket.on(\"connect\", () => {\r\n    console.log(\"Connected\");\r\n});\r\nsocket.on(\"disconnect\", () => {\r\n    console.log(\"Disconnected\");\r\n});\r\nsocket.on(\"redirect\", (destination: string) => {\r\n    console.log(\"redirecting\");\r\n    window.location.href = destination;\r\n});\r\nsocket.on(\"Folder.Root.Set\", (root: number) => {\r\n    assetStore.setRoot(root);\r\n});\r\nsocket.on(\"Folder.Set\", (folder: Asset) => {\r\n    assetStore.clear();\r\n    if (folder.children) {\r\n        for (const child of folder.children) {\r\n            assetStore.idMap.set(child.id, child);\r\n            if (child.file_hash) {\r\n                assetStore.files.push(child.id);\r\n            } else {\r\n                assetStore.folders.push(child.id);\r\n            }\r\n        }\r\n    }\r\n});\r\nsocket.on(\"Folder.Create\", (folder: Asset) => {\r\n    assetStore.folders.push(folder.id);\r\n    assetStore.idMap.set(folder.id, folder);\r\n});\r\nsocket.on(\"Asset.Upload.Finish\", (asset: Asset) => {\r\n    assetStore.idMap.set(asset.id, asset);\r\n    assetStore.files.push(asset.id);\r\n});\r\n","\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\n\r\nimport Component from \"vue-class-component\";\r\n\r\nimport ContextMenu from \"@/core/components/contextmenu.vue\";\r\nimport ConfirmDialog from \"@/core/components/modals/confirm.vue\";\r\nimport Prompt from \"@/core/components/modals/prompt.vue\";\r\nimport AssetManager from \"./manager.vue\";\r\n\r\nimport { socket } from \"@/assetManager/socket\";\r\nimport { assetStore } from \"@/assetManager/store\";\r\n\r\n@Component({\r\n    components: {\r\n        ContextMenu,\r\n    },\r\n})\r\nexport default class AssetContextMenu extends Vue {\r\n    visible = false;\r\n    left = 0;\r\n    top = 0;\r\n\r\n    get parent(): AssetManager {\r\n        return <AssetManager>this.$parent;\r\n    }\r\n\r\n    open(event: MouseEvent, inode: number) {\r\n        if (!assetStore.selected.includes(inode)) this.parent.select(event, inode);\r\n\r\n        this.visible = true;\r\n        this.left = event.pageX;\r\n        this.top = event.pageY;\r\n        this.$nextTick(() => {\r\n            (<HTMLElement>this.$children[0].$el).focus();\r\n        });\r\n    }\r\n    close() {\r\n        this.visible = false;\r\n    }\r\n    rename() {\r\n        if (assetStore.selected.length !== 1) return;\r\n        const asset = assetStore.idMap.get(assetStore.selected[0])!;\r\n\r\n        (<Prompt>this.parent.$refs.prompt).prompt(\"New name:\", `Renaming ${asset.name}`).then(\r\n            (name: string) => {\r\n                socket.emit(\"Asset.Rename\", {\r\n                    asset: asset.id,\r\n                    name,\r\n                });\r\n                asset.name = name;\r\n                this.parent.$forceUpdate();\r\n            },\r\n            () => {},\r\n        );\r\n        this.close();\r\n    }\r\n    remove() {\r\n        if (assetStore.selected.length === 0) return;\r\n        (<ConfirmDialog>this.parent.$refs.confirm).open(\"Are you sure you wish to remove this?\").then(\r\n            (result: boolean) => {\r\n                if (result) {\r\n                    for (const sel of assetStore.selected) {\r\n                        socket.emit(\"Asset.Remove\", sel);\r\n                        if (assetStore.files.includes(sel)) assetStore.files.splice(assetStore.files.indexOf(sel), 1);\r\n                        else assetStore.folders.splice(assetStore.folders.indexOf(sel), 1);\r\n                    }\r\n                    assetStore.clearSelected();\r\n                }\r\n            },\r\n            () => {},\r\n        );\r\n        this.close();\r\n    }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./contextMenu.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./contextMenu.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./contextMenu.vue?vue&type=template&id=0d56a6e0&\"\nimport script from \"./contextMenu.vue?vue&type=script&lang=ts&\"\nexport * from \"./contextMenu.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('modal',{attrs:{\"visible\":_vm.visible},on:{\"close\":_vm.close},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_vm._v(\" \"+_vm._s(_vm.title)+\" \")])}}])},[_c('div',{staticClass:\"modal-body\"},[_c('button',{ref:\"confirm\",on:{\"click\":_vm.confirm}},[_vm._v(_vm._s(_vm.yes))]),(!!_vm.no)?_c('button',{on:{\"click\":_vm.deny}},[_vm._v(_vm._s(_vm.no))]):_vm._e()])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('transition',{attrs:{\"name\":\"modal\"}},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.visible),expression:\"visible\"}],staticClass:\"mask\",class:{ 'modal-mask': _vm.mask, 'dialog-mask': !_vm.mask },on:{\"click\":_vm.close,\"dragover\":function($event){$event.preventDefault();return _vm.dragOver($event)}}},[_c('div',{ref:\"container\",staticClass:\"modal-container\",style:({ 'background-color': _vm.colour }),on:{\"click\":function($event){$event.stopPropagation();}}},[_vm._t(\"header\",null,{\"dragStart\":_vm.dragStart,\"dragEnd\":_vm.dragEnd}),_vm._t(\"default\")],2)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\nimport { Prop } from \"vue-property-decorator\";\r\n\r\n@Component\r\nexport default class Modal extends Vue {\r\n    @Prop(Boolean) visible!: boolean;\r\n    @Prop({ type: Boolean, default: true }) mask!: boolean;\r\n    @Prop({ type: String, default: \"white\" }) colour!: string;\r\n\r\n    $refs!: {\r\n        container: HTMLElement;\r\n    };\r\n\r\n    positioned = false;\r\n    offsetX = 0;\r\n    offsetY = 0;\r\n    screenX = 0;\r\n    screenY = 0;\r\n    dragging = false;\r\n\r\n    // Example of mounted required: opening note\r\n    mounted() {\r\n        this.updatePosition();\r\n    }\r\n    // Example of updated required: opening initiative\r\n    updated() {\r\n        this.updatePosition();\r\n    }\r\n\r\n    close(_event: MouseEvent) {\r\n        this.$emit(\"close\");\r\n    }\r\n    updatePosition() {\r\n        if (!this.positioned) {\r\n            const container = <any>this.$refs.container;\r\n            if (container.offsetWidth === 0 && container.offsetHeight === 0) return;\r\n            this.$refs.container.style.left = (window.innerWidth - container.offsetWidth) / 2 + \"px\";\r\n            this.$refs.container.style.top = (window.innerHeight - container.offsetHeight) / 2 + \"px\";\r\n            this.positioned = true;\r\n        }\r\n    }\r\n    dragStart(event: DragEvent) {\r\n        if (event === null || event.dataTransfer === null) return;\r\n        event.dataTransfer.setData(\"Hack\", \"\");\r\n        // Because the drag event is happening on the header, we have to change the drag image\r\n        // in order to give the impression that the entire modal is dragged.\r\n        event.dataTransfer.setDragImage(<Element>this.$refs.container, event.offsetX, event.offsetY);\r\n        this.offsetX = event.offsetX;\r\n        this.offsetY = event.offsetY;\r\n        this.screenX = event.screenX;\r\n        this.screenY = event.screenY;\r\n        this.dragging = true;\r\n    }\r\n    dragEnd(event: DragEvent) {\r\n        this.dragging = false;\r\n        let left = event.clientX - this.offsetX;\r\n        let top = event.clientY - this.offsetY;\r\n        if (event.clientX === 0 && event.clientY === 0 && event.pageX === 0 && event.pageY === 0) {\r\n            left = parseInt(this.$refs.container.style.left!, 10) - (this.screenX - event.screenX);\r\n            top = parseInt(this.$refs.container.style.top!, 10) - (this.screenY - event.screenY);\r\n        }\r\n        if (left < 0) left = 0;\r\n        if (left > window.innerWidth - 100) left = window.innerWidth - 100;\r\n        if (top < 0) top = 0;\r\n        if (top > window.innerHeight - 100) top = window.innerHeight - 100;\r\n        this.$refs.container.style.left = left + \"px\";\r\n        this.$refs.container.style.top = top + \"px\";\r\n        this.$refs.container.style.display = \"block\";\r\n    }\r\n    dragOver(_event: DragEvent) {\r\n        if (this.dragging) this.$refs.container.style.display = \"none\";\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./modal.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./modal.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./modal.vue?vue&type=template&id=2098e4f8&scoped=true&\"\nimport script from \"./modal.vue?vue&type=script&lang=ts&\"\nexport * from \"./modal.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./modal.vue?vue&type=style&index=0&id=2098e4f8&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2098e4f8\",\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\n@Component({\r\n    components: {\r\n        Modal,\r\n    },\r\n})\r\nexport default class ConfirmDialog extends Vue {\r\n    $refs!: {\r\n        confirm: HTMLButtonElement;\r\n    };\r\n\r\n    visible = false;\r\n    yes = \"Yes\";\r\n    no = \"No\";\r\n    title = \"\";\r\n\r\n    resolve = (_ok: boolean) => {};\r\n    reject = () => {};\r\n\r\n    confirm() {\r\n        this.resolve(true);\r\n        this.close();\r\n    }\r\n    deny() {\r\n        this.resolve(false);\r\n        this.close();\r\n    }\r\n    close() {\r\n        this.reject();\r\n        this.visible = false;\r\n        this.title = \"\";\r\n    }\r\n    open(title: string, yes = \"yes\", no = \"no\"): Promise<boolean> {\r\n        this.yes = yes;\r\n        this.no = no;\r\n        this.title = title;\r\n\r\n        this.visible = true;\r\n        this.$nextTick(() => {\r\n            this.$refs.confirm.focus();\r\n        });\r\n\r\n        return new Promise((resolve, reject) => {\r\n            this.resolve = resolve;\r\n            this.reject = reject;\r\n        });\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./confirm.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./confirm.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./confirm.vue?vue&type=template&id=46dc898b&scoped=true&\"\nimport script from \"./confirm.vue?vue&type=script&lang=ts&\"\nexport * from \"./confirm.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./confirm.vue?vue&type=style&index=0&id=46dc898b&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"46dc898b\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Modal',{attrs:{\"visible\":_vm.visible},on:{\"close\":_vm.close},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_vm._v(\" \"+_vm._s(_vm.title)+\" \")])}}])},[_c('div',{staticClass:\"modal-body\"},[_vm._v(\" \"+_vm._s(_vm.question)+\" \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.answer),expression:\"answer\"}],ref:\"answer\",attrs:{\"type\":\"text\"},domProps:{\"value\":(_vm.answer)},on:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.submit($event)},\"input\":function($event){if($event.target.composing){ return; }_vm.answer=$event.target.value}}})]),_c('div',{staticClass:\"modal-footer\"},[_c('button',{on:{\"click\":_vm.submit}},[_vm._v(\"Submit\")])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\n@Component({\r\n    components: {\r\n        Modal,\r\n    },\r\n})\r\nexport default class Prompt extends Vue {\r\n    $refs!: {\r\n        answer: HTMLElement;\r\n    };\r\n\r\n    visible = false;\r\n    question = \"\";\r\n    answer = \"\";\r\n    title = \"\";\r\n\r\n    resolve = (_value: string) => {};\r\n    reject = () => {};\r\n\r\n    submit() {\r\n        this.resolve(this.answer);\r\n        this.close();\r\n    }\r\n    close() {\r\n        this.reject();\r\n        this.visible = false;\r\n        this.question = \"\";\r\n        this.answer = \"\";\r\n        this.title = \"\";\r\n    }\r\n    prompt(question: string, title: string): Promise<string> {\r\n        this.question = question;\r\n        this.title = title;\r\n        this.visible = true;\r\n        this.$nextTick(() => {\r\n            this.$refs.answer.focus();\r\n        });\r\n        return new Promise((resolve, reject) => {\r\n            this.resolve = resolve;\r\n            this.reject = reject;\r\n        });\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./prompt.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./prompt.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./prompt.vue?vue&type=template&id=391b52fc&scoped=true&\"\nimport script from \"./prompt.vue?vue&type=script&lang=ts&\"\nexport * from \"./prompt.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./prompt.vue?vue&type=style&index=0&id=391b52fc&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"391b52fc\",\n  null\n  \n)\n\nexport default component.exports","// Reference: https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\r\nexport function uuidv4(): string {\r\n    return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, c => {\r\n        const r = (Math.random() * 16) | 0;\r\n        const v = c === \"x\" ? r : (r & 0x3) | 0x8;\r\n        return v.toString(16);\r\n    });\r\n}\r\n\r\nexport function capitalize(text: string): string {\r\n    return text.charAt(0).toUpperCase() + text.slice(1);\r\n}\r\n\r\nexport function alphSort(a: string, b: string): number {\r\n    if (a.toLowerCase() < b.toLowerCase()) return -1;\r\n    else return 1;\r\n}\r\n\r\nexport function getHTMLFont(element: HTMLElement): string {\r\n    let font = element.style.font;\r\n    while (font === null && element.parentElement !== null) {\r\n        element = element.parentElement;\r\n        font = element.style.font;\r\n    }\r\n    if (font === null) font = window.getComputedStyle(document.body).getPropertyValue(\"font\");\r\n    return font;\r\n}\r\n\r\nexport function getHTMLTextWidth(text: string, font: string): number {\r\n    let fakeElement = <HTMLCanvasElement>document.getElementById(\"emptycanvas\");\r\n    if (fakeElement === null) {\r\n        fakeElement = document.createElement(\"canvas\");\r\n        fakeElement.id = \"emptycanvas\";\r\n        fakeElement.style.display = \"\";\r\n        document.body.appendChild(fakeElement);\r\n    }\r\n    const ctx = fakeElement.getContext(\"2d\")!;\r\n    ctx.font = font;\r\n    return Math.ceil(ctx.measureText(text).width);\r\n}\r\n\r\nexport function partition<T>(arr: T[], predicate: (n: T) => boolean): T[][] {\r\n    const ret: T[][] = [[], []];\r\n    arr.forEach(n => (predicate(n) ? ret[1].push(n) : ret[0].push(n)));\r\n    return ret;\r\n}\r\n\r\nexport function calcFontScale(ctx: CanvasRenderingContext2D, text: string, r: number): number {\r\n    const fontWidth = ctx.measureText(text).width;\r\n    const fontSize = Number(ctx.font.split(\"px\")[0]) * 1.5;\r\n    return (Math.cos(Math.atan(fontSize / fontWidth)) * 2 * r) / fontWidth;\r\n}\r\n\r\nexport function fixedEncodeURIComponent(str: string): string {\r\n    return encodeURIComponent(str).replace(/[!'()*]/g, c => {\r\n        return \"%\" + c.charCodeAt(0).toString(16);\r\n    });\r\n}\r\n\r\nexport class OrderedMap<K, V> {\r\n    keys: K[] = [];\r\n    values: V[] = [];\r\n\r\n    get length(): number {\r\n        return this.keys.length;\r\n    }\r\n\r\n    get(key: K): V {\r\n        return this.values[this.keys.indexOf(key)];\r\n    }\r\n    getIndexValue(idx: number): V {\r\n        return this.values[idx];\r\n    }\r\n    getIndexKey(idx: number): K {\r\n        return this.keys[idx];\r\n    }\r\n    set(key: K, value: V): void {\r\n        this.keys.push(key);\r\n        this.values.push(value);\r\n    }\r\n    has(key: K): boolean {\r\n        return this.indexOf(key) >= 0;\r\n    }\r\n    indexOf(element: K): number {\r\n        return this.keys.indexOf(element);\r\n    }\r\n    remove(element: K): void {\r\n        const idx = this.indexOf(element);\r\n        this.keys.splice(idx, 1);\r\n        this.values.splice(idx, 1);\r\n    }\r\n}\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport AssetContextMenu from \"@/assetManager/contextMenu.vue\";\r\nimport ConfirmDialog from \"@/core/components/modals/confirm.vue\";\r\nimport Prompt from \"@/core/components/modals/prompt.vue\";\r\n\r\nimport { socket } from \"@/assetManager/socket\";\r\nimport { assetStore } from \"@/assetManager/store\";\r\nimport { Asset } from \"@/core/comm/types\";\r\nimport { uuidv4 } from \"@/core/utils\";\r\n\r\n@Component({\r\n    components: {\r\n        Prompt,\r\n        ConfirmDialog,\r\n        AssetContextMenu,\r\n    },\r\n    beforeRouteEnter(to, from, next) {\r\n        socket.connect();\r\n        next();\r\n    },\r\n    beforeRouteLeave(to, from, next) {\r\n        socket.disconnect();\r\n        next();\r\n    },\r\n})\r\nexport default class AssetManager extends Vue {\r\n    path: number[] = [];\r\n    draggingSelection = false;\r\n\r\n    get folders(): number[] {\r\n        return assetStore.folders;\r\n    }\r\n\r\n    get files(): number[] {\r\n        return assetStore.files;\r\n    }\r\n\r\n    get selected(): number[] {\r\n        return assetStore.selected;\r\n    }\r\n\r\n    get idMap() {\r\n        return assetStore.idMap;\r\n    }\r\n\r\n    get currentFolder(): number {\r\n        if (this.path.length) return this.path[this.path.length - 1];\r\n        return assetStore.root;\r\n    }\r\n    get parentFolder(): number {\r\n        let parent = this.path[this.path.length - 2];\r\n        if (parent === undefined) parent = assetStore.root;\r\n        return parent;\r\n    }\r\n    get firstSelectedFile(): Asset | null {\r\n        for (const sel of assetStore.selected) {\r\n            if (assetStore.idMap.get(sel)!.file_hash) {\r\n                return assetStore.idMap.get(sel)!;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    changeDirectory(nextFolder: number) {\r\n        if (nextFolder < 0) this.path.pop();\r\n        else this.path.push(nextFolder);\r\n        assetStore.clearSelected();\r\n        socket.emit(\"Folder.Get\", this.currentFolder);\r\n    }\r\n    createDirectory() {\r\n        const name = window.prompt(\"New folder name\");\r\n        if (name !== null) {\r\n            socket.emit(\"Folder.Create\", { name, parent: this.currentFolder });\r\n        }\r\n    }\r\n    moveInode(inode: number, target: number) {\r\n        if (assetStore.files.includes(inode)) assetStore.files.splice(assetStore.files.indexOf(inode), 1);\r\n        else assetStore.folders.splice(assetStore.folders.indexOf(inode), 1);\r\n        assetStore.idMap.delete(inode);\r\n        socket.emit(\"Inode.Move\", { inode, target });\r\n    }\r\n    select(event: MouseEvent, inode: number) {\r\n        if (event.shiftKey && assetStore.selected.length > 0) {\r\n            const inodes = [...assetStore.files, ...assetStore.folders];\r\n            const start = inodes.indexOf(assetStore.selected[assetStore.selected.length - 1]);\r\n            const end = inodes.indexOf(inode);\r\n            for (let i = start; i !== end; start < end ? i++ : i--) {\r\n                if (i === start) continue;\r\n                assetStore.selected.push(inodes[i]);\r\n            }\r\n            assetStore.selected.push(inodes[end]);\r\n        } else {\r\n            if (!event.ctrlKey) {\r\n                assetStore.clearSelected();\r\n            }\r\n            assetStore.selected.push(inode);\r\n        }\r\n    }\r\n    startDrag(event: DragEvent, file: number) {\r\n        if (event.dataTransfer === null) return;\r\n        event.dataTransfer.setData(\"Hack\", \"ittyHack\");\r\n        event.dataTransfer.dropEffect = \"move\";\r\n        if (!assetStore.selected.includes(file)) assetStore.selected.push(file);\r\n        this.draggingSelection = true;\r\n    }\r\n    moveDrag(event: DragEvent) {\r\n        if ((<HTMLElement>event.target).classList.contains(\"folder\"))\r\n            (<HTMLElement>event.target).classList.add(\"inode-selected\");\r\n    }\r\n    leaveDrag(event: DragEvent) {\r\n        if ((<HTMLElement>event.target).classList.contains(\"folder\"))\r\n            (<HTMLElement>event.target).classList.remove(\"inode-selected\");\r\n    }\r\n    stopDrag(event: DragEvent, target: number) {\r\n        (<HTMLElement>event.target).classList.remove(\"inode-selected\");\r\n        if (this.draggingSelection) {\r\n            if (\r\n                (target === assetStore.root || assetStore.folders.includes(target)) &&\r\n                !assetStore.selected.includes(target)\r\n            ) {\r\n                for (const inode of assetStore.selected) {\r\n                    this.moveInode(inode, target);\r\n                }\r\n            }\r\n            assetStore.clearSelected();\r\n        } else if (event.dataTransfer && event.dataTransfer.files.length > 0) {\r\n            this.upload(event.dataTransfer.files, target);\r\n        }\r\n        this.draggingSelection = false;\r\n    }\r\n    prepareUpload() {\r\n        document.getElementById(\"files\")!.click();\r\n    }\r\n    upload(fls?: FileList, target?: number) {\r\n        const files = (<HTMLInputElement>document.getElementById(\"files\")!).files;\r\n        if (fls === undefined) {\r\n            if (files) fls = files;\r\n            else return;\r\n        }\r\n        if (target === undefined) target = this.currentFolder;\r\n        const CHUNK_SIZE = 100000;\r\n        for (const file of fls) {\r\n            const uuid = uuidv4();\r\n            const slices = Math.ceil(file.size / CHUNK_SIZE);\r\n            for (let slice = 0; slice < slices; slice++) {\r\n                const fr = new FileReader();\r\n                fr.readAsArrayBuffer(\r\n                    file.slice(\r\n                        slice * CHUNK_SIZE,\r\n                        slice * CHUNK_SIZE + Math.min(CHUNK_SIZE, file.size - slice * CHUNK_SIZE),\r\n                    ),\r\n                );\r\n                fr.onload = _e => {\r\n                    socket.emit(\"Asset.Upload\", {\r\n                        name: file.name,\r\n                        directory: target,\r\n                        data: fr.result,\r\n                        slice,\r\n                        totalSlices: slices,\r\n                        uuid,\r\n                    });\r\n                };\r\n            }\r\n        }\r\n    }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./manager.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./manager.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./manager.vue?vue&type=template&id=299e7717&\"\nimport script from \"./manager.vue?vue&type=script&lang=ts&\"\nexport * from \"./manager.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./manager.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('form',{on:{\"focusin\":_vm.focusin,\"focusout\":_vm.focusout,\"submit\":function($event){$event.preventDefault();return _vm.login($event)}}},[_c('fieldset',[_c('legend',{staticClass:\"legend\"},[_vm._v(\"PlanarAlly\")]),_c('div',{staticClass:\"input\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.username),expression:\"username\"}],attrs:{\"type\":\"text\",\"name\":\"username\",\"placeholder\":\"Username\",\"autocomplete\":\"username\",\"required\":\"\",\"autofocus\":\"\"},domProps:{\"value\":(_vm.username)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.username=$event.target.value}}}),_vm._m(0)]),_c('div',{staticClass:\"input\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.password),expression:\"password\"}],attrs:{\"type\":\"password\",\"name\":\"password\",\"placeholder\":\"Password\",\"autocomplete\":\"current-password\",\"required\":\"\"},domProps:{\"value\":(_vm.password)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.password=$event.target.value}}}),_vm._m(1)]),_c('div',{staticStyle:{\"display\":\"flex\"}},[_c('button',{staticStyle:{\"visibility\":\"hidden\",\"display\":\"none\"},attrs:{\"type\":\"submit\",\"name\":\"login\"}}),_c('button',{staticClass:\"submit\",attrs:{\"type\":\"button\",\"name\":\"register\",\"title\":\"Register\"},on:{\"click\":_vm.register}},[_c('i',{staticClass:\"fas fa-plus\"})]),_vm._m(2)])]),(_vm.error)?_c('div',{staticClass:\"feedback\"},[_c('p',{staticClass:\"error\"},[_c('strong',[_vm._v(\"Error:\")]),_vm._v(\" \"+_vm._s(_vm.error)+\" \")])]):_vm._e()])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',[_c('i',{staticClass:\"fas fa-user-circle\"})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',[_c('i',{staticClass:\"fas fa-lock\"})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('button',{staticClass:\"submit\",attrs:{\"type\":\"submit\",\"name\":\"login\",\"title\":\"Login\"}},[_c('i',{staticClass:\"fas fa-arrow-right\"})])}]\n\nexport { render, staticRenderFns }","import { getModule, Module, Mutation, VuexModule } from \"vuex-module-decorators\";\r\n\r\nimport { rootStore } from \"@/store\";\r\n\r\nexport interface CoreState {\r\n    authenticated: boolean;\r\n    initialized: boolean;\r\n    username: string;\r\n}\r\n\r\n@Module({ dynamic: true, store: rootStore, name: \"core\" })\r\nclass CoreStore extends VuexModule implements CoreState {\r\n    authenticated = false;\r\n    initialized = false;\r\n    username = \"\";\r\n\r\n    @Mutation\r\n    setAuthenticated(auth: boolean): void {\r\n        this.authenticated = auth;\r\n    }\r\n\r\n    @Mutation\r\n    setInitialized(init: boolean): void {\r\n        this.initialized = init;\r\n    }\r\n\r\n    @Mutation\r\n    setUsername(username: string): void {\r\n        this.username = username;\r\n    }\r\n}\r\n\r\nexport const coreStore = getModule(CoreStore);\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport axios, { AxiosError, AxiosResponse } from \"axios\";\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { coreStore } from \"@/core/store\";\r\n\r\n@Component\r\nexport default class Login extends Vue {\r\n    username = \"\";\r\n    password = \"\";\r\n    error = \"\";\r\n\r\n    login() {\r\n        axios\r\n            .post(\"/api/login\", {\r\n                username: this.username,\r\n                password: this.password,\r\n            })\r\n            .then((_response: AxiosResponse) => {\r\n                coreStore.setUsername(this.username);\r\n                coreStore.setAuthenticated(true);\r\n                this.$router.push(<string>this.$route.query.redirect || \"/\");\r\n            })\r\n            .catch((error: AxiosError) => {\r\n                if (error.response) this.error = error.response.statusText;\r\n                else this.error = \"Unknown error occured\";\r\n            });\r\n    }\r\n\r\n    register() {\r\n        axios\r\n            .post(\"/api/register\", {\r\n                username: this.username,\r\n                password: this.password,\r\n            })\r\n            .then((_response: AxiosResponse) => {\r\n                coreStore.setUsername(this.username);\r\n                coreStore.setAuthenticated(true);\r\n                this.$router.push(<string>this.$route.query.redirect || \"/\");\r\n            })\r\n            .catch((error: AxiosError) => {\r\n                if (error.response) this.error = error.response.statusText;\r\n                else this.error = \"Unknown error occured\";\r\n            });\r\n    }\r\n\r\n    focusin(event: { target?: { nextElementSibling?: HTMLElement } }) {\r\n        if (event.target && event.target.nextElementSibling) {\r\n            const span = event.target.nextElementSibling;\r\n            span.style.opacity = \"0\";\r\n        }\r\n    }\r\n\r\n    focusout(event: { target?: { nextElementSibling?: HTMLElement } }) {\r\n        if (event.target && event.target.nextElementSibling) {\r\n            const span = event.target.nextElementSibling;\r\n            span.style.opacity = \"1\";\r\n        }\r\n    }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./login.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./login.vue?vue&type=template&id=986db5b0&scoped=true&\"\nimport script from \"./login.vue?vue&type=script&lang=ts&\"\nexport * from \"./login.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./login.vue?vue&type=style&index=0&id=986db5b0&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"986db5b0\",\n  null\n  \n)\n\nexport default component.exports","import Axios from \"axios\";\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\nimport { Route } from \"vue-router\";\r\n\r\nimport { coreStore } from \"@/core/store\";\r\n\r\nComponent.registerHooks([\"beforeRouteEnter\"]);\r\n\r\n@Component({})\r\nexport default class Logout extends Vue {\r\n    // eslint-disable-next-line no-empty-pattern\r\n    beforeRouteEnter(to: Route, from: Route, next: ({}) => {}): void {\r\n        Axios.post(\"/api/logout\").then(() => {\r\n            coreStore.setAuthenticated(false);\r\n            coreStore.setUsername(\"\");\r\n            next({ path: \"/auth/login\" });\r\n        });\r\n    }\r\n}\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_vm._v(_vm._s(_vm.message))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\n@Component\r\nexport default class LoadComponent extends Vue {\r\n    message = \"Loading...\";\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./load.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./load.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./load.vue?vue&type=template&id=6d2dfb9c&\"\nimport script from \"./load.vue?vue&type=script&lang=ts&\"\nexport * from \"./load.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"formcontainer\"}},[(_vm.owned || _vm.joined)?_c('form',[_c('fieldset',[_c('legend',{staticClass:\"legend\"},[_vm._v(\"Your sessions\")]),_c('div',{staticClass:\"input\"},[_vm._l((_vm.owned),function(room,i){return _c('router-link',{key:'o-' + i,attrs:{\"to\":'/game/' + encodeURIComponent(room[1]) + '/' + encodeURIComponent(room[0])}},[_vm._v(\" \"+_vm._s(room[0])+\" \")])}),_vm._l((_vm.joined),function(room,i){return _c('router-link',{key:'j-' + i,attrs:{\"to\":'/game/' + encodeURIComponent(room[1]) + '/' + encodeURIComponent(room[0])}},[_vm._v(\" \"+_vm._s(room[1])+\"/\"+_vm._s(room[0])+\" \")])})],2),(_vm.owned.length === 0)?_c('div',{staticClass:\"input\"},[_vm._v(\"No active sessions\")]):_vm._e()])]):_vm._e(),_vm._m(0),_c('form',{on:{\"submit\":function($event){$event.preventDefault();return _vm.createRoom($event)}}},[_c('fieldset',[(!_vm.owned && !_vm.joined)?_c('legend',{staticClass:\"legend\"},[_vm._v(\"Create a session\")]):_c('div',{staticClass:\"input\"},[_vm._v(\"Create a new session\")]),_c('div',{staticClass:\"input\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.newSessionName),expression:\"newSessionName\"}],attrs:{\"type\":\"text\",\"name\":\"room_name\",\"placeholder\":\"Session Name\"},domProps:{\"value\":(_vm.newSessionName)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.newSessionName=$event.target.value}}}),_vm._m(1)]),_vm._m(2)])]),_c('div',{attrs:{\"id\":\"account-options\"}},[_c('form',{on:{\"submit\":function($event){$event.preventDefault();}}},[_c('router-link',{staticClass:\"submit\",attrs:{\"tag\":\"button\",\"title\":\"Account Settings\",\"to\":\"/account\"}},[_c('i',{staticClass:\"fas fa-cog\"})])],1),_c('form',{on:{\"submit\":function($event){$event.preventDefault();}}},[_c('router-link',{staticClass:\"submit\",attrs:{\"tag\":\"button\",\"title\":\"Logout\",\"to\":\"/auth/logout\"}},[_c('i',{staticClass:\"fas fa-sign-out-alt\"})])],1)])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h4',[_c('span',[_vm._v(\"OR\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',[_c('i',{staticClass:\"fab fa-d-and-d\"})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('button',{staticClass:\"submit\",attrs:{\"type\":\"submit\",\"title\":\"Create\"}},[_c('i',{staticClass:\"fas fa-arrow-right\"})])}]\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport axios, { AxiosError, AxiosResponse } from \"axios\";\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\nimport { Route } from \"vue-router\";\r\n\r\nimport { coreStore } from \"@/core/store\";\r\n\r\nComponent.registerHooks([\"beforeRouteEnter\"]);\r\n\r\n@Component\r\nexport default class Dashboard extends Vue {\r\n    owned = [];\r\n    joined = [];\r\n    error = \"\";\r\n\r\n    newSessionName = \"\";\r\n\r\n    // eslint-disable-next-line no-empty-pattern\r\n    beforeRouteEnter(to: Route, from: Route, next: ({}) => {}) {\r\n        axios\r\n            .get(\"/api/rooms\")\r\n            .then((response: AxiosResponse) => {\r\n                next((vm: this) => {\r\n                    vm.owned = response.data.owned;\r\n                    vm.joined = response.data.joined;\r\n                });\r\n            })\r\n            .catch((err: AxiosError) => {\r\n                next((vm: this) => {\r\n                    vm.error = err.message;\r\n                });\r\n            });\r\n    }\r\n\r\n    createRoom(_event: Event) {\r\n        axios\r\n            .post(\"/api/rooms\", {\r\n                name: this.newSessionName,\r\n            })\r\n            .then((_response: AxiosResponse) => {\r\n                this.$router.push(\r\n                    `/game/${encodeURIComponent(coreStore.username)}/${encodeURIComponent(this.newSessionName)}`,\r\n                );\r\n            })\r\n            .catch((err: AxiosError) => {\r\n                this.error = err.message;\r\n            });\r\n    }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./main.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./main.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./main.vue?vue&type=template&id=f34c77ee&scoped=true&\"\nimport script from \"./main.vue?vue&type=script&lang=ts&\"\nexport * from \"./main.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./main.vue?vue&type=style&index=0&id=f34c77ee&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f34c77ee\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"main\"},on:{\"mouseleave\":_vm.mouseleave,\"wheel\":_vm.zoom}},[(_vm.showUI)?_c('menu-bar'):_vm._e(),_c('div',{attrs:{\"id\":\"board\"}},[(_vm.ready.manager)?[_c('tool-bar',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showUI),expression:\"showUI\"}],ref:\"tools\"})]:_vm._e(),_c('div',{attrs:{\"id\":\"layers\"},on:{\"mousedown\":_vm.mousedown,\"mouseup\":_vm.mouseup,\"mousemove\":_vm.mousemove,\"contextmenu\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.contextmenu($event)},\"dragover\":function($event){$event.preventDefault();},\"drop\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.drop($event)}}}),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showUI && _vm.layers.length > 1),expression:\"showUI && layers.length > 1\"}],attrs:{\"id\":\"layerselect\"}},[_c('ul',_vm._l((_vm.layers),function(layer){return _c('li',{key:layer.name,class:{ 'layer-selected': layer === _vm.selectedLayer },on:{\"mousedown\":function($event){return _vm.selectLayer(layer)}}},[_c('a',{attrs:{\"href\":\"#\"}},[_vm._v(_vm._s(layer))])])}),0)])],2),_c('selection-info',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showUI),expression:\"showUI\"}],ref:\"selectionInfo\"}),_c('initiative-dialog',{ref:\"initiative\",attrs:{\"id\":\"initiativedialog\"}}),_c('note-dialog',{ref:\"note\"}),_c('label-dialog',{ref:\"labels\"}),(_vm.IS_DM || _vm.FAKE_PLAYER)?_c('dm-settings',{ref:\"dmsettings\"}):_vm._e(),_c('zoom-slider',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showUI),expression:\"showUI\"}],attrs:{\"id\":\"zoomer\",\"height\":6,\"width\":200,\"min\":0,\"max\":1,\"interval\":0.1,\"dot-size\":[8, 20],\"dot-options\":{ style: { 'border-radius': '15%', 'z-index': 11 } },\"tooltip-placement\":'bottom',\"tooltip\":'focus',\"tooltip-formatter\":_vm.zoomDisplay.toFixed(1),\"rail-style\":{ 'background-color': '#fff', 'box-shadow': '0.5px 0.5px 3px 1px rgba(0, 0, 0, .36)' },\"process-style\":{ 'background-color': '#fff' }},model:{value:(_vm.zoomDisplay),callback:function ($$v) {_vm.zoomDisplay=$$v},expression:\"zoomDisplay\"}}),_c('prompt-dialog',{ref:\"prompt\"}),_c('confirm-dialog',{ref:\"confirm\"})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import io from \"socket.io-client\";\r\nimport { Route } from \"vue-router\";\r\n\r\nexport const socket = io(location.protocol + \"//\" + location.host + \"/planarally\", { autoConnect: false });\r\n\r\nexport function createConnection(route: Route): void {\r\n    socket.io.opts.query = `user=${decodeURIComponent(route.params.creator)}&room=${decodeURIComponent(\r\n        route.params.room,\r\n    )}`;\r\n    socket.connect();\r\n}\r\n","import Vue from \"vue\";\r\nexport const EventBus = new Vue();\r\n","/*\r\nThis module defines some Point classes.\r\nA strong focus is made to ensure that at no time a global and a local point are mixed up with each other.\r\nAt first glance this adds weird looking hacks as ts does not support nominal typing.\r\n*/\r\n\r\nexport function getPointDistance(p1: Point, p2: Point): number {\r\n    const a = p1.x - p2.x;\r\n    const b = p1.y - p2.y;\r\n    return Math.sqrt(a * a + b * b);\r\n}\r\n\r\nexport class Point {\r\n    readonly x: number;\r\n    readonly y: number;\r\n    constructor(x: number, y: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n    static fromArray(point: number[]): Point {\r\n        return new Point(point[0], point[1]);\r\n    }\r\n    add(vec: Vector): this {\r\n        return new (this as any).constructor(this.x + vec.x, this.y + vec.y);\r\n    }\r\n    subtract(other: this): Vector {\r\n        return new Vector(this.x - other.x, this.y - other.y);\r\n    }\r\n    clone(): this {\r\n        return new (this as any).constructor(this.x, this.y);\r\n    }\r\n    get(dimension: 0 | 1): number {\r\n        if (dimension === 0) return this.x;\r\n        return this.y;\r\n    }\r\n    asArray(): number[] {\r\n        return [this.x, this.y];\r\n    }\r\n}\r\nexport class GlobalPoint extends Point {\r\n    // This is to differentiate with LocalPoint, is actually never used\r\n    // We do ! to prevent errors that it never gets initialized\r\n    // tslint:disable-next-line:variable-name\r\n    _GlobalPoint!: string;\r\n    static fromArray(point: number[]): GlobalPoint {\r\n        return new GlobalPoint(point[0], point[1]);\r\n    }\r\n}\r\n\r\nexport class LocalPoint extends Point {\r\n    // This is to differentiate with GlobalPoint, is actually never used\r\n    // We do ! to prevent errors that it never gets initialized\r\n    // tslint:disable-next-line:variable-name\r\n    _LocalPoint!: string;\r\n}\r\n\r\nexport class Vector {\r\n    readonly x: number;\r\n    readonly y: number;\r\n    constructor(x: number, y: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n    dot(other: Vector): number {\r\n        return this.x * other.x + this.y * other.y;\r\n    }\r\n    inverse(): Vector {\r\n        return new Vector(this.x === 0 ? 0 : 1 / this.x, this.y === 0 ? 0 : 1 / this.y);\r\n    }\r\n    squaredLength(): number {\r\n        return Math.pow(this.x, 2) + Math.pow(this.y, 2);\r\n    }\r\n    length(): number {\r\n        return Math.sqrt(this.squaredLength());\r\n    }\r\n    normalize(): Vector {\r\n        const l = this.length();\r\n        return new Vector(this.x / l, this.y / l);\r\n    }\r\n    reverse(): Vector {\r\n        return new Vector(-this.x, -this.y);\r\n    }\r\n    multiply(scale: number): Vector {\r\n        return new Vector(this.x * scale, this.y * scale);\r\n    }\r\n    angle(): number {\r\n        return (Math.atan2(this.y, this.x) * 180) / Math.PI;\r\n    }\r\n}\r\n\r\nexport class Ray<T extends Point> {\r\n    readonly direction: Vector;\r\n    readonly origin: T;\r\n    tMax: number;\r\n    constructor(origin: T, direction: Vector, tMax?: number) {\r\n        this.direction = direction;\r\n        this.origin = origin;\r\n        if (tMax === undefined) tMax = Infinity;\r\n        this.tMax = tMax;\r\n    }\r\n    static fromPoints<T extends Point>(p1: T, p2: T): Ray<T> {\r\n        const vec = new Vector(p2.x - p1.x, p2.y - p1.y);\r\n        let maxT;\r\n        if (Math.abs(vec.x) > 0.01) maxT = (p2.x - p1.x) / vec.x;\r\n        else maxT = (p2.y - p1.y) / vec.y;\r\n        return new Ray(p1, vec, maxT);\r\n    }\r\n    get(t: number): T {\r\n        return <T>new Point(this.origin.x + t * this.direction.x, this.origin.y + t * this.direction.y);\r\n    }\r\n    getDistance(t1: number, t2: number): number {\r\n        return Math.sqrt(Math.pow(t2 - t1, 2) * (Math.pow(this.direction.x, 2) + Math.pow(this.direction.y, 2)));\r\n    }\r\n    getT(t1: number, distance: number): number {\r\n        return t1 + Math.sqrt(Math.pow(distance, 2) / (Math.pow(this.direction.x, 2) + Math.pow(this.direction.y, 2)));\r\n    }\r\n}\r\n","import { socket } from \"@/game/api/socket\";\r\n\r\nexport function sendClientOptions(locationOptions: { panX: number; panY: number; zoomFactor: number }): void {\r\n    socket.emit(\"Client.Options.Set\", { locationOptions });\r\n}\r\n","import { GlobalPoint, LocalPoint, Ray } from \"@/game/geom\";\r\nimport { gameStore } from \"@/game/store\";\r\n\r\nexport function g2l(obj: GlobalPoint): LocalPoint {\r\n    const z = gameStore.zoomFactor;\r\n    const panX = gameStore.panX;\r\n    const panY = gameStore.panY;\r\n    return new LocalPoint((obj.x + panX) * z, (obj.y + panY) * z);\r\n}\r\n\r\nexport function g2lx(x: number): number {\r\n    return g2l(new GlobalPoint(x, 0)).x;\r\n}\r\n\r\nexport function g2ly(y: number): number {\r\n    return g2l(new GlobalPoint(0, y)).y;\r\n}\r\n\r\nexport function g2lz(z: number): number {\r\n    return z * gameStore.zoomFactor;\r\n}\r\n\r\nexport function getUnitDistance(r: number): number {\r\n    return (r / gameStore.unitSize) * gameStore.gridSize;\r\n}\r\n\r\nexport function g2lr(r: number): number {\r\n    return g2lz(getUnitDistance(r));\r\n}\r\n\r\nexport function l2g(obj: LocalPoint): GlobalPoint;\r\nexport function l2g(obj: Ray<LocalPoint>): Ray<GlobalPoint>;\r\nexport function l2g(obj: LocalPoint | Ray<LocalPoint>): GlobalPoint | Ray<GlobalPoint> {\r\n    const z = gameStore.zoomFactor;\r\n    const panX = gameStore.panX;\r\n    const panY = gameStore.panY;\r\n    if (obj instanceof LocalPoint) {\r\n        return new GlobalPoint(obj.x / z - panX, obj.y / z - panY);\r\n    } else {\r\n        return new Ray<GlobalPoint>(l2g(obj.origin), obj.direction.multiply(1 / z), obj.tMax);\r\n    }\r\n}\r\n\r\nexport function l2gx(x: number): number {\r\n    return l2g(new LocalPoint(x, 0)).x;\r\n}\r\n\r\nexport function l2gy(y: number): number {\r\n    return l2g(new LocalPoint(0, y)).y;\r\n}\r\n\r\nexport function l2gz(z: number): number {\r\n    return z / gameStore.zoomFactor;\r\n}\r\n\r\nexport function l2gr(r: number): number {\r\n    return l2gz(getUnitDistance(r));\r\n}\r\n\r\n(<any>window).g2lx = g2lx;\r\n(<any>window).g2ly = g2ly;\r\n","import tinycolor from \"tinycolor2\";\r\n\r\nimport { LocalPoint } from \"@/game/geom\";\r\nimport { gameStore } from \"./store\";\r\n\r\nexport function getMouse(e: MouseEvent): LocalPoint {\r\n    return new LocalPoint(e.pageX, e.pageY);\r\n}\r\n\r\nexport function getFogColour(opposite: boolean = false): string {\r\n    const tc = tinycolor(gameStore.fowColour);\r\n    if (gameStore.IS_DM) tc.setAlpha(opposite ? 1 : gameStore.fowOpacity);\r\n    else tc.setAlpha(1);\r\n    return tc.toRgbString();\r\n}\r\n\r\nexport function zoomValue(display: number): number {\r\n    // Powercurve 0.2/3/10\r\n    // Based on https://stackoverflow.com/a/17102320\r\n    return 1 / (-5 / 3 + (28 / 15) * Math.exp(1.83 * display));\r\n}\r\n\r\nexport function zoomDisplay(value: number): number {\r\n    return Math.log((1 / value + 5 / 3) * (15 / 28)) / 1.83;\r\n}\r\n","import Vue from \"vue\";\r\nimport { rootStore } from \"@/store\";\r\nimport { getModule, Module, Mutation, VuexModule } from \"vuex-module-decorators\";\r\n\r\nimport { AssetList } from \"@/core/comm/types\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { sendClientOptions } from \"@/game/api/utils\";\r\nimport { Note } from \"@/game/comm/types/general\";\r\nimport { ServerShape } from \"@/game/comm/types/shapes\";\r\nimport { GlobalPoint, Vector } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { g2l, l2g } from \"@/game/units\";\r\nimport { zoomValue } from \"@/game/utils\";\r\n\r\nexport interface LocationOptions {\r\n    panX: number;\r\n    panY: number;\r\n    zoomFactor: number;\r\n}\r\n\r\nexport interface GameState {\r\n    boardInitialized: boolean;\r\n}\r\n\r\n@Module({ dynamic: true, store: rootStore, name: \"game\", namespaced: true })\r\nclass GameStore extends VuexModule implements GameState {\r\n    // This is a limited view of selectable layers that is used to generate the layer selection UI and ability to switch layers\r\n    // See the layerManager for proper layer management tools\r\n    layers: string[] = [];\r\n    selectedLayerIndex = -1;\r\n    boardInitialized = false;\r\n\r\n    locations: string[] = [];\r\n\r\n    assets: AssetList = {};\r\n\r\n    notes: Note[] = [];\r\n\r\n    IS_DM = false;\r\n    FAKE_PLAYER = false;\r\n    isLocked = false;\r\n    gridSize = 50;\r\n    username = \"\";\r\n    roomName = \"\";\r\n    roomCreator = \"\";\r\n    invitationCode = \"\";\r\n    players: { id: number; name: string }[] = [];\r\n\r\n    gridColour = \"rgba(0, 0, 0, 1)\";\r\n    fowColour = \"rgba(0, 0, 0, 1)\";\r\n    rulerColour = \"rgba(255, 0, 0, 1)\";\r\n    panX = 0;\r\n    panY = 0;\r\n\r\n    zoomDisplay = 0.5;\r\n    // zoomFactor = 1;\r\n\r\n    unitSize = 5;\r\n    unitSizeUnit = \"ft\";\r\n    useGrid = true;\r\n    fullFOW = false;\r\n    fowOpacity = 0.3;\r\n    fowLOS = false;\r\n    locationName = \"\";\r\n\r\n    annotations: string[] = [];\r\n    ownedtokens: string[] = [];\r\n    _activeTokens: string[] = [];\r\n\r\n    drawTEContour = false;\r\n    visionRangeMin = 1640;\r\n    visionRangeMax = 3281;\r\n\r\n    clipboard: ServerShape[] = [];\r\n    clipboardPosition: GlobalPoint = new GlobalPoint(0, 0);\r\n\r\n    // Maps are not yet supported in Vue untill 3.X, so for now we're using a plain old object\r\n    labels: { [uuid: string]: Label } = {};\r\n\r\n    filterNoLabel = false;\r\n    labelFilters: string[] = [];\r\n\r\n    showUI = true;\r\n\r\n    selectionHelperID: string | null = null;\r\n\r\n    get selectedLayer(): string {\r\n        return this.layers[this.selectedLayerIndex];\r\n    }\r\n\r\n    get zoomFactor(): number {\r\n        return zoomValue(this.zoomDisplay);\r\n    }\r\n\r\n    get locationOptions(): LocationOptions {\r\n        return {\r\n            panX: gameStore.panX,\r\n            panY: gameStore.panY,\r\n            zoomFactor: gameStore.zoomFactor,\r\n        };\r\n    }\r\n\r\n    get activeTokens(): string[] {\r\n        if (this._activeTokens.length === 0) return this.ownedtokens;\r\n        return this._activeTokens;\r\n    }\r\n\r\n    get screenTopLeft(): GlobalPoint {\r\n        return new GlobalPoint(-this.panX, -this.panY);\r\n    }\r\n\r\n    get screenCenter(): GlobalPoint {\r\n        const halfScreen = new Vector(window.innerWidth / 2, window.innerHeight / 2);\r\n        return l2g(g2l(this.screenTopLeft).add(halfScreen));\r\n    }\r\n\r\n    @Mutation\r\n    setSelectionHelperId(id: string): void {\r\n        this.selectionHelperID = id;\r\n    }\r\n\r\n    @Mutation\r\n    setFakePlayer(value: boolean): void {\r\n        this.FAKE_PLAYER = value;\r\n        this.IS_DM = !value;\r\n        layerManager.invalidate();\r\n    }\r\n\r\n    @Mutation\r\n    setZoomDisplay(zoom: number): void {\r\n        if (zoom === this.zoomDisplay) return;\r\n        if (zoom < 0) zoom = 0;\r\n        if (zoom > 1) zoom = 1;\r\n        this.zoomDisplay = zoom;\r\n        layerManager.invalidate();\r\n    }\r\n\r\n    @Mutation\r\n    setBoardInitialized(boardInitialized: boolean): void {\r\n        this.boardInitialized = boardInitialized;\r\n    }\r\n\r\n    @Mutation\r\n    toggleUnlabeledFilter(): void {\r\n        this.filterNoLabel = !this.filterNoLabel;\r\n    }\r\n\r\n    @Mutation\r\n    addLabel(label: Label): void {\r\n        Vue.set(this.labels, label.uuid, label);\r\n    }\r\n\r\n    @Mutation\r\n    setLabelFilters(filters: string[]): void {\r\n        this.labelFilters = filters;\r\n    }\r\n\r\n    @Mutation\r\n    setLabelVisibility(data: { user: string; uuid: string; visible: boolean }): void {\r\n        if (!(data.uuid in this.labels)) return;\r\n        this.labels[data.uuid].visible = data.visible;\r\n    }\r\n\r\n    @Mutation\r\n    deleteLabel(data: { uuid: string; user: string }): void {\r\n        if (!(data.uuid in this.labels)) return;\r\n        const label = this.labels[data.uuid];\r\n        const updatedLayers: Set<string> = new Set();\r\n        for (const shape of layerManager.UUIDMap.values()) {\r\n            const i = shape.labels.indexOf(label);\r\n            if (i >= 0) {\r\n                shape.labels.splice(i, 1);\r\n                updatedLayers.add(shape.layer);\r\n            }\r\n        }\r\n        for (const layer of updatedLayers) layerManager.getLayer(layer)!.invalidate(false);\r\n        Vue.delete(this.labels, data.uuid);\r\n    }\r\n\r\n    @Mutation\r\n    setDM(isDM: boolean): void {\r\n        this.IS_DM = isDM;\r\n    }\r\n\r\n    @Mutation\r\n    setUsername(username: string): void {\r\n        this.username = username;\r\n    }\r\n\r\n    @Mutation\r\n    setRoomName(name: string): void {\r\n        this.roomName = name;\r\n    }\r\n\r\n    @Mutation\r\n    setRoomCreator(name: string): void {\r\n        this.roomCreator = name;\r\n    }\r\n\r\n    @Mutation\r\n    setInvitationCode(code: string): void {\r\n        this.invitationCode = code;\r\n    }\r\n\r\n    @Mutation\r\n    addLayer(name: string): void {\r\n        this.layers.push(name);\r\n        if (this.selectedLayerIndex === -1) this.selectedLayerIndex = this.layers.indexOf(name);\r\n    }\r\n\r\n    @Mutation\r\n    selectLayer(data: { name: string; sync: boolean }): void {\r\n        const index = this.layers.indexOf(data.name);\r\n        if (index >= 0) this.selectedLayerIndex = index;\r\n        if (data.sync) socket.emit(\"Client.ActiveLayer.Set\", data.name);\r\n    }\r\n\r\n    @Mutation\r\n    newNote(data: { note: Note; sync: boolean }): void {\r\n        this.notes.push(data.note);\r\n        if (data.sync) socket.emit(\"Note.New\", data.note);\r\n    }\r\n\r\n    @Mutation\r\n    setAssets(assets: AssetList): void {\r\n        this.assets = assets;\r\n    }\r\n\r\n    @Mutation\r\n    setLocations(locations: string[]): void {\r\n        this.locations = locations;\r\n    }\r\n\r\n    @Mutation\r\n    resetLayerInfo(): void {\r\n        this.layers = [];\r\n        this.selectedLayerIndex = -1;\r\n    }\r\n\r\n    @Mutation\r\n    updateZoom(data: { newZoomDisplay: number; zoomLocation: GlobalPoint }): void {\r\n        if (data.newZoomDisplay === this.zoomDisplay) return;\r\n        if (data.newZoomDisplay < 0) data.newZoomDisplay = 0;\r\n        if (data.newZoomDisplay > 1) data.newZoomDisplay = 1;\r\n        const oldLoc = g2l(data.zoomLocation);\r\n        this.zoomDisplay = data.newZoomDisplay;\r\n        const newLoc = l2g(oldLoc);\r\n        // Change the pan settings to keep the zoomLocation in the same exact location before and after the zoom.\r\n        const diff = newLoc.subtract(data.zoomLocation);\r\n        this.panX += diff.x;\r\n        this.panY += diff.y;\r\n        layerManager.invalidate();\r\n        sendClientOptions(gameStore.locationOptions);\r\n    }\r\n\r\n    @Mutation\r\n    setGridColour(data: { colour: string; sync: boolean }): void {\r\n        this.gridColour = data.colour;\r\n        layerManager.getGridLayer()!.drawGrid();\r\n        if (data.sync) socket.emit(\"Client.Options.Set\", { gridColour: data.colour });\r\n    }\r\n\r\n    @Mutation\r\n    setFOWColour(data: { colour: string; sync: boolean }): void {\r\n        this.fowColour = data.colour;\r\n        layerManager.invalidate();\r\n        if (data.sync) socket.emit(\"Client.Options.Set\", { fowColour: data.colour });\r\n    }\r\n\r\n    @Mutation\r\n    setRulerColour(data: { colour: string; sync: boolean }): void {\r\n        this.rulerColour = data.colour;\r\n        if (data.sync) socket.emit(\"Client.Options.Set\", { rulerColour: data.colour });\r\n    }\r\n\r\n    @Mutation\r\n    setPanX(x: number): void {\r\n        this.panX = x;\r\n    }\r\n\r\n    @Mutation\r\n    setPanY(y: number): void {\r\n        this.panY = y;\r\n    }\r\n\r\n    @Mutation\r\n    increasePanX(increase: number): void {\r\n        this.panX += increase;\r\n    }\r\n\r\n    @Mutation\r\n    increasePanY(increase: number): void {\r\n        this.panY += increase;\r\n    }\r\n\r\n    @Mutation\r\n    setUnitSize(data: { unitSize: number; sync: boolean }): void {\r\n        if (this.unitSize !== data.unitSize && data.unitSize > 0 && data.unitSize < Infinity) {\r\n            this.unitSize = data.unitSize;\r\n            layerManager.invalidate();\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            if (data.sync) socket.emit(\"Location.Options.Set\", { unit_size: data.unitSize });\r\n        }\r\n    }\r\n\r\n    @Mutation\r\n    setUnitSizeUnit(data: { unitSizeUnit: string; sync: boolean }): void {\r\n        if (this.unitSizeUnit !== data.unitSizeUnit) {\r\n            this.unitSizeUnit = data.unitSizeUnit;\r\n            layerManager.invalidate();\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            if (data.sync) socket.emit(\"Location.Options.Set\", { unit_size_unit: data.unitSizeUnit });\r\n        }\r\n    }\r\n\r\n    @Mutation\r\n    setUseGrid(data: { useGrid: boolean; sync: boolean }): void {\r\n        if (this.useGrid !== data.useGrid) {\r\n            this.useGrid = data.useGrid;\r\n            const gridLayer = layerManager.getGridLayer()!;\r\n            if (data.useGrid) gridLayer.canvas.style.display = \"block\";\r\n            else gridLayer.canvas.style.display = \"none\";\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            if (data.sync) socket.emit(\"Location.Options.Set\", { use_grid: data.useGrid });\r\n        }\r\n    }\r\n\r\n    @Mutation\r\n    setGridSize(data: { gridSize: number; sync: boolean }): void {\r\n        if (this.gridSize !== data.gridSize && data.gridSize > 0) {\r\n            this.gridSize = data.gridSize;\r\n            const gridLayer = layerManager.getGridLayer();\r\n            if (gridLayer !== undefined) gridLayer.drawGrid();\r\n            if (data.sync) socket.emit(\"Gridsize.Set\", data.gridSize);\r\n        }\r\n    }\r\n\r\n    @Mutation\r\n    setVisionRangeMin(data: { value: number; sync: boolean }): void {\r\n        this.visionRangeMin = data.value;\r\n        layerManager.invalidateLight();\r\n        // eslint-disable-next-line @typescript-eslint/camelcase\r\n        if (data.sync) socket.emit(\"Location.Options.Set\", { vision_min_range: data.value });\r\n    }\r\n\r\n    @Mutation\r\n    setVisionRangeMax(data: { value: number; sync: boolean }): void {\r\n        this.visionRangeMax = Math.max(data.value, this.visionRangeMin);\r\n        layerManager.invalidateLight();\r\n        // eslint-disable-next-line @typescript-eslint/camelcase\r\n        if (data.sync) socket.emit(\"Location.Options.Set\", { vision_max_range: this.visionRangeMax });\r\n    }\r\n\r\n    @Mutation\r\n    setFullFOW(data: { fullFOW: boolean; sync: boolean }): void {\r\n        if (this.fullFOW !== data.fullFOW) {\r\n            this.fullFOW = data.fullFOW;\r\n            layerManager.invalidateLight();\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            if (data.sync) socket.emit(\"Location.Options.Set\", { full_fow: data.fullFOW });\r\n        }\r\n    }\r\n\r\n    @Mutation\r\n    setFOWOpacity(data: { fowOpacity: number; sync: boolean }): void {\r\n        this.fowOpacity = data.fowOpacity;\r\n        layerManager.invalidateLight();\r\n        // eslint-disable-next-line @typescript-eslint/camelcase\r\n        if (data.sync) socket.emit(\"Location.Options.Set\", { fow_opacity: data.fowOpacity });\r\n    }\r\n\r\n    @Mutation\r\n    setLineOfSight(data: { fowLOS: boolean; sync: boolean }): void {\r\n        if (this.fowLOS !== data.fowLOS) {\r\n            this.fowLOS = data.fowLOS;\r\n            layerManager.invalidate();\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            if (data.sync) socket.emit(\"Location.Options.Set\", { fow_los: data.fowLOS });\r\n        }\r\n    }\r\n\r\n    @Mutation\r\n    setLocationName(name: string): void {\r\n        this.locationName = name;\r\n    }\r\n\r\n    @Mutation\r\n    updateNote(data: { note: Note; sync: boolean }): void {\r\n        const actualNote = this.notes.find(n => n.uuid === data.note.uuid);\r\n        if (actualNote === undefined) return;\r\n        actualNote.title = data.note.title;\r\n        actualNote.text = data.note.text;\r\n        if (data.sync) socket.emit(\"Note.Update\", actualNote);\r\n    }\r\n\r\n    @Mutation\r\n    removeNote(data: { note: Note; sync: boolean }): void {\r\n        this.notes = this.notes.filter(n => n.uuid !== data.note.uuid);\r\n        if (data.sync) socket.emit(\"Note.Remove\", data.note.uuid);\r\n    }\r\n\r\n    @Mutation\r\n    toggleUI(): void {\r\n        this.showUI = !this.showUI;\r\n    }\r\n\r\n    @Mutation\r\n    setClipboard(clipboard: ServerShape[]): void {\r\n        this.clipboard = clipboard;\r\n    }\r\n\r\n    @Mutation\r\n    setClipboardPosition(position: GlobalPoint): void {\r\n        this.clipboardPosition = position;\r\n    }\r\n\r\n    @Mutation\r\n    setActiveTokens(tokens: string[]): void {\r\n        this._activeTokens = tokens;\r\n        layerManager.invalidateLight();\r\n    }\r\n\r\n    @Mutation\r\n    addActiveToken(token: string): void {\r\n        this._activeTokens.push(token);\r\n        layerManager.invalidateLight();\r\n    }\r\n\r\n    @Mutation\r\n    removeActiveToken(token: string): void {\r\n        if (this._activeTokens.length === 0) {\r\n            this._activeTokens = [...this.ownedtokens];\r\n        }\r\n        this._activeTokens.splice(this._activeTokens.indexOf(token), 1);\r\n        layerManager.invalidateLight();\r\n    }\r\n\r\n    @Mutation\r\n    setPlayers(players: { id: number; name: string }[]): void {\r\n        this.players = players;\r\n    }\r\n\r\n    @Mutation\r\n    addPlayer(player: { id: number; name: string }): void {\r\n        this.players.push(player);\r\n    }\r\n\r\n    @Mutation\r\n    kickPlayer(playerId: number): void {\r\n        this.players = this.players.filter(p => p.id !== playerId);\r\n    }\r\n\r\n    @Mutation\r\n    setIsLocked(data: { isLocked: boolean; sync: boolean }): void {\r\n        this.isLocked = data.isLocked;\r\n        if (data.sync) {\r\n            socket.emit(\"Room.Info.Set.Locked\", this.isLocked);\r\n        }\r\n    }\r\n\r\n    @Mutation\r\n    clear(): void {\r\n        this.ownedtokens = [];\r\n        this.annotations = [];\r\n        this.notes = [];\r\n    }\r\n}\r\n\r\nexport const gameStore = getModule(GameStore);\r\n","import { GridLayer } from \"@/game/layers/grid\";\r\nimport { Layer } from \"@/game/layers/layer\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\n\r\nclass LayerManager {\r\n    layers: Layer[] = [];\r\n    width = window.innerWidth;\r\n    height = window.innerHeight;\r\n\r\n    UUIDMap: Map<string, Shape> = new Map();\r\n\r\n    // Refresh interval and redraw setter.\r\n    interval = 30;\r\n\r\n    constructor() {\r\n        requestAnimationFrame(this.drawLoop);\r\n    }\r\n\r\n    reset(): void {\r\n        this.layers = [];\r\n        this.UUIDMap = new Map();\r\n    }\r\n\r\n    drawLoop = () => {\r\n        for (let i = this.layers.length - 1; i >= 0; i--) {\r\n            this.layers[i].draw();\r\n        }\r\n        requestAnimationFrame(this.drawLoop);\r\n    };\r\n\r\n    setWidth(width: number): void {\r\n        this.width = width;\r\n        for (const layer of this.layers) {\r\n            layer.canvas.width = width;\r\n            layer.width = width;\r\n        }\r\n    }\r\n\r\n    setHeight(height: number): void {\r\n        this.height = height;\r\n        for (const layer of this.layers) {\r\n            layer.canvas.height = height;\r\n            layer.height = height;\r\n        }\r\n    }\r\n\r\n    addLayer(layer: Layer): void {\r\n        this.layers.push(layer);\r\n        if (!gameStore.IS_DM && !layer.playerEditable) return;\r\n        if (layer.selectable) gameStore.addLayer(layer.name);\r\n    }\r\n\r\n    hasLayer(name: string): boolean {\r\n        return this.layers.some(l => l.name === name);\r\n    }\r\n\r\n    getLayer(name?: string): Layer | undefined {\r\n        name = name === undefined ? gameStore.selectedLayer : name;\r\n        for (const layer of this.layers) {\r\n            if (layer.name === name) return layer;\r\n        }\r\n    }\r\n\r\n    selectLayer(name: string, sync: boolean = true): void {\r\n        let found = false;\r\n        for (const layer of this.layers) {\r\n            if (!layer.selectable) continue;\r\n            if (found && layer.name !== \"fow\") layer.ctx.globalAlpha = 0.3;\r\n            else layer.ctx.globalAlpha = 1.0;\r\n\r\n            if (name === layer.name) {\r\n                gameStore.selectLayer({ name, sync });\r\n                found = true;\r\n            }\r\n\r\n            layer.clearSelection();\r\n            layer.invalidate(true);\r\n        }\r\n    }\r\n\r\n    getGridLayer(): GridLayer | undefined {\r\n        return <GridLayer>this.getLayer(\"grid\");\r\n    }\r\n\r\n    hasSelection(): boolean {\r\n        const selection = this.getSelection();\r\n        return selection !== undefined && selection.length > 0;\r\n    }\r\n\r\n    // THIS INCLUDES POTENTIALLY THE SelectTool.SelectionHelper !!!\r\n    getSelection(): Shape[] | undefined {\r\n        const layer = this.getLayer();\r\n        if (layer === undefined) return undefined;\r\n        return layer.selection;\r\n    }\r\n\r\n    invalidate(): void {\r\n        for (let i = this.layers.length - 1; i >= 0; i--) {\r\n            this.layers[i].invalidate(true);\r\n        }\r\n    }\r\n\r\n    invalidateLight(): void {\r\n        for (let i = this.layers.length - 1; i >= 0; i--)\r\n            if (this.layers[i].isVisionLayer) this.layers[i].invalidate(true);\r\n    }\r\n}\r\n\r\nexport const layerManager = new LayerManager();\r\n(<any>window).lm = layerManager;\r\n","import { GlobalPoint, Ray } from \"@/game/geom\";\r\nimport { EdgeCirculator, Point, Sign, Triangle, Vertex } from \"./tds\";\r\n\r\ntype Line = number[];\r\n\r\nexport function cw(index: number): number {\r\n    return (index + 2) % 3;\r\n}\r\n\r\nexport function ccw(index: number): number {\r\n    return (index + 1) % 3;\r\n}\r\n\r\nexport function edgeInfo(\r\n    va: Vertex,\r\n    vb: Vertex,\r\n): { includes: false } | { includes: true; vi: Vertex; fr: Triangle; i: number } {\r\n    const ec = new EdgeCirculator(va, null);\r\n    if (ec.valid) {\r\n        do {\r\n            const indv = 3 - ec.t!.indexV(va) - ec.ri;\r\n            const v = ec.t!.vertices[indv]!;\r\n            if (!v.infinite) {\r\n                if (v === vb) {\r\n                    return { includes: true, vi: vb, fr: ec.t!, i: ec.ri };\r\n                } else {\r\n                    const orient = orientation(va.point!, vb.point!, v.point!);\r\n                    if (orient === Sign.COLLINEAR && collinearBetween(va.point!, v.point!, vb.point!)) {\r\n                        return { includes: true, vi: v, fr: ec.t!, i: ec.ri };\r\n                    }\r\n                }\r\n            }\r\n        } while (ec.next());\r\n    }\r\n    return { includes: false };\r\n}\r\n\r\nexport function collinearBetween(p: Point, q: Point, r: Point): boolean {\r\n    let cPQ: Sign;\r\n    let cQR: Sign;\r\n    if (compare(0, p, r) === Sign.EQUAL) {\r\n        cPQ = compare(1, p, q);\r\n        cQR = compare(1, q, r);\r\n    } else {\r\n        cPQ = compare(0, p, q);\r\n        cQR = compare(0, q, r);\r\n    }\r\n    return (cPQ === Sign.SMALLER && cQR === Sign.SMALLER) || (cPQ === Sign.LARGER && cQR === Sign.LARGER);\r\n}\r\n\r\nfunction compare(index: number, a: Point, b: Point): Sign {\r\n    if (a[index] < b[index]) return Sign.SMALLER;\r\n    if (a[index] > b[index]) return Sign.LARGER;\r\n    return Sign.EQUAL;\r\n}\r\n\r\nexport function orientation(p: Point, q: Point, r: Point): Sign {\r\n    const px = p[0];\r\n    const py = p[1];\r\n    const qx = q[0];\r\n    const qy = q[1];\r\n    const rx = r[0];\r\n    const ry = r[1];\r\n    const pqx = qx - px;\r\n    const pqy = qy - py;\r\n    const prx = rx - px;\r\n    const pry = ry - py;\r\n    const det = determinant(pqx, pqy, prx, pry);\r\n    let maxX = Math.abs(pqx);\r\n    let maxY = Math.abs(pqy);\r\n    const aprX = Math.abs(prx);\r\n    const aprY = Math.abs(pry);\r\n    if (maxX < aprX) maxX = aprX;\r\n    if (maxY < aprY) maxY = aprY;\r\n    if (maxX > maxY) [maxX, maxY] = [maxY, maxX];\r\n    // underflow proection in eps computation?? Math.sqrt(Number.MIN_VALUE, Number.EPSILON)\r\n    if (maxX < 2e-162 && maxX === 0) {\r\n        return Sign.ZERO;\r\n    }\r\n    // overflow protection in det computation\r\n    if (maxY < 1e153) {\r\n        const eps = Number.EPSILON * maxX * maxY;\r\n        if (det > eps) return Sign.POSITIVE;\r\n        if (det < -eps) return Sign.NEGATIVE;\r\n    }\r\n    return Sign.ZERO;\r\n}\r\n\r\nexport function determinant(a00: number, a01: number, a10: number, a11: number): number {\r\n    return a00 * a11 - a01 * a10;\r\n}\r\n\r\nexport function hasInexactNegativeOrientation(p: Point, q: Point, r: Point): boolean {\r\n    return determinant(q[0] - p[0], q[1] - p[1], r[0] - p[0], r[1] - p[1]) < 0;\r\n}\r\n\r\nexport function sideOfOrientedCircle(t: Triangle, p: Point, perturb: boolean): Sign {\r\n    if (!t.isInfinite())\r\n        return sideOfOrientedCircleP(t.vertices[0]!.point!, t.vertices[1]!.point!, t.vertices[2]!.point!, p, perturb);\r\n    throw new Error(\"SSS\");\r\n}\r\n\r\nexport function sideOfOrientedCircleP(p0: Point, p1: Point, p2: Point, p: Point, perturb: boolean): Sign {\r\n    const os = getOrientedSide(p0, p1, p2, p);\r\n    if (os !== Sign.ON_ORIENTED_BOUNDARY || !perturb) return os;\r\n    const points = [p0, p1, p2, p];\r\n    points.sort((a, b) => a[0] - b[0] || a[1] - b[1]);\r\n    for (const point of points.reverse()) {\r\n        if (point === p) return Sign.ON_NEGATIVE_SIDE;\r\n        let o = orientation(p0, p1, p);\r\n        if (point === p2 && o !== Sign.COLLINEAR) return o;\r\n        o = orientation(p0, p, p2);\r\n        if (point === p1 && o !== Sign.COLLINEAR) return o;\r\n        o = orientation(p, p1, p2);\r\n        if (point === p0 && o !== Sign.COLLINEAR) return o;\r\n    }\r\n    return Sign.ON_NEGATIVE_SIDE;\r\n}\r\n\r\nexport function xyEqual(p: Point, q: Point): boolean {\r\n    return p[0] === q[0] && p[1] === q[1];\r\n}\r\n\r\nexport function xySmaller(p: Point, q: Point): boolean {\r\n    return p[0] < q[0] || (p[0] === q[0] && p[1] < q[1]);\r\n}\r\n\r\nexport function xyCompare(p: Point, q: Point): Sign {\r\n    if (xySmaller(p, q)) return Sign.SMALLER;\r\n    if (xyEqual(p, q)) return Sign.EQUAL;\r\n    return Sign.LARGER;\r\n}\r\n\r\nfunction getOrientedSide(p: Point, q: Point, r: Point, t: Point): Sign {\r\n    const qpx = q[0] - p[0];\r\n    const qpy = q[1] - p[1];\r\n    const rpx = r[0] - p[0];\r\n    const rpy = r[1] - p[1];\r\n    const tpx = t[0] - p[0];\r\n    const tpy = t[1] - p[1];\r\n    const tqx = t[0] - q[0];\r\n    const tqy = t[1] - q[1];\r\n    const rqx = r[0] - q[0];\r\n    const rqy = r[1] - q[1];\r\n\r\n    const det = determinant(qpx * tpy - qpy * tpx, tpx * tqx + tpy * tqy, qpx * rpy - qpy * rpx, rpx * rqx + rpy * rqy);\r\n    let maxx = Math.abs(qpx);\r\n    let maxy = Math.abs(qpy);\r\n    const arpx = Math.abs(rpx);\r\n    const arpy = Math.abs(rpy);\r\n    const atqx = Math.abs(tqx);\r\n    const atqy = Math.abs(tqy);\r\n    const atpx = Math.abs(tpx);\r\n    const atpy = Math.abs(tpy);\r\n    const arqx = Math.abs(rqx);\r\n    const arqy = Math.abs(rqy);\r\n\r\n    if (maxx < arpx) maxx = arpx;\r\n    if (maxx < atpx) maxx = atpx;\r\n    if (maxx < atqx) maxx = atqx;\r\n    if (maxx < arqx) maxx = arqx;\r\n\r\n    if (maxy < arpy) maxy = arpy;\r\n    if (maxy < atpy) maxy = atpy;\r\n    if (maxy < atqy) maxy = atqy;\r\n    if (maxy < arqy) maxy = arqy;\r\n\r\n    if (maxx > maxy) [maxx, maxy] = [maxy, maxx];\r\n\r\n    if (maxx < 1e-73 && maxx === 0) return Sign.ON_ORIENTED_BOUNDARY;\r\n    // sqrt(sqrt(max_double/16\r\n    else if (maxy < 1e76) {\r\n        const eps = Number.EPSILON * maxx * maxy * (maxy * maxy);\r\n        if (det > eps) return Sign.ON_POSITIVE_SIDE;\r\n        if (det < -eps) return Sign.ON_NEGATIVE_SIDE;\r\n    }\r\n\r\n    return Sign.ZERO;\r\n}\r\n\r\nfunction segSegDoIntersectCrossing(p1: Point, p2: Point, p3: Point, p4: Point): boolean {\r\n    switch (orientation(p1, p2, p3)) {\r\n        case Sign.LEFT_TURN:\r\n            return orientation(p3, p4, p2) !== Sign.RIGHT_TURN;\r\n        case Sign.RIGHT_TURN:\r\n            return orientation(p3, p4, p2) !== Sign.LEFT_TURN;\r\n        case Sign.COLLINEAR:\r\n            return true;\r\n    }\r\n}\r\n\r\nfunction segSegDoIntersectContained(p1: Point, p2: Point, p3: Point, p4: Point): boolean {\r\n    switch (orientation(p1, p2, p3)) {\r\n        case Sign.LEFT_TURN:\r\n            return orientation(p1, p2, p4) !== Sign.LEFT_TURN;\r\n        case Sign.RIGHT_TURN:\r\n            return orientation(p1, p2, p4) !== Sign.RIGHT_TURN;\r\n        case Sign.COLLINEAR:\r\n            return true;\r\n    }\r\n}\r\n\r\nexport function intersection(pa: Point, pb: Point, pc: Point, pd: Point): Point | null {\r\n    const i = getIntersectionType(pa, pb, pc, pd);\r\n    switch (i.intersectionType) {\r\n        case IntersectionType.POINT:\r\n            return i.point!;\r\n        case IntersectionType.NO_INTERSECTION:\r\n            return null;\r\n    }\r\n    throw new Error(\"sdfgighowen\");\r\n}\r\n\r\nenum IntersectionType {\r\n    NO_INTERSECTION,\r\n    POINT,\r\n    SEGMENT,\r\n}\r\n\r\nfunction getLine(p0: Point, p1: Point): Line {\r\n    if (p0[0] === p1[0]) return [1, 0, -p0[0]];\r\n    if (p0[1] === p1[1]) return [0, 1, -p0[1]];\r\n    const x = p1[0] - p0[0];\r\n    const y = p1[1] - p0[1];\r\n    return [-y, x, -x * p0[1] + y * p0[0]];\r\n}\r\n\r\nfunction getIntersectionType(\r\n    pa: Point,\r\n    pb: Point,\r\n    pc: Point,\r\n    pd: Point,\r\n): { intersectionType: IntersectionType; point: Point | null } {\r\n    if (!doIntersect(pa, pb, pc, pd)) return { intersectionType: IntersectionType.NO_INTERSECTION, point: null };\r\n    const l1 = getLine(pa, pb);\r\n    const l2 = getLine(pc, pd);\r\n    const info = getIntersectionTypeLine(l1, l2);\r\n    switch (info.intersectionType) {\r\n        case IntersectionType.POINT: {\r\n            return info;\r\n        }\r\n    }\r\n    throw new Error(\"gzseuihgpib\");\r\n}\r\n\r\nfunction getIntersectionTypeLine(la: Line, lb: Line): { intersectionType: IntersectionType; point: Point } {\r\n    const denom = la[0] * lb[1] - lb[0] * la[1];\r\n    const nom1 = la[1] * lb[2] - lb[1] * la[2];\r\n    const nom2 = lb[0] * la[2] - la[0] * lb[2];\r\n    return {\r\n        intersectionType: IntersectionType.POINT,\r\n        point: [nom1 / denom, nom2 / denom],\r\n    };\r\n}\r\n\r\nfunction doIntersect(A1: Point, A2: Point, B1: Point, B2: Point): boolean {\r\n    if (xySmaller(A1, A2)) {\r\n        if (xySmaller(B1, B2)) {\r\n            if (xySmaller(A2, B1) || xySmaller(B2, A1)) return false;\r\n        } else {\r\n            if (xySmaller(A2, B2) || xySmaller(B1, A1)) return false;\r\n        }\r\n    } else {\r\n        if (xySmaller(B1, B2)) {\r\n            if (xySmaller(A1, B1) || xySmaller(B2, A2)) return false;\r\n        } else {\r\n            if (xySmaller(A1, B2) || xySmaller(B1, A2)) return false;\r\n        }\r\n    }\r\n    if (xySmaller(A1, A2)) {\r\n        if (xySmaller(B1, B2)) {\r\n            switch (xyCompare(A1, B1)) {\r\n                case Sign.SMALLER: {\r\n                    switch (xyCompare(A2, B1)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(A2, B2)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(A1, A2, B1, B2);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(A1, A2, B1, B2);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                case Sign.EQUAL:\r\n                    return true;\r\n                default:\r\n                    switch (xyCompare(B2, A1)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(B2, A2)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(B1, B2, A1, A2);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(B1, B2, A1, A2);\r\n                            }\r\n                        }\r\n                    }\r\n            }\r\n        } else {\r\n            switch (xyCompare(A1, B2)) {\r\n                case Sign.SMALLER: {\r\n                    switch (xyCompare(A2, B2)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(A2, B1)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(A1, A2, B2, B1);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(A1, A2, B2, B1);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                case Sign.EQUAL:\r\n                    return true;\r\n                default:\r\n                    switch (xyCompare(B1, A1)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(B1, A2)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(B2, B1, A1, A2);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(B2, B1, A1, A2);\r\n                            }\r\n                        }\r\n                    }\r\n            }\r\n        }\r\n    } else {\r\n        if (xySmaller(B1, B2)) {\r\n            switch (xyCompare(A2, B1)) {\r\n                case Sign.SMALLER: {\r\n                    switch (xyCompare(A1, B1)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(A1, B2)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(A2, A1, B1, B2);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(A2, A1, B1, B2);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                case Sign.EQUAL:\r\n                    return true;\r\n                default:\r\n                    switch (xyCompare(B2, A2)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(B2, A1)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(B1, B2, A2, A1);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(B1, B2, A2, A1);\r\n                            }\r\n                        }\r\n                    }\r\n            }\r\n        } else {\r\n            switch (xyCompare(A2, B2)) {\r\n                case Sign.SMALLER: {\r\n                    switch (xyCompare(A1, B2)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(A1, B1)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(A2, A1, B2, B1);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(A2, A1, B2, B1);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                case Sign.EQUAL:\r\n                    return true;\r\n                default:\r\n                    switch (xyCompare(B1, A2)) {\r\n                        case Sign.SMALLER:\r\n                            return false;\r\n                        case Sign.EQUAL:\r\n                            return true;\r\n                        default: {\r\n                            switch (xyCompare(B1, A1)) {\r\n                                case Sign.SMALLER:\r\n                                    return segSegDoIntersectCrossing(B2, B1, A2, A1);\r\n                                case Sign.EQUAL:\r\n                                    return true;\r\n                                default:\r\n                                    return segSegDoIntersectContained(B2, B1, A2, A1);\r\n                            }\r\n                        }\r\n                    }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction nextUp(x: number): number {\r\n    if (x !== x) {\r\n        return x;\r\n    }\r\n    if (x === -1 / 0) {\r\n        return -Number.MAX_VALUE;\r\n    }\r\n    if (x === +1 / 0) {\r\n        return +1 / 0;\r\n    }\r\n    if (x === +Number.MAX_VALUE) {\r\n        return +1 / 0;\r\n    }\r\n    let y = x * (x < 0 ? 1 - Number.EPSILON / 2 : 1 + Number.EPSILON);\r\n    if (y === x) {\r\n        y = Number.MIN_VALUE * Number.EPSILON > 0 ? x + Number.MIN_VALUE * Number.EPSILON : x + Number.MIN_VALUE;\r\n    }\r\n    if (y === +1 / 0) {\r\n        y = +Number.MAX_VALUE;\r\n    }\r\n    const b = x + (y - x) / 2;\r\n    if (x < b && b < y) {\r\n        y = b;\r\n    }\r\n    const c = (y + x) / 2;\r\n    if (x < c && c < y) {\r\n        y = c;\r\n    }\r\n    return y === 0 ? -0 : y;\r\n}\r\n\r\nexport function ulp(x: number): number {\r\n    return x < 0 ? nextUp(x) - x : x + nextUp(-x);\r\n}\r\n\r\nexport function circleLineIntersection(\r\n    circleCenter: GlobalPoint,\r\n    circleRadius: number,\r\n    A: GlobalPoint,\r\n    B: GlobalPoint,\r\n): GlobalPoint[] {\r\n    const segmentRay = Ray.fromPoints(A, B); // d\r\n    const circleLineRay = Ray.fromPoints(circleCenter, A); // f\r\n    const a = segmentRay.direction.dot(segmentRay.direction);\r\n    const b = 2 * circleLineRay.direction.dot(segmentRay.direction);\r\n    const c = circleLineRay.direction.dot(circleLineRay.direction) - circleRadius ** 2;\r\n    let d = b ** 2 - 4 * a * c;\r\n    if (d < 0) return [];\r\n\r\n    const intersectionPoints: GlobalPoint[] = [];\r\n\r\n    d = Math.sqrt(d);\r\n    const t1 = (-b - d) / (2 * a);\r\n    const t2 = (-b + d) / (2 * a);\r\n    if (t1 >= 0 && t1 <= 1) intersectionPoints.push(segmentRay.get(t1));\r\n    if (t2 >= 0 && t2 <= 1) intersectionPoints.push(segmentRay.get(t2));\r\n    return intersectionPoints;\r\n}\r\n","import { GlobalPoint, Point, Ray, Vector } from \"@/game/geom\";\r\nimport { g2lx, g2ly } from \"../units\";\r\n\r\nexport class BoundingRect {\r\n    readonly w: number;\r\n    readonly h: number;\r\n    readonly topLeft: GlobalPoint;\r\n    readonly topRight: GlobalPoint;\r\n    readonly botRight: GlobalPoint;\r\n    readonly botLeft: GlobalPoint;\r\n\r\n    constructor(topleft: GlobalPoint, w: number, h: number) {\r\n        this.w = w;\r\n        this.h = h;\r\n        this.topLeft = topleft;\r\n        this.topRight = new GlobalPoint(topleft.x + w, topleft.y);\r\n        this.botRight = new GlobalPoint(topleft.x + w, topleft.y + h);\r\n        this.botLeft = new GlobalPoint(topleft.x, topleft.y + h);\r\n    }\r\n\r\n    contains(point: GlobalPoint): boolean {\r\n        return (\r\n            this.topLeft.x <= point.x &&\r\n            this.topRight.x >= point.x &&\r\n            this.topLeft.y <= point.y &&\r\n            this.botLeft.y >= point.y\r\n        );\r\n    }\r\n\r\n    get points(): number[][] {\r\n        if (this.w === 0 || this.h === 0) return [[this.topLeft.x, this.topLeft.y]];\r\n        return [\r\n            [this.topLeft.x, this.topLeft.y],\r\n            [this.botLeft.x, this.botLeft.y],\r\n            [this.botRight.x, this.botRight.y],\r\n            [this.topRight.x, this.topRight.y],\r\n        ];\r\n    }\r\n\r\n    offset(vector: Vector): BoundingRect {\r\n        return new BoundingRect(this.topLeft.add(vector), this.w, this.h);\r\n    }\r\n\r\n    union(other: BoundingRect): BoundingRect {\r\n        const xmin = Math.min(this.topLeft.x, other.topLeft.x);\r\n        const xmax = Math.max(this.topRight.x, other.topRight.x);\r\n        const ymin = Math.min(this.topLeft.y, other.topLeft.y);\r\n        const ymax = Math.max(this.botLeft.y, other.botLeft.y);\r\n        return new BoundingRect(new GlobalPoint(xmin, ymin), xmax - xmin, ymax - ymin);\r\n    }\r\n\r\n    getDiagCorner(botright: boolean): GlobalPoint {\r\n        return botright ? this.botRight : this.topLeft;\r\n    }\r\n\r\n    intersectsWith(other: BoundingRect): boolean {\r\n        return !(\r\n            other.topLeft.x > this.topRight.x ||\r\n            other.topRight.x < this.topLeft.x ||\r\n            other.topLeft.y > this.botLeft.y ||\r\n            other.botLeft.y < this.topLeft.y\r\n        );\r\n    }\r\n\r\n    intersectsWithInner(other: BoundingRect): boolean {\r\n        return !(\r\n            other.topLeft.x >= this.topRight.x ||\r\n            other.topRight.x <= this.topLeft.x ||\r\n            other.topLeft.y >= this.botLeft.y ||\r\n            other.botLeft.y <= this.topLeft.y\r\n        );\r\n    }\r\n\r\n    intersectP(ray: Ray<Point>, invDir: Vector, dirIsNeg: boolean[]): { hit: boolean; min: number; max: number } {\r\n        let txmin = invDir.x * (this.getDiagCorner(dirIsNeg[0]).x - ray.origin!.x);\r\n        let txmax = invDir.x * (this.getDiagCorner(!dirIsNeg[0]).x - ray.origin!.x);\r\n        const tymin = invDir.y * (this.getDiagCorner(dirIsNeg[1]).y - ray.origin!.y);\r\n        const tymax = invDir.y * (this.getDiagCorner(!dirIsNeg[1]).y - ray.origin!.y);\r\n        if (txmin > tymax || tymin > txmax) return { hit: false, min: txmin, max: txmax };\r\n        if (tymin > txmin) txmin = tymin;\r\n        if (tymax < txmax) txmax = tymax;\r\n        return { hit: txmin < ray.tMax! && txmax > 0, min: txmin, max: txmax };\r\n    }\r\n\r\n    center(): GlobalPoint {\r\n        return this.topLeft.add(new Vector(this.w / 2, this.h / 2));\r\n    }\r\n\r\n    getMaxExtent(): 0 | 1 {\r\n        return this.w > this.h ? 0 : 1;\r\n    }\r\n    visibleInCanvas(canvas: HTMLCanvasElement): boolean {\r\n        const coreVisible = !(\r\n            g2lx(this.topLeft.x) > canvas.width ||\r\n            g2ly(this.topLeft.y) > canvas.height ||\r\n            g2lx(this.topRight.x) < 0 ||\r\n            g2ly(this.botRight.y) < 0\r\n        );\r\n        if (coreVisible) return true;\r\n        return false;\r\n    }\r\n}\r\n","import { ServerAura } from \"@/game/comm/types/shapes\";\r\n\r\nexport const aurasFromServer = (auras: ServerAura[]): Aura[] => {\r\n    const result = [];\r\n    for (const aura of auras) {\r\n        result.push({\r\n            uuid: aura.uuid,\r\n            visionSource: aura.vision_source,\r\n            visible: aura.visible,\r\n            name: aura.name,\r\n            value: aura.value,\r\n            dim: aura.dim,\r\n            colour: aura.colour,\r\n        });\r\n    }\r\n    return result;\r\n};\r\n\r\nexport const aurasToServer = (auras: Aura[]): ServerAura[] => {\r\n    const result = [];\r\n    for (const aura of auras) {\r\n        result.push({\r\n            uuid: aura.uuid,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            vision_source: aura.visionSource,\r\n            visible: aura.visible,\r\n            name: aura.name,\r\n            value: aura.value,\r\n            dim: aura.dim,\r\n            colour: aura.colour,\r\n        });\r\n    }\r\n    return result;\r\n};\r\n","import { BoundingRect } from \"@/game/shapes/boundingrect\";\r\n\r\nexport class BoundingNode {\r\n    bbox: BoundingRect;\r\n    nPrimitives: number;\r\n    children: BoundingNode[] = [];\r\n    constructor(nPrimitives: number, bbox: BoundingRect) {\r\n        this.nPrimitives = nPrimitives;\r\n        this.bbox = bbox;\r\n    }\r\n}\r\n\r\nexport class LeafNode extends BoundingNode {\r\n    firstPrimOffset: number;\r\n    constructor(first: number, n: number, bbox: BoundingRect) {\r\n        super(n, bbox);\r\n        this.firstPrimOffset = first;\r\n    }\r\n}\r\n\r\nexport class InteriorNode extends BoundingNode {\r\n    dimension: number;\r\n    constructor(dimension: number, c1: BoundingNode, c2: BoundingNode) {\r\n        super(0, c1.bbox.union(c2.bbox));\r\n        this.dimension = dimension;\r\n        this.children.push(c1);\r\n        this.children.push(c2);\r\n    }\r\n}\r\n","import { partition } from \"@/core/utils\";\r\nimport { GlobalPoint, Ray } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { BoundingRect } from \"@/game/shapes/boundingrect\";\r\nimport { g2lx, g2ly, g2lz } from \"@/game/units\";\r\nimport { BoundingNode, InteriorNode, LeafNode } from \"@/game/visibility/bvh/node\";\r\n\r\ninterface BuildInfo {\r\n    index: number;\r\n    bbox: BoundingRect;\r\n    center: BoundingRect;\r\n}\r\ninterface LinearBHVNode {\r\n    bbox: BoundingRect;\r\n    nPrimitives: number;\r\n}\r\ninterface LinearLeafNode extends LinearBHVNode {\r\n    primitivesOffset: number;\r\n}\r\ninterface LinearInternalNode extends LinearBHVNode {\r\n    secondChildOffset: number;\r\n    dimension: number;\r\n}\r\n\r\nexport class BoundingVolume {\r\n    totalNodes = 0;\r\n    buildData: BuildInfo[] = [];\r\n    shapes: string[];\r\n    orderedPrims: string[] = [];\r\n    root: BoundingNode | null;\r\n    nodes: LinearBHVNode[] = [];\r\n\r\n    offset = 0;\r\n\r\n    constructor(shapes: string[]) {\r\n        this.shapes = shapes;\r\n        if (this.shapes.length === 0) {\r\n            this.root = null;\r\n            this.nodes = [];\r\n            return;\r\n        }\r\n        for (let i = 0; i < shapes.length; i++) {\r\n            const shape = layerManager.UUIDMap.get(shapes[i])!;\r\n            this.buildData.push({\r\n                index: i,\r\n                bbox: shape.getBoundingBox(),\r\n                center: new BoundingRect(shape.center(), 0, 0),\r\n            });\r\n        }\r\n        this.root = this.recursiveBuild(0, shapes.length);\r\n        this.compact();\r\n    }\r\n\r\n    draw(): void {\r\n        const ctx = layerManager.getLayer(\"draw\")!.ctx;\r\n        for (const node of this.nodes) {\r\n            const b = node.bbox;\r\n            ctx.strokeRect(g2lx(b.topLeft.x), g2ly(b.topLeft.y), g2lz(b.w), g2lz(b.h));\r\n        }\r\n    }\r\n\r\n    recursiveBuild(start: number, end: number): BoundingNode {\r\n        this.totalNodes++;\r\n        let bbox = this.buildData[start].bbox;\r\n        for (let i = start + 1; i < end; i++) bbox = bbox.union(this.buildData[i].bbox);\r\n        const nPrimitives = end - start;\r\n        if (nPrimitives === 1) {\r\n            return this.createLeaf(start, end, nPrimitives, bbox);\r\n        } else {\r\n            let centroidBbox = this.buildData[start].center;\r\n            for (let i = start; i < end; i++) centroidBbox = centroidBbox.union(this.buildData[i].center);\r\n            const dimension = centroidBbox.getMaxExtent();\r\n            if (centroidBbox.botRight.get(dimension) === centroidBbox.topLeft.get(dimension)) {\r\n                return this.createLeaf(start, end, nPrimitives, bbox);\r\n            }\r\n            // Use shitty Middle thingy until an introselect js algo is added\r\n            const pMid = 0.5 * (centroidBbox.topLeft.get(dimension) + centroidBbox.botRight.get(dimension));\r\n            const partitionedData = partition(\r\n                this.buildData.slice(start, end),\r\n                (n: BuildInfo) => n.center.center().get(dimension) < pMid,\r\n            );\r\n            const flattened = (<BuildInfo[]>[]).concat.apply([], partitionedData);\r\n            if (partitionedData[0].length === 0 || partitionedData[1].length === 0) console.log(\"EMPTY\");\r\n            this.buildData.splice(start, flattened.length, ...flattened);\r\n            const mid = partitionedData[0].length + start;\r\n            return new InteriorNode(dimension, this.recursiveBuild(start, mid), this.recursiveBuild(mid, end));\r\n        }\r\n    }\r\n\r\n    intersect(\r\n        ray: Ray<GlobalPoint>,\r\n        stopOnFirstHit?: boolean,\r\n    ): { hit: boolean; intersect: GlobalPoint; tMin: number; tMax: number } {\r\n        if (this.nodes.length === 0) return { hit: false, intersect: ray.get(0), tMin: 0, tMax: ray.tMax };\r\n        if (stopOnFirstHit === undefined) stopOnFirstHit = false;\r\n        // Initialize return values\r\n        let hit = false;\r\n        let tMin = 0;\r\n        let tMax = ray.tMax;\r\n\r\n        // Initialize work variables\r\n        let todoOffset = 0;\r\n        let nodeNum = 0;\r\n        const todo: number[] = [];\r\n\r\n        // Precalculate intersection vectors\r\n        const invDir = ray.direction.inverse();\r\n        const dirIsNegative = [invDir.x < 0, invDir.y < 0];\r\n\r\n        while (true) {\r\n            const node = this.nodes[nodeNum];\r\n\r\n            const i = node.bbox.intersectP(ray, invDir, dirIsNegative);\r\n            if (i.hit) {\r\n                if (node.nPrimitives > 0) {\r\n                    // TODO: nPrimitives is currently always 1 , this could be generalised\r\n                    // for (let i=0; i < node.nPrimitives; i++) {\r\n                    //     if (this.shapes[(<LinearLeafNode>node).primitivesOffset + i])\r\n                    // }\r\n                    hit = true;\r\n                    tMin = ray.tMax = i.min;\r\n                    tMax = i.max;\r\n                    if (todoOffset === 0 || stopOnFirstHit) break;\r\n                    nodeNum = todo[--todoOffset];\r\n                } else {\r\n                    if (dirIsNegative[(<LinearInternalNode>node).dimension]) {\r\n                        todo[todoOffset++] = nodeNum + 1;\r\n                        nodeNum = (<LinearInternalNode>node).secondChildOffset;\r\n                    } else {\r\n                        todo[todoOffset++] = (<LinearInternalNode>node).secondChildOffset;\r\n                        nodeNum++;\r\n                    }\r\n                }\r\n            } else {\r\n                if (todoOffset === 0) break;\r\n                nodeNum = todo[--todoOffset];\r\n            }\r\n        }\r\n        return { hit, intersect: ray.get(tMin), tMin, tMax };\r\n    }\r\n\r\n    private compact(): void {\r\n        this.offset = 0;\r\n        if (this.root !== null) this.flatten(this.root);\r\n    }\r\n\r\n    private flatten(node: BoundingNode): number {\r\n        const index = this.offset;\r\n        const myOffset = this.offset++;\r\n        if (node.nPrimitives === 0) {\r\n            this.flatten(node.children[0]);\r\n            const secondOffset = this.flatten(node.children[1]);\r\n            const linearNode: LinearInternalNode = {\r\n                bbox: node.bbox,\r\n                dimension: (<InteriorNode>node).dimension,\r\n                nPrimitives: 0,\r\n                secondChildOffset: secondOffset,\r\n            };\r\n            this.nodes[index] = linearNode;\r\n        } else {\r\n            const leafNode: LinearLeafNode = {\r\n                bbox: node.bbox,\r\n                primitivesOffset: (<LeafNode>node).firstPrimOffset,\r\n                nPrimitives: node.nPrimitives,\r\n            };\r\n            this.nodes[index] = leafNode;\r\n        }\r\n        return myOffset;\r\n    }\r\n\r\n    private createLeaf(start: number, end: number, nPrimitives: number, bbox: BoundingRect): LeafNode {\r\n        const size = this.orderedPrims.length;\r\n        for (let i = start; i < end; i++) this.orderedPrims.push(this.shapes[this.buildData[i].index]);\r\n        return new LeafNode(size, nPrimitives, bbox);\r\n    }\r\n}\r\n","import { CDT } from \"./cdt\";\r\nimport { ccw, cw, orientation, ulp } from \"./triag\";\r\n\r\nexport type Point = number[];\r\n\r\nexport const INFINITE = -7e310;\r\n\r\nlet _INFINITE_VERTEX: Vertex;\r\n\r\nexport enum Sign {\r\n    NEGATIVE = -1,\r\n    ZERO = 0,\r\n    POSITIVE = 1,\r\n\r\n    RIGHT_TURN = -1,\r\n    LEFT_TURN = 1,\r\n\r\n    SMALLER = -1,\r\n    EQUAL = 0,\r\n    LARGER = 1,\r\n\r\n    CLOCKWISE = -1,\r\n    COUNTERCLOCKWISE = 1,\r\n\r\n    COLLINEAR = 0,\r\n    COPLANAR = 0,\r\n    DEGENERATE = 0,\r\n\r\n    ON_NEGATIVE_SIDE = -1,\r\n    ON_ORIENTED_BOUNDARY = 0,\r\n    ON_POSITIVE_SIDE = 1,\r\n}\r\n\r\nenum LineFaceState {\r\n    UNDEFINED = -1,\r\n    VERTEX_VERTEX = 0,\r\n    VERTEX_EDGE = 1,\r\n    EDGE_VERTEX = 2,\r\n    EDGE_EDGE = 3,\r\n}\r\n\r\nfunction newPoint(): Point {\r\n    return [INFINITE, INFINITE];\r\n}\r\n\r\nexport class Triangle {\r\n    vertices: (Vertex | null)[] = [];\r\n    neighbours: (Triangle | null)[] = [null, null, null];\r\n    constraints = [false, false, false];\r\n    static _counter = 0;\r\n    uid = Triangle._counter++;\r\n\r\n    constructor(...vertices: (Vertex | null)[]) {\r\n        this.vertices = vertices;\r\n    }\r\n\r\n    from(t: Triangle): this {\r\n        this.vertices = t.vertices.slice(0, t.vertices.length);\r\n        this.neighbours = t.neighbours.slice(0, t.neighbours.length);\r\n        this.constraints = t.constraints.slice(0, t.constraints.length);\r\n        return this;\r\n    }\r\n\r\n    get dimension(): number {\r\n        return this.vertices.length - 1;\r\n    }\r\n\r\n    addVertex(vertex: Vertex): void {\r\n        if (vertex === undefined) {\r\n            console.log(\"UNDEFINED HIERE\");\r\n        }\r\n        this.vertices.push(vertex);\r\n        vertex.triangle = this;\r\n    }\r\n\r\n    isConstrained(index: number): boolean {\r\n        return this.constraints[index];\r\n    }\r\n\r\n    reorient(): void {\r\n        // If certain indices do not exist yet thay will append faulty undefined's, thus we slice them\r\n        this.vertices = [this.vertices[1], this.vertices[0], this.vertices[2]].slice(0, this.vertices.length);\r\n        this.neighbours = [this.neighbours[1], this.neighbours[0], this.neighbours[2]];\r\n        this.constraints = [this.constraints[1], this.constraints[0], this.constraints[2]];\r\n    }\r\n\r\n    indexV(v: Vertex): number {\r\n        return this.vertices.indexOf(v);\r\n    }\r\n\r\n    indexT(t: Triangle): number {\r\n        return this.neighbours.indexOf(t);\r\n    }\r\n\r\n    isInfinite(index?: number): boolean {\r\n        if (index === undefined) {\r\n            return this.vertices.includes(_INFINITE_VERTEX);\r\n        } else {\r\n            return this.vertices[ccw(index)]!.infinite || this.vertices[cw(index)]!.infinite;\r\n        }\r\n    }\r\n\r\n    contains(point: Point): boolean {\r\n        const A =\r\n            -this.vertices[1]!.point![1] * this.vertices[2]!.point![0] +\r\n            this.vertices[0]!.point![1] * (-this.vertices[1]!.point![0] + this.vertices[2]!.point![0]) +\r\n            this.vertices[0]!.point![0] * (this.vertices[1]!.point![1] - this.vertices[2]!.point![1]) +\r\n            this.vertices[1]!.point![0] * this.vertices[2]!.point![1];\r\n        const sign = A < 0 ? -1 : 1;\r\n        const s =\r\n            (this.vertices[0]!.point![1] * this.vertices[2]!.point![0] -\r\n                this.vertices[0]!.point![0] * this.vertices[2]!.point![1] +\r\n                (this.vertices[2]!.point![1] - this.vertices[0]!.point![1]) * point[0] +\r\n                (this.vertices[0]!.point![0] - this.vertices[2]!.point![0]) * point[1]) *\r\n            sign;\r\n        if (s < 0) return false;\r\n        const t =\r\n            (this.vertices[0]!.point![0] * this.vertices[1]!.point![1] -\r\n                this.vertices[0]!.point![1] * this.vertices[1]!.point![0] +\r\n                (this.vertices[0]!.point![1] - this.vertices[1]!.point![1]) * point[0] +\r\n                (this.vertices[1]!.point![0] - this.vertices[0]!.point![0]) * point[1]) *\r\n            sign;\r\n\r\n        return t > 0 && s + t < A * sign;\r\n    }\r\n}\r\n\r\nexport class Vertex {\r\n    infinite = false;\r\n    private _point: Point | undefined;\r\n    triangle: Triangle | undefined;\r\n\r\n    constructor(point?: Point) {\r\n        this._point = point;\r\n    }\r\n\r\n    get point(): Point | undefined {\r\n        return this._point;\r\n    }\r\n\r\n    set point(point: Point | undefined) {\r\n        this._point = point;\r\n        this.infinite = false;\r\n    }\r\n}\r\n\r\nexport class EdgeCirculator {\r\n    ri: number;\r\n    v: Vertex | null;\r\n    t: Triangle | null;\r\n    _ri: number;\r\n    _v: Vertex | null;\r\n    _t: Triangle | null;\r\n\r\n    constructor(v: Vertex | null, t: Triangle | null) {\r\n        this.v = v;\r\n        this.t = t;\r\n        if (v === null) {\r\n            this.t = null;\r\n        } else if (t === null) {\r\n            this.t = v.triangle!;\r\n        }\r\n        if (this.t == null || this.t.dimension < 1) {\r\n            this.ri = 0;\r\n            this.v = null;\r\n            this.t = null;\r\n        } else {\r\n            const i = this.t.indexV(v!);\r\n            if (this.t.dimension === 2) this.ri = ccw(i);\r\n            else this.ri = 2;\r\n        }\r\n        this._ri = this.ri;\r\n        this._v = this.v;\r\n        this._t = this.t;\r\n    }\r\n\r\n    get valid(): boolean {\r\n        return this.t !== null && this.v !== null;\r\n    }\r\n\r\n    next(): boolean {\r\n        let i = this.t!.indexV(this.v!);\r\n        if (this.t!.dimension === 1) {\r\n            this.t = this.t!.neighbours[i === 0 ? 1 : 0];\r\n        } else {\r\n            this.t = this.t!.neighbours[ccw(i)];\r\n            i = this.t!.indexV(this.v!);\r\n            this.ri = ccw(i);\r\n        }\r\n        return this.ri !== this._ri || this.v !== this._v || this.t !== this._t;\r\n    }\r\n}\r\n\r\nexport class EdgeIterator {\r\n    private i = 0;\r\n    pos: Triangle | null;\r\n    edge: Edge = new Edge();\r\n    tds: TDS;\r\n    _es = 0;\r\n    constructor(tds: TDS) {\r\n        this.tds = tds;\r\n        this.edge.second = 0;\r\n        if (tds.dimension <= 0) {\r\n            this.pos = null;\r\n            return;\r\n        }\r\n        this.pos = tds.triangles[0];\r\n        if (tds.dimension === 1) this.edge.second = 2;\r\n        while (this.pos !== null && !this.associatedEdge()) {\r\n            throw new Error(\"[poi\");\r\n        }\r\n\r\n        if (tds.dimension === 1) this._es = 2;\r\n    }\r\n\r\n    get valid(): boolean {\r\n        return (this.pos !== null || this._es !== this.edge.second) && this.pos!.isInfinite(this.edge.second);\r\n    }\r\n\r\n    next(): void {\r\n        do {\r\n            this.increment();\r\n        } while (this.pos !== null && !this.associatedEdge());\r\n    }\r\n\r\n    collect(): Edge {\r\n        this.edge.first = this.pos;\r\n        return this.edge;\r\n    }\r\n\r\n    associatedEdge(): boolean {\r\n        if (this.tds.dimension === 1) return true;\r\n        return (\r\n            this.tds.triangles.indexOf(this.pos!) < this.tds.triangles.indexOf(this.pos!.neighbours[this.edge.second]!)\r\n        );\r\n    }\r\n\r\n    increment(): void {\r\n        if (this.tds.dimension === 1) {\r\n            this.i++;\r\n            if (this.tds.triangles.length <= this.i) this.pos = null;\r\n            else this.pos = this.tds.triangles[this.i];\r\n        } else if (this.edge.second === 2) {\r\n            this.edge.second = 0;\r\n            this.i++;\r\n            if (this.tds.triangles.length <= this.i) this.pos = null;\r\n            else this.pos = this.tds.triangles[this.i];\r\n        } else {\r\n            this.edge.second++;\r\n        }\r\n    }\r\n}\r\n\r\nexport class FaceCirculator {\r\n    v: Vertex | null;\r\n    t: Triangle | null;\r\n    _v: Vertex | null;\r\n    _t: Triangle | null;\r\n\r\n    constructor(v: Vertex | null, t: Triangle | null) {\r\n        this.v = v;\r\n        this.t = t;\r\n        if (v === null) {\r\n            this.t = null;\r\n        } else if (t === null) {\r\n            this.t = v.triangle!;\r\n        }\r\n        if (this.t == null || this.t.dimension < 2) {\r\n            this.v = null;\r\n            this.t = null;\r\n        }\r\n        this._v = this.v;\r\n        this._t = this.t;\r\n    }\r\n\r\n    get valid(): boolean {\r\n        return this.t !== null && this.v !== null;\r\n    }\r\n\r\n    prev(): void {\r\n        const i = this.t!.indexV(this.v!);\r\n        this.t = this.t!.neighbours[cw(i)];\r\n    }\r\n\r\n    next(): boolean {\r\n        const i = this.t!.indexV(this.v!);\r\n        this.t = this.t!.neighbours[ccw(i)];\r\n        return this.v !== this._v || this.t !== this._t;\r\n    }\r\n}\r\n\r\nexport class LineFaceCirculator {\r\n    private i = 0;\r\n    pos: Triangle | null = null;\r\n    _tr: CDT;\r\n    s: LineFaceState = LineFaceState.UNDEFINED;\r\n    p: Point;\r\n    q: Point;\r\n\r\n    constructor(v: Vertex, tr: CDT, dir: Point) {\r\n        this._tr = tr;\r\n        this.p = v.point!;\r\n        this.q = dir;\r\n\r\n        const fc = new FaceCirculator(v, null);\r\n        let ic = fc.t!.indexV(v);\r\n        let vt = fc.t!.vertices[cw(ic)]!;\r\n        while (v === _INFINITE_VERTEX || orientation(this.p, this.q, vt.point!) !== Sign.LEFT_TURN) {\r\n            fc.next();\r\n            ic = fc.t!.indexV(v);\r\n            vt = fc.t!.vertices[cw(ic)]!;\r\n            if (!fc.valid) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        let vr = fc.t!.vertices[ccw(ic)]!;\r\n        let pqr: Sign = Sign.RIGHT_TURN;\r\n        // tslint:disable:no-conditional-assignment\r\n        while (vr !== _INFINITE_VERTEX && (pqr = orientation(this.p, this.q, vr.point!)) === Sign.LEFT_TURN) {\r\n            fc.prev();\r\n            ic = fc.t!.indexV(v);\r\n            vr = fc.t!.vertices[ccw(ic)]!;\r\n        }\r\n\r\n        ic = fc.t!.indexV(v);\r\n        vt = fc.t!.vertices[cw(ic)]!;\r\n\r\n        if (vr === _INFINITE_VERTEX) {\r\n            fc.prev();\r\n            ic = fc.t!.indexV(v);\r\n            vr = fc.t!.vertices[ccw(ic)]!;\r\n            pqr = orientation(this.p, this.q, vr.point!);\r\n            switch (pqr) {\r\n                case Sign.RIGHT_TURN:\r\n                case Sign.COLLINEAR: {\r\n                    fc.next();\r\n                    ic = fc.t!.indexV(_INFINITE_VERTEX);\r\n                    this.pos = fc.t!;\r\n                    this.s = LineFaceState.VERTEX_VERTEX;\r\n                    this.i = ic;\r\n                    break;\r\n                }\r\n                case Sign.LEFT_TURN: {\r\n                    break;\r\n                }\r\n            }\r\n        } else if (pqr === Sign.COLLINEAR) {\r\n            this.pos = fc.t!;\r\n            this.s = LineFaceState.VERTEX_VERTEX;\r\n            this.i = ccw(ic);\r\n        } else {\r\n            this.pos = fc.t!;\r\n            this.s = LineFaceState.VERTEX_EDGE;\r\n            this.i = ic;\r\n        }\r\n    }\r\n\r\n    next(): void {\r\n        this.increment();\r\n    }\r\n\r\n    increment(): void {\r\n        let o: Sign;\r\n        if (this.s === LineFaceState.VERTEX_VERTEX || this.s === LineFaceState.EDGE_VERTEX) {\r\n            do {\r\n                const n = this.pos!.neighbours[cw(this.i)]!;\r\n                this.i = n.indexT(this.pos!);\r\n                this.pos = n;\r\n                if (this.pos!.vertices[this.i] === _INFINITE_VERTEX) {\r\n                    o = Sign.COLLINEAR;\r\n                    this.i = cw(this.i);\r\n                    break;\r\n                }\r\n                o = orientation(this.p, this.q, this.pos!.vertices[this.i]!.point!);\r\n                this.i = cw(this.i);\r\n            } while (o === Sign.LEFT_TURN);\r\n            if (o === Sign.COLLINEAR) {\r\n                this.s = LineFaceState.VERTEX_VERTEX;\r\n                this.i = ccw(this.i);\r\n            } else {\r\n                this.s = LineFaceState.VERTEX_EDGE;\r\n            }\r\n        } else {\r\n            const n = this.pos!.neighbours[this.i]!;\r\n            const ni = n.indexT(this.pos!);\r\n            this.pos = n;\r\n            o =\r\n                this.pos!.vertices[ni]! === _INFINITE_VERTEX\r\n                    ? Sign.COLLINEAR\r\n                    : orientation(this.p, this.q, this.pos!.vertices[ni]!.point!);\r\n            switch (o) {\r\n                case Sign.LEFT_TURN: {\r\n                    this.s = LineFaceState.EDGE_EDGE;\r\n                    this.i = ccw(ni);\r\n                    break;\r\n                }\r\n                case Sign.RIGHT_TURN: {\r\n                    this.s = LineFaceState.EDGE_EDGE;\r\n                    this.i = cw(ni);\r\n                    break;\r\n                }\r\n                default: {\r\n                    this.s = LineFaceState.EDGE_VERTEX;\r\n                    this.i = ni;\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nclass Edge {\r\n    first: Triangle | null = null;\r\n    second: number = 0;\r\n}\r\n\r\nexport enum LocateType {\r\n    VERTEX,\r\n    EDGE,\r\n    FACE,\r\n    OUTSIDE_CONVEX_HULL,\r\n    OUTSIDE_AFFINE_HULL,\r\n}\r\n\r\nexport class TDS {\r\n    dimension = -1;\r\n    vertices: Vertex[] = [];\r\n    triangles: Triangle[] = [];\r\n    _infinite: Vertex;\r\n\r\n    constructor() {\r\n        this._infinite = this.createVertex();\r\n        _INFINITE_VERTEX = this._infinite;\r\n        const t = new Triangle();\r\n        t.addVertex(this._infinite);\r\n        this.triangles.push(t);\r\n    }\r\n\r\n    createVertex(): Vertex {\r\n        const v = this.infiniteVertex;\r\n        if (v === undefined) {\r\n            console.log(\"UNDEFINED HIERE\");\r\n        }\r\n        this.vertices.push(v);\r\n        return v;\r\n    }\r\n\r\n    createTriangle(\r\n        v0: Vertex | null,\r\n        v1: Vertex | null,\r\n        v2: Vertex | null,\r\n        n0: Triangle | null,\r\n        n1: Triangle | null,\r\n        n2: Triangle | null,\r\n    ): Triangle {\r\n        const t = new Triangle(v0, v1, v2);\r\n        t.neighbours[0] = n0;\r\n        t.neighbours[1] = n1;\r\n        t.neighbours[2] = n2;\r\n        this.triangles.push(t);\r\n        return t;\r\n    }\r\n\r\n    deleteTriangle(trig: Triangle): void {\r\n        this.triangles = this.triangles.filter(t => t !== trig);\r\n    }\r\n\r\n    setAdjacency(t0: Triangle, i0: number, t1: Triangle, i1: number): void {\r\n        t0.neighbours[i0] = t1;\r\n        t1.neighbours[i1] = t0;\r\n    }\r\n\r\n    get finiteVertex(): Vertex {\r\n        return this.vertices[1];\r\n    }\r\n\r\n    get infiniteVertex(): Vertex {\r\n        const v = new Vertex(newPoint());\r\n        v.infinite = true;\r\n        return v;\r\n    }\r\n\r\n    get finiteEdge(): Edge {\r\n        if (this.dimension < 1) throw new Error(\"aspo\");\r\n        const ei = new EdgeIterator(this);\r\n        while (ei.valid) ei.next();\r\n        return ei.collect();\r\n    }\r\n\r\n    insertDimUp(w: Vertex = new Vertex(), orient: boolean = true): Vertex {\r\n        const v = this.createVertex();\r\n        this.dimension++;\r\n        let t1: Triangle;\r\n        let t2: Triangle;\r\n        switch (this.dimension) {\r\n            case 0: {\r\n                t1 = this.triangles[0];\r\n                t2 = new Triangle(v);\r\n                this.triangles.push(t2);\r\n                this.setAdjacency(t1, 0, t2, 0);\r\n                v.triangle = t2;\r\n                break;\r\n            }\r\n            case 1:\r\n            case 2: {\r\n                const deleteList: Triangle[] = [];\r\n                const triangles = this.triangles.slice(0, this.triangles.length);\r\n                for (const trig of triangles) {\r\n                    const copy = new Triangle().from(trig);\r\n                    this.triangles.push(copy);\r\n                    trig.vertices[this.dimension] = v;\r\n                    copy.vertices[this.dimension] = w;\r\n                    this.setAdjacency(trig, this.dimension, copy, this.dimension);\r\n                    if (trig.vertices.includes(w)) deleteList.push(copy);\r\n                }\r\n                for (const trig of triangles) {\r\n                    const neighbour = trig.neighbours[this.dimension];\r\n                    for (let j = 0; j < this.dimension; ++j) {\r\n                        neighbour!.neighbours[j] = trig.neighbours[j]!.neighbours[this.dimension];\r\n                    }\r\n                }\r\n\r\n                let lfit = 0;\r\n                if (this.dimension === 1) {\r\n                    if (orient) {\r\n                        triangles[lfit].reorient();\r\n                        lfit++;\r\n                        triangles[lfit].neighbours[1]!.reorient();\r\n                    } else {\r\n                        triangles[lfit].neighbours[1]!.reorient();\r\n                        lfit++;\r\n                        triangles[lfit].reorient();\r\n                    }\r\n                } else {\r\n                    for (const trig of triangles) {\r\n                        if (orient) trig.neighbours[2]!.reorient();\r\n                        else trig.reorient();\r\n                    }\r\n                }\r\n\r\n                for (const trig of deleteList) {\r\n                    let j = 1;\r\n                    if (trig.vertices[0] === w) j = 0;\r\n                    t1 = trig.neighbours[this.dimension]!;\r\n                    const i1 = this.mirrorIndex(trig, this.dimension);\r\n                    t2 = trig.neighbours[j]!;\r\n                    const i2 = this.mirrorIndex(trig, j);\r\n                    this.setAdjacency(t1, i1, t2, i2);\r\n                    this.deleteTriangle(trig);\r\n                }\r\n                v.triangle = triangles[0];\r\n                break;\r\n            }\r\n            default: {\r\n                throw new Error(\"Dimension unknown\");\r\n            }\r\n        }\r\n        return v;\r\n    }\r\n\r\n    mirrorIndex(t: Triangle, i: number): number {\r\n        if (t.dimension === 1) {\r\n            const j = t.neighbours[i]!.indexV(t.vertices[i === 0 ? 1 : 0]!);\r\n            return j === 0 ? 1 : 0;\r\n        }\r\n        return ccw(t.neighbours[i]!.indexV(t.vertices[ccw(i)]!));\r\n    }\r\n\r\n    insertInFace(t: Triangle): Vertex {\r\n        const v = this.createVertex();\r\n        const v0 = t.vertices[0]!;\r\n        const v1 = t.vertices[1]!;\r\n        const v2 = t.vertices[2]!;\r\n        const n1 = t.neighbours[1]!;\r\n        const n2 = t.neighbours[2]!;\r\n        const t1 = this.createTriangle(v0, v, v2, t, n1, null);\r\n        const t2 = this.createTriangle(v0, v1, v, t, null, n2);\r\n        this.setAdjacency(t1, 2, t2, 1);\r\n        if (n1 !== null) {\r\n            const i1 = this.mirrorIndex(t, 1);\r\n            n1.neighbours[i1] = t1;\r\n        }\r\n        if (n2 !== null) {\r\n            const i2 = this.mirrorIndex(t, 2);\r\n            n2.neighbours[i2] = t2;\r\n        }\r\n        t.vertices[0] = v;\r\n        t.neighbours[1] = t1;\r\n        t.neighbours[2] = t2;\r\n        if (v0.triangle === t) v0.triangle = t2;\r\n        v.triangle = t;\r\n        return v;\r\n    }\r\n\r\n    flip(t: Triangle, i: number): void {\r\n        const n = t.neighbours[i]!;\r\n        const ni = this.mirrorIndex(t, i);\r\n        const vCW = t.vertices[cw(i)]!;\r\n        const vCCW = t.vertices[ccw(i)]!;\r\n        const tr = t.neighbours[ccw(i)]!;\r\n        const tri = this.mirrorIndex(t, ccw(i));\r\n        const bl = n.neighbours[ccw(ni)]!;\r\n        const bli = this.mirrorIndex(n, ccw(ni));\r\n\r\n        t.vertices[cw(i)] = n.vertices[ni]!;\r\n        n.vertices[cw(ni)] = t.vertices[i]!;\r\n\r\n        this.setAdjacency(t, i, bl, bli);\r\n        this.setAdjacency(t, ccw(i), n, ccw(ni));\r\n        this.setAdjacency(n, ni, tr, tri);\r\n\r\n        if (vCW.triangle! === t) vCW.triangle = n;\r\n        if (vCCW.triangle! === n) vCCW.triangle = t;\r\n    }\r\n\r\n    insertInEdge(t: Triangle, i: number): Vertex {\r\n        let v: Vertex;\r\n        if (this.dimension === 1) {\r\n            v = this.createVertex();\r\n            const ff = t.neighbours[0]!;\r\n            const vv = t.vertices[1]!;\r\n            const g = this.createTriangle(v, vv, null, ff, t, null);\r\n            t.vertices[1] = v;\r\n            t.neighbours[0] = g;\r\n            ff.neighbours[1] = g;\r\n            v.triangle = g;\r\n            vv.triangle = ff;\r\n        } else {\r\n            const n = t.neighbours[i]!;\r\n            const ni = this.mirrorIndex(t, i);\r\n            v = this.insertInFace(t);\r\n            this.flip(n, ni);\r\n        }\r\n        return v;\r\n    }\r\n}\r\n\r\nexport class BoundingBox {\r\n    x1: number;\r\n    x2: number;\r\n    y1: number;\r\n    y2: number;\r\n    constructor(p: Point) {\r\n        this.x1 = p[0];\r\n        this.y1 = p[1];\r\n        this.x2 = p[0];\r\n        this.y2 = p[1];\r\n    }\r\n\r\n    dilate(dist: number): void {\r\n        this.x1 -= dist * ulp(this.x1);\r\n        this.y1 -= dist * ulp(this.y1);\r\n        this.x2 += dist * ulp(this.x2);\r\n        this.y2 += dist * ulp(this.y2);\r\n    }\r\n\r\n    overlaps(other: BoundingBox): boolean {\r\n        if (this.x2 < other.x1 || other.x2 < this.x1) return false;\r\n        if (this.y2 < other.y1 || other.y2 < this.y1) return false;\r\n        return true;\r\n    }\r\n}\r\n","import { layerManager } from \"@/game/layers/manager\";\r\nimport { visibilityStore } from \"../store\";\r\nimport { CDT } from \"./cdt\";\r\n\r\nexport enum TriangulationTarget {\r\n    VISION = \"vision\",\r\n    MOVEMENT = \"movement\",\r\n}\r\n\r\nexport let PA_CDT = {\r\n    vision: new CDT(),\r\n    movement: new CDT(),\r\n};\r\n\r\nexport function triangulate(target: TriangulationTarget, partial: boolean = false): void {\r\n    const cdt = new CDT();\r\n    PA_CDT[target] = cdt;\r\n    let shapes;\r\n    if (target === \"vision\") shapes = visibilityStore.visionBlockers;\r\n    else shapes = visibilityStore.movementblockers;\r\n\r\n    for (const sh of shapes) {\r\n        const shape = layerManager.UUIDMap.get(sh)!;\r\n        if (partial && !shape.visibleInCanvas(layerManager.getLayer()!.canvas)) continue;\r\n        const j = shape.isClosed ? 0 : 1;\r\n        for (let i = 0; i < shape.points.length - j; i++) {\r\n            cdt.insertConstraint(shape.points[i], shape.points[(i + 1) % shape.points.length]);\r\n        }\r\n    }\r\n    // LEFT WALL\r\n    cdt.insertConstraint([-1e8, -1e8], [-1e8, 1e8]);\r\n    cdt.insertConstraint([-1e8, 1e8], [-1e11, 1e8]);\r\n    cdt.insertConstraint([-1e11, 1e8], [-1e11, -1e8]);\r\n    cdt.insertConstraint([-1e11, -1e8], [-1e8, -1e8]);\r\n    // TOP WALL\r\n    cdt.insertConstraint([-1e8, -1e8], [1e8, -1e8]);\r\n    cdt.insertConstraint([1e8, -1e8], [1e8, -1e11]);\r\n    cdt.insertConstraint([1e8, -1e11], [-1e8, -1e11]);\r\n    cdt.insertConstraint([-1e8, -1e11], [-1e8, -1e8]);\r\n    // RIGHT WALL\r\n    cdt.insertConstraint([1e8, -1e8], [1e8, 1e8]);\r\n    cdt.insertConstraint([1e8, 1e8], [1e11, 1e8]);\r\n    cdt.insertConstraint([1e11, 1e8], [1e11, -1e8]);\r\n    cdt.insertConstraint([1e11, -1e8], [1e8, -1e8]);\r\n    // BOT WALL\r\n    cdt.insertConstraint([-1e8, 1e8], [1e8, 1e8]);\r\n    cdt.insertConstraint([1e8, 1e8], [1e8, 1e11]);\r\n    cdt.insertConstraint([1e8, 1e11], [-1e8, 1e11]);\r\n    cdt.insertConstraint([-1e8, 1e11], [-1e8, 1e8]);\r\n    (<any>window).CDT = PA_CDT;\r\n}\r\n","import {\r\n    BoundingBox,\r\n    EdgeCirculator,\r\n    FaceCirculator,\r\n    LineFaceCirculator,\r\n    LocateType,\r\n    Point,\r\n    Sign,\r\n    TDS,\r\n    Triangle,\r\n    Vertex,\r\n} from \"./tds\";\r\nimport {\r\n    ccw,\r\n    collinearBetween,\r\n    cw,\r\n    edgeInfo,\r\n    hasInexactNegativeOrientation,\r\n    intersection,\r\n    orientation,\r\n    sideOfOrientedCircle,\r\n    xyEqual,\r\n} from \"./triag\";\r\n\r\nexport type Edge = [Triangle, number];\r\n\r\nexport class CDT {\r\n    tds: TDS;\r\n    constructor() {\r\n        this.tds = new TDS();\r\n    }\r\n    insertConstraint(a: Point, b: Point): void {\r\n        const va = this.insert(a);\r\n        const vb = this.insert(b);\r\n        if (va !== vb) this.insertConstraintV(va, vb);\r\n    }\r\n\r\n    insertConstraintV(va: Vertex, vb: Vertex): void {\r\n        const stack = [[va, vb]];\r\n        while (stack.length > 0) {\r\n            const v = stack.pop()!;\r\n            const info = edgeInfo(v[0], v[1]);\r\n            if (info.includes) {\r\n                this.markConstraint(info.fr!, info.i!);\r\n                if (info.vi! !== v[1]) {\r\n                    stack.push([info.vi!, v[1]]);\r\n                }\r\n                continue;\r\n            }\r\n            const intersectionInfo = this.findIntersectedFaces(v[0], v[1]);\r\n            if (intersectionInfo.found) {\r\n                if (intersectionInfo.vi !== v[0] && intersectionInfo.vi !== v[1]) {\r\n                    stack.push([v[0], intersectionInfo.vi]);\r\n                    stack.push([intersectionInfo.vi, v[1]]);\r\n                } else {\r\n                    stack.push(v);\r\n                }\r\n                continue;\r\n            }\r\n            this.triangulateHole(intersectionInfo.intersectedFaces, intersectionInfo.listAB, intersectionInfo.listBA);\r\n            if (intersectionInfo.vi !== v[1]) {\r\n                stack.push([intersectionInfo.vi, v[1]]);\r\n            }\r\n        }\r\n    }\r\n\r\n    triangulateHole(intersectedFaces: Triangle[], listAB: Edge[], listBA: Edge[]): void {\r\n        const edges: Edge[] = [];\r\n        this.triangulateHole2(intersectedFaces, listAB, listBA, edges);\r\n        this.propagatingFlipE(edges);\r\n    }\r\n\r\n    triangulateHole2(intersectedFaces: Triangle[], listAB: Edge[], listBA: Edge[], edges: Edge[]): void {\r\n        if (listAB.length > 0) {\r\n            this.triangulateHalfHole(listAB, edges);\r\n            this.triangulateHalfHole(listBA, edges);\r\n            const fl = listAB[0][0];\r\n            const fr = listBA[0][0];\r\n            fl.neighbours[2] = fr;\r\n            fr.neighbours[2] = fl;\r\n            fl.constraints[2] = true;\r\n            fr.constraints[2] = true;\r\n\r\n            while (intersectedFaces.length > 0) {\r\n                this.tds.deleteTriangle(intersectedFaces.shift()!);\r\n            }\r\n        }\r\n    }\r\n\r\n    triangulateHalfHole(conflictBoundaries: Edge[], edges: Edge[]): void {\r\n        let iC = 0;\r\n        let iN: number;\r\n        let iT: number;\r\n        const current = (): [Triangle, number] => conflictBoundaries[iC];\r\n        const next = (): [Triangle, number] => conflictBoundaries[iN];\r\n        // const tempo = (): [Triangle, number] => conflictBoundaries[iT];\r\n\r\n        const va = current()[0].vertices[ccw(current()[1])]!;\r\n        iN = iC;\r\n        ++iN;\r\n\r\n        let n: Triangle;\r\n        let n1: Triangle;\r\n        let n2: Triangle;\r\n        let ind: number;\r\n        let ind1: number;\r\n        let ind2: number;\r\n        do {\r\n            n1 = current()[0];\r\n            ind1 = current()[1];\r\n            if (n1.neighbours[ind1] !== null) {\r\n                n = n1.neighbours[ind1]!;\r\n                ind = cw(n.indexV(n1.vertices[cw(ind1)]!));\r\n                n1 = n.neighbours[ind]!;\r\n                ind1 = this.tds.mirrorIndex(n, ind);\r\n            }\r\n            n2 = next()[0];\r\n            ind2 = next()[1];\r\n            if (n2.neighbours[ind2] !== null) {\r\n                n = n2.neighbours[ind2]!;\r\n                ind = cw(n.indexV(n2.vertices[cw(ind2)]!));\r\n                n2 = n.neighbours[ind]!;\r\n                ind2 = this.tds.mirrorIndex(n, ind);\r\n            }\r\n            const v0 = n1.vertices[ccw(ind1)]!;\r\n            const v1 = n1.vertices[cw(ind1)]!;\r\n            const v2 = n2.vertices[cw(ind2)]!;\r\n            const orient = orientation(v0.point!, v1.point!, v2.point!);\r\n            switch (orient) {\r\n                case Sign.RIGHT_TURN: {\r\n                    const newlf = this.tds.createTriangle(v0, v2, v1, null, null, null);\r\n                    edges.push([newlf, 2]);\r\n                    newlf.neighbours[1] = n1;\r\n                    newlf.neighbours[0] = n2;\r\n                    n1.neighbours[ind1] = newlf;\r\n                    n2.neighbours[ind2] = newlf;\r\n                    if (n1.isConstrained(ind1)) newlf.constraints[1] = true;\r\n                    if (n2.isConstrained(ind2)) newlf.constraints[0] = true;\r\n                    v0.triangle = newlf;\r\n                    v1.triangle = newlf;\r\n                    v2.triangle = newlf;\r\n                    iT = iC + 1;\r\n                    conflictBoundaries.splice(iC, 0, [newlf, 2]);\r\n                    conflictBoundaries.splice(Math.max(iT, iN), 1);\r\n                    conflictBoundaries.splice(Math.min(iT, iN), 1);\r\n                    iN = iC;\r\n                    if (v0 !== va) --iC;\r\n                    else ++iN;\r\n                    break;\r\n                }\r\n                case Sign.LEFT_TURN:\r\n                case Sign.COLLINEAR: {\r\n                    ++iC;\r\n                    ++iN;\r\n                    break;\r\n                }\r\n            }\r\n        } while (iN < conflictBoundaries.length);\r\n    }\r\n\r\n    findIntersectedFaces(\r\n        vaa: Vertex,\r\n        vbb: Vertex,\r\n    ): { found: boolean; vi: Vertex; listAB: Edge[]; listBA: Edge[]; intersectedFaces: Triangle[] } {\r\n        const aa = vaa.point!;\r\n        const bb = vbb.point!;\r\n        const listAB: Edge[] = [];\r\n        const listBA: Edge[] = [];\r\n        const intersectedFaces: Triangle[] = [];\r\n        const lfc = new LineFaceCirculator(vaa, this, bb);\r\n        let ind = lfc.pos!.indexV(vaa);\r\n        let vi: Vertex;\r\n        if (lfc.pos!.isConstrained(ind)) {\r\n            vi = this.intersect(lfc.pos!, ind, vaa, vbb);\r\n            return { found: true, vi, listAB, listBA, intersectedFaces };\r\n        }\r\n        let lf = lfc.pos!.neighbours[ccw(ind)]!;\r\n        let rf = lfc.pos!.neighbours[cw(ind)]!;\r\n        listAB.push([lf, lf.indexT(lfc.pos!)]);\r\n        listBA.unshift([rf, rf.indexT(lfc.pos!)]);\r\n        intersectedFaces.unshift(lfc.pos!);\r\n        let previousFace = lfc.pos!;\r\n        lfc.next();\r\n        ind = lfc.pos!.indexT(previousFace);\r\n        let currentVertex = lfc.pos!.vertices[ind]!;\r\n        let done = false;\r\n        while (currentVertex !== vbb && !done) {\r\n            let i1: number;\r\n            let i2: number;\r\n            const orient = orientation(aa, bb, currentVertex.point!);\r\n            switch (orient) {\r\n                case Sign.COLLINEAR: {\r\n                    done = true;\r\n                    break;\r\n                }\r\n                case Sign.LEFT_TURN:\r\n                case Sign.RIGHT_TURN: {\r\n                    if (orient === Sign.LEFT_TURN) {\r\n                        i1 = ccw(ind);\r\n                        i2 = cw(ind);\r\n                    } else {\r\n                        i1 = cw(ind);\r\n                        i2 = ccw(ind);\r\n                    }\r\n                    if (lfc.pos!.isConstrained(i1)) {\r\n                        vi = this.intersect(lfc.pos!, i1, vaa, vbb);\r\n                        return { found: true, vi, listAB, listBA, intersectedFaces };\r\n                    } else {\r\n                        lf = lfc.pos!.neighbours[i2]!;\r\n                        intersectedFaces.unshift(lfc.pos!);\r\n                        if (orient === Sign.LEFT_TURN) listAB.push([lf, lf.indexT(lfc.pos!)]);\r\n                        else listBA.unshift([lf, lf.indexT(lfc.pos!)]);\r\n                        previousFace = lfc.pos!;\r\n                        lfc.next();\r\n                        ind = lfc.pos!.indexT(previousFace);\r\n                        currentVertex = lfc.pos!.vertices[ind]!;\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        vi = currentVertex;\r\n        intersectedFaces.unshift(lfc.pos!);\r\n        lf = lfc.pos!.neighbours[cw(ind)]!;\r\n        listAB.push([lf, lf.indexT(lfc.pos!)]);\r\n        rf = lfc.pos!.neighbours[ccw(ind)]!;\r\n        listBA.unshift([rf, rf.indexT(lfc.pos!)]);\r\n        return { found: false, vi, listAB, listBA, intersectedFaces };\r\n    }\r\n\r\n    intersect(t: Triangle, i: number, vaa: Vertex, vbb: Vertex): Vertex {\r\n        const vcc = t.vertices[cw(i)]!;\r\n        const vdd = t.vertices[ccw(i)]!;\r\n        const pa = vaa.point!;\r\n        const pb = vbb.point!;\r\n        const pc = vcc.point!;\r\n        const pd = vdd.point!;\r\n        let pi = intersection(pa, pb, pc, pd);\r\n        if (pi !== pa && pi !== pb && pi !== pc && pi !== pd) {\r\n            const bbox = new BoundingBox(pi!);\r\n            bbox.dilate(4);\r\n            if (bbox.overlaps(new BoundingBox(pa))) pi = pa;\r\n            if (bbox.overlaps(new BoundingBox(pb))) pi = pb;\r\n            if (bbox.overlaps(new BoundingBox(pc))) pi = pc;\r\n            if (bbox.overlaps(new BoundingBox(pd))) pi = pd;\r\n        }\r\n        let vi: Vertex;\r\n        if (pi === null) throw new Error(\"what\");\r\n        else {\r\n            this.removeConstrainedEdge(t, i);\r\n            vi = this.insert(pi, t);\r\n        }\r\n\r\n        if (vi !== vcc && vi !== vdd) {\r\n            this.insertConstraintV(vcc, vi);\r\n            this.insertConstraintV(vi, vdd);\r\n        } else {\r\n            this.insertConstraintV(vcc, vdd);\r\n        }\r\n        return vi;\r\n    }\r\n\r\n    removeConstrainedEdge(t: Triangle, i: number): void {\r\n        t.constraints[i] = false;\r\n        if (this.tds.dimension === 2) t.neighbours[i]!.constraints[this.tds.mirrorIndex(t, i)] = false;\r\n    }\r\n\r\n    updateConstraintsOpposite(v: Vertex): void {\r\n        let t = v.triangle!;\r\n        const start = t;\r\n        let indf: number;\r\n        do {\r\n            indf = t.indexV(v);\r\n            if (t.neighbours[indf]!.constraints[this.tds.mirrorIndex(t, indf)]) t.constraints[indf] = true;\r\n            else t.constraints[indf] = false;\r\n            t = t.neighbours[ccw(indf)]!;\r\n        } while (t !== start);\r\n    }\r\n\r\n    markConstraint(t: Triangle, i: number): void {\r\n        if (this.tds.dimension === 1) t.constraints[2] = true;\r\n        else {\r\n            t.constraints[i] = true;\r\n            t.neighbours[i]!.constraints[this.tds.mirrorIndex(t, i)] = true;\r\n        }\r\n    }\r\n\r\n    insert(p: Point, start: Triangle | null = null): Vertex {\r\n        const locateInfo = this.locate(p, this.iLocate(p, start));\r\n        const va = this.insertb(p, locateInfo.loc, locateInfo.lt, locateInfo.li);\r\n        this.flipAround(va);\r\n        return va;\r\n    }\r\n\r\n    flipAround(v: Vertex): void {\r\n        if (this.tds.dimension <= 1) return;\r\n        let t = v.triangle!;\r\n        let i: number;\r\n        let next: Triangle;\r\n        const start = t;\r\n        do {\r\n            i = t.indexV(v);\r\n            next = t.neighbours[ccw(i)]!;\r\n            this.propagatingFlip(t, i);\r\n            t = next;\r\n        } while (next !== start);\r\n    }\r\n\r\n    propagatingFlip(t: Triangle, i: number, depth = 0): void {\r\n        if (!this.isFlipable(t, i)) return;\r\n        const maxDepth = 100;\r\n        if (depth === maxDepth) {\r\n            throw new Error(\"maxde\");\r\n        }\r\n        const ni = t.neighbours[i]!;\r\n        this.flip(t, i);\r\n        this.propagatingFlip(t, i, depth + 1);\r\n        i = ni.indexV(t.vertices[i]!);\r\n        this.propagatingFlip(ni, i, depth + 1);\r\n    }\r\n\r\n    lessEdge(e1: Edge, e2: Edge): boolean {\r\n        const ind1 = e1[1];\r\n        const ind2 = e2[1];\r\n        return e1[0].uid < e2[0].uid || (e1[0].uid === e2[0].uid && ind1 < ind2);\r\n    }\r\n\r\n    propagatingFlipE(edges: Edge[]): void {\r\n        let eI = 0;\r\n        let t: Triangle;\r\n        let i: number;\r\n        let eni: Edge;\r\n        const edgeSet: Edge[] = [];\r\n        while (eI < edges.length) {\r\n            t = edges[eI][0];\r\n            i = edges[eI][1];\r\n            if (this.isFlipable(t, i)) {\r\n                eni = [t.neighbours[i]!, this.tds.mirrorIndex(t, i)];\r\n                if (this.lessEdge(edges[eI], eni)) edgeSet.push(edges[eI]);\r\n                else edgeSet.push(eni);\r\n            }\r\n            ++eI;\r\n        }\r\n        let indf: number;\r\n        let ni: Triangle;\r\n        let indn: number;\r\n        let ei: Edge;\r\n        const e: (Edge | null)[] = [null, null, null, null];\r\n        while (edgeSet.length > 0) {\r\n            t = edgeSet[0][0];\r\n            indf = edgeSet[0][1];\r\n            ni = t.neighbours[indf]!;\r\n            indn = this.tds.mirrorIndex(t, indf);\r\n            ei = [t, indf];\r\n            edgeSet.splice(\r\n                edgeSet.findIndex(ed => ed[0] === ei[0] && ed[1] === ei[1]),\r\n                1,\r\n            );\r\n            e[0] = [t, cw(indf)];\r\n            e[1] = [t, ccw(indf)];\r\n            e[2] = [ni, cw(indn)];\r\n            e[3] = [ni, ccw(indn)];\r\n\r\n            for (const edge of e) {\r\n                const tt = edge![0];\r\n                const ii = edge![1];\r\n                eni = [tt.neighbours[ii]!, this.tds.mirrorIndex(tt, ii)];\r\n                if (this.lessEdge(edge!, eni))\r\n                    edgeSet.splice(\r\n                        edgeSet.findIndex(ed => ed[0] === edge![0] && ed[1] === edge![1]),\r\n                        1,\r\n                    );\r\n                else\r\n                    edgeSet.splice(\r\n                        edgeSet.findIndex(ed => ed[0] === eni[0] && ed[1] === eni[1]),\r\n                        1,\r\n                    );\r\n            }\r\n\r\n            this.flip(t, indf);\r\n\r\n            for (const edge of e) {\r\n                const tt = edge![0];\r\n                const ii = edge![1];\r\n                if (this.isFlipable(tt, ii)) {\r\n                    eni = [tt.neighbours[ii]!, this.tds.mirrorIndex(tt, ii)];\r\n                    if (this.lessEdge(edge!, eni)) edgeSet.push(edge!);\r\n                    else edgeSet.push(eni);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    flip(t: Triangle, i: number): void {\r\n        const u = t.neighbours[i]!;\r\n        const j = this.tds.mirrorIndex(t, i);\r\n        const t1 = t.neighbours[cw(i)]!;\r\n        const i1 = this.tds.mirrorIndex(t, cw(i));\r\n        const t2 = t.neighbours[ccw(i)]!;\r\n        const i2 = this.tds.mirrorIndex(t, ccw(i));\r\n        const t3 = u.neighbours[cw(j)]!;\r\n        const i3 = this.tds.mirrorIndex(u, cw(j));\r\n        const t4 = u.neighbours[ccw(j)]!;\r\n        const i4 = this.tds.mirrorIndex(u, ccw(j));\r\n        this.tds.flip(t, i);\r\n        t.constraints[t.indexT(u)] = false;\r\n        u.constraints[u.indexT(t)] = false;\r\n        t1.neighbours[i1]!.constraints[this.tds.mirrorIndex(t1, i1)] = t1.constraints[i1];\r\n        t2.neighbours[i2]!.constraints[this.tds.mirrorIndex(t2, i2)] = t2.constraints[i2];\r\n        t3.neighbours[i3]!.constraints[this.tds.mirrorIndex(t3, i3)] = t3.constraints[i3];\r\n        t4.neighbours[i4]!.constraints[this.tds.mirrorIndex(t4, i4)] = t4.constraints[i4];\r\n    }\r\n\r\n    isFlipable(t: Triangle, i: number, perturb = true): boolean {\r\n        const ni = t.neighbours[i]!;\r\n        if (t.isInfinite() || ni.isInfinite()) return false;\r\n        if (t.constraints[i]) return false;\r\n        return sideOfOrientedCircle(ni, t.vertices[i]!.point!, perturb) === Sign.ON_POSITIVE_SIDE;\r\n    }\r\n\r\n    insertb(a: Point, loc: Triangle | null, lt: LocateType, li: number): Vertex {\r\n        let insertInConstrainedEdge = false;\r\n        let v1: Vertex;\r\n        let v2: Vertex;\r\n        if (lt === LocateType.EDGE && loc!.isConstrained(li)) {\r\n            insertInConstrainedEdge = true;\r\n            v1 = loc!.vertices[ccw(li)]!;\r\n            v2 = loc!.vertices[cw(li)]!;\r\n        }\r\n        const va = this.insertc(a, loc, lt, li);\r\n        if (insertInConstrainedEdge) this.updateConstraintsIncident(va, v1!, v2!);\r\n        else if (lt !== LocateType.VERTEX) this.clearConstraintsIncident(va);\r\n        if (this.tds.dimension === 2) this.updateConstraintsOpposite(va);\r\n        return va;\r\n    }\r\n\r\n    updateConstraintsIncident(va: Vertex, c1: Vertex, c2: Vertex): void {\r\n        if (this.tds.dimension === 0) return;\r\n        if (this.tds.dimension === 1) {\r\n            const ec = new EdgeCirculator(va, null);\r\n            do {\r\n                ec.t!.constraints[2] = true;\r\n            } while (ec.next());\r\n        } else {\r\n            const fc = new FaceCirculator(va, null);\r\n            do {\r\n                const indf = fc.t!.indexV(va);\r\n                const cwi = cw(indf);\r\n                const ccwi = ccw(indf);\r\n                if (fc.t!.vertices[cwi] === c1 || fc.t!.vertices[cwi] === c2) {\r\n                    fc.t!.constraints[ccwi] = true;\r\n                    fc.t!.constraints[cwi] = false;\r\n                } else {\r\n                    fc.t!.constraints[ccwi] = false;\r\n                    fc.t!.constraints[cwi] = true;\r\n                }\r\n            } while (fc.next());\r\n        }\r\n    }\r\n\r\n    clearConstraintsIncident(v: Vertex): void {\r\n        const ec = new EdgeCirculator(v, null);\r\n        if (ec.valid) {\r\n            do {\r\n                const t = ec.t!;\r\n                const indf = ec.ri;\r\n                t.constraints[indf] = false;\r\n                if (this.tds.dimension === 2) t.neighbours[indf]!.constraints[this.tds.mirrorIndex(t, indf)] = false;\r\n            } while (ec.next());\r\n        }\r\n    }\r\n\r\n    insertc(p: Point, loc: Triangle | null, lt: LocateType, li: number): Vertex {\r\n        if (this.tds.vertices.length === 1) {\r\n            return this.insertFirst(p);\r\n        } else if (this.tds.vertices.length === 2) {\r\n            if (lt === LocateType.VERTEX) return this.tds.finiteVertex;\r\n            else return this.insertSecond(p);\r\n        }\r\n        switch (lt) {\r\n            case LocateType.VERTEX: {\r\n                return loc!.vertices[li]!;\r\n            }\r\n            case LocateType.OUTSIDE_AFFINE_HULL: {\r\n                return this.insertOutsideAffineHull(p);\r\n            }\r\n            case LocateType.OUTSIDE_CONVEX_HULL: {\r\n                return this.insertOutsideConvexHull(p, loc!);\r\n            }\r\n            case LocateType.EDGE: {\r\n                return this.insertInEdge(p, loc!, li);\r\n            }\r\n            case LocateType.FACE: {\r\n                return this.insertInFace(p, loc!);\r\n            }\r\n        }\r\n        throw new Error(\"qwe\");\r\n    }\r\n\r\n    insertInEdge(p: Point, loc: Triangle, li: number): Vertex {\r\n        const v = this.tds.insertInEdge(loc, li);\r\n        v.point = p;\r\n        return v;\r\n    }\r\n\r\n    insertInFace(p: Point, loc: Triangle): Vertex {\r\n        const v = this.tds.insertInFace(loc);\r\n        v.point = p;\r\n        return v;\r\n    }\r\n\r\n    insertFirst(p: Point): Vertex {\r\n        const v = this.tds.insertDimUp();\r\n        v.point = p;\r\n        return v;\r\n    }\r\n\r\n    insertSecond(p: Point): Vertex {\r\n        const v = this.tds.insertDimUp(this.tds._infinite, true);\r\n        v.point = p;\r\n        return v;\r\n    }\r\n\r\n    insertOutsideAffineHull(p: Point): Vertex {\r\n        let conform = false;\r\n        if (this.tds.dimension === 1) {\r\n            const t = this.tds.finiteEdge.first!;\r\n            const orient = orientation(t.vertices[0]!.point!, t.vertices[1]!.point!, p);\r\n            conform = orient === Sign.COUNTERCLOCKWISE;\r\n        }\r\n        const v = this.tds.insertDimUp(this.tds._infinite, conform);\r\n        v.point = p;\r\n        return v;\r\n    }\r\n\r\n    insertOutsideConvexHull(p: Point, t: Triangle): Vertex {\r\n        let v: Vertex;\r\n        if (this.tds.dimension === 1) {\r\n            throw new Error(\"sdfasdasd\");\r\n        } else {\r\n            v = this.insertOutsideConvexHull2(p, t);\r\n        }\r\n        v.point = p;\r\n        return v;\r\n    }\r\n\r\n    insertOutsideConvexHull2(p: Point, t: Triangle): Vertex {\r\n        let li = t.indexV(this.tds._infinite);\r\n        const ccwlist: Triangle[] = [];\r\n        const cwlist: Triangle[] = [];\r\n        let fc = new FaceCirculator(this.tds._infinite, t);\r\n        let done = false;\r\n        while (!done) {\r\n            fc.prev();\r\n            li = fc.t!.indexV(this.tds._infinite);\r\n            const q = fc.t!.vertices[ccw(li)]!.point!;\r\n            const r = fc.t!.vertices[cw(li)]!.point!;\r\n            if (orientation(p, q, r) === Sign.LEFT_TURN) ccwlist.push(fc.t!);\r\n            else done = true;\r\n        }\r\n        fc = new FaceCirculator(this.tds._infinite, t);\r\n        done = false;\r\n        while (!done) {\r\n            fc.next();\r\n            li = fc.t!.indexV(this.tds._infinite);\r\n            const q = fc.t!.vertices[ccw(li)]!.point!;\r\n            const r = fc.t!.vertices[cw(li)]!.point!;\r\n            if (orientation(p, q, r) === Sign.LEFT_TURN) cwlist.push(fc.t!);\r\n            else done = true;\r\n        }\r\n        const v = this.tds.insertInFace(t);\r\n        v.point = p;\r\n        let th;\r\n        while (ccwlist.length > 0) {\r\n            th = ccwlist[0];\r\n            li = ccw(th.indexV(this.tds._infinite));\r\n            this.tds.flip(th, li);\r\n            ccwlist.shift();\r\n        }\r\n        while (cwlist.length > 0) {\r\n            th = cwlist[0];\r\n            li = cw(th.indexV(this.tds._infinite));\r\n            this.tds.flip(th, li);\r\n            cwlist.shift();\r\n        }\r\n        fc = new FaceCirculator(v, null);\r\n        while (!fc.t!.isInfinite()) fc.next();\r\n        this.tds._infinite.triangle = fc.t!;\r\n        return v;\r\n    }\r\n\r\n    locate(\r\n        p: Point,\r\n        start: Triangle | null,\r\n    ): { loc: Triangle; lt: LocateType; li: number } | { loc: null; lt: number; li: number } {\r\n        let lt = 0;\r\n        let li = 0;\r\n        if (this.tds.dimension < 0) {\r\n            lt = LocateType.OUTSIDE_AFFINE_HULL;\r\n            li = 4;\r\n            return { loc: null, lt, li };\r\n        } else if (this.tds.dimension === 0) {\r\n            if (xyEqual(p, this.tds.finiteVertex.triangle!.vertices[0]!.point!)) {\r\n                lt = LocateType.VERTEX;\r\n            } else {\r\n                lt = LocateType.OUTSIDE_AFFINE_HULL;\r\n            }\r\n            li = 4;\r\n            return { loc: null, lt, li };\r\n        } else if (this.tds.dimension === 1) {\r\n            return this.marchLocate1D(p);\r\n        }\r\n        if (start === null) {\r\n            const t = this.tds._infinite.triangle!;\r\n            start = t.neighbours[t.indexV(this.tds._infinite)]!;\r\n        } else if (start.isInfinite()) {\r\n            start = start.neighbours[start.indexV(this.tds._infinite)]!;\r\n        }\r\n        return this.marchLocate2D(start, p);\r\n    }\r\n\r\n    marchLocate1D(p: Point): { loc: Triangle; lt: LocateType; li: number } {\r\n        let ff = this.tds._infinite.triangle!;\r\n        let iv = ff.indexV(this.tds._infinite);\r\n        let t = ff.neighbours[iv]!;\r\n        const pqt = orientation(t.vertices[0]!.point!, t.vertices[1]!.point!, p);\r\n        if (pqt === Sign.RIGHT_TURN || pqt === Sign.LEFT_TURN) {\r\n            return { loc: new Triangle(), lt: LocateType.OUTSIDE_AFFINE_HULL, li: 4 };\r\n        }\r\n        let i = t.indexT(ff);\r\n        if (collinearBetween(p, t.vertices[1 - i]!.point!, t.vertices[i]!.point!))\r\n            return { loc: ff, lt: LocateType.OUTSIDE_CONVEX_HULL, li: iv };\r\n\r\n        if (xyEqual(p, t.vertices[1 - i]!.point!)) return { loc: t, lt: LocateType.VERTEX, li: 1 - i };\r\n\r\n        ff = ff.neighbours[1 - iv]!;\r\n        iv = ff.indexV(this.tds._infinite);\r\n        t = ff.neighbours[iv]!;\r\n        i = t.indexT(ff);\r\n        if (collinearBetween(p, t.vertices[1 - i]!.point!, t.vertices[i]!.point!))\r\n            return { loc: ff, lt: LocateType.OUTSIDE_CONVEX_HULL, li: iv };\r\n        if (xyEqual(p, t.vertices[1 - i]!.point!)) return { loc: t, lt: LocateType.VERTEX, li: 1 - i };\r\n        throw new Error(\"sdfsdf\");\r\n    }\r\n\r\n    marchLocate2D(c: Triangle, p: Point): { loc: Triangle; lt: LocateType; li: number } {\r\n        let prev = null;\r\n        let first = true;\r\n        let lt: LocateType | undefined;\r\n        let li: number | undefined;\r\n        while (true) {\r\n            if (c.isInfinite()) {\r\n                return { loc: c, lt: LocateType.OUTSIDE_CONVEX_HULL, li: c.indexV(this.tds._infinite) };\r\n            }\r\n            const leftFirst = 0; // Math.round(Math.random());\r\n            const p0 = c.vertices[0]!.point!;\r\n            const p1 = c.vertices[1]!.point!;\r\n            const p2 = c.vertices[2]!.point!;\r\n            let o0: Sign;\r\n            let o1: Sign;\r\n            let o2: Sign;\r\n            if (first) {\r\n                prev = c;\r\n                first = false;\r\n                o0 = orientation(p0, p1, p);\r\n                if (o0 === Sign.NEGATIVE) {\r\n                    c = c.neighbours[2]!;\r\n                    continue;\r\n                }\r\n                o1 = orientation(p1, p2, p);\r\n                if (o1 === Sign.NEGATIVE) {\r\n                    c = c.neighbours[0]!;\r\n                    continue;\r\n                }\r\n                o2 = orientation(p2, p0, p);\r\n                if (o2 === Sign.NEGATIVE) {\r\n                    c = c.neighbours[1]!;\r\n                    continue;\r\n                }\r\n            } else if (leftFirst) {\r\n                if (c.neighbours[0]! === prev) {\r\n                    prev = c;\r\n                    o0 = orientation(p0, p1, p);\r\n                    if (o0 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[2]!;\r\n                        continue;\r\n                    }\r\n                    o2 = orientation(p2, p0, p);\r\n                    if (o2 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[1]!;\r\n                        continue;\r\n                    }\r\n                    o1 = Sign.POSITIVE;\r\n                } else if (c.neighbours[1]! === prev) {\r\n                    prev = c;\r\n                    o1 = orientation(p1, p2, p);\r\n                    if (o1 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[0]!;\r\n                        continue;\r\n                    }\r\n                    o0 = orientation(p0, p1, p);\r\n                    if (o0 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[2]!;\r\n                        continue;\r\n                    }\r\n                    o2 = Sign.POSITIVE;\r\n                } else {\r\n                    prev = c;\r\n                    o2 = orientation(p2, p0, p);\r\n                    if (o2 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[1]!;\r\n                        continue;\r\n                    }\r\n                    o1 = orientation(p1, p2, p);\r\n                    if (o1 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[0]!;\r\n                        continue;\r\n                    }\r\n                    o0 = Sign.POSITIVE;\r\n                }\r\n            } else {\r\n                if (c.neighbours[0] === prev) {\r\n                    prev = c;\r\n                    o2 = orientation(p2, p0, p);\r\n                    if (o2 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[1]!;\r\n                        continue;\r\n                    }\r\n                    o0 = orientation(p0, p1, p);\r\n                    if (o0 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[2]!;\r\n                        continue;\r\n                    }\r\n                    o1 = Sign.POSITIVE;\r\n                } else if (c.neighbours[1] === prev) {\r\n                    prev = c;\r\n                    o0 = orientation(p0, p1, p);\r\n                    if (o0 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[2]!;\r\n                        continue;\r\n                    }\r\n                    o1 = orientation(p1, p2, p);\r\n                    if (o1 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[0]!;\r\n                        continue;\r\n                    }\r\n                    o2 = Sign.POSITIVE;\r\n                } else {\r\n                    prev = c;\r\n                    o1 = orientation(p1, p2, p);\r\n                    if (o1 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[0]!;\r\n                        continue;\r\n                    }\r\n                    o2 = orientation(p2, p0, p);\r\n                    if (o2 === Sign.NEGATIVE) {\r\n                        c = c.neighbours[1]!;\r\n                        continue;\r\n                    }\r\n                    o0 = Sign.POSITIVE;\r\n                }\r\n            }\r\n            const sum =\r\n                (o0 === Sign.COLLINEAR ? 1 : 0) + (o1 === Sign.COLLINEAR ? 1 : 0) + (o2 === Sign.COLLINEAR ? 1 : 0);\r\n            switch (sum) {\r\n                case 0: {\r\n                    lt = LocateType.FACE;\r\n                    li = 4;\r\n                    break;\r\n                }\r\n                case 1: {\r\n                    lt = LocateType.EDGE;\r\n                    li = o0 === Sign.COLLINEAR ? 2 : o1 === Sign.COLLINEAR ? 0 : 1;\r\n                    break;\r\n                }\r\n                case 2: {\r\n                    lt = LocateType.VERTEX;\r\n                    li = o0 !== Sign.COLLINEAR ? 2 : o1 !== Sign.COLLINEAR ? 0 : 1;\r\n                    break;\r\n                }\r\n            }\r\n            if (lt === undefined || li === undefined) throw new Error(\"ert\");\r\n            return { loc: c, lt, li };\r\n        }\r\n    }\r\n\r\n    iLocate(p: Point, start: Triangle | null): Triangle | null {\r\n        if (this.tds.dimension < 2) return start;\r\n        if (start === null) {\r\n            const t = this.tds._infinite.triangle!;\r\n            start = t.neighbours[t.indexV(this.tds._infinite)];\r\n        } else if (start.isInfinite()) {\r\n            start = start.neighbours[start.indexV(this.tds._infinite)];\r\n        }\r\n        let prev = null;\r\n        let c = start!;\r\n        let first = true;\r\n        let nTurns = 2500;\r\n        while (true) {\r\n            if (!nTurns--) return c;\r\n            if (c.isInfinite()) return c;\r\n            const p0 = c.vertices[0]!.point!;\r\n            const p1 = c.vertices[1]!.point!;\r\n            const p2 = c.vertices[2]!.point!;\r\n            if (first) {\r\n                prev = c;\r\n                first = false;\r\n                if (hasInexactNegativeOrientation(p0, p1, p)) {\r\n                    c = c.neighbours[2]!;\r\n                    continue;\r\n                }\r\n                if (hasInexactNegativeOrientation(p1, p2, p)) {\r\n                    c = c.neighbours[0]!;\r\n                    continue;\r\n                }\r\n                if (hasInexactNegativeOrientation(p2, p0, p)) {\r\n                    c = c.neighbours[1]!;\r\n                    continue;\r\n                }\r\n            } else {\r\n                if (c.neighbours[0] === prev) {\r\n                    prev = c;\r\n                    if (hasInexactNegativeOrientation(p0, p1, p)) {\r\n                        c = c.neighbours[2]!;\r\n                        continue;\r\n                    }\r\n                    if (hasInexactNegativeOrientation(p2, p0, p)) {\r\n                        c = c.neighbours[1]!;\r\n                        continue;\r\n                    }\r\n                } else if (c.neighbours[1] === prev) {\r\n                    prev = c;\r\n                    if (hasInexactNegativeOrientation(p0, p1, p)) {\r\n                        c = c.neighbours[2]!;\r\n                        continue;\r\n                    }\r\n                    if (hasInexactNegativeOrientation(p1, p2, p)) {\r\n                        c = c.neighbours[0]!;\r\n                        continue;\r\n                    }\r\n                } else {\r\n                    prev = c;\r\n                    if (hasInexactNegativeOrientation(p2, p0, p)) {\r\n                        c = c.neighbours[1]!;\r\n                        continue;\r\n                    }\r\n                    if (hasInexactNegativeOrientation(p1, p2, p)) {\r\n                        c = c.neighbours[0]!;\r\n                        continue;\r\n                    }\r\n                }\r\n            }\r\n            break;\r\n        }\r\n        return c;\r\n    }\r\n}\r\n","import { socket } from \"@/game/api/socket\";\r\nimport { rootStore } from \"@/store\";\r\nimport { Action, getModule, Module, Mutation, VuexModule } from \"vuex-module-decorators\";\r\nimport { BoundingVolume } from \"./bvh/bvh\";\r\nimport { triangulate, TriangulationTarget } from \"./te/pa\";\r\n\r\nexport interface VisibilityState {\r\n    visionMode: \"bvh\" | \"triangle\";\r\n    visionBlockers: string[];\r\n}\r\n\r\n@Module({ dynamic: true, store: rootStore, name: \"visibility\", namespaced: true })\r\nclass VisibilityStore extends VuexModule implements VisibilityState {\r\n    BV = Object.freeze(new BoundingVolume([]));\r\n\r\n    visionMode: \"bvh\" | \"triangle\" = \"bvh\";\r\n    visionBlockers: string[] = [];\r\n    movementblockers: string[] = [];\r\n    visionSources: { shape: string; aura: string }[] = [];\r\n\r\n    @Mutation\r\n    setVisionMode(data: { mode: \"bvh\" | \"triangle\"; sync: boolean }): void {\r\n        this.visionMode = data.mode;\r\n        // eslint-disable-next-line @typescript-eslint/camelcase\r\n        if (data.sync) socket.emit(\"Location.Options.Set\", { vision_mode: data.mode });\r\n    }\r\n\r\n    @Mutation\r\n    recalculateVision(): void {\r\n        if (this.visionMode === \"triangle\") triangulate(TriangulationTarget.VISION);\r\n        else this.BV = Object.freeze(new BoundingVolume(this.visionBlockers));\r\n    }\r\n\r\n    @Mutation\r\n    recalculateMovement(): void {\r\n        if (this.visionMode === \"triangle\") triangulate(TriangulationTarget.MOVEMENT);\r\n    }\r\n\r\n    @Action\r\n    clear(): void {\r\n        (<any>this.context.state).visionBlockers = [];\r\n        (<any>this.context.state).visionSources = [];\r\n        (<any>this.context.state).movementblockers = [];\r\n        this.context.commit(\"recalculateVision\");\r\n        this.context.commit(\"recalculateMovement\");\r\n    }\r\n}\r\n\r\nexport const visibilityStore = getModule(VisibilityStore);\r\n","import { uuidv4 } from \"@/core/utils\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { aurasFromServer, aurasToServer } from \"@/game/comm/conversion/aura\";\r\nimport { InitiativeData } from \"@/game/comm/types/general\";\r\nimport { ServerShape } from \"@/game/comm/types/shapes\";\r\nimport { GlobalPoint, LocalPoint, Vector } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { BoundingRect } from \"@/game/shapes/boundingrect\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { g2l, g2lr, g2lx, g2ly, g2lz } from \"@/game/units\";\r\nimport tinycolor from \"tinycolor2\";\r\nimport { visibilityStore } from \"../visibility/store\";\r\n\r\nexport abstract class Shape {\r\n    // Used to create class instance from server shape data\r\n    abstract readonly type: string;\r\n    // The unique ID of this shape\r\n    readonly uuid: string;\r\n    // The layer the shape is currently on\r\n    layer!: string;\r\n\r\n    // A reference point regarding that specific shape's structure\r\n    protected _refPoint: GlobalPoint;\r\n\r\n    // Fill colour of the shape\r\n    fillColour: string = \"#000\";\r\n    strokeColour: string = \"rgba(0,0,0,0)\";\r\n    // The optional name associated with the shape\r\n    name = \"Unknown shape\";\r\n    nameVisible = true;\r\n\r\n    // Associated trackers/auras/owners\r\n    trackers: Tracker[] = [];\r\n    auras: Aura[] = [];\r\n    labels: Label[] = [];\r\n    protected _owners: string[] = [];\r\n\r\n    // Block light sources\r\n    visionObstruction = false;\r\n    // Prevent shapes from overlapping with this shape\r\n    movementObstruction = false;\r\n    // Does this shape represent a playable token\r\n    isToken = false;\r\n    // Show a highlight box\r\n    showHighlight = false;\r\n\r\n    // Mouseover annotation\r\n    annotation: string = \"\";\r\n\r\n    // Draw modus to use\r\n    globalCompositeOperation: string = \"source-over\";\r\n\r\n    // Additional options for specialized uses\r\n    options: Map<string, any> = new Map();\r\n\r\n    constructor(refPoint: GlobalPoint, fillColour?: string, strokeColour?: string, uuid?: string) {\r\n        this._refPoint = refPoint;\r\n        this.uuid = uuid || uuidv4();\r\n        if (fillColour !== undefined) this.fillColour = fillColour;\r\n        if (strokeColour !== undefined) this.strokeColour = strokeColour;\r\n    }\r\n\r\n    // Are the last and first point connected\r\n    get isClosed(): boolean {\r\n        return true;\r\n    }\r\n\r\n    get refPoint(): GlobalPoint {\r\n        return this._refPoint;\r\n    }\r\n    set refPoint(point: GlobalPoint) {\r\n        this._refPoint = point;\r\n    }\r\n\r\n    abstract getBoundingBox(): BoundingRect;\r\n\r\n    // If inWorldCoord is\r\n    abstract contains(point: GlobalPoint): boolean;\r\n\r\n    abstract center(): GlobalPoint;\r\n    abstract center(centerPoint: GlobalPoint): void;\r\n    visibleInCanvas(_canvas: HTMLCanvasElement): boolean {\r\n        // for (const aura of this.auras) {\r\n        //     if (aura.value > 0) {\r\n        //         const auraCircle = new Circle(this.center(), aura.value);\r\n        //         if (auraCircle.visibleInCanvas(canvas)) return true;\r\n        //     }\r\n        // }\r\n        return false;\r\n    }\r\n\r\n    // Code to snap a shape to the grid\r\n    // This is shape dependent as the shape refPoints are shape specific in\r\n    abstract snapToGrid(): void;\r\n    abstract resizeToGrid(): void;\r\n    abstract resize(resizePoint: number, point: LocalPoint): void;\r\n\r\n    abstract get points(): number[][];\r\n\r\n    getPointIndex(p: GlobalPoint, delta = 0): number {\r\n        for (const [idx, point] of this.points.entries()) {\r\n            if (Math.abs(p.x - point[0]) <= delta && Math.abs(p.y - point[1]) <= delta) return idx;\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    getPointOrientation(i: number): Vector {\r\n        const prev = GlobalPoint.fromArray(this.points[(this.points.length + i - 1) % this.points.length]);\r\n        const point = GlobalPoint.fromArray(this.points[i]);\r\n        const next = GlobalPoint.fromArray(this.points[(i + 1) % this.points.length]);\r\n        const vec = next.subtract(prev);\r\n        const mid = prev.add(vec.multiply(0.5));\r\n        return point.subtract(mid).normalize();\r\n    }\r\n\r\n    invalidate(skipLightUpdate: boolean): void {\r\n        const l = layerManager.getLayer(this.layer);\r\n        if (l) l.invalidate(skipLightUpdate);\r\n    }\r\n\r\n    checkVisionSources(recalculate = true): void {\r\n        const self = this;\r\n        const obstructionIndex = visibilityStore.visionBlockers.indexOf(this.uuid);\r\n        let update = false;\r\n        if (this.visionObstruction && obstructionIndex === -1) {\r\n            visibilityStore.visionBlockers.push(this.uuid);\r\n            update = true;\r\n        } else if (!this.visionObstruction && obstructionIndex >= 0) {\r\n            visibilityStore.visionBlockers.splice(obstructionIndex, 1);\r\n            update = true;\r\n        }\r\n        if (update && recalculate) visibilityStore.recalculateVision();\r\n\r\n        // Check if the visionsource auras are in the gameManager\r\n        for (const au of this.auras) {\r\n            const ls = visibilityStore.visionSources;\r\n            const i = ls.findIndex(o => o.aura === au.uuid);\r\n            if (au.visionSource && i === -1) {\r\n                ls.push({ shape: self.uuid, aura: au.uuid });\r\n            } else if (!au.visionSource && i >= 0) {\r\n                ls.splice(i, 1);\r\n            }\r\n        }\r\n        // Check if anything in the gameManager referencing this shape is in fact still a visionsource\r\n        for (let i = visibilityStore.visionSources.length - 1; i >= 0; i--) {\r\n            const ls = visibilityStore.visionSources[i];\r\n            if (ls.shape === self.uuid) {\r\n                if (!self.auras.some(a => a.uuid === ls.aura && a.visionSource))\r\n                    visibilityStore.visionSources.splice(i, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    setMovementBlock(blocksMovement: boolean, recalculate = true): void {\r\n        this.movementObstruction = blocksMovement || false;\r\n        const obstructionIndex = visibilityStore.movementblockers.indexOf(this.uuid);\r\n        let update = false;\r\n        if (this.movementObstruction && obstructionIndex === -1) {\r\n            visibilityStore.movementblockers.push(this.uuid);\r\n            update = true;\r\n        } else if (!this.movementObstruction && obstructionIndex >= 0) {\r\n            visibilityStore.movementblockers.splice(obstructionIndex, 1);\r\n            update = true;\r\n        }\r\n        if (update && recalculate) visibilityStore.recalculateMovement();\r\n    }\r\n\r\n    setIsToken(isToken: boolean): void {\r\n        this.isToken = isToken;\r\n        if (this.ownedBy()) {\r\n            const i = gameStore.ownedtokens.indexOf(this.uuid);\r\n            if (this.isToken && i === -1) gameStore.ownedtokens.push(this.uuid);\r\n            else if (!this.isToken && i >= 0) gameStore.ownedtokens.splice(i, 1);\r\n        }\r\n    }\r\n\r\n    abstract asDict(): ServerShape;\r\n    getBaseDict(): ServerShape {\r\n        return {\r\n            type_: this.type,\r\n            uuid: this.uuid,\r\n            x: this.refPoint.x,\r\n            y: this.refPoint.y,\r\n            layer: this.layer,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            draw_operator: this.globalCompositeOperation,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            movement_obstruction: this.movementObstruction,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            vision_obstruction: this.visionObstruction,\r\n            auras: aurasToServer(this.auras),\r\n            trackers: this.trackers,\r\n            labels: this.labels,\r\n            owners: this._owners,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            fill_colour: this.fillColour,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            stroke_colour: this.strokeColour,\r\n            name: this.name,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            name_visible: this.nameVisible,\r\n            annotation: this.annotation,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            is_token: this.isToken,\r\n            options: JSON.stringify([...this.options]),\r\n        };\r\n    }\r\n    fromDict(data: ServerShape): void {\r\n        this.layer = data.layer;\r\n        this.globalCompositeOperation = data.draw_operator;\r\n        this.movementObstruction = data.movement_obstruction;\r\n        this.visionObstruction = data.vision_obstruction;\r\n        this.auras = aurasFromServer(data.auras);\r\n        this.trackers = data.trackers;\r\n        this.labels = data.labels;\r\n        this._owners = data.owners;\r\n        this.isToken = data.is_token;\r\n        this.nameVisible = data.name_visible;\r\n        if (data.annotation) this.annotation = data.annotation;\r\n        if (data.name) this.name = data.name;\r\n        if (data.options) this.options = new Map(JSON.parse(data.options));\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        if (this.globalCompositeOperation !== undefined) ctx.globalCompositeOperation = this.globalCompositeOperation;\r\n        else ctx.globalCompositeOperation = \"source-over\";\r\n        if (this.showHighlight) {\r\n            const bbox = this.getBoundingBox();\r\n            ctx.strokeStyle = \"red\";\r\n            ctx.strokeRect(g2lx(bbox.topLeft.x) - 5, g2ly(bbox.topLeft.y) - 5, g2lz(bbox.w) + 10, g2lz(bbox.h) + 10);\r\n        }\r\n    }\r\n\r\n    drawAuras(ctx: CanvasRenderingContext2D): void {\r\n        for (const aura of this.auras) {\r\n            if (aura.value === 0 && aura.dim === 0) return;\r\n            ctx.beginPath();\r\n\r\n            const loc = g2l(this.center());\r\n            const innerRange = g2lr(aura.value + aura.dim);\r\n\r\n            if (aura.dim === 0) ctx.fillStyle = aura.colour;\r\n            else {\r\n                const gradient = ctx.createRadialGradient(\r\n                    loc.x,\r\n                    loc.y,\r\n                    g2lr(aura.value),\r\n                    loc.x,\r\n                    loc.y,\r\n                    g2lr(aura.value + aura.dim),\r\n                );\r\n                const tc = tinycolor(aura.colour);\r\n                ctx.fillStyle = gradient;\r\n                gradient.addColorStop(0, aura.colour);\r\n                gradient.addColorStop(1, tc.setAlpha(0).toRgbString());\r\n            }\r\n            if (!aura.visionSource || aura.lastPath === undefined) {\r\n                ctx.arc(loc.x, loc.y, innerRange, 0, 2 * Math.PI);\r\n                ctx.fill();\r\n            } else {\r\n                try {\r\n                    ctx.fill(aura.lastPath);\r\n                } catch (e) {\r\n                    ctx.arc(loc.x, loc.y, innerRange, 0, 2 * Math.PI);\r\n                    ctx.fill();\r\n                    console.warn(e);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    drawSelection(ctx: CanvasRenderingContext2D): void {\r\n        ctx.globalCompositeOperation = this.globalCompositeOperation;\r\n        const z = gameStore.zoomFactor;\r\n        const bb = this.getBoundingBox();\r\n        ctx.strokeRect(g2lx(bb.topLeft.x), g2ly(bb.topLeft.y), bb.w * z, bb.h * z);\r\n\r\n        // Draw vertices\r\n        for (const p of this.points) {\r\n            ctx.beginPath();\r\n            ctx.arc(g2lx(p[0]), g2ly(p[1]), 3, 0, 2 * Math.PI);\r\n            ctx.fill();\r\n        }\r\n\r\n        // Draw edges\r\n        ctx.beginPath();\r\n        ctx.moveTo(g2lx(this.points[0][0]), g2ly(this.points[0][1]));\r\n        const j = this.isClosed ? 0 : 1;\r\n        for (let i = 1; i <= this.points.length - j; i++) {\r\n            const vertex = this.points[i % this.points.length];\r\n            ctx.lineTo(g2lx(vertex[0]), g2ly(vertex[1]));\r\n        }\r\n        ctx.stroke();\r\n    }\r\n\r\n    getInitiativeRepr(): InitiativeData {\r\n        return {\r\n            uuid: this.uuid,\r\n            visible: !gameStore.IS_DM,\r\n            group: false,\r\n            source: this.name,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            has_img: false,\r\n            effects: [],\r\n            index: Infinity,\r\n        };\r\n    }\r\n\r\n    moveLayer(layer: string, sync: boolean): void {\r\n        const oldLayer = layerManager.getLayer(this.layer);\r\n        const newLayer = layerManager.getLayer(layer);\r\n        if (oldLayer === undefined || newLayer === undefined) return;\r\n        this.layer = layer;\r\n        // Update layer shapes\r\n        oldLayer.shapes.splice(oldLayer.shapes.indexOf(this), 1);\r\n        newLayer.shapes.push(this);\r\n        // Revalidate layers  (light should at most be redone once)\r\n        oldLayer.invalidate(true);\r\n        newLayer.invalidate(false);\r\n        // Sync!\r\n        if (sync) socket.emit(\"Shape.Layer.Change\", { uuid: this.uuid, layer });\r\n    }\r\n\r\n    // this screws up vetur if typed as `readonly stringp[]`\r\n    // eslint-disable-next-line @typescript-eslint/array-type\r\n    get owners(): ReadonlyArray<string> {\r\n        return Object.freeze(this._owners.slice());\r\n    }\r\n\r\n    ownedBy(username?: string): boolean {\r\n        if (username === undefined) username = gameStore.username;\r\n        return (\r\n            gameStore.IS_DM ||\r\n            this._owners.includes(username) ||\r\n            (gameStore.FAKE_PLAYER && gameStore.activeTokens.includes(this.uuid))\r\n        );\r\n    }\r\n\r\n    addOwner(owner: string): void {\r\n        if (!this._owners.includes(owner)) this._owners.push(owner);\r\n    }\r\n\r\n    updateOwner(oldValue: string, newValue: string): void {\r\n        const ownerIndex = this._owners.findIndex(o => o === oldValue);\r\n        if (ownerIndex >= 0) this._owners.splice(ownerIndex, 1, newValue);\r\n        else this.addOwner(newValue);\r\n    }\r\n\r\n    removeOwner(owner: string): void {\r\n        const ownerIndex = this._owners.findIndex(o => o === owner);\r\n        this._owners.splice(ownerIndex, 1);\r\n    }\r\n}\r\n","import { GlobalPoint, Ray, Vector } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { visibilityStore } from \"@/game/visibility/store\";\r\nimport { PA_CDT } from \"@/game/visibility/te/pa\";\r\nimport { Point, Sign, Triangle } from \"@/game/visibility/te/tds\";\r\nimport { ccw, cw, intersection, orientation } from \"@/game/visibility/te/triag\";\r\n\r\n// First go through each shape in the selection and see if the delta has to be truncated due to movement blockers\r\n\r\n// This is definitely super convoluted and inefficient but I was tired and really wanted the smooth wall sliding collision stuff to work\r\n// And it does now, so hey ¯\\_(ツ)_/¯\r\nexport function calculateDelta(delta: Vector, sel: Shape, done?: string[]): Vector {\r\n    if (delta.x === 0 && delta.y === 0) return delta;\r\n    if (visibilityStore.visionMode === \"bvh\") {\r\n        if (done === undefined) done = [];\r\n        const ogSelBBox = sel.getBoundingBox();\r\n        const newSelBBox = ogSelBBox.offset(delta);\r\n        let refine = false;\r\n        for (const movementBlocker of visibilityStore.movementblockers) {\r\n            if (done.includes(movementBlocker)) continue;\r\n            const blocker = layerManager.UUIDMap.get(movementBlocker)!;\r\n            const blockerBBox = blocker.getBoundingBox();\r\n            let found = blockerBBox.intersectsWithInner(newSelBBox);\r\n            if (!found) {\r\n                // This is an edge case, precalculating the rays is not worth in this case.\r\n                const ray = Ray.fromPoints(ogSelBBox.topLeft.add(delta.normalize()), newSelBBox.topLeft);\r\n                const invDir = ray.direction.inverse();\r\n                const dirIsNegative = [invDir.x < 0, invDir.y < 0];\r\n                found = blockerBBox.intersectP(ray, invDir, dirIsNegative).hit;\r\n            }\r\n            // Check if the bounding box of our destination would intersect with the bounding box of the movementblocker\r\n            if (found) {\r\n                const bCenter = blockerBBox.center();\r\n                const sCenter = ogSelBBox.center();\r\n\r\n                const d = sCenter.subtract(bCenter);\r\n                const ux = new Vector(1, 0);\r\n                const uy = new Vector(0, 1);\r\n                let dx = d.dot(ux);\r\n                let dy = d.dot(uy);\r\n                if (dx > blockerBBox.w / 2) dx = blockerBBox.w / 2;\r\n                if (dx < -blockerBBox.w / 2) dx = -blockerBBox.w / 2;\r\n                if (dy > blockerBBox.h / 2) dy = blockerBBox.h / 2;\r\n                if (dy < -blockerBBox.h / 2) dy = -blockerBBox.h / 2;\r\n\r\n                // Closest point / intersection point between the two bboxes.  Not the delta intersect!\r\n                const p = bCenter.add(ux.multiply(dx)).add(uy.multiply(dy));\r\n\r\n                if (p.x === ogSelBBox.topLeft.x || p.x === ogSelBBox.topRight.x) delta = new Vector(0, delta.y);\r\n                else if (p.y === ogSelBBox.topLeft.y || p.y === ogSelBBox.botLeft.y) delta = new Vector(delta.x, 0);\r\n                else {\r\n                    if (p.x < ogSelBBox.topLeft.x) delta = new Vector(p.x - ogSelBBox.topLeft.x, delta.y);\r\n                    else if (p.x > ogSelBBox.topRight.x) delta = new Vector(p.x - ogSelBBox.topRight.x, delta.y);\r\n                    else if (p.y < ogSelBBox.topLeft.y) delta = new Vector(delta.x, p.y - ogSelBBox.topLeft.y);\r\n                    else if (p.y > ogSelBBox.botLeft.y) delta = new Vector(delta.x, p.y - ogSelBBox.botLeft.y);\r\n                }\r\n                refine = true;\r\n                done.push(movementBlocker);\r\n                break;\r\n            }\r\n        }\r\n        if (refine) delta = calculateDelta(delta, sel, done);\r\n        return delta;\r\n    } else {\r\n        const centerTriangle = PA_CDT.movement.locate(sel.center().asArray(), null).loc;\r\n        for (const point of sel.points) {\r\n            const lt = PA_CDT.movement.locate(point, centerTriangle);\r\n            const triangle = lt.loc;\r\n            if (triangle === null) continue;\r\n            delta = checkTriangle(point, triangle, delta);\r\n        }\r\n        return delta;\r\n    }\r\n}\r\n\r\nfunction checkTriangle(point: Point, triangle: Triangle, delta: Vector, skip: Triangle[] = []): Vector {\r\n    const p = new GlobalPoint(point[0], point[1]);\r\n    const endpoint = p.add(delta).asArray();\r\n    if (triangle.contains(endpoint)) return delta;\r\n    skip.push(triangle);\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n        if (skip.includes(triangle.neighbours[i]!)) continue;\r\n\r\n        const _cw = triangle.vertices[cw(i)]!.point!;\r\n        const _ccw = triangle.vertices[ccw(i)]!.point!;\r\n        const ix = intersection(point, endpoint, _cw, _ccw);\r\n\r\n        if (ix === null) continue;\r\n\r\n        if (!triangle.isConstrained(i)) return checkTriangle(point, triangle.neighbours[i]!, delta, skip);\r\n\r\n        if (ix[0] === p.x && ix[1] === p.y) {\r\n            const o = orientation(point, endpoint, _ccw);\r\n            // Remember: canvas y axis is inverted\r\n            if (o === Sign.LEFT_TURN) continue;\r\n            if (o === Sign.ZERO) continue;\r\n        }\r\n        let newDelta = new GlobalPoint(ix[0], ix[1]).subtract(p).multiply(0.8);\r\n        if (newDelta.length() < 1) newDelta = new Vector(0, 0);\r\n        if (newDelta.length() < delta.length()) delta = newDelta;\r\n    }\r\n    return delta;\r\n}\r\n","import { GlobalPoint, LocalPoint, Vector } from \"@/game/geom\";\r\nimport { BoundingRect } from \"@/game/shapes/boundingrect\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { calculateDelta } from \"@/game/ui/tools/utils\";\r\nimport { g2lx, g2ly, l2g, l2gx, l2gy } from \"@/game/units\";\r\nimport { ServerShape } from \"../comm/types/shapes\";\r\n\r\nexport abstract class BaseRect extends Shape {\r\n    w: number;\r\n    h: number;\r\n    constructor(topleft: GlobalPoint, w: number, h: number, fillColour?: string, strokeColour?: string, uuid?: string) {\r\n        super(topleft, fillColour, strokeColour, uuid);\r\n        this.w = w;\r\n        this.h = h;\r\n    }\r\n    getBaseDict(): ServerShape & { width: number; height: number } {\r\n        return Object.assign(super.getBaseDict(), {\r\n            width: this.w,\r\n            height: this.h,\r\n        });\r\n    }\r\n    getBoundingBox(): BoundingRect {\r\n        return new BoundingRect(this.refPoint, this.w, this.h);\r\n    }\r\n\r\n    get points(): number[][] {\r\n        if (this.w === 0 || this.h === 0) return [[this.refPoint.x, this.refPoint.y]];\r\n        // note to self: topright and botleft are swapped because I'm retarded.\r\n        const topright = this.refPoint.add(new Vector(0, this.h));\r\n        const botright = this.refPoint.add(new Vector(this.w, this.h));\r\n        const botleft = this.refPoint.add(new Vector(this.w, 0));\r\n        return [\r\n            [this.refPoint.x, this.refPoint.y],\r\n            [topright.x, topright.y],\r\n            [botright.x, botright.y],\r\n            [botleft.x, botleft.y],\r\n        ];\r\n    }\r\n\r\n    contains(point: GlobalPoint): boolean {\r\n        return (\r\n            this.refPoint.x <= point.x &&\r\n            this.refPoint.x + this.w >= point.x &&\r\n            this.refPoint.y <= point.y &&\r\n            this.refPoint.y + this.h >= point.y\r\n        );\r\n    }\r\n    center(): GlobalPoint;\r\n    center(centerPoint: GlobalPoint): void;\r\n    center(centerPoint?: GlobalPoint): GlobalPoint | void {\r\n        if (centerPoint === undefined) return this.refPoint.add(new Vector(this.w / 2, this.h / 2));\r\n        this.refPoint = new GlobalPoint(centerPoint.x - this.w / 2, centerPoint.y - this.h / 2);\r\n    }\r\n\r\n    visibleInCanvas(canvas: HTMLCanvasElement): boolean {\r\n        if (super.visibleInCanvas(canvas)) return true;\r\n        const coreVisible = !(\r\n            g2lx(this.refPoint.x) > canvas.width ||\r\n            g2ly(this.refPoint.y) > canvas.height ||\r\n            g2lx(this.refPoint.x + this.w) < 0 ||\r\n            g2ly(this.refPoint.y + this.h) < 0\r\n        );\r\n        if (coreVisible) return true;\r\n        return false;\r\n    }\r\n    snapToGrid(): void {\r\n        const gs = gameStore.gridSize;\r\n        const center = this.center();\r\n        const mx = center.x;\r\n        const my = center.y;\r\n\r\n        let targetX;\r\n        let targetY;\r\n\r\n        if ((this.w / gs) % 2 === 0) {\r\n            targetX = Math.round(mx / gs) * gs - this.w / 2;\r\n        } else {\r\n            targetX = (Math.round((mx + gs / 2) / gs) - 1 / 2) * gs - this.w / 2;\r\n        }\r\n        if ((this.h / gs) % 2 === 0) {\r\n            targetY = Math.round(my / gs) * gs - this.h / 2;\r\n        } else {\r\n            targetY = (Math.round((my + gs / 2) / gs) - 1 / 2) * gs - this.h / 2;\r\n        }\r\n\r\n        const delta = calculateDelta(new Vector(targetX - this.refPoint.x, targetY - this.refPoint.y), this);\r\n        this.refPoint = this.refPoint.add(delta);\r\n\r\n        this.invalidate(false);\r\n    }\r\n    resizeToGrid(): void {\r\n        const gs = gameStore.gridSize;\r\n        this.refPoint = new GlobalPoint(Math.round(this.refPoint.x / gs) * gs, Math.round(this.refPoint.y / gs) * gs);\r\n        this.w = Math.max(Math.round(this.w / gs) * gs, gs);\r\n        this.h = Math.max(Math.round(this.h / gs) * gs, gs);\r\n        this.invalidate(false);\r\n    }\r\n    resize(resizePoint: number, point: LocalPoint): void {\r\n        const z = gameStore.zoomFactor;\r\n        switch (resizePoint) {\r\n            case 0: {\r\n                this.w = g2lx(this.refPoint.x) + this.w * z - point.x;\r\n                this.h = g2ly(this.refPoint.y) + this.h * z - point.y;\r\n                this.refPoint = l2g(point);\r\n                break;\r\n            }\r\n            case 1: {\r\n                this.w = g2lx(this.refPoint.x) + this.w * z - point.x;\r\n                this.h = point.y - g2ly(this.refPoint.y);\r\n                this.refPoint = new GlobalPoint(l2gx(point.x), this.refPoint.y);\r\n                break;\r\n            }\r\n            case 2: {\r\n                this.w = point.x - g2lx(this.refPoint.x);\r\n                this.h = point.y - g2ly(this.refPoint.y);\r\n                break;\r\n            }\r\n            case 3: {\r\n                this.w = point.x - g2lx(this.refPoint.x);\r\n                this.h = g2ly(this.refPoint.y) + this.h * z - point.y;\r\n                this.refPoint = new GlobalPoint(this.refPoint.x, l2gy(point.y));\r\n                break;\r\n            }\r\n        }\r\n\r\n        this.w /= z;\r\n        this.h /= z;\r\n\r\n        if (this.w < 0) {\r\n            this.refPoint = this.refPoint.add(new Vector(this.w, 0));\r\n            this.w = Math.abs(this.w);\r\n        }\r\n        if (this.h < 0) {\r\n            this.refPoint = this.refPoint.add(new Vector(0, this.h));\r\n            this.h = Math.abs(this.h);\r\n        }\r\n    }\r\n}\r\n","import { InitiativeData } from \"@/game/comm/types/general\";\r\nimport { ServerAsset } from \"@/game/comm/types/shapes\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { BaseRect } from \"@/game/shapes/baserect\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { g2lx, g2ly, g2lz } from \"@/game/units\";\r\n\r\nexport class Asset extends BaseRect {\r\n    type = \"assetrect\";\r\n    img: HTMLImageElement;\r\n    src: string = \"\";\r\n    constructor(img: HTMLImageElement, topleft: GlobalPoint, w: number, h: number, uuid?: string) {\r\n        super(topleft, w, h, undefined, undefined, uuid);\r\n        this.img = img;\r\n    }\r\n    asDict(): ServerAsset {\r\n        return Object.assign(this.getBaseDict(), {\r\n            src: this.src,\r\n        });\r\n    }\r\n    fromDict(data: ServerAsset): void {\r\n        super.fromDict(data);\r\n        this.src = data.src;\r\n    }\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        try {\r\n            ctx.drawImage(this.img, g2lx(this.refPoint.x), g2ly(this.refPoint.y), g2lz(this.w), g2lz(this.h));\r\n        } catch (error) {\r\n            console.warn(`Shape ${this.uuid} could not load the image ${this.src}`);\r\n        }\r\n    }\r\n    getInitiativeRepr(): InitiativeData {\r\n        return {\r\n            uuid: this.uuid,\r\n            visible: !gameStore.IS_DM,\r\n            group: false,\r\n            source: this.src,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            has_img: true,\r\n            effects: [],\r\n            index: Infinity,\r\n        };\r\n    }\r\n}\r\n","import { ServerCircle } from \"@/game/comm/types/shapes\";\r\nimport { GlobalPoint, LocalPoint, Vector } from \"@/game/geom\";\r\nimport { BoundingRect } from \"@/game/shapes/boundingrect\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { calculateDelta } from \"@/game/ui/tools/utils\";\r\nimport { g2l, g2lz, l2g } from \"@/game/units\";\r\nimport { getFogColour } from \"@/game/utils\";\r\n\r\nexport class Circle extends Shape {\r\n    type = \"circle\";\r\n    r: number;\r\n    constructor(center: GlobalPoint, r: number, fillColour?: string, strokeColour?: string, uuid?: string) {\r\n        super(center, fillColour, strokeColour, uuid);\r\n        this.r = r || 1;\r\n    }\r\n    asDict(): ServerCircle {\r\n        // const base = <ServerCircle>this.getBaseDict();\r\n        // base.r = this.r;\r\n        // base.border = this.border;\r\n        // return base;\r\n        return Object.assign(this.getBaseDict(), {\r\n            radius: this.r,\r\n        });\r\n    }\r\n    fromDict(data: ServerCircle): void {\r\n        super.fromDict(data);\r\n        this.r = data.radius;\r\n    }\r\n    getBoundingBox(): BoundingRect {\r\n        return new BoundingRect(\r\n            new GlobalPoint(this.refPoint.x - this.r, this.refPoint.y - this.r),\r\n            this.r * 2,\r\n            this.r * 2,\r\n        );\r\n    }\r\n\r\n    get points(): number[][] {\r\n        return this.getBoundingBox().points;\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        ctx.beginPath();\r\n        if (this.fillColour === \"fog\") ctx.fillStyle = getFogColour();\r\n        else ctx.fillStyle = this.fillColour;\r\n        const loc = g2l(this.refPoint);\r\n        ctx.arc(loc.x, loc.y, g2lz(this.r), 0, 2 * Math.PI);\r\n        ctx.fill();\r\n        if (this.strokeColour !== \"rgba(0, 0, 0, 0)\") {\r\n            const borderWidth = 5;\r\n            ctx.beginPath();\r\n            ctx.lineWidth = g2lz(borderWidth);\r\n            ctx.strokeStyle = this.strokeColour;\r\n            // Inset the border with - borderWidth / 2\r\n            ctx.arc(loc.x, loc.y, Math.max(borderWidth / 2, g2lz(this.r - borderWidth / 2)), 0, 2 * Math.PI);\r\n            ctx.stroke();\r\n        }\r\n    }\r\n    contains(point: GlobalPoint): boolean {\r\n        return (point.x - this.refPoint.x) ** 2 + (point.y - this.refPoint.y) ** 2 < this.r ** 2;\r\n    }\r\n    center(): GlobalPoint;\r\n    center(centerPoint: GlobalPoint): void;\r\n    center(centerPoint?: GlobalPoint): GlobalPoint | void {\r\n        if (centerPoint === undefined) return this.refPoint;\r\n        this.refPoint = centerPoint;\r\n    }\r\n    visibleInCanvas(canvas: HTMLCanvasElement): boolean {\r\n        return this.getBoundingBox().visibleInCanvas(canvas);\r\n    } // TODO\r\n    snapToGrid(): void {\r\n        const gs = gameStore.gridSize;\r\n        let targetX;\r\n        let targetY;\r\n        if (((2 * this.r) / gs) % 2 === 0) {\r\n            targetX = Math.round(this.refPoint.x / gs) * gs;\r\n        } else {\r\n            targetX = Math.round((this.refPoint.x - gs / 2) / gs) * gs + this.r;\r\n        }\r\n        if (((2 * this.r) / gs) % 2 === 0) {\r\n            targetY = Math.round(this.refPoint.y / gs) * gs;\r\n        } else {\r\n            targetY = Math.round((this.refPoint.y - gs / 2) / gs) * gs + this.r;\r\n        }\r\n        const delta = calculateDelta(new Vector(targetX - this.refPoint.x, targetY - this.refPoint.y), this);\r\n        this.refPoint = this.refPoint.add(delta);\r\n        this.invalidate(false);\r\n    }\r\n    resizeToGrid(): void {\r\n        const gs = gameStore.gridSize;\r\n        this.r = Math.max(Math.round(this.r / gs) * gs, gs / 2);\r\n        this.invalidate(false);\r\n    }\r\n    resize(resizePoint: number, point: LocalPoint): void {\r\n        const diff = l2g(point).subtract(this.refPoint);\r\n        this.r = Math.sqrt(Math.pow(diff.length(), 2) / 2);\r\n    }\r\n}\r\n","import * as tinycolor from \"tinycolor2\";\r\n\r\nimport { calcFontScale } from \"@/core/utils\";\r\nimport { InitiativeData } from \"@/game/comm/types/general\";\r\nimport { ServerCircularToken } from \"@/game/comm/types/shapes\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { Circle } from \"@/game/shapes/circle\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { g2l, g2lz } from \"@/game/units\";\r\n\r\nexport class CircularToken extends Circle {\r\n    type = \"circulartoken\";\r\n    text: string;\r\n    font: string;\r\n    constructor(\r\n        center: GlobalPoint,\r\n        r: number,\r\n        text: string,\r\n        font: string,\r\n        fillColour?: string,\r\n        strokeColour?: string,\r\n        uuid?: string,\r\n    ) {\r\n        super(center, r, fillColour, strokeColour, uuid);\r\n        this.text = text;\r\n        this.font = font;\r\n    }\r\n    asDict(): ServerCircularToken {\r\n        return Object.assign(this.getBaseDict(), {\r\n            radius: this.r,\r\n            text: this.text,\r\n            font: this.font,\r\n        });\r\n    }\r\n    fromDict(data: ServerCircularToken): void {\r\n        super.fromDict(data);\r\n        this.r = data.radius;\r\n        this.text = data.text;\r\n        this.font = data.font;\r\n    }\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        ctx.font = this.font;\r\n        ctx.save();\r\n        const dest = g2l(this.center());\r\n        ctx.textAlign = \"center\";\r\n        ctx.textBaseline = \"middle\";\r\n        const fontScale = calcFontScale(ctx, this.text, g2lz(this.r - 5));\r\n        ctx.setTransform(fontScale, 0, 0, fontScale, dest.x, dest.y);\r\n        ctx.fillStyle = tinycolor.mostReadable(this.fillColour, [\"#000\", \"#fff\"]).toHexString();\r\n        ctx.fillText(this.text, 0, 0);\r\n        ctx.restore();\r\n    }\r\n    getInitiativeRepr(): InitiativeData {\r\n        return {\r\n            uuid: this.uuid,\r\n            visible: !gameStore.IS_DM,\r\n            group: false,\r\n            source: this.name === \"\" || this.name === \"Unknown shape\" ? this.text : this.name,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            has_img: false,\r\n            effects: [],\r\n            index: Infinity,\r\n        };\r\n    }\r\n}\r\n","import { GlobalPoint, LocalPoint } from \"@/game/geom\";\r\nimport { BoundingRect } from \"@/game/shapes/boundingrect\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { g2lx, g2ly, l2g, g2lz } from \"@/game/units\";\r\nimport { ServerLine } from \"../comm/types/shapes\";\r\n\r\nexport class Line extends Shape {\r\n    type = \"line\";\r\n    endPoint: GlobalPoint;\r\n    lineWidth: number;\r\n    constructor(\r\n        startPoint: GlobalPoint,\r\n        endPoint: GlobalPoint,\r\n        lineWidth?: number,\r\n        strokeColour?: string,\r\n        uuid?: string,\r\n    ) {\r\n        super(startPoint, \"rgba(0, 0, 0, 0)\", strokeColour || \"#000\", uuid);\r\n        this.endPoint = endPoint;\r\n        this.lineWidth = lineWidth === undefined ? 1 : lineWidth;\r\n    }\r\n\r\n    get isClosed(): boolean {\r\n        return false;\r\n    }\r\n\r\n    asDict(): ServerLine {\r\n        return Object.assign(this.getBaseDict(), {\r\n            x2: this.endPoint.x,\r\n            y2: this.endPoint.y,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            line_width: this.lineWidth,\r\n        });\r\n    }\r\n    get points(): number[][] {\r\n        return [\r\n            [this.refPoint.x, this.refPoint.y],\r\n            [this.endPoint.x, this.endPoint.y],\r\n        ];\r\n    }\r\n    getBoundingBox(): BoundingRect {\r\n        return new BoundingRect(\r\n            new GlobalPoint(Math.min(this.refPoint.x, this.endPoint.x), Math.min(this.refPoint.y, this.endPoint.y)),\r\n            Math.abs(this.refPoint.x - this.endPoint.x),\r\n            Math.abs(this.refPoint.y - this.endPoint.y),\r\n        );\r\n    }\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        ctx.strokeStyle = this.strokeColour;\r\n        ctx.beginPath();\r\n        ctx.moveTo(g2lx(this.refPoint.x), g2ly(this.refPoint.y));\r\n        ctx.lineTo(g2lx(this.endPoint.x), g2ly(this.endPoint.y));\r\n        ctx.lineWidth = g2lz(this.lineWidth);\r\n        ctx.stroke();\r\n    }\r\n    contains(_point: GlobalPoint): boolean {\r\n        return false; // TODO\r\n    }\r\n\r\n    center(): GlobalPoint;\r\n    center(centerPoint: GlobalPoint): void;\r\n    center(_centerPoint?: GlobalPoint): GlobalPoint | void {} // TODO\r\n    visibleInCanvas(canvas: HTMLCanvasElement): boolean {\r\n        return this.getBoundingBox().visibleInCanvas(canvas);\r\n    } // TODO\r\n    snapToGrid(): void {}\r\n    resizeToGrid(): void {}\r\n    resize(resizePoint: number, point: LocalPoint): void {\r\n        if (resizePoint === 0) this.refPoint = l2g(point);\r\n        else this.endPoint = l2g(point);\r\n    }\r\n}\r\n","import { GlobalPoint } from \"@/game/geom\";\r\nimport { BaseRect } from \"@/game/shapes/baserect\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { g2l } from \"@/game/units\";\r\nimport { getFogColour } from \"@/game/utils\";\r\nimport { ServerShape } from \"../comm/types/shapes\";\r\n\r\nexport class Rect extends BaseRect {\r\n    type = \"rect\";\r\n    constructor(topleft: GlobalPoint, w: number, h: number, fillColour?: string, strokeColour?: string, uuid?: string) {\r\n        super(topleft, w, h, fillColour, strokeColour, uuid);\r\n    }\r\n    asDict(): ServerShape {\r\n        return super.getBaseDict();\r\n    }\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        if (this.fillColour === \"fog\") ctx.fillStyle = getFogColour();\r\n        else ctx.fillStyle = this.fillColour;\r\n        const z = gameStore.zoomFactor;\r\n        const loc = g2l(this.refPoint);\r\n        ctx.fillRect(loc.x, loc.y, this.w * z, this.h * z);\r\n        if (this.strokeColour !== \"rgba(0, 0, 0, 0)\") {\r\n            ctx.strokeStyle = this.strokeColour;\r\n            ctx.lineWidth = 5;\r\n            ctx.strokeRect(loc.x, loc.y, this.w * z, this.h * z);\r\n        }\r\n    }\r\n}\r\n","import { GlobalPoint, LocalPoint } from \"@/game/geom\";\r\nimport { BoundingRect } from \"@/game/shapes/boundingrect\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { g2l } from \"@/game/units\";\r\nimport { ServerText } from \"../comm/types/shapes\";\r\n\r\nexport class Text extends Shape {\r\n    type = \"text\";\r\n    text: string;\r\n    font: string;\r\n    angle: number;\r\n    constructor(\r\n        position: GlobalPoint,\r\n        text: string,\r\n        font: string,\r\n        angle?: number,\r\n        fillColour?: string,\r\n        strokeColour?: string,\r\n        uuid?: string,\r\n    ) {\r\n        super(position, fillColour, strokeColour, uuid);\r\n        this.text = text;\r\n        this.font = font;\r\n        this.angle = angle || 0;\r\n    }\r\n    asDict(): ServerText {\r\n        return Object.assign(this.getBaseDict(), {\r\n            text: this.text,\r\n            font: this.font,\r\n            angle: this.angle,\r\n        });\r\n    }\r\n    get points(): number[][] {\r\n        return [[this.refPoint.x, this.refPoint.y]];\r\n    }\r\n    getBoundingBox(): BoundingRect {\r\n        return new BoundingRect(this.refPoint, 5, 5); // TODO: fix this bounding box\r\n    }\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        ctx.font = this.font;\r\n        ctx.fillStyle = this.fillColour;\r\n        ctx.save();\r\n        const dest = g2l(this.refPoint);\r\n        ctx.translate(dest.x, dest.y);\r\n        ctx.rotate(this.angle);\r\n        ctx.textAlign = \"center\";\r\n        this.getLines(ctx).map(line => ctx.fillText(line.text, line.x, line.y));\r\n        ctx.restore();\r\n    }\r\n    contains(_point: GlobalPoint): boolean {\r\n        return false; // TODO\r\n    }\r\n\r\n    center(): GlobalPoint;\r\n    center(centerPoint: GlobalPoint): void;\r\n    center(_centerPoint?: GlobalPoint): GlobalPoint | void {} // TODO\r\n    visibleInCanvas(canvas: HTMLCanvasElement): boolean {\r\n        return this.getBoundingBox().visibleInCanvas(canvas);\r\n    } // TODO\r\n    snapToGrid(): void {}\r\n    resizeToGrid(): void {}\r\n    resize(_resizePoint: number, _point: LocalPoint): void {}\r\n\r\n    getMaxHeight(ctx: CanvasRenderingContext2D): number {\r\n        const lines = this.getLines(ctx);\r\n        const lineHeight = 30;\r\n        return lineHeight * lines.length;\r\n    }\r\n\r\n    getMaxWidth(ctx: CanvasRenderingContext2D): number {\r\n        const lines = this.getLines(ctx);\r\n        const widths = lines.map(line => ctx.measureText(line.text).width);\r\n        return Math.max(...widths);\r\n    }\r\n\r\n    private getLines(ctx: CanvasRenderingContext2D): { text: string; x: number; y: number }[] {\r\n        const lines = this.text.split(\"\\n\");\r\n        const allLines: { text: string; x: number; y: number }[] = [];\r\n        const maxWidth = ctx.canvas.width;\r\n        const lineHeight = 30;\r\n        const x = 0; // this.refPoint.x;\r\n        let y = 0; // this.refPoint.y;\r\n\r\n        for (const line of lines) {\r\n            let targetLine = \"\";\r\n            const words = line.split(\" \");\r\n            for (const word of words) {\r\n                const testLine = targetLine + word + \" \";\r\n                const metrics = ctx.measureText(testLine);\r\n                const testWidth = metrics.width;\r\n                if (testWidth > maxWidth) {\r\n                    ctx.fillText(targetLine, x, y);\r\n                    allLines.push({ text: targetLine, x, y });\r\n                    targetLine = word + \" \";\r\n                    y += lineHeight;\r\n                } else {\r\n                    targetLine = testLine;\r\n                }\r\n            }\r\n            allLines.push({ text: targetLine, x, y });\r\n            y += lineHeight;\r\n        }\r\n        return allLines;\r\n    }\r\n}\r\n","import { ServerPolygon } from \"../comm/types/shapes\";\r\nimport { GlobalPoint, LocalPoint } from \"../geom\";\r\nimport { g2lx, g2ly, g2lz, l2g } from \"../units\";\r\nimport { getFogColour } from \"../utils\";\r\nimport { BoundingRect } from \"./boundingrect\";\r\nimport { Shape } from \"./shape\";\r\n\r\nexport class Polygon extends Shape {\r\n    type = \"polygon\";\r\n    _vertices: GlobalPoint[] = [];\r\n    openPolygon = false;\r\n    lineWidth: number;\r\n\r\n    constructor(\r\n        startPoint: GlobalPoint,\r\n        vertices?: GlobalPoint[],\r\n        fillColour?: string,\r\n        strokeColour?: string,\r\n        lineWidth?: number,\r\n        openPolygon = false,\r\n        uuid?: string,\r\n    ) {\r\n        super(startPoint, fillColour, strokeColour, uuid);\r\n        this._vertices = vertices || [];\r\n        this.openPolygon = openPolygon;\r\n        this.lineWidth = lineWidth || 2;\r\n    }\r\n\r\n    get isClosed(): boolean {\r\n        return !this.openPolygon;\r\n    }\r\n\r\n    get refPoint(): GlobalPoint {\r\n        return this._refPoint;\r\n    }\r\n    set refPoint(point: GlobalPoint) {\r\n        const delta = point.subtract(this._refPoint);\r\n        this._refPoint = point;\r\n        for (let i = 0; i < this._vertices.length; i++) this._vertices[i] = this._vertices[i].add(delta);\r\n    }\r\n\r\n    get vertices(): GlobalPoint[] {\r\n        return [this._refPoint, ...this._vertices];\r\n    }\r\n\r\n    asDict(): ServerPolygon {\r\n        return Object.assign(this.getBaseDict(), {\r\n            vertices: this._vertices.map(p => ({ x: p.x, y: p.y })),\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            open_polygon: this.openPolygon,\r\n            // eslint-disable-next-line @typescript-eslint/camelcase\r\n            line_width: this.lineWidth,\r\n        });\r\n    }\r\n\r\n    fromDict(data: ServerPolygon): void {\r\n        super.fromDict(data);\r\n        this._vertices = data.vertices.map(v => new GlobalPoint(v.x, v.y));\r\n        this.openPolygon = data.open_polygon;\r\n        this.lineWidth = data.line_width;\r\n    }\r\n\r\n    get points(): number[][] {\r\n        return this.vertices.map(point => [point.x, point.y]);\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        super.draw(ctx);\r\n        ctx.lineCap = \"round\";\r\n        ctx.lineJoin = \"round\";\r\n        ctx.lineWidth = g2lz(this.lineWidth);\r\n\r\n        if (this.strokeColour === \"fog\") ctx.strokeStyle = getFogColour();\r\n        else ctx.strokeStyle = this.strokeColour;\r\n        if (this.fillColour === \"fog\") ctx.fillStyle = getFogColour();\r\n        else ctx.fillStyle = this.fillColour;\r\n\r\n        ctx.beginPath();\r\n        ctx.moveTo(g2lx(this.vertices[0].x), g2ly(this.vertices[0].y));\r\n        for (let i = 1; i <= this.vertices.length - (this.openPolygon ? 1 : 0); i++) {\r\n            const vertex = this.vertices[i % this.vertices.length];\r\n            ctx.lineTo(g2lx(vertex.x), g2ly(vertex.y));\r\n        }\r\n        if (!this.openPolygon) ctx.fill();\r\n        ctx.stroke();\r\n    }\r\n\r\n    contains(point: GlobalPoint): boolean {\r\n        return this.getBoundingBox().contains(point);\r\n    }\r\n\r\n    center(): GlobalPoint;\r\n    center(centerPoint: GlobalPoint): void;\r\n    center(_centerPoint?: GlobalPoint): GlobalPoint | void {\r\n        return this.getBoundingBox().center();\r\n    }\r\n    visibleInCanvas(canvas: HTMLCanvasElement): boolean {\r\n        return this.getBoundingBox().visibleInCanvas(canvas);\r\n    } // TODO\r\n    snapToGrid(): void {}\r\n    resizeToGrid(): void {}\r\n    resize(resizePoint: number, point: LocalPoint): void {\r\n        if (resizePoint === 0) this._refPoint = l2g(point);\r\n        else this._vertices[resizePoint - 1] = l2g(point);\r\n    }\r\n    getBoundingBox(): BoundingRect {\r\n        let minx: number = this.refPoint.x;\r\n        let maxx: number = this.refPoint.x;\r\n        let miny: number = this.refPoint.y;\r\n        let maxy: number = this.refPoint.y;\r\n        for (const p of this._vertices) {\r\n            if (p.x < minx) minx = p.x;\r\n            if (p.x > maxx) maxx = p.x;\r\n            if (p.y < miny) miny = p.y;\r\n            if (p.y > maxy) maxy = p.y;\r\n        }\r\n        return new BoundingRect(new GlobalPoint(minx, miny), maxx - minx, maxy - miny);\r\n    }\r\n}\r\n","import { uuidv4 } from \"@/core/utils\";\r\nimport {\r\n    ServerAsset,\r\n    ServerAura,\r\n    ServerCircle,\r\n    ServerCircularToken,\r\n    ServerLine,\r\n    ServerPolygon,\r\n    ServerRect,\r\n    ServerShape,\r\n    ServerText,\r\n} from \"@/game/comm/types/shapes\";\r\nimport { GlobalPoint, Vector } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Asset } from \"@/game/shapes/asset\";\r\nimport { Circle } from \"@/game/shapes/circle\";\r\nimport { CircularToken } from \"@/game/shapes/circulartoken\";\r\nimport { Line } from \"@/game/shapes/line\";\r\nimport { Rect } from \"@/game/shapes/rect\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { Text } from \"@/game/shapes/text\";\r\nimport { EventBus } from \"../event-bus\";\r\nimport { gameStore } from \"../store\";\r\nimport { Polygon } from \"./polygon\";\r\n\r\nexport function createShapeFromDict(shape: ServerShape): Shape | undefined {\r\n    let sh: Shape;\r\n\r\n    // A fromJSON and toJSON on Shape would be cleaner but ts does not allow for static abstracts so yeah.\r\n\r\n    // Shape Type specifics\r\n\r\n    const refPoint = new GlobalPoint(shape.x, shape.y);\r\n    if (shape.type_ === \"rect\") {\r\n        const rect = <ServerRect>shape;\r\n        sh = new Rect(refPoint, rect.width, rect.height, rect.fill_colour, rect.stroke_colour, rect.uuid);\r\n    } else if (shape.type_ === \"circle\") {\r\n        const circ = <ServerCircle>shape;\r\n        sh = new Circle(refPoint, circ.radius, circ.fill_colour, circ.stroke_colour, circ.uuid);\r\n    } else if (shape.type_ === \"circulartoken\") {\r\n        const token = <ServerCircularToken>shape;\r\n        sh = new CircularToken(\r\n            refPoint,\r\n            token.radius,\r\n            token.text,\r\n            token.font,\r\n            token.fill_colour,\r\n            token.stroke_colour,\r\n            token.uuid,\r\n        );\r\n    } else if (shape.type_ === \"line\") {\r\n        const line = <ServerLine>shape;\r\n        sh = new Line(refPoint, new GlobalPoint(line.x2, line.y2), line.line_width, line.stroke_colour, line.uuid);\r\n    } else if (shape.type_ === \"polygon\") {\r\n        const polygon = <ServerPolygon>shape;\r\n        sh = new Polygon(\r\n            refPoint,\r\n            polygon.vertices.map(v => new GlobalPoint(v.x, v.y)),\r\n            polygon.fill_colour,\r\n            polygon.stroke_colour,\r\n            polygon.line_width,\r\n            polygon.open_polygon,\r\n            polygon.uuid,\r\n        );\r\n    } else if (shape.type_ === \"text\") {\r\n        const text = <ServerText>shape;\r\n        sh = new Text(refPoint, text.text, text.font, text.angle, text.fill_colour, text.stroke_colour, text.uuid);\r\n    } else if (shape.type_ === \"assetrect\") {\r\n        const asset = <ServerAsset>shape;\r\n        const img = new Image(asset.width, asset.height);\r\n        if (asset.src.startsWith(\"http\")) img.src = new URL(asset.src).pathname;\r\n        else img.src = asset.src;\r\n        sh = new Asset(img, refPoint, asset.width, asset.height, asset.uuid);\r\n        img.onload = () => {\r\n            layerManager.getLayer(shape.layer)!.invalidate(false);\r\n        };\r\n    } else {\r\n        return undefined;\r\n    }\r\n    sh.fromDict(shape);\r\n    return sh;\r\n}\r\n\r\nexport function copyShapes(): void {\r\n    const layer = layerManager.getLayer();\r\n    if (!layer) return;\r\n    if (!layer.selection) return;\r\n    const clipboard = [];\r\n    for (const shape of layer.selection) {\r\n        if (gameStore.selectionHelperID === shape.uuid) continue;\r\n        clipboard.push(shape.asDict());\r\n    }\r\n    gameStore.setClipboard(clipboard);\r\n    gameStore.setClipboardPosition(gameStore.screenCenter);\r\n}\r\n\r\nexport function pasteShapes(targetLayer?: string): Shape[] {\r\n    const layer = layerManager.getLayer(targetLayer);\r\n    if (!layer) return [];\r\n    if (!gameStore.clipboard) return [];\r\n    layer.selection = [];\r\n    let offset = gameStore.screenCenter.subtract(gameStore.clipboardPosition);\r\n    gameStore.setClipboardPosition(gameStore.screenCenter);\r\n    // Check against 200 as that is the squared length of a vector with size 10, 10\r\n    if (offset.squaredLength() < 200) {\r\n        offset = new Vector(10, 10);\r\n    }\r\n    for (const clip of gameStore.clipboard) {\r\n        clip.x += offset.x;\r\n        clip.y += offset.y;\r\n        clip.uuid = uuidv4();\r\n        const oldTrackers = clip.trackers;\r\n        clip.trackers = [];\r\n        for (const tracker of oldTrackers) {\r\n            const newTracker: Tracker = {\r\n                ...tracker,\r\n                uuid: uuidv4(),\r\n            };\r\n            clip.trackers.push(newTracker);\r\n        }\r\n        const oldAuras = clip.auras;\r\n        clip.auras = [];\r\n        for (const aura of oldAuras) {\r\n            const newAura: ServerAura = {\r\n                ...aura,\r\n                uuid: uuidv4(),\r\n            };\r\n            clip.auras.push(newAura);\r\n        }\r\n        const shape = createShapeFromDict(clip);\r\n        if (shape === undefined) continue;\r\n        layer.addShape(shape, true);\r\n        layer.selection.push(shape);\r\n    }\r\n    if (layer.selection.length === 1) EventBus.$emit(\"SelectionInfo.Shape.Set\", layer.selection[0]);\r\n    else EventBus.$emit(\"SelectionInfo.Shape.Set\", null);\r\n    layer.invalidate(false);\r\n    return layer.selection;\r\n}\r\n\r\nexport function deleteShapes(): void {\r\n    if (layerManager.getLayer === undefined) {\r\n        console.log(\"No active layer selected for delete operation\");\r\n        return;\r\n    }\r\n    const l = layerManager.getLayer()!;\r\n    for (let i = l.selection.length - 1; i >= 0; i--) {\r\n        const sel = l.selection[i];\r\n        if (gameStore.selectionHelperID === sel.uuid) {\r\n            l.selection.splice(i, 1);\r\n            continue;\r\n        }\r\n        l.removeShape(sel, true, false);\r\n        EventBus.$emit(\"SelectionInfo.Shape.Set\", null);\r\n        EventBus.$emit(\"Initiative.Remove\", sel.uuid);\r\n    }\r\n}\r\n\r\nexport function cutShapes(): void {\r\n    copyShapes();\r\n    deleteShapes();\r\n}\r\n","import { socket } from \"@/game/api/socket\";\r\nimport { ServerShape } from \"@/game/comm/types/shapes\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { createShapeFromDict } from \"@/game/shapes/utils\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { visibilityStore } from \"../visibility/store\";\r\n\r\nexport class Layer {\r\n    name: string;\r\n    width: number;\r\n    height: number;\r\n    canvas: HTMLCanvasElement;\r\n    ctx: CanvasRenderingContext2D;\r\n\r\n    selectable: boolean = false;\r\n    playerEditable: boolean = false;\r\n    isVisionLayer: boolean = false;\r\n\r\n    // When set to false, the layer will be redrawn on the next tick\r\n    valid: boolean = false;\r\n    // The collection of shapes that this layer contains.\r\n    // These are ordered on a depth basis.\r\n    shapes: Shape[] = [];\r\n\r\n    // Collection of shapes that are currently selected\r\n    selection: Shape[] = [];\r\n\r\n    // Extra selection highlighting settings\r\n    selectionColor = \"#CC0000\";\r\n    selectionWidth = 2;\r\n\r\n    constructor(canvas: HTMLCanvasElement, name: string) {\r\n        this.canvas = canvas;\r\n        this.name = name;\r\n        this.width = canvas.width;\r\n        this.height = canvas.height;\r\n        this.ctx = canvas.getContext(\"2d\")!;\r\n    }\r\n\r\n    invalidate(skipLightUpdate: boolean): void {\r\n        this.valid = false;\r\n        if (!skipLightUpdate) {\r\n            layerManager.invalidateLight();\r\n        }\r\n    }\r\n\r\n    addShape(shape: Shape, sync: boolean, temporary?: boolean, invalidate = true): void {\r\n        if (temporary === undefined) temporary = false;\r\n        shape.layer = this.name;\r\n        this.shapes.push(shape);\r\n        layerManager.UUIDMap.set(shape.uuid, shape);\r\n        shape.checkVisionSources(invalidate);\r\n        shape.setMovementBlock(shape.movementObstruction, invalidate);\r\n        if (shape.ownedBy(gameStore.username) && shape.isToken) gameStore.ownedtokens.push(shape.uuid);\r\n        if (shape.annotation.length) gameStore.annotations.push(shape.uuid);\r\n        if (sync) socket.emit(\"Shape.Add\", { shape: shape.asDict(), temporary });\r\n        if (invalidate) this.invalidate(!sync);\r\n    }\r\n\r\n    setShapes(shapes: ServerShape[]): void {\r\n        for (const serverShape of shapes) {\r\n            const shape = createShapeFromDict(serverShape);\r\n            if (shape === undefined) {\r\n                console.log(`Shape with unknown type ${serverShape.type_} could not be added`);\r\n                return;\r\n            }\r\n            this.addShape(shape, false, false, false);\r\n        }\r\n        this.clearSelection(); // TODO: Fix keeping selection on those items that are not moved.\r\n        this.invalidate(false);\r\n    }\r\n\r\n    removeShape(shape: Shape, sync: boolean, temporary?: boolean): void {\r\n        if (temporary === undefined) temporary = false;\r\n        const idx = this.shapes.indexOf(shape);\r\n        if (idx < 0) {\r\n            console.error(\"attempted to remove shape not in layer.\");\r\n            return;\r\n        }\r\n        this.shapes.splice(idx, 1);\r\n\r\n        if (sync) socket.emit(\"Shape.Remove\", { shape: shape.asDict(), temporary });\r\n        const lsI = visibilityStore.visionSources.findIndex(ls => ls.shape === shape.uuid);\r\n        const lbI = visibilityStore.visionBlockers.findIndex(ls => ls === shape.uuid);\r\n\r\n        const mbI = visibilityStore.movementblockers.findIndex(ls => ls === shape.uuid);\r\n        const anI = gameStore.annotations.findIndex(ls => ls === shape.uuid);\r\n        if (lsI >= 0) visibilityStore.visionSources.splice(lsI, 1);\r\n        if (lbI >= 0) visibilityStore.visionBlockers.splice(lbI, 1);\r\n        if (mbI >= 0) visibilityStore.movementblockers.splice(mbI, 1);\r\n        if (anI >= 0) gameStore.annotations.splice(anI, 1);\r\n\r\n        const annotationIndex = gameStore.annotations.indexOf(shape.uuid);\r\n        if (annotationIndex >= 0) gameStore.annotations.splice(annotationIndex, 1);\r\n\r\n        const ownedIndex = gameStore.ownedtokens.indexOf(shape.uuid);\r\n        if (ownedIndex >= 0) gameStore.ownedtokens.splice(ownedIndex, 1);\r\n\r\n        layerManager.UUIDMap.delete(shape.uuid);\r\n\r\n        const index = this.selection.indexOf(shape);\r\n        if (index >= 0) this.selection.splice(index, 1);\r\n        if (lbI >= 0) visibilityStore.recalculateVision();\r\n        if (mbI >= 0) visibilityStore.recalculateMovement();\r\n        this.invalidate(!sync);\r\n    }\r\n\r\n    clear(): void {\r\n        this.ctx.clearRect(0, 0, this.width, this.height);\r\n    }\r\n\r\n    clearSelection(): void {\r\n        this.selection = [];\r\n        EventBus.$emit(\"SelectionInfo.Shape.Set\", null);\r\n    }\r\n\r\n    draw(doClear?: boolean): void {\r\n        if (!this.valid) {\r\n            const ctx = this.ctx;\r\n            const ogOP = ctx.globalCompositeOperation;\r\n            doClear = doClear === undefined ? true : doClear;\r\n\r\n            if (doClear) this.clear();\r\n\r\n            const state = this;\r\n\r\n            // We iterate twice over all shapes\r\n            // First to draw the auras and a second time to draw the shapes themselves\r\n            // Otherwise auras from one shape could be overlapping another shape itself.\r\n\r\n            for (const shape of this.shapes) {\r\n                if (shape.options.has(\"skipDraw\") && shape.options.get(\"skipDraw\")) continue;\r\n                if (layerManager.getLayer() === undefined) continue;\r\n                if (!shape.visibleInCanvas(state.canvas)) continue;\r\n                if (state.name === \"fow\" && layerManager.getLayer()!.name !== state.name) continue;\r\n                shape.drawAuras(ctx);\r\n            }\r\n            for (const shape of this.shapes) {\r\n                if (shape.options.has(\"skipDraw\") && shape.options.get(\"skipDraw\")) continue;\r\n                if (shape.labels.length === 0 && gameStore.filterNoLabel) continue;\r\n                if (\r\n                    shape.labels.length &&\r\n                    gameStore.labelFilters.length &&\r\n                    !shape.labels.some(l => gameStore.labelFilters.includes(l.uuid))\r\n                )\r\n                    continue;\r\n                if (layerManager.getLayer() === undefined) continue;\r\n                if (!shape.visibleInCanvas(state.canvas)) continue;\r\n                if (state.name === \"fow\" && layerManager.getLayer()!.name !== state.name) continue;\r\n                shape.draw(ctx);\r\n            }\r\n\r\n            if (this.selection != null) {\r\n                ctx.fillStyle = this.selectionColor;\r\n                ctx.strokeStyle = this.selectionColor;\r\n                ctx.lineWidth = this.selectionWidth;\r\n                for (const shape of this.selection) {\r\n                    shape.drawSelection(ctx);\r\n                }\r\n            }\r\n            ctx.globalCompositeOperation = ogOP;\r\n            this.valid = true;\r\n        }\r\n    }\r\n\r\n    moveShapeOrder(shape: Shape, destinationIndex: number, sync: boolean): void {\r\n        const oldIdx = this.shapes.indexOf(shape);\r\n        if (oldIdx === destinationIndex) return;\r\n        this.shapes.splice(oldIdx, 1);\r\n        this.shapes.splice(destinationIndex, 0, shape);\r\n        if (sync) socket.emit(\"Shape.Order.Set\", { shape: shape.asDict(), index: destinationIndex });\r\n        this.invalidate(true);\r\n    }\r\n}\r\n","export class Settings {\r\n    static angleSteps = 4;\r\n    static drawAngleLines = false;\r\n    static drawFirstLightHit = false;\r\n    static skipPlayerFOW = false;\r\n    static skipLightFOW = false;\r\n\r\n    static tempFill: string = \"fog\";\r\n}\r\n","import { layerManager } from \"@/game/layers/manager\";\r\nimport { g2lx, g2ly } from \"@/game/units\";\r\nimport { EdgeIterator, TDS } from \"./tds\";\r\nimport { ccw, cw } from \"./triag\";\r\n\r\nexport function drawPolygon(polygon: number[][], colour?: string): void {\r\n    const dl = layerManager.getLayer(\"draw\");\r\n    if (dl === undefined) return;\r\n    const ctx = dl.ctx;\r\n    ctx.lineJoin = \"round\";\r\n    // ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);\r\n    ctx.lineJoin = \"round\";\r\n    ctx.beginPath();\r\n    ctx.strokeStyle =\r\n        colour === undefined ? `rgb(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255})` : colour;\r\n    ctx.moveTo(g2lx(polygon[0][0]), g2ly(polygon[0][1]));\r\n    for (const point of polygon) {\r\n        ctx.lineTo(g2lx(point[0]), g2ly(point[1]));\r\n    }\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n}\r\n\r\nexport function drawPolygonL(polygon: number[][], colour?: string): void {\r\n    const dl = layerManager.getLayer(\"draw\");\r\n    if (dl === undefined) return;\r\n    const ctx = dl.ctx;\r\n    ctx.lineJoin = \"round\";\r\n    // ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);\r\n    ctx.lineJoin = \"round\";\r\n    ctx.beginPath();\r\n    ctx.strokeStyle =\r\n        colour === undefined ? `rgb(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255})` : colour;\r\n    ctx.moveTo(polygon[0][0], polygon[0][1]);\r\n    for (const point of polygon) {\r\n        ctx.lineTo(point[0], point[1]);\r\n    }\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n}\r\n\r\nfunction x(xx: number, local: boolean): number {\r\n    if (local) return xx;\r\n    else return g2lx(xx);\r\n}\r\n\r\nfunction y(yy: number, local: boolean): number {\r\n    if (local) return yy;\r\n    else return g2ly(yy);\r\n}\r\n\r\nlet I = 0;\r\nlet J = 0;\r\n\r\nfunction drl(ctx: CanvasRenderingContext2D, from: number[], to: number[], constrained: boolean, local: boolean): void {\r\n    // J++;\r\n    // if (constrained) {\r\n    //     I++;\r\n    //     console.log(\"*\", from, to);\r\n    // } else {\r\n    //     console.log(\" \", from, to);\r\n    // }\r\n    ctx.beginPath();\r\n    ctx.strokeStyle = constrained ? \"rgba(255, 0, 0, 0.30)\" : \"rgba(0, 0, 0, 0.30)\";\r\n    ctx.moveTo(x(from[0], local), y(from[1], local));\r\n    ctx.lineTo(x(to[0], local), y(to[1], local));\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n}\r\n\r\nfunction drawPolygonT(tds: TDS, local = true, clear = true, logs: 0 | 1 | 2 = 0): void {\r\n    I = 0;\r\n    J = 0;\r\n    let T = 0;\r\n    const dl = layerManager.getLayer(\"draw\");\r\n    if (dl === undefined) return;\r\n    const ctx = dl.ctx;\r\n    if (clear) ctx.clearRect(0, 0, 2000, 1000);\r\n    ctx.lineJoin = \"round\";\r\n    // ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);\r\n    ctx.lineJoin = \"round\";\r\n    const ei = new EdgeIterator(tds);\r\n    while (ei.valid) {\r\n        ei.next();\r\n        ei.collect();\r\n    }\r\n    ei.collect();\r\n    do {\r\n        const fromP = ei.edge.first!.vertices[ccw(ei.edge.second)]!.point!;\r\n        const toP = ei.edge.first!.vertices[cw(ei.edge.second)]!.point!;\r\n        if (logs > 0) {\r\n            if (fromP[0] === -Infinity || toP[0] === -Infinity) {\r\n                ei.next();\r\n                continue;\r\n            }\r\n            J++;\r\n            if (ei.edge.first!.constraints[ei.edge.second]) {\r\n                I++;\r\n                if (logs === 2) console.log(`Edge: (*) ${fromP} > ${toP}`);\r\n            } else if (logs === 2) console.log(`Edge: ${fromP} > ${toP}`);\r\n        }\r\n        do {\r\n            ei.next();\r\n            ei.collect();\r\n        } while (ei.valid);\r\n    } while (ei.pos !== null);\r\n    for (const t of tds.triangles) {\r\n        if (t.isInfinite()) continue;\r\n        T++;\r\n        const po = [];\r\n        ctx.fillStyle = \"red\";\r\n        if (t.vertices[0] !== undefined) {\r\n            po.push(t.vertices[0]!.point);\r\n            ctx.beginPath();\r\n            ctx.arc(x(t.vertices[0]!.point![0], local), y(t.vertices[0]!.point![1], local), 5, 0, 2 * Math.PI);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n        if (t.vertices[1] !== undefined) {\r\n            po.push(t.vertices[1]!.point);\r\n            ctx.arc(x(t.vertices[1]!.point![0], local), y(t.vertices[1]!.point![1], local), 5, 0, 2 * Math.PI);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n        if (t.vertices[2] !== undefined) {\r\n            po.push(t.vertices[2]!.point);\r\n            ctx.arc(x(t.vertices[2]!.point![0], local), y(t.vertices[2]!.point![1], local), 5, 0, 2 * Math.PI);\r\n            ctx.closePath();\r\n            ctx.fill();\r\n        }\r\n        if (logs === 2) console.log(\"[T] \", ...po, t.constraints);\r\n\r\n        ctx.moveTo(x(t.vertices[0]!.point![0], local), y(t.vertices[0]!.point![1], local));\r\n        if (t.vertices[0] !== undefined && t.vertices[1] !== undefined)\r\n            drl(ctx, t.vertices[0]!.point!, t.vertices[1]!.point!, t.constraints[2], local);\r\n        if (t.vertices[1] !== undefined && t.vertices[2] !== undefined)\r\n            drl(ctx, t.vertices[1]!.point!, t.vertices[2]!.point!, t.constraints[0], local);\r\n        if (t.vertices[2] !== undefined && t.vertices[0] !== undefined)\r\n            drl(ctx, t.vertices[2]!.point!, t.vertices[0]!.point!, t.constraints[1], local);\r\n    }\r\n    if (logs > 0) {\r\n        console.log(`Edges: ${I}/${J}`);\r\n        console.log(`Faces: ${T}`);\r\n    }\r\n}\r\n\r\n(<any>window).DP = drawPolygon;\r\n(<any>window).DPL = drawPolygonL;\r\n(<any>window).DPT = drawPolygonT;\r\n","import { GlobalPoint } from \"@/game/geom\";\r\nimport { gameStore } from \"@/game/store\";\r\n\r\nimport { Edge } from \"./cdt\";\r\nimport { drawPolygon } from \"./draw\";\r\nimport { PA_CDT } from \"./pa\";\r\nimport { Point, Sign, Triangle } from \"./tds\";\r\nimport { ccw, cw, orientation } from \"./triag\";\r\n\r\nexport function computeVisibility(q: GlobalPoint, target: \"vision\" | \"movement\", drawt?: boolean): number[][] {\r\n    if (drawt === undefined) drawt = gameStore.drawTEContour;\r\n    // console.time(\"CV\");\r\n    const Q: Point = [q.x, q.y];\r\n    const rawOutput: number[][] = [];\r\n    const triangle = PA_CDT[target].locate(Q, null).loc;\r\n    if (triangle === null) {\r\n        console.error(\"Triangle not found\");\r\n        return [];\r\n    }\r\n    // triangle.fill();\r\n    rawOutput.push(triangle.vertices[1]!.point!);\r\n    if (!triangle.isConstrained(0))\r\n        expandEdge(Q, triangle.vertices[2]!.point!, triangle.vertices[1]!.point!, triangle, 0, rawOutput);\r\n    rawOutput.push(triangle.vertices[2]!.point!);\r\n    if (!triangle.isConstrained(1))\r\n        expandEdge(Q, triangle.vertices[0]!.point!, triangle.vertices[2]!.point!, triangle, 1, rawOutput);\r\n    rawOutput.push(triangle.vertices[0]!.point!);\r\n    if (!triangle.isConstrained(2))\r\n        expandEdge(Q, triangle.vertices[1]!.point!, triangle.vertices[0]!.point!, triangle, 2, rawOutput);\r\n    // console.timeEnd(\"CV\");\r\n\r\n    if (drawt) drawPolygon(rawOutput, \"red\");\r\n\r\n    return rawOutput;\r\n}\r\n\r\nfunction expandEdge(\r\n    q: Point,\r\n    left: number[],\r\n    right: number[],\r\n    fh: Triangle,\r\n    index: number,\r\n    rawOutput: number[][],\r\n): void {\r\n    // fh.edge(index).draw();\r\n    const nfh = fh.neighbours[index]!;\r\n    // nfh.fill(\"rgba(255, 0, 0, 0.25)\");\r\n    const nIndex = nfh.indexT(fh);\r\n    const rIndex = ccw(nIndex);\r\n    const lIndex = cw(nIndex);\r\n    const nvh = nfh.vertices[nIndex]!;\r\n    const rvh = nfh.vertices[lIndex]!;\r\n    const lvh = nfh.vertices[rIndex]!;\r\n\r\n    const re: Edge = [nfh, rIndex];\r\n    const le: Edge = [nfh, lIndex];\r\n\r\n    const ro = orientation(q, right, nvh.point!);\r\n    const lo = orientation(q, left, nvh.point!);\r\n\r\n    // const ctx = layerManager.getLayer(\"draw\")!.ctx;\r\n    // ctx.beginPath();\r\n    // ctx.strokeStyle = \"red\";\r\n    // ctx.lineJoin = \"round\";\r\n    // ctx.moveTo(g2lx(q.x), g2ly(q.y));\r\n    // ctx.lineTo(g2lx(left[0]), g2ly(left[1]));\r\n    // ctx.moveTo(g2lx(q.x), g2ly(q.y));\r\n    // ctx.lineTo(g2lx(nvh[0]), g2ly(nvh[1]));\r\n    // ctx.strokeStyle = \"blue\";\r\n    // ctx.moveTo(g2lx(q.x), g2ly(q.y));\r\n    // ctx.lineTo(g2lx(right[0]), g2ly(right[1]));\r\n    // ctx.moveTo(g2lx(q.x), g2ly(q.y));\r\n    // ctx.lineTo(g2lx(nvh[0]), g2ly(nvh[1]));\r\n    // ctx.closePath();\r\n    // ctx.stroke();\r\n\r\n    // Right edge is seen if the new vertex is ccw of the right ray\r\n    if (ro === Sign.COUNTERCLOCKWISE) {\r\n        if (re[0].isConstrained(re[1])) {\r\n            // See if current right ray is rvh\r\n            if (right !== rvh.point!) rawOutput.push(raySegIntersection(q, right, nvh.point!, rvh.point!));\r\n            if (lo === Sign.COUNTERCLOCKWISE) rawOutput.push(raySegIntersection(q, left, nvh.point!, rvh.point!));\r\n        } else {\r\n            if (lo === Sign.COUNTERCLOCKWISE) return expandEdge(q, left, right, nfh, rIndex, rawOutput);\r\n            else expandEdge(q, nvh.point!, right, nfh, rIndex, rawOutput);\r\n        }\r\n    }\r\n\r\n    if (ro !== Sign.CLOCKWISE && lo !== Sign.COUNTERCLOCKWISE) {\r\n        rawOutput.push(nvh.point!);\r\n    }\r\n\r\n    if (lo === Sign.CLOCKWISE) {\r\n        if (le[0].isConstrained(le[1])) {\r\n            if (ro === Sign.CLOCKWISE) {\r\n                rawOutput.push(raySegIntersection(q, right, nvh.point!, lvh.point!));\r\n            }\r\n            if (left !== lvh.point!) {\r\n                rawOutput.push(raySegIntersection(q, left, nvh.point!, lvh.point!));\r\n            }\r\n            return;\r\n        } else {\r\n            if (ro === Sign.CLOCKWISE) {\r\n                return expandEdge(q, left, right, nfh, lIndex, rawOutput);\r\n            } else {\r\n                return expandEdge(q, left, nvh.point!, nfh, lIndex, rawOutput);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction raySegIntersection(q: Point, b: Point, s: Point, t: Point): Point {\r\n    const denominator = (t[1] - s[1]) * (b[0] - q[0]) - (t[0] - s[0]) * (b[1] - q[1]);\r\n    const ua = ((t[0] - s[0]) * (q[1] - s[1]) - (t[1] - s[1]) * (q[0] - s[0])) / denominator;\r\n    // const ub = ((b[0] - q.x) * (q.y - s[1]) - (b[1] - q.y) * (q.x - s[0])) / denominator;\r\n    const x = q[0] + ua * (b[0] - q[0]);\r\n    const y = q[1] + ua * (b[1] - q[1]);\r\n\r\n    return [x, y];\r\n}\r\n","import { GlobalPoint, Ray, LocalPoint } from \"@/game/geom\";\r\nimport { Layer } from \"@/game/layers/layer\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Settings } from \"@/game/settings\";\r\nimport { Circle } from \"@/game/shapes/circle\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { g2l, g2lr, g2lx, g2ly, g2lz, getUnitDistance } from \"@/game/units\";\r\nimport { getFogColour } from \"@/game/utils\";\r\nimport { visibilityStore } from \"../visibility/store\";\r\nimport { computeVisibility } from \"../visibility/te/te\";\r\nimport { TriangulationTarget } from \"../visibility/te/pa\";\r\nimport { circleLineIntersection, xyEqual } from \"../visibility/te/triag\";\r\n\r\nexport class FOWLayer extends Layer {\r\n    isVisionLayer: boolean = true;\r\n    preFogShapes: Shape[] = [];\r\n    virtualCanvas: HTMLCanvasElement;\r\n    vCtx: CanvasRenderingContext2D;\r\n\r\n    constructor(canvas: HTMLCanvasElement, name: string) {\r\n        super(canvas, name);\r\n        this.virtualCanvas = document.createElement(\"canvas\");\r\n        this.virtualCanvas.width = window.innerWidth;\r\n        this.virtualCanvas.height = window.innerHeight;\r\n        this.vCtx = this.virtualCanvas.getContext(\"2d\")!;\r\n    }\r\n\r\n    addShape(shape: Shape, sync: boolean, temporary?: boolean, invalidate = true): void {\r\n        super.addShape(shape, sync, temporary, invalidate);\r\n        if (shape.options.has(\"preFogShape\") && shape.options.get(\"preFogShape\")) {\r\n            this.preFogShapes.push(shape);\r\n        }\r\n    }\r\n\r\n    removeShape(shape: Shape, sync: boolean, temporary?: boolean): void {\r\n        if (shape.options.has(\"preFogShape\") && shape.options.get(\"preFogShape\")) {\r\n            const idx = this.preFogShapes.findIndex(s => s.uuid === shape.uuid);\r\n            this.preFogShapes.splice(idx, 1);\r\n        }\r\n        super.removeShape(shape, sync, temporary);\r\n    }\r\n\r\n    draw(): void {\r\n        if (!this.valid) {\r\n            const ctx = this.ctx;\r\n\r\n            if (Settings.skipLightFOW) {\r\n                ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n                this.valid = true;\r\n                return;\r\n            }\r\n\r\n            const originalOperation = ctx.globalCompositeOperation;\r\n            ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n            ctx.fillStyle = \"rgba(0, 0, 0, 1)\";\r\n\r\n            const dctx = layerManager.getLayer(\"draw\")!.ctx;\r\n            if (Settings.drawAngleLines || Settings.drawFirstLightHit) {\r\n                dctx.clearRect(0, 0, dctx.canvas.width, dctx.canvas.height);\r\n            }\r\n\r\n            // At all times provide a minimal vision range to prevent losing your tokens in fog.\r\n            if (gameStore.fullFOW && layerManager.hasLayer(\"tokens\")) {\r\n                for (const sh of layerManager.getLayer(\"tokens\")!.shapes) {\r\n                    if (!sh.ownedBy() || !sh.isToken) continue;\r\n                    const bb = sh.getBoundingBox();\r\n                    const lcenter = g2l(sh.center());\r\n                    const alm = 0.8 * g2lz(bb.w);\r\n                    ctx.beginPath();\r\n                    ctx.arc(lcenter.x, lcenter.y, alm, 0, 2 * Math.PI);\r\n                    const gradient = ctx.createRadialGradient(lcenter.x, lcenter.y, alm / 2, lcenter.x, lcenter.y, alm);\r\n                    gradient.addColorStop(0, \"rgba(0, 0, 0, 1)\");\r\n                    gradient.addColorStop(1, \"rgba(0, 0, 0, 0)\");\r\n                    ctx.fillStyle = gradient;\r\n                    ctx.fill();\r\n                }\r\n            }\r\n\r\n            this.vCtx.clearRect(0, 0, window.innerWidth, window.innerHeight);\r\n\r\n            // First cut out all the light sources\r\n            for (const light of visibilityStore.visionSources) {\r\n                const shape = layerManager.UUIDMap.get(light.shape);\r\n                if (shape === undefined) continue;\r\n                const aura = shape.auras.find(a => a.uuid === light.aura);\r\n                if (aura === undefined) continue;\r\n\r\n                const auraLength = getUnitDistance(aura.value + aura.dim);\r\n                const center = shape.center();\r\n                const lcenter = g2l(center);\r\n\r\n                const auraCircle = new Circle(center, auraLength);\r\n                if (!auraCircle.visibleInCanvas(ctx.canvas)) continue;\r\n\r\n                if (visibilityStore.visionMode === \"bvh\") {\r\n                    let lastArcAngle = -1;\r\n\r\n                    const path = new Path2D();\r\n                    path.moveTo(lcenter.x, lcenter.y);\r\n                    let firstPoint: GlobalPoint;\r\n\r\n                    for (let angle = 0; angle < 2 * Math.PI; angle += (Settings.angleSteps / 180) * Math.PI) {\r\n                        const anglePoint = new GlobalPoint(\r\n                            center.x + auraLength * Math.cos(angle),\r\n                            center.y + auraLength * Math.sin(angle),\r\n                        );\r\n                        if (Settings.drawAngleLines) {\r\n                            dctx!.beginPath();\r\n                            dctx!.moveTo(g2lx(center.x), g2ly(center.y));\r\n                            dctx!.lineTo(g2lx(anglePoint.x), g2ly(anglePoint.y));\r\n                            dctx!.stroke();\r\n                        }\r\n\r\n                        // Check if there is a hit with one of the nearby light blockers.\r\n                        const lightRay = Ray.fromPoints(center, anglePoint);\r\n                        const hitResult = visibilityStore.BV.intersect(lightRay);\r\n\r\n                        if (angle === 0) firstPoint = hitResult.hit ? hitResult.intersect : anglePoint;\r\n\r\n                        // We can move on to the next angle if nothing was hit.\r\n                        if (!hitResult.hit) {\r\n                            // If an earlier hit caused the aura to leave the arc, we need to go back to the arc\r\n                            if (lastArcAngle === -1) {\r\n                                // Set the start of a new arc beginning at the current angle\r\n                                lastArcAngle = angle;\r\n                                // Draw a line from the last non arc location back to the arc\r\n                                const dest = g2l(anglePoint);\r\n                                ctx.lineTo(dest.x, dest.y);\r\n                            }\r\n                            continue;\r\n                        }\r\n                        // If hit , first finish any ongoing arc, then move to the intersection point\r\n                        if (lastArcAngle !== -1) {\r\n                            path.arc(lcenter.x, lcenter.y, g2lr(aura.value + aura.dim), lastArcAngle, angle);\r\n                            lastArcAngle = -1;\r\n                        }\r\n                        path.lineTo(g2lx(hitResult.intersect.x), g2ly(hitResult.intersect.y));\r\n                    }\r\n                    // Finish the final arc.\r\n                    if (lastArcAngle === -1) path.lineTo(g2lx(firstPoint!.x), g2ly(firstPoint!.y));\r\n                    else path.arc(lcenter.x, lcenter.y, g2lr(aura.value + aura.dim), lastArcAngle, 2 * Math.PI);\r\n\r\n                    if (gameStore.fullFOW) {\r\n                        if (aura.dim > 0) {\r\n                            // Fill the light aura with a radial dropoff towards the outside.\r\n                            const gradient = ctx.createRadialGradient(\r\n                                lcenter.x,\r\n                                lcenter.y,\r\n                                g2lr(aura.value),\r\n                                lcenter.x,\r\n                                lcenter.y,\r\n                                g2lr(aura.value + aura.dim),\r\n                            );\r\n                            gradient.addColorStop(0, \"rgba(0, 0, 0, 1)\");\r\n                            gradient.addColorStop(1, \"rgba(0, 0, 0, 0)\");\r\n                            ctx.fillStyle = gradient;\r\n                        } else {\r\n                            ctx.fillStyle = \"rgba(0, 0, 0, 1)\";\r\n                        }\r\n                        ctx.fill(path);\r\n                    }\r\n\r\n                    aura.lastPath = path;\r\n                } else {\r\n                    this.vCtx.globalCompositeOperation = \"source-over\";\r\n                    this.vCtx.fillStyle = \"rgba(0, 0, 0, 1)\";\r\n                    const polygon = computeVisibility(center, TriangulationTarget.VISION);\r\n                    this.vCtx.beginPath();\r\n                    this.vCtx.moveTo(g2lx(polygon[0][0]), g2ly(polygon[0][1]));\r\n                    for (const point of polygon) this.vCtx.lineTo(g2lx(point[0]), g2ly(point[1]));\r\n                    this.vCtx.closePath();\r\n                    this.vCtx.fill();\r\n                    if (aura.dim > 0) {\r\n                        // Fill the light aura with a radial dropoff towards the outside.\r\n                        const gradient = this.vCtx.createRadialGradient(\r\n                            lcenter.x,\r\n                            lcenter.y,\r\n                            g2lr(aura.value),\r\n                            lcenter.x,\r\n                            lcenter.y,\r\n                            g2lr(aura.value + aura.dim),\r\n                        );\r\n                        gradient.addColorStop(0, \"rgba(0, 0, 0, 1)\");\r\n                        gradient.addColorStop(1, \"rgba(0, 0, 0, 0)\");\r\n                        this.vCtx.fillStyle = gradient;\r\n                    } else {\r\n                        this.vCtx.fillStyle = \"rgba(0, 0, 0, 1)\";\r\n                    }\r\n                    this.vCtx.globalCompositeOperation = \"source-in\";\r\n                    this.vCtx.beginPath();\r\n                    this.vCtx.arc(lcenter.x, lcenter.y, g2lr(aura.value + aura.dim), 0, 2 * Math.PI);\r\n                    this.vCtx.fill();\r\n                    ctx.drawImage(this.virtualCanvas, 0, 0);\r\n                    aura.lastPath = this.updateAuraPath(polygon, auraCircle);\r\n                    shape.invalidate(true);\r\n                }\r\n            }\r\n\r\n            // At the DM Side due to opacity of the two fow layers, it looks strange if we just render them on top of eachother like players.\r\n            if (gameStore.fowLOS) {\r\n                ctx.globalCompositeOperation = \"source-in\";\r\n                ctx.drawImage(layerManager.getLayer(\"fow-players\")!.canvas, 0, 0);\r\n            }\r\n\r\n            for (const preShape of this.preFogShapes) {\r\n                if (!preShape.visibleInCanvas(this.canvas)) continue;\r\n                const ogComposite = preShape.globalCompositeOperation;\r\n                if (!gameStore.fullFOW) {\r\n                    if (preShape.globalCompositeOperation === \"source-over\")\r\n                        preShape.globalCompositeOperation = \"destination-out\";\r\n                    else if (preShape.globalCompositeOperation === \"destination-out\")\r\n                        preShape.globalCompositeOperation = \"source-over\";\r\n                }\r\n                preShape.draw(ctx);\r\n                preShape.globalCompositeOperation = ogComposite;\r\n            }\r\n\r\n            if (gameStore.fullFOW) {\r\n                ctx.globalCompositeOperation = \"source-out\";\r\n                ctx.fillStyle = getFogColour();\r\n                ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n            }\r\n\r\n            super.draw(false);\r\n\r\n            ctx.globalCompositeOperation = originalOperation;\r\n        }\r\n    }\r\n\r\n    updateAuraPath(visibilityPolygon: number[][], auraCircle: Circle): Path2D {\r\n        const path = new Path2D();\r\n        const lCenter = g2l(auraCircle.center());\r\n        const lRadius = g2lz(auraCircle.r);\r\n        let firstAngle: number | null = null;\r\n        let lastAngle: number | null = null;\r\n\r\n        const ixs: LocalPoint[][] = [];\r\n\r\n        // First find all polygon segments that are actually relevant\r\n        for (const [i, p] of visibilityPolygon.map(p => GlobalPoint.fromArray(p)).entries()) {\r\n            const np = GlobalPoint.fromArray(visibilityPolygon[(i + 1) % visibilityPolygon.length]);\r\n            const pLoc = g2l(p);\r\n            const npLoc = g2l(np);\r\n            const ix = circleLineIntersection(auraCircle.center(), auraCircle.r, p, np).map(x => g2l(x));\r\n            if (ix.length === 0) {\r\n                // segment lies completely outside circle\r\n                if (!auraCircle.contains(p)) continue;\r\n                // segment lies completely inside circle\r\n                else ix.push(pLoc, npLoc);\r\n            } else if (ix.length === 1) {\r\n                // segment is tangent to circle, segment can be ignored\r\n                if (xyEqual(ix[0].asArray(), pLoc.asArray()) || xyEqual(ix[0].asArray(), npLoc.asArray())) continue;\r\n                if (auraCircle.contains(p)) {\r\n                    ix.unshift(pLoc);\r\n                } else {\r\n                    ix.push(npLoc);\r\n                }\r\n            }\r\n            // Check some bad cases\r\n            if (ixs.length > 0) {\r\n                const lastIx = ixs[ixs.length - 1];\r\n                if (xyEqual(lastIx[0].asArray(), ix[1].asArray()) && xyEqual(lastIx[1].asArray(), ix[0].asArray()))\r\n                    continue;\r\n                if (xyEqual(lastIx[0].asArray(), ix[0].asArray()) && xyEqual(lastIx[1].asArray(), ix[1].asArray()))\r\n                    continue;\r\n            }\r\n            ixs.push(ix);\r\n        }\r\n\r\n        if (ixs.length <= 1) {\r\n            path.arc(lCenter.x, lCenter.y, lRadius, 0, 2 * Math.PI);\r\n            return path;\r\n        }\r\n\r\n        // If enough interesting edges have been found, cut the circle up.\r\n        for (const ix of ixs) {\r\n            const circleHitAngle = Math.atan2(ix[0].y - lCenter.y, ix[0].x - lCenter.x);\r\n            if (lastAngle === null) {\r\n                path.moveTo(ix[0].x, ix[0].y);\r\n                firstAngle = Math.atan2(ix[0].y - lCenter.y, ix[0].x - lCenter.x);\r\n            } else if (lastAngle !== circleHitAngle) {\r\n                path.arc(lCenter.x, lCenter.y, lRadius, lastAngle, circleHitAngle);\r\n            }\r\n            lastAngle = Math.atan2(ix[1].y - lCenter.y, ix[1].x - lCenter.x);\r\n            path.lineTo(ix[1].x, ix[1].y);\r\n        }\r\n        if (firstAngle && lastAngle) {\r\n            if (firstAngle !== lastAngle) path.arc(lCenter.x, lCenter.y, lRadius, lastAngle, firstAngle);\r\n        } else path.arc(lCenter.x, lCenter.y, lRadius, 0, 2 * Math.PI);\r\n\r\n        return path;\r\n    }\r\n}\r\n","import { Ray, Vector } from \"@/game/geom\";\r\nimport { Layer } from \"@/game/layers/layer\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Settings } from \"@/game/settings\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { g2l, g2lr, g2lx, g2ly } from \"@/game/units\";\r\nimport { visibilityStore } from \"../visibility/store\";\r\nimport { TriangulationTarget } from \"../visibility/te/pa\";\r\nimport { computeVisibility } from \"../visibility/te/te\";\r\n\r\nexport class FOWPlayersLayer extends Layer {\r\n    isVisionLayer: boolean = true;\r\n\r\n    draw(): void {\r\n        if (!this.valid) {\r\n            // console.time(\"VI\");\r\n            const ctx = this.ctx;\r\n\r\n            if (!gameStore.fowLOS || Settings.skipPlayerFOW) {\r\n                ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n                this.valid = true;\r\n                return;\r\n            }\r\n\r\n            ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n            const originalOperation = ctx.globalCompositeOperation;\r\n\r\n            ctx.fillStyle = \"rgba(0, 0, 0, 1)\";\r\n\r\n            // For the DM this is done at the end of this function.  TODO: why the split up ???\r\n            // This was done in commit be1e65cff1e7369375fe11cfa1643fab1d11beab.\r\n            if (!gameStore.IS_DM) super.draw(!gameStore.fullFOW);\r\n\r\n            // Then cut out all the player vision auras\r\n            const maxLength = ctx.canvas.width + ctx.canvas.height;\r\n\r\n            for (const tokenId of gameStore.activeTokens) {\r\n                const token = layerManager.UUIDMap.get(tokenId);\r\n                if (token === undefined) continue;\r\n                const center = token.center();\r\n                const lcenter = g2l(center);\r\n                if (visibilityStore.visionMode === \"bvh\") {\r\n                    ctx.beginPath();\r\n                    let lastArcAngle = -1;\r\n\r\n                    for (let angle = 0; angle < 2 * Math.PI; angle += (Settings.angleSteps / 2 / 180) * Math.PI) {\r\n                        const cos = Math.cos(angle);\r\n                        const sin = Math.sin(angle);\r\n                        // Check if there is a hit with one of the nearby light blockers.\r\n                        const lightRay = new Ray(center, new Vector(cos, sin));\r\n                        const hitResult = visibilityStore.BV.intersect(lightRay);\r\n\r\n                        // We can move on to the next angle if nothing was hit.\r\n                        if (!hitResult.hit) {\r\n                            // If an earlier hit caused the aura to leave the arc, we need to go back to the arc\r\n                            if (lastArcAngle === -1) {\r\n                                // Draw a line from the last non arc location back to the arc\r\n                                ctx.lineTo(lcenter.x + maxLength * cos, lcenter.y + maxLength * sin);\r\n                                // Set the start of a new arc beginning at the current angle\r\n                                lastArcAngle = angle;\r\n                            }\r\n                            continue;\r\n                        }\r\n                        // If hit , first finish any ongoing arc, then move to the intersection point\r\n                        if (lastArcAngle !== -1) {\r\n                            ctx.arc(lcenter.x, lcenter.y, maxLength, lastArcAngle, angle);\r\n                            lastArcAngle = -1;\r\n                        }\r\n                        ctx.lineTo(g2lx(hitResult.intersect.x), g2ly(hitResult.intersect.y));\r\n                    }\r\n\r\n                    // Finish the final arc.\r\n                    if (lastArcAngle !== -1) ctx.arc(lcenter.x, lcenter.y, maxLength, lastArcAngle, 2 * Math.PI);\r\n                    else ctx.closePath();\r\n                    ctx.fill();\r\n                } else {\r\n                    if (true) {\r\n                        // Add a gradient vision dropoff\r\n                        const gradient = ctx.createRadialGradient(\r\n                            lcenter.x,\r\n                            lcenter.y,\r\n                            g2lr(gameStore.visionRangeMin),\r\n                            lcenter.x,\r\n                            lcenter.y,\r\n                            g2lr(gameStore.visionRangeMax),\r\n                        );\r\n                        gradient.addColorStop(0, \"rgba(0, 0, 0, 1)\");\r\n                        gradient.addColorStop(1, \"rgba(0, 0, 0, 0)\");\r\n                        ctx.fillStyle = gradient;\r\n                    } else {\r\n                        ctx.fillStyle = \"rgba(0, 0, 0, 1)\";\r\n                    }\r\n                    try {\r\n                        const polygon = computeVisibility(token.center(), TriangulationTarget.VISION);\r\n                        ctx.beginPath();\r\n                        ctx.moveTo(g2lx(polygon[0][0]), g2ly(polygon[0][1]));\r\n                        for (const point of polygon) ctx.lineTo(g2lx(point[0]), g2ly(point[1]));\r\n                        ctx.closePath();\r\n                        ctx.fill();\r\n                    } catch {\r\n                        // no-op\r\n                    }\r\n                }\r\n            }\r\n\r\n            // For the players this is done at the beginning of this function.  TODO: why the split up ???\r\n            // This was done in commit be1e65cff1e7369375fe11cfa1643fab1d11beab.\r\n            if (gameStore.IS_DM) super.draw(!gameStore.fullFOW);\r\n\r\n            ctx.globalCompositeOperation = originalOperation;\r\n            // console.timeEnd(\"VI\");\r\n        }\r\n    }\r\n}\r\n","import { Layer } from \"@/game/layers/layer\";\r\nimport { gameStore } from \"@/game/store\";\r\n\r\nexport class GridLayer extends Layer {\r\n    invalidate(): void {\r\n        this.valid = false;\r\n    }\r\n    draw(_doClear?: boolean): void {\r\n        if (!this.valid) {\r\n            this.drawGrid();\r\n        }\r\n    }\r\n    drawGrid(): void {\r\n        const ctx = this.ctx;\r\n        this.clear();\r\n        ctx.beginPath();\r\n\r\n        const gs = gameStore.gridSize;\r\n\r\n        for (let i = 0; i < this.width; i += gs * gameStore.zoomFactor) {\r\n            ctx.moveTo(i + (gameStore.panX % gs) * gameStore.zoomFactor, 0);\r\n            ctx.lineTo(i + (gameStore.panX % gs) * gameStore.zoomFactor, this.height);\r\n            ctx.moveTo(0, i + (gameStore.panY % gs) * gameStore.zoomFactor);\r\n            ctx.lineTo(this.width, i + (gameStore.panY % gs) * gameStore.zoomFactor);\r\n        }\r\n\r\n        ctx.strokeStyle = gameStore.gridColour;\r\n        ctx.lineWidth = 1;\r\n        ctx.stroke();\r\n        this.valid = true;\r\n    }\r\n}\r\n","import { ServerLayer } from \"@/game/comm/types/general\";\r\nimport { FOWLayer } from \"@/game/layers/fow\";\r\nimport { FOWPlayersLayer } from \"@/game/layers/fowplayers\";\r\nimport { GridLayer } from \"@/game/layers/grid\";\r\nimport { Layer } from \"@/game/layers/layer\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { GlobalPoint } from \"../geom\";\r\nimport { Asset } from \"../shapes/asset\";\r\nimport { l2gx, l2gy, l2gz } from \"../units\";\r\n\r\nexport function createLayer(layerInfo: ServerLayer): void {\r\n    // Create canvas element\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.style.zIndex = layerManager.layers.length.toString();\r\n    canvas.width = window.innerWidth;\r\n    canvas.height = window.innerHeight;\r\n\r\n    // Create the Layer instance\r\n    let layer: Layer;\r\n    if (layerInfo.type_ === \"grid\") layer = new GridLayer(canvas, layerInfo.name);\r\n    else if (layerInfo.type_ === \"fow\") layer = new FOWLayer(canvas, layerInfo.name);\r\n    else if (layerInfo.type_ === \"fow-players\") layer = new FOWPlayersLayer(canvas, layerInfo.name);\r\n    else layer = new Layer(canvas, layerInfo.name);\r\n    layer.selectable = layerInfo.selectable;\r\n    layer.playerEditable = layerInfo.player_editable;\r\n    layerManager.addLayer(layer);\r\n\r\n    // Add the element to the DOM\r\n    const layers = document.getElementById(\"layers\");\r\n    if (layers === null) {\r\n        console.warn(\"Layers div is missing, this will prevent the main game board from loading!\");\r\n        return;\r\n    }\r\n    if (layerInfo.name !== \"fow-players\") layers.appendChild(canvas);\r\n\r\n    if (layerInfo.type_ === \"grid\" && layerInfo.size) gameStore.setGridSize({ gridSize: layerInfo.size, sync: false });\r\n    // Load layer shapes\r\n    layer.setShapes(layerInfo.shapes);\r\n}\r\n\r\nexport function dropAsset(event: DragEvent): void {\r\n    const layer = layerManager.getLayer();\r\n    if (layer === undefined || event === null || event.dataTransfer === null) return;\r\n    const image = document.createElement(\"img\");\r\n    image.src = event.dataTransfer.getData(\"text/plain\");\r\n    const asset = new Asset(\r\n        image,\r\n        new GlobalPoint(l2gx(event.clientX), l2gy(event.clientY)),\r\n        l2gz(image.width),\r\n        l2gz(image.height),\r\n    );\r\n    asset.src = new URL(image.src).pathname;\r\n\r\n    if (gameStore.useGrid) {\r\n        const gs = gameStore.gridSize;\r\n        asset.refPoint = new GlobalPoint(\r\n            Math.round(asset.refPoint.x / gs) * gs,\r\n            Math.round(asset.refPoint.y / gs) * gs,\r\n        );\r\n        asset.w = Math.max(Math.round(asset.w / gs) * gs, gs);\r\n        asset.h = Math.max(Math.round(asset.h / gs) * gs, gs);\r\n    }\r\n\r\n    layer.addShape(asset, true);\r\n}\r\n","import { GlobalPoint, LocalPoint } from \"@/game/geom\";\r\nimport { Layer } from \"@/game/layers/layer\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Rect } from \"@/game/shapes/rect\";\r\nimport { Text } from \"@/game/shapes/text\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { l2g } from \"@/game/units\";\r\n\r\nexport class AnnotationManager {\r\n    annotationText: Text;\r\n    annotationRect: Rect;\r\n    layer: Layer | undefined;\r\n    shown: boolean = false;\r\n\r\n    constructor() {\r\n        const origin = new GlobalPoint(0, 0);\r\n        this.annotationText = new Text(origin, \"\", \"bold 20px serif\", 0, \"rgba(230, 230, 230, 1)\");\r\n        this.annotationRect = new Rect(origin, 0, 0, \"rgba(0, 0, 0, 0.6)\");\r\n    }\r\n\r\n    setActiveText(text: string): void {\r\n        if (this.layer === undefined) {\r\n            if (layerManager.hasLayer(\"draw\")) {\r\n                this.layer = layerManager.getLayer(\"draw\")!;\r\n                this.layer.addShape(this.annotationRect, false);\r\n                this.layer.addShape(this.annotationText, false);\r\n            } else {\r\n                console.warn(\"There is no draw layer to draw annotations on!\");\r\n                return;\r\n            }\r\n        }\r\n        this.shown = text !== \"\";\r\n        this.annotationText.refPoint = l2g(new LocalPoint(this.layer.canvas.width / 2, 50));\r\n        this.annotationText.text = text;\r\n        const width = this.shown ? this.annotationText.getMaxWidth(this.layer.ctx) + 10 : 0;\r\n        const height = this.shown ? this.annotationText.getMaxHeight(this.layer.ctx) + 10 : 0;\r\n        this.annotationRect.refPoint = l2g(new LocalPoint(this.layer.canvas.width / 2 - width / 2, 30));\r\n        this.annotationRect.w = width / gameStore.zoomFactor;\r\n        this.annotationRect.h = height / gameStore.zoomFactor;\r\n        this.layer.invalidate(true);\r\n    }\r\n}\r\n","import { sendClientOptions } from \"@/game/api/utils\";\r\nimport { ServerShape } from \"@/game/comm/types/shapes\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { createShapeFromDict } from \"@/game/shapes/utils\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { AnnotationManager } from \"@/game/ui/annotation\";\r\nimport { g2l } from \"@/game/units\";\r\nimport { EventBus } from \"./event-bus\";\r\nimport { visibilityStore } from \"./visibility/store\";\r\n\r\nexport class GameManager {\r\n    selectedTool: number = 0;\r\n\r\n    annotationManager = new AnnotationManager();\r\n\r\n    addShape(shape: ServerShape): void {\r\n        if (!layerManager.hasLayer(shape.layer)) {\r\n            console.log(`Shape with unknown layer ${shape.layer} could not be added`);\r\n            return;\r\n        }\r\n        const layer = layerManager.getLayer(shape.layer)!;\r\n        const sh = createShapeFromDict(shape);\r\n        if (sh === undefined) {\r\n            console.log(`Shape with unknown type ${shape.type_} could not be added`);\r\n            return;\r\n        }\r\n        layer.addShape(sh, false);\r\n        layer.invalidate(false);\r\n    }\r\n\r\n    updateShape(data: { shape: ServerShape; redraw: boolean; move: boolean; temporary: boolean }): void {\r\n        if (!layerManager.hasLayer(data.shape.layer)) {\r\n            console.log(`Shape with unknown layer ${data.shape.layer} could not be added`);\r\n            return;\r\n        }\r\n        const sh = createShapeFromDict(data.shape);\r\n        if (sh === undefined) {\r\n            console.log(`Shape with unknown type ${data.shape.type_} could not be added`);\r\n            return;\r\n        }\r\n        const oldShape = layerManager.UUIDMap.get(data.shape.uuid);\r\n        if (oldShape === undefined) {\r\n            console.log(`Shape with unknown id could not be updated`);\r\n            return;\r\n        }\r\n        const redrawInitiative = sh.owners !== oldShape.owners;\r\n        const shape = Object.assign(oldShape, sh);\r\n        shape.checkVisionSources();\r\n        shape.setMovementBlock(shape.movementObstruction);\r\n        shape.setIsToken(shape.isToken);\r\n        if (data.redraw) {\r\n            if (shape.visionObstruction) visibilityStore.recalculateVision();\r\n            layerManager.getLayer(data.shape.layer)!.invalidate(false);\r\n            if (shape.movementObstruction) visibilityStore.recalculateMovement();\r\n        }\r\n        if (redrawInitiative) EventBus.$emit(\"Initiative.ForceUpdate\");\r\n    }\r\n\r\n    setCenterPosition(position: GlobalPoint): void {\r\n        const localPos = g2l(position);\r\n        gameStore.increasePanX((window.innerWidth / 2 - localPos.x) / gameStore.zoomFactor);\r\n        gameStore.increasePanY((window.innerHeight / 2 - localPos.y) / gameStore.zoomFactor);\r\n        layerManager.invalidate();\r\n        sendClientOptions(gameStore.locationOptions);\r\n    }\r\n}\r\n\r\nexport const gameManager = new GameManager();\r\n(<any>window).gameManager = gameManager;\r\n","import { AssetList } from \"@/core/comm/types\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { BoardInfo, Note, ServerClient, ServerLocation } from \"@/game/comm/types/general\";\r\nimport { ServerShape } from \"@/game/comm/types/shapes\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { createLayer } from \"@/game/layers/utils\";\r\nimport { gameManager } from \"@/game/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { router } from \"@/router\";\r\nimport { zoomDisplay } from \"../utils\";\r\nimport { visibilityStore } from \"../visibility/store\";\r\n\r\nsocket.on(\"connect\", () => {\r\n    console.log(\"Connected\");\r\n});\r\nsocket.on(\"disconnect\", () => {\r\n    console.log(\"Disconnected\");\r\n});\r\nsocket.on(\"connect_error\", (_error: any) => {\r\n    console.error(\"Could not connect to game session.\");\r\n    router.push(\"/dashboard\");\r\n});\r\nsocket.on(\"error\", (_error: any) => {\r\n    console.error(\"Game session does not exist.\");\r\n    router.push(\"/dashboard\");\r\n});\r\nsocket.on(\"redirect\", (destination: string) => {\r\n    console.log(\"redirecting\");\r\n    router.push(destination);\r\n});\r\nsocket.on(\r\n    \"Room.Info.Set\",\r\n    (data: {\r\n        name: string;\r\n        creator: string;\r\n        invitationCode: string;\r\n        isLocked: boolean;\r\n        players: { id: number; name: string }[];\r\n    }) => {\r\n        gameStore.setRoomName(data.name);\r\n        gameStore.setRoomCreator(data.creator);\r\n        gameStore.setInvitationCode(data.invitationCode);\r\n        gameStore.setIsLocked({ isLocked: data.isLocked, sync: false });\r\n        gameStore.setPlayers(data.players);\r\n    },\r\n);\r\nsocket.on(\"Room.Info.InvitationCode.Set\", (invitationCode: string) => {\r\n    gameStore.setInvitationCode(invitationCode);\r\n    EventBus.$emit(\"DmSettings.RefreshedInviteCode\");\r\n});\r\nsocket.on(\"Room.Info.Players.Add\", (data: { id: number; name: string }) => {\r\n    gameStore.addPlayer(data);\r\n});\r\nsocket.on(\"Username.Set\", (username: string) => {\r\n    gameStore.setUsername(username);\r\n    gameStore.setDM(username === decodeURIComponent(window.location.pathname.split(\"/\")[2]));\r\n});\r\nsocket.on(\"Client.Options.Set\", (options: ServerClient) => {\r\n    gameStore.setGridColour({ colour: options.grid_colour, sync: false });\r\n    gameStore.setFOWColour({ colour: options.fow_colour, sync: false });\r\n    gameStore.setRulerColour({ colour: options.ruler_colour, sync: false });\r\n    gameStore.setPanX(options.pan_x);\r\n    gameStore.setPanY(options.pan_y);\r\n    gameStore.setZoomDisplay(zoomDisplay(options.zoom_factor));\r\n    // gameStore.setZoomDisplay(0.5);\r\n    if (options.active_layer) layerManager.selectLayer(options.active_layer, false);\r\n    if (layerManager.getGridLayer() !== undefined) layerManager.getGridLayer()!.invalidate();\r\n});\r\nsocket.on(\"Location.Set\", (data: Partial<ServerLocation>) => {\r\n    if (data.name !== undefined) gameStore.setLocationName(data.name);\r\n    if (data.unit_size !== undefined) gameStore.setUnitSize({ unitSize: data.unit_size, sync: false });\r\n    if (data.unit_size_unit !== undefined)\r\n        gameStore.setUnitSizeUnit({ unitSizeUnit: data.unit_size_unit, sync: false });\r\n    if (data.use_grid !== undefined) gameStore.setUseGrid({ useGrid: data.use_grid, sync: false });\r\n    if (data.full_fow !== undefined) gameStore.setFullFOW({ fullFOW: data.full_fow, sync: false });\r\n    if (data.fow_opacity !== undefined) gameStore.setFOWOpacity({ fowOpacity: data.fow_opacity, sync: false });\r\n    if (data.fow_los !== undefined) gameStore.setLineOfSight({ fowLOS: data.fow_los, sync: false });\r\n    if (data.vision_min_range !== undefined) gameStore.setVisionRangeMin({ value: data.vision_min_range, sync: false });\r\n    if (data.vision_max_range !== undefined) gameStore.setVisionRangeMax({ value: data.vision_max_range, sync: false });\r\n    if (data.vision_mode !== undefined) {\r\n        visibilityStore.setVisionMode({ mode: data.vision_mode, sync: false });\r\n        visibilityStore.recalculateVision();\r\n        visibilityStore.recalculateMovement();\r\n    }\r\n});\r\nsocket.on(\"Position.Set\", (data: { x: number; y: number; zoom: number }) => {\r\n    gameStore.setZoomDisplay(data.zoom);\r\n    gameManager.setCenterPosition(new GlobalPoint(data.x, data.y));\r\n});\r\nsocket.on(\"Notes.Set\", (notes: Note[]) => {\r\n    for (const note of notes) gameStore.newNote({ note, sync: false });\r\n});\r\nsocket.on(\"Asset.List.Set\", (assets: AssetList) => {\r\n    gameStore.setAssets(assets);\r\n});\r\nsocket.on(\"Board.Set\", (locationInfo: BoardInfo) => {\r\n    gameStore.clear();\r\n    visibilityStore.clear();\r\n    gameStore.setLocations(locationInfo.locations);\r\n    document.getElementById(\"layers\")!.innerHTML = \"\";\r\n    gameStore.resetLayerInfo();\r\n    layerManager.reset();\r\n    for (const layer of locationInfo.layers) createLayer(layer);\r\n    // Force the correct opacity render on other layers.\r\n    layerManager.selectLayer(layerManager.getLayer()!.name, false);\r\n    EventBus.$emit(\"Initiative.Clear\");\r\n    visibilityStore.recalculateVision();\r\n    visibilityStore.recalculateMovement();\r\n    gameStore.setBoardInitialized(true);\r\n});\r\nsocket.on(\"Gridsize.Set\", (gridSize: number) => {\r\n    gameStore.setGridSize({ gridSize, sync: false });\r\n});\r\nsocket.on(\"Shape.Add\", (shape: ServerShape) => {\r\n    gameManager.addShape(shape);\r\n});\r\nsocket.on(\"Shape.Remove\", (shape: ServerShape) => {\r\n    if (!layerManager.UUIDMap.has(shape.uuid)) {\r\n        console.log(`Attempted to remove an unknown shape`);\r\n        return;\r\n    }\r\n    if (!layerManager.hasLayer(shape.layer)) {\r\n        console.log(`Attempted to remove shape from an unknown layer ${shape.layer}`);\r\n        return;\r\n    }\r\n    const layer = layerManager.getLayer(shape.layer)!;\r\n    layer.removeShape(layerManager.UUIDMap.get(shape.uuid)!, false);\r\n    layer.invalidate(false);\r\n});\r\nsocket.on(\"Shape.Order.Set\", (data: { shape: ServerShape; index: number }) => {\r\n    if (!layerManager.UUIDMap.has(data.shape.uuid)) {\r\n        console.log(`Attempted to move the shape order of an unknown shape`);\r\n        return;\r\n    }\r\n    if (!layerManager.hasLayer(data.shape.layer)) {\r\n        console.log(`Attempted to remove shape from an unknown layer ${data.shape.layer}`);\r\n        return;\r\n    }\r\n    const shape = layerManager.UUIDMap.get(data.shape.uuid)!;\r\n    const layer = layerManager.getLayer(shape.layer)!;\r\n    layer.moveShapeOrder(shape, data.index, false);\r\n});\r\nsocket.on(\"Shape.Layer.Change\", (data: { uuid: string; layer: string }) => {\r\n    const shape = layerManager.UUIDMap.get(data.uuid);\r\n    if (shape === undefined) return;\r\n    shape.moveLayer(data.layer, false);\r\n});\r\nsocket.on(\"Shape.Update\", (data: { shape: ServerShape; redraw: boolean; move: boolean; temporary: boolean }) => {\r\n    gameManager.updateShape(data);\r\n});\r\nsocket.on(\"Temp.Clear\", (shapeIds: string[]) => {\r\n    for (const shapeId of shapeIds) {\r\n        if (!layerManager.UUIDMap.has(shapeId)) {\r\n            console.log(\"Attempted to remove an unknown temporary shape\");\r\n            continue;\r\n        }\r\n        const shape = layerManager.UUIDMap.get(shapeId)!;\r\n        if (!layerManager.hasLayer(shape.layer)) {\r\n            console.log(`Attempted to remove shape from an unknown layer ${shape.layer}`);\r\n            continue;\r\n        }\r\n        const realShape = layerManager.UUIDMap.get(shape.uuid)!;\r\n        layerManager.getLayer(shape.layer)!.removeShape(realShape, false);\r\n    }\r\n});\r\nsocket.on(\"Labels.Set\", (labels: Label[]) => {\r\n    for (const label of labels) gameStore.addLabel(label);\r\n});\r\nsocket.on(\"Label.Visibility.Set\", (data: { user: string; uuid: string; visible: boolean }) => {\r\n    gameStore.setLabelVisibility(data);\r\n});\r\nsocket.on(\"Label.Add\", (data: Label) => {\r\n    gameStore.addLabel(data);\r\n});\r\nsocket.on(\"Label.Delete\", (data: { user: string; uuid: string }) => {\r\n    gameStore.deleteLabel(data);\r\n});\r\nsocket.on(\"Labels.Filter.Add\", (uuid: string) => {\r\n    gameStore.labelFilters.push(uuid);\r\n    layerManager.invalidate();\r\n});\r\nsocket.on(\"Labels.Filter.Remove\", (uuid: string) => {\r\n    const idx = gameStore.labelFilters.indexOf(uuid);\r\n    if (idx >= 0) {\r\n        gameStore.labelFilters.splice(idx, 1);\r\n        layerManager.invalidate();\r\n    }\r\n});\r\nsocket.on(\"Labels.Filters.Set\", (filters: string[]) => {\r\n    gameStore.setLabelFilters(filters);\r\n});\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('modal',{attrs:{\"visible\":_vm.visible,\"mask\":false},on:{\"close\":function($event){_vm.visible = false}},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_c('div',[_vm._v(\"Initiative\")]),_c('div',{staticClass:\"header-close\",on:{\"click\":function($event){_vm.visible = false}}},[_c('i',{staticClass:\"far fa-window-close\"})])])}}])},[_c('div',{staticClass:\"modal-body\"},[_c('draggable',{attrs:{\"id\":\"initiative-list\",\"setData\":_vm.fakeSetData,\"disabled\":!_vm.$store.state.game.IS_DM},on:{\"change\":_vm.updateOrder},model:{value:(_vm.$store.state.initiative.data),callback:function ($$v) {_vm.$set(_vm.$store.state.initiative, \"data\", $$v)},expression:\"$store.state.initiative.data\"}},[_vm._l((_vm.$store.state.initiative.data),function(actor){return [_c('div',{key:actor.uuid,staticStyle:{\"display\":\"flex\",\"flex-direction\":\"column\",\"align-items\":\"flex-end\"}},[_c('div',{staticClass:\"initiative-actor\",class:{ 'initiative-selected': _vm.$store.state.initiative.currentActor === actor.uuid },style:({ cursor: _vm.$store.state.game.IS_DM && 'move' }),on:{\"mouseenter\":function($event){return _vm.toggleHighlight(actor, true)},\"mouseleave\":function($event){return _vm.toggleHighlight(actor, false)}}},[(actor.has_img)?[_c('img',{attrs:{\"src\":actor.source,\"width\":\"30px\",\"height\":\"30px\"}})]:[_c('span',{staticStyle:{\"width\":\"auto\"}},[_vm._v(_vm._s(actor.source))])],_c('input',{directives:[{name:\"model\",rawName:\"v-model.lazy.number\",value:(actor.initiative),expression:\"actor.initiative\",modifiers:{\"lazy\":true,\"number\":true}}],class:{ notAllowed: !_vm.owns(actor) },attrs:{\"type\":\"text\",\"placeholder\":\"value\",\"disabled\":!_vm.owns(actor)},domProps:{\"value\":(actor.initiative)},on:{\"change\":[function($event){_vm.$set(actor, \"initiative\", _vm._n($event.target.value))},function($event){return _vm.syncInitiative(actor)}],\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('div',{staticClass:\"initiative-effects-icon\",class:{ notAllowed: !_vm.owns(actor) },staticStyle:{\"opacity\":\"0.6\"},on:{\"click\":function($event){_vm.createEffect(actor, _vm.getDefaultEffect(), true)}}},[_c('i',{staticClass:\"fas fa-stopwatch\"}),(actor.effects)?[_vm._v(\" \"+_vm._s(actor.effects.length)+\" \")]:[_vm._v(\" 0 \")]],2),_c('div',{class:{ notAllowed: !_vm.owns(actor) },style:({ opacity: actor.visible ? '1.0' : '0.3' }),on:{\"click\":function($event){return _vm.toggleOption(actor, 'visible')}}},[_c('i',{staticClass:\"fas fa-eye\"})]),_c('div',{class:{ notAllowed: !_vm.owns(actor) },style:({ opacity: actor.group ? '1.0' : '0.3' }),on:{\"click\":function($event){return _vm.toggleOption(actor, 'group')}}},[_c('i',{staticClass:\"fas fa-users\"})]),_c('div',{class:{ notAllowed: !_vm.owns(actor) },style:({ opacity: _vm.owns(actor) ? '1.0' : '0.3' }),on:{\"click\":function($event){return _vm.removeInitiative(actor.uuid, true, true)}}},[_c('i',{staticClass:\"fas fa-trash-alt\"})])],2),(actor.effects)?_c('div',{staticClass:\"initiative-effect\"},_vm._l((actor.effects),function(effect){return _c('div',{key:effect.uuid},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(effect.name),expression:\"effect.name\"}],attrs:{\"type\":\"text\",\"size\":effect.name.length || 1},domProps:{\"value\":(effect.name)},on:{\"change\":function($event){return _vm.updateEffect(actor.uuid, effect, true)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(effect, \"name\", $event.target.value)}}}),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(effect.turns),expression:\"effect.turns\"}],attrs:{\"type\":\"text\",\"size\":effect.turns.toString().length || 1},domProps:{\"value\":(effect.turns)},on:{\"change\":function($event){return _vm.updateEffect(actor.uuid, effect, true)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(effect, \"turns\", $event.target.value)}}})])}),0):_vm._e()])]})],2),_c('div',{attrs:{\"id\":\"initiative-bar\"}},[_c('div',{attrs:{\"id\":\"initiative-round\"}},[_vm._v(\"Round \"+_vm._s(_vm.$store.state.initiative.roundCounter))]),_c('div',{staticStyle:{\"display\":\"flex\"}}),_c('div',{staticClass:\"initiative-bar-button\",style:(_vm.visionLock ? 'background-color: #82c8a0' : ''),on:{\"click\":_vm.toggleVisionLock}},[_c('i',{staticClass:\"fas fa-eye\"})]),_c('div',{staticClass:\"initiative-bar-button\",style:(_vm.cameraLock ? 'background-color: #82c8a0' : ''),on:{\"click\":function($event){_vm.cameraLock = !_vm.cameraLock}}},[_c('i',{staticClass:\"fas fa-video\"})]),_c('div',{staticClass:\"initiative-bar-button\",class:{ notAllowed: !_vm.$store.state.game.IS_DM },on:{\"click\":function($event){_vm.setRound(0, true);\n                    _vm.updateTurn(_vm.$store.state.initiative.data[0].uuid, true);}}},[_c('i',{staticClass:\"fas fa-sync-alt\"})]),_c('div',{staticClass:\"initiative-bar-button\",class:{ notAllowed: !_vm.$store.state.game.IS_DM },on:{\"click\":_vm.nextTurn}},[_c('i',{staticClass:\"fas fa-chevron-right\"})])])],1)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { socket } from \"@/game/api/socket\";\r\nimport { InitiativeData } from \"@/game/comm/types/general\";\r\nimport { rootStore } from \"@/store\";\r\nimport { getModule, Module, Mutation, VuexModule } from \"vuex-module-decorators\";\r\n\r\nexport function inInitiative(uuid: string): boolean {\r\n    return initiativeStore.data.some(d => d.uuid === uuid);\r\n}\r\n\r\nexport interface InitiativeState {\r\n    data: InitiativeData[];\r\n    currentActor: string | null;\r\n    roundCounter: number;\r\n}\r\n\r\n@Module({ dynamic: true, store: rootStore, name: \"initiative\", namespaced: true })\r\nclass InitiativeStore extends VuexModule implements InitiativeState {\r\n    data: InitiativeData[] = [];\r\n    currentActor: string | null = null;\r\n    roundCounter = 0;\r\n\r\n    @Mutation\r\n    clear(): void {\r\n        this.data = [];\r\n        this.currentActor = null;\r\n    }\r\n\r\n    @Mutation\r\n    setCurrentActor(actor: string | null): void {\r\n        this.currentActor = actor;\r\n    }\r\n\r\n    @Mutation\r\n    setData(data: InitiativeData[]): void {\r\n        this.data = data;\r\n    }\r\n\r\n    @Mutation\r\n    addInitiative(data: InitiativeData): void {\r\n        const d = this.data.findIndex(a => a.uuid === data.uuid);\r\n        if (d >= 0) return;\r\n        if (data.initiative === undefined) data.initiative = 0;\r\n        socket.emit(\"Initiative.Update\", data);\r\n    }\r\n\r\n    @Mutation\r\n    setRoundCounter(round: number): void {\r\n        this.roundCounter = round;\r\n    }\r\n\r\n    @Mutation\r\n    setTurn(actorId: string | null): void {\r\n        this.currentActor = actorId;\r\n    }\r\n}\r\n\r\nexport const initiativeStore = getModule(InitiativeStore);\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\nimport draggable from \"vuedraggable\";\r\nVue.component(\"draggable\", draggable);\r\n\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\nimport { uuidv4 } from \"@/core/utils\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { InitiativeData, InitiativeEffect } from \"@/game/comm/types/general\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { initiativeStore } from \"./store\";\r\nimport { gameManager } from \"../../manager\";\r\n\r\n@Component({\r\n    components: {\r\n        Modal,\r\n        draggable,\r\n    },\r\n})\r\nexport default class Initiative extends Vue {\r\n    visible = false;\r\n    visionLock = false;\r\n    cameraLock = false;\r\n    _activeTokens: string[] = [];\r\n\r\n    mounted() {\r\n        EventBus.$on(\"Initiative.Clear\", initiativeStore.clear);\r\n        EventBus.$on(\"Initiative.Remove\", (data: string) => this.removeInitiative(data));\r\n        EventBus.$on(\"Initiative.Show\", () => (this.visible = true));\r\n        EventBus.$on(\"Initiative.ForceUpdate\", () => this.$forceUpdate());\r\n\r\n        socket.on(\"Initiative.Set\", initiativeStore.setData);\r\n        socket.on(\"Initiative.Turn.Set\", (data: string) => this.setTurn(data));\r\n        socket.on(\"Initiative.Turn.Update\", (data: string) => this.updateTurn(data, false));\r\n        socket.on(\"Initiative.Round.Update\", (data: number) => this.setRound(data, false));\r\n        socket.on(\"Initiative.Effect.New\", (data: { actor: string; effect: InitiativeEffect }) => {\r\n            const actor = this.getActor(data.actor);\r\n            if (actor === undefined) return;\r\n            this.createEffect(actor, data.effect, false);\r\n        });\r\n        socket.on(\"Initiative.Effect.Update\", (data: { actor: string; effect: InitiativeEffect }) =>\r\n            this.updateEffect(data.actor, data.effect, false),\r\n        );\r\n    }\r\n\r\n    beforeDestroy() {\r\n        EventBus.$off(\"Initiative.Clear\");\r\n        EventBus.$off(\"Initiative.Remove\");\r\n        EventBus.$off(\"Initiative.Show\");\r\n        socket.off(\"Initiative.Set\");\r\n        socket.off(\"Initiative.Turn.Set\");\r\n        socket.off(\"Initiative.Turn.Update\");\r\n        socket.off(\"Initiative.Round.Update\");\r\n        socket.off(\"Initiative.Effect.New\");\r\n        socket.off(\"Initiative.Effect.Update\");\r\n    }\r\n\r\n    // Utilities\r\n    getActor(actorId: string) {\r\n        return initiativeStore.data.find(a => a.uuid === actorId);\r\n    }\r\n    owns(actor: InitiativeData): boolean {\r\n        if (gameStore.IS_DM) return true;\r\n        const shape = layerManager.UUIDMap.get(actor.uuid);\r\n        // Shapes that are unknown to this client are hidden from this client but owned by other clients\r\n        if (shape === undefined) return false;\r\n        return shape.owners.includes(gameStore.username);\r\n    }\r\n    getDefaultEffect() {\r\n        return { uuid: uuidv4(), name: \"New Effect\", turns: 10 };\r\n    }\r\n    fakeSetData(dataTransfer: DataTransfer) {\r\n        dataTransfer.setData(\"Hack\", \"\");\r\n    }\r\n    syncInitiative(data: InitiativeData | { uuid: string }) {\r\n        socket.emit(\"Initiative.Update\", data);\r\n    }\r\n    // Events\r\n    removeInitiative(uuid: string) {\r\n        const d = initiativeStore.data.findIndex(a => a.uuid === uuid);\r\n        if (d < 0 || initiativeStore.data[d].group) return;\r\n        this.syncInitiative({ uuid });\r\n        // Remove highlight\r\n        const shape = layerManager.UUIDMap.get(uuid);\r\n        if (shape === undefined) return;\r\n        if (shape.showHighlight) {\r\n            shape.showHighlight = false;\r\n            layerManager.getLayer(shape.layer)!.invalidate(true);\r\n        }\r\n    }\r\n    updateOrder() {\r\n        if (!gameStore.IS_DM) return;\r\n        socket.emit(\r\n            \"Initiative.Set\",\r\n            initiativeStore.data.map(d => d.uuid),\r\n        );\r\n    }\r\n    updateTurn(actorId: string | null, sync: boolean) {\r\n        if (!gameStore.IS_DM && sync) return;\r\n        initiativeStore.setCurrentActor(actorId);\r\n        const actor = initiativeStore.data.find(a => a.uuid === actorId);\r\n        if (actor === undefined) return;\r\n        if (actor.effects) {\r\n            for (let e = actor.effects.length - 1; e >= 0; e--) {\r\n                if (actor.effects[e].turns <= 0) actor.effects.splice(e, 1);\r\n                else actor.effects[e].turns--;\r\n            }\r\n        }\r\n        if (this.visionLock) {\r\n            if (actorId !== null && gameStore.ownedtokens.includes(actorId)) gameStore.setActiveTokens([actorId]);\r\n            else gameStore.setActiveTokens([]);\r\n        }\r\n        if (this.cameraLock) {\r\n            if (actorId !== null) {\r\n                const shape = layerManager.UUIDMap.get(actorId);\r\n                if (shape !== undefined && shape.ownedBy()) {\r\n                    gameManager.setCenterPosition(shape.center());\r\n                }\r\n            }\r\n        }\r\n        if (sync) socket.emit(\"Initiative.Turn.Update\", actorId);\r\n    }\r\n    setRound(round: number, sync: boolean) {\r\n        if (!gameStore.IS_DM && sync) return;\r\n        initiativeStore.setRoundCounter(round);\r\n        if (sync) socket.emit(\"Initiative.Round.Update\", round);\r\n    }\r\n    setTurn(actorId: string | null) {\r\n        initiativeStore.setTurn(actorId);\r\n    }\r\n    nextTurn() {\r\n        if (!gameStore.IS_DM) return;\r\n        const order = initiativeStore.data;\r\n        const next = order[(order.findIndex(a => a.uuid === initiativeStore.currentActor) + 1) % order.length];\r\n        if (initiativeStore.data[0].uuid === next.uuid) this.setRound(initiativeStore.roundCounter + 1, true);\r\n        this.updateTurn(next.uuid, true);\r\n    }\r\n    toggleHighlight(actor: InitiativeData, show: boolean) {\r\n        const shape = layerManager.UUIDMap.get(actor.uuid);\r\n        if (shape === undefined) return;\r\n        shape.showHighlight = show;\r\n        layerManager.getLayer(shape.layer)!.invalidate(true);\r\n    }\r\n    toggleOption(actor: InitiativeData, option: \"visible\" | \"group\") {\r\n        if (!this.owns(actor)) return;\r\n        actor[option] = !actor[option];\r\n        this.syncInitiative(actor);\r\n    }\r\n    createEffect(actor: InitiativeData, effect: InitiativeEffect, sync: boolean) {\r\n        if (!this.owns(actor)) return;\r\n        actor.effects.push(effect);\r\n        if (sync) socket.emit(\"Initiative.Effect.New\", { actor: actor.uuid, effect });\r\n    }\r\n    syncEffect(actor: InitiativeData, effect: InitiativeEffect) {\r\n        if (!this.owns(actor)) return;\r\n        socket.emit(\"Initiative.Effect.Update\", { actor: actor.uuid, effect });\r\n    }\r\n    updateEffect(actorId: string, effect: InitiativeEffect, sync: boolean) {\r\n        const actor = initiativeStore.data.find(a => a.uuid === actorId);\r\n        if (actor === undefined) return;\r\n        const effectIndex = actor.effects.findIndex(e => e.uuid === effect.uuid);\r\n        if (effectIndex === undefined) return;\r\n        actor.effects[effectIndex] = effect;\r\n        if (sync) this.syncEffect(actor, effect);\r\n        else this.$forceUpdate();\r\n    }\r\n    toggleVisionLock() {\r\n        this.visionLock = !this.visionLock;\r\n        if (this.visionLock) {\r\n            this._activeTokens = [...gameStore._activeTokens];\r\n            if (initiativeStore.currentActor !== null && gameStore.ownedtokens.includes(initiativeStore.currentActor))\r\n                gameStore.setActiveTokens([initiativeStore.currentActor]);\r\n        } else {\r\n            gameStore.setActiveTokens(this._activeTokens);\r\n        }\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./initiative.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./initiative.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./initiative.vue?vue&type=template&id=3f1843d1&scoped=true&\"\nimport script from \"./initiative.vue?vue&type=script&lang=ts&\"\nexport * from \"./initiative.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./initiative.vue?vue&type=style&index=0&id=3f1843d1&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3f1843d1\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Modal',{attrs:{\"visible\":_vm.visible,\"mask\":false},on:{\"close\":function($event){_vm.visible = false}},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_c('div',[_vm._v(\"Label manager\")]),_c('div',{staticClass:\"header-close\",on:{\"click\":function($event){_vm.visible = false}}},[_c('i',{staticClass:\"far fa-window-close\"})])])}}])},[_c('div',{staticClass:\"modal-body\"},[_c('div',{staticClass:\"grid\"},[_c('div',{staticClass:\"header\"},[_c('abbr',{attrs:{\"title\":\"Category\"}},[_vm._v(\"Cat.\")])]),_c('div',{staticClass:\"header name\"},[_vm._v(\"Name\")]),_c('div',{staticClass:\"header\"},[_c('abbr',{attrs:{\"title\":\"Visible\"}},[_vm._v(\"Vis.\")])]),_c('div',{staticClass:\"header\"},[_c('abbr',{attrs:{\"title\":\"Delete\"}},[_vm._v(\"Del.\")])]),_c('div',{staticClass:\"separator spanrow\",staticStyle:{\"margin\":\"0 0 7px\"}}),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.search),expression:\"search\"}],ref:\"search\",staticClass:\"spanrow\",attrs:{\"type\":\"text\",\"placeholder\":\"search\"},domProps:{\"value\":(_vm.search)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.search=$event.target.value}}})]),_c('div',{staticClass:\"grid scroll\"},[_vm._l((_vm.categories),function(category){return [_vm._l((_vm.labels[category]),function(label){return [_c('div',{key:'row-' + label.uuid,staticClass:\"row\",on:{\"click\":function($event){return _vm.selectLabel(label.uuid)}}},[(label.category)?[_c('div',{key:'cat-' + label.uuid},[_vm._v(_vm._s(label.category))]),_c('div',{key:'name-' + label.uuid,staticClass:\"name\"},[_vm._v(_vm._s(label.name))])]:_vm._e(),(!label.category)?[_c('div',{key:'cat-' + label.uuid}),_c('div',{key:'name-' + label.uuid,staticClass:\"name\"},[_vm._v(_vm._s(label.name))])]:_vm._e(),_c('div',{key:'visible-' + label.uuid,class:{ 'lower-opacity': !label.visible },style:({ textAlign: 'center' }),on:{\"click\":function($event){$event.stopPropagation();return _vm.toggleVisibility(label)}}},[_c('i',{staticClass:\"fas fa-eye\"})]),_c('div',{key:'delete-' + label.uuid,on:{\"click\":function($event){$event.stopPropagation();return _vm.deleteLabel(label.uuid)}}},[_c('i',{staticClass:\"fas fa-trash-alt\"})])],2)]})]}),(_vm.labels.length === 0)?[_c('div',{attrs:{\"id\":\"no-labels\"}},[_vm._v(\"No labels exist yet\")])]:_vm._e()],2),_c('div',{staticClass:\"grid\"},[_c('div',{staticClass:\"separator spanrow\"}),_c('input',{directives:[{name:\"model\",rawName:\"v-model.trim\",value:(_vm.newCategory),expression:\"newCategory\",modifiers:{\"trim\":true}}],attrs:{\"type\":\"text\"},domProps:{\"value\":(_vm.newCategory)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.newCategory=$event.target.value.trim()},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('input',{directives:[{name:\"model\",rawName:\"v-model.trim\",value:(_vm.newName),expression:\"newName\",modifiers:{\"trim\":true}}],attrs:{\"type\":\"text\"},domProps:{\"value\":(_vm.newName)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.newName=$event.target.value.trim()},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('button',{attrs:{\"id\":\"addLabelButton\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.addLabel($event)}}},[_vm._v(\"Add\")])])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\nimport { uuidv4 } from \"@/core/utils\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { gameStore } from \"@/game/store\";\r\n\r\n@Component({\r\n    components: {\r\n        Modal,\r\n    },\r\n})\r\nexport default class LabelManager extends Vue {\r\n    visible = false;\r\n    newCategory = \"\";\r\n    newName = \"\";\r\n    search = \"\";\r\n\r\n    mounted() {\r\n        EventBus.$on(\"LabelManager.Open\", () => {\r\n            this.visible = true;\r\n            this.newCategory = \"\";\r\n            this.newName = \"\";\r\n            this.$nextTick(() => (<HTMLInputElement>this.$refs.search).focus());\r\n        });\r\n    }\r\n\r\n    beforeDestroy() {\r\n        EventBus.$off(\"LabelManager.Open\");\r\n    }\r\n\r\n    get labels() {\r\n        const cat: { [category: string]: Label[] } = { \"\": [] };\r\n        for (const uuid of Object.keys(gameStore.labels)) {\r\n            const label = gameStore.labels[uuid];\r\n            if (\r\n                this.search.length &&\r\n                `${label.category.toLowerCase()}${label.name.toLowerCase()}`.search(this.search.toLowerCase()) < 0\r\n            )\r\n                continue;\r\n            if (label.user !== gameStore.username) continue;\r\n            if (!label.category) cat[\"\"].push(label);\r\n            else {\r\n                if (!(label.category in cat)) cat[label.category] = [];\r\n                cat[label.category].push(label);\r\n                cat[label.category].sort((a, b) => a.name.localeCompare(b.name));\r\n            }\r\n        }\r\n        return cat;\r\n    }\r\n\r\n    get categories() {\r\n        return Object.keys(this.labels).sort();\r\n    }\r\n\r\n    selectLabel(label: string) {\r\n        EventBus.$emit(\"EditDialog.AddLabel\", label);\r\n        this.visible = false;\r\n    }\r\n\r\n    toggleVisibility(label: Label) {\r\n        label.visible = !label.visible;\r\n        socket.emit(\"Label.Visibility.Set\", { uuid: label.uuid, visible: label.visible });\r\n    }\r\n\r\n    addLabel() {\r\n        if (this.newName === \"\") return;\r\n        const label = {\r\n            uuid: uuidv4(),\r\n            category: this.newCategory,\r\n            name: this.newName,\r\n            visible: false,\r\n            user: gameStore.username,\r\n        };\r\n        gameStore.addLabel(label);\r\n        socket.emit(\"Label.Add\", label);\r\n        this.newCategory = \"\";\r\n        this.newName = \"\";\r\n    }\r\n\r\n    deleteLabel(uuid: string) {\r\n        gameStore.deleteLabel({ uuid, user: gameStore.username });\r\n        socket.emit(\"Label.Delete\", uuid);\r\n    }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./labels.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./labels.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./labels.vue?vue&type=template&id=3261513c&scoped=true&\"\nimport script from \"./labels.vue?vue&type=script&lang=ts&\"\nexport * from \"./labels.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./labels.vue?vue&type=style&index=0&id=3261513c&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3261513c\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"menuContainer\"}},[_c('div',{ref:\"rm\",style:({\n            left: _vm.visible.settings ? '200px' : '0',\n            top: _vm.visible.locations ? '100px' : '0',\n        }),attrs:{\"id\":\"radialmenu\"}},[_c('div',{staticClass:\"rm-wrapper\"},[_c('div',{staticClass:\"rm-toggler\"},[_c('ul',{staticClass:\"rm-list\",class:{ 'rm-list-dm': _vm.IS_DM }},[(_vm.IS_DM)?_c('li',{staticClass:\"rm-item\",attrs:{\"id\":\"rm-locations\"},on:{\"click\":function($event){_vm.visible.locations = !_vm.visible.locations}}},[_vm._m(0)]):_vm._e(),_c('li',{staticClass:\"rm-item\",attrs:{\"id\":\"rm-settings\"},on:{\"click\":function($event){_vm.visible.settings = !_vm.visible.settings}}},[_vm._m(1)])])]),_vm._m(2)])]),_c('transition',{attrs:{\"name\":\"settings\"},on:{\"enter\":function($event){_vm.$refs.rm.style.transition = 'left 500ms'}}},[(_vm.visible.settings)?_c('div',{ref:\"settings\",attrs:{\"id\":\"menu\"},on:{\"click\":_vm.settingsClick}},[_c('div',{staticStyle:{\"width\":\"200px\",\"height\":\"90%\",\"overflow-y\":\"auto\",\"overflow-x\":\"hidden\"}},[(_vm.IS_DM)?[_c('button',{staticClass:\"menu-accordion\"},[_vm._v(\"Assets\")]),_c('div',{staticClass:\"menu-accordion-panel\"},[_c('a',{staticClass:\"actionButton\",attrs:{\"href\":\"/assets\",\"target\":\"blank\",\"title\":\"Open asset manager\"}},[_c('i',{staticClass:\"fas fa-external-link-alt\"})]),_c('div',{staticClass:\"directory\",attrs:{\"id\":\"menu-tokens\"}},[_c('asset-node',{attrs:{\"asset\":_vm.assets}}),(!_vm.assets)?_c('div',[_vm._v(\"No assets\")]):_vm._e()],1)]),_c('button',{staticClass:\"menu-accordion\"},[_vm._v(\"Notes\")]),_c('div',{staticClass:\"menu-accordion-panel\"},[_c('div',{staticClass:\"menu-accordion-subpanel\",attrs:{\"id\":\"menu-notes\"}},[_c('a',{staticClass:\"actionButton\",on:{\"click\":_vm.createNote}},[_c('i',{staticClass:\"far fa-plus-square\"})]),_vm._l((_vm.notes),function(note){return _c('div',{key:note.uuid,staticStyle:{\"cursor\":\"pointer\"},on:{\"click\":function($event){return _vm.openNote(note)}}},[_vm._v(\" \"+_vm._s(note.title || \"[?]\")+\" \")])}),(!_vm.notes.length)?_c('div',[_vm._v(\"No notes\")]):_vm._e()],2)]),_c('button',{staticClass:\"menu-accordion\",on:{\"click\":_vm.openDmSettings}},[_vm._v(\"DM Options\")])]:_vm._e(),_c('button',{staticClass:\"menu-accordion\"},[_vm._v(\"Client Options\")]),_c('div',{staticClass:\"menu-accordion-panel\"},[_c('div',{staticClass:\"menu-accordion-subpanel\"},[_c('label',{attrs:{\"for\":\"gridColour\"}},[_vm._v(\"Grid Colour:\")]),_c('color-picker',{attrs:{\"id\":\"gridColour\",\"color\":_vm.gridColour},on:{\"update:color\":function($event){_vm.gridColour=$event}}}),_c('label',{attrs:{\"for\":\"fowColour\"}},[_vm._v(\"FOW Colour:\")]),_c('color-picker',{attrs:{\"id\":\"fowColour\",\"color\":_vm.fowColour},on:{\"update:color\":function($event){_vm.fowColour=$event}}}),_c('label',{attrs:{\"for\":\"rulerColour\"}},[_vm._v(\"Ruler Colour:\")]),_c('color-picker',{attrs:{\"id\":\"rulerColour\",\"color\":_vm.rulerColour},on:{\"update:color\":function($event){_vm.rulerColour=$event}}})],1)])],2),_c('router-link',{staticClass:\"menu-accordion\",staticStyle:{\"text-decoration\":\"none\",\"display\":\"inline-block\",\"position\":\"absolute\",\"bottom\":\"0\"},attrs:{\"to\":\"/dashboard\"}},[_vm._v(\" Exit \")])],1):_vm._e()]),_c('transition',{attrs:{\"name\":\"locations\"},on:{\"enter\":function($event){_vm.$refs.rm.style.transition = 'top 500ms'}}},[(_vm.IS_DM && _vm.visible.locations)?_c('div',{attrs:{\"id\":\"locations-menu\"}},[_c('div',[_vm._l((_vm.locations),function(location){return _c('div',{key:location,style:([_vm.getCurrentLocation() === location ? { 'background-color': '#82c8a0' } : {}]),on:{\"click\":function($event){return _vm.changeLocation(location)}}},[_vm._v(\" \"+_vm._s(location)+\" \")])}),_c('div',{on:{\"click\":_vm.createLocation}},[_c('i',{staticClass:\"fas fa-plus\"})])],2)]):_vm._e()]),_c('img',{attrs:{\"id\":\"dragImage\"}})],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('a',{attrs:{\"href\":\"#\"}},[_c('i',{staticClass:\"far fa-compass\"})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('a',{attrs:{\"href\":\"#\"}},[_c('i',{staticClass:\"fas fa-cog\"})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',{staticClass:\"rm-topper\"},[_c('i',{staticClass:\"icon-share-alt\"})])}]\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"outer\",on:{\"click\":function($event){if($event.target !== $event.currentTarget){ return null; }return _vm.open($event)}}},[_c('div',{staticClass:\"current-color\",style:(_vm.transparent\n                ? 'background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)'\n                : 'background-color:' + _vm.color),on:{\"click\":function($event){if($event.target !== $event.currentTarget){ return null; }return _vm.open($event)}}}),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.display),expression:\"display\"}],staticClass:\"mask\",on:{\"click\":function($event){if($event.target !== $event.currentTarget){ return null; }return _vm.closePicker($event)}}}),_c('chrome-picker',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.display),expression:\"display\"}],ref:\"chromePicker\",style:({ position: 'fixed', left: _vm.left + 'px', top: _vm.top + 'px', 'z-index': 9999 }),attrs:{\"value\":_vm.color,\"tabindex\":\"-1\"},on:{\"input\":_vm.updateColor}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport tinycolor from \"tinycolor2\";\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { Chrome } from \"vue-color\";\r\nimport { Prop } from \"vue-property-decorator\";\r\n\r\n@Component<ColorPicker>({\r\n    components: {\r\n        \"chrome-picker\": Chrome,\r\n    },\r\n})\r\nexport default class ColorPicker extends Vue {\r\n    @Prop(String) color!: string;\r\n    @Prop(Boolean) disabled!: boolean;\r\n\r\n    display = false;\r\n    left = 0;\r\n    top = 0;\r\n    transparent = false;\r\n\r\n    mounted() {\r\n        this.transparent = (<any>this.$refs.chromePicker).val.rgba.a === 0;\r\n        this.setPosition();\r\n    }\r\n\r\n    open() {\r\n        if (this.display || this.disabled) return; // click on the picker itself\r\n        this.setPosition();\r\n        this.display = true;\r\n        this.$nextTick(() => (<HTMLElement>this.$children[0].$el).focus());\r\n    }\r\n    updateColor(value: { rgba: { r: number; g: number; b: number; a: number } }) {\r\n        this.transparent = value.rgba.a === 0;\r\n        const newColor = tinycolor(value.rgba).toRgbString();\r\n        this.$emit(\"update:color\", newColor);\r\n        this.$emit(\"input\", newColor);\r\n    }\r\n    closePicker() {\r\n        this.display = false;\r\n        this.$emit(\"change\", this.color);\r\n    }\r\n    setPosition() {\r\n        const rect = this.$el.getBoundingClientRect();\r\n        // 224 is the width of the picker, 242 the height\r\n        if (rect.right + 224 > window.innerWidth) this.left = rect.left - 224;\r\n        else this.left = rect.right;\r\n        if (rect.bottom + 242 > window.innerHeight) this.top = rect.top - 242;\r\n        else this.top = rect.bottom;\r\n    }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./colorpicker.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./colorpicker.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./colorpicker.vue?vue&type=template&id=e45ccc1a&scoped=true&\"\nimport script from \"./colorpicker.vue?vue&type=script&lang=ts&\"\nexport * from \"./colorpicker.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./colorpicker.vue?vue&type=style&index=0&id=e45ccc1a&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"e45ccc1a\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ul',[_vm._l((_vm.folders),function(folder){return _c('li',{key:folder,staticClass:\"folder\",on:{\"click\":function($event){$event.stopPropagation();return _vm.toggle($event)}}},[_vm._v(\" \"+_vm._s(folder)+\" \"),_c('asset-node',{attrs:{\"asset\":_vm.asset[folder]}})],1)}),_vm._l((_vm.files),function(file){return _c('li',{key:file.name,staticClass:\"file draggable token\",attrs:{\"draggable\":\"true\"},on:{\"mouseover\":function($event){_vm.showImage = file.hash},\"mouseout\":function($event){_vm.showImage = null},\"dragstart\":function($event){return _vm.dragStart($event, '/static/assets/' + file.hash)}}},[_vm._v(\" \"+_vm._s(file.name)+\" \"),(_vm.showImage == file.hash)?_c('div',{staticClass:\"preview\"},[_c('img',{staticClass:\"asset-preview-image\",attrs:{\"src\":'/static/assets/' + file.hash}})]):_vm._e()])})],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\nimport { Prop } from \"vue-property-decorator\";\r\n\r\nimport { AssetFile, AssetList } from \"@/core/comm/types\";\r\nimport { alphSort } from \"@/core/utils\";\r\n\r\n@Component({\r\n    name: \"asset-node\",\r\n})\r\nexport default class AssetNode extends Vue {\r\n    @Prop() asset!: AssetList;\r\n\r\n    showImage = null;\r\n    get folders(): string[] {\r\n        return Object.keys(this.asset)\r\n            .filter(el => ![\"__files\"].includes(el))\r\n            .sort(alphSort);\r\n    }\r\n\r\n    get files(): AssetFile[] {\r\n        if (this.asset.__files)\r\n            return (<AssetFile[]>this.asset.__files)\r\n                .concat()\r\n                .sort((a, b) => (a.name.toLowerCase() > b.name.toLowerCase() ? 1 : -1));\r\n        return [];\r\n    }\r\n\r\n    toggle(event: { target: HTMLElement }) {\r\n        // tslint:disable-next-line:prefer-for-of\r\n        for (let i = 0; i < event.target.children.length; i++) {\r\n            const el = <HTMLElement>event.target.children[i];\r\n            el.style.display = el.style.display === \"\" ? \"block\" : \"\";\r\n        }\r\n    }\r\n\r\n    dragStart(event: DragEvent, imageSource: string) {\r\n        this.showImage = null;\r\n        if (event === null || event.dataTransfer === null) return;\r\n        const img = (<HTMLElement>event.target).querySelector(\".preview\")!;\r\n        event.dataTransfer.setDragImage(img, 0, 0);\r\n        event.dataTransfer.setData(\"text/plain\", imageSource);\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./asset_node.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./asset_node.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./asset_node.vue?vue&type=template&id=03f9ac64&scoped=true&\"\nimport script from \"./asset_node.vue?vue&type=script&lang=ts&\"\nexport * from \"./asset_node.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./asset_node.vue?vue&type=style&index=0&id=03f9ac64&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"03f9ac64\",\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { mapState } from \"vuex\";\r\n\r\nimport ColorPicker from \"@/core/components/colorpicker.vue\";\r\nimport Game from \"@/game/game.vue\";\r\nimport AssetNode from \"@/game/ui/menu/asset_node.vue\";\r\n\r\nimport { uuidv4 } from \"@/core/utils\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { Note } from \"@/game/comm/types/general\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { EventBus } from \"../../event-bus\";\r\n\r\n@Component({\r\n    components: {\r\n        \"color-picker\": ColorPicker,\r\n        \"asset-node\": AssetNode,\r\n    },\r\n    computed: {\r\n        ...mapState(\"game\", [\"locations\", \"assets\", \"notes\"]),\r\n    },\r\n})\r\nexport default class MenuBar extends Vue {\r\n    visible = {\r\n        settings: false,\r\n        locations: false,\r\n    };\r\n\r\n    get IS_DM(): boolean {\r\n        return gameStore.IS_DM || gameStore.FAKE_PLAYER;\r\n    }\r\n    get gridColour(): string {\r\n        return gameStore.gridColour;\r\n    }\r\n    set gridColour(value: string) {\r\n        gameStore.setGridColour({ colour: value, sync: true });\r\n    }\r\n    get fowColour(): string {\r\n        return gameStore.fowColour;\r\n    }\r\n    set fowColour(value: string) {\r\n        gameStore.setFOWColour({ colour: value, sync: true });\r\n    }\r\n    get rulerColour(): string {\r\n        return gameStore.rulerColour;\r\n    }\r\n    set rulerColour(value: string) {\r\n        gameStore.setRulerColour({ colour: value, sync: true });\r\n    }\r\n    settingsClick(event: { target: HTMLElement }) {\r\n        if (event.target.classList.contains(\"menu-accordion\")) {\r\n            event.target.classList.toggle(\"menu-accordion-active\");\r\n            const next = <HTMLElement>event.target.nextElementSibling;\r\n            if (next !== null) next.style.display = next.style.display === \"\" ? \"block\" : \"\";\r\n        }\r\n    }\r\n    getCurrentLocation() {\r\n        return gameStore.locationName;\r\n    }\r\n    changeLocation(name: string) {\r\n        socket.emit(\"Location.Change\", name);\r\n    }\r\n    createLocation() {\r\n        (<Game>this.$parent).$refs.prompt.prompt(`New location name:`, `Create new location`).then(\r\n            (value: string) => {\r\n                socket.emit(\"Location.New\", value);\r\n            },\r\n            () => {},\r\n        );\r\n    }\r\n    createNote() {\r\n        const note = { title: \"New note\", text: \"\", uuid: uuidv4() };\r\n        gameStore.newNote({ note, sync: true });\r\n        this.openNote(note);\r\n    }\r\n    openNote(note: Note) {\r\n        (<Game>this.$parent).$refs.note.open(note);\r\n    }\r\n\r\n    openDmSettings() {\r\n        EventBus.$emit(\"DmSettings.Open\");\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./menu.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./menu.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./menu.vue?vue&type=template&id=5fbaa291&scoped=true&\"\nimport script from \"./menu.vue?vue&type=script&lang=ts&\"\nexport * from \"./menu.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./menu.vue?vue&type=style&index=0&id=5fbaa291&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5fbaa291\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.note !== null)?_c('modal',{attrs:{\"visible\":_vm.visible,\"mask\":false},on:{\"close\":function($event){_vm.visible = false}},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_c('span',{on:{\"click\":function($event){return _vm.$refs.title.select()}}},[_c('i',{staticClass:\"fas fa-pencil-alt\",staticStyle:{\"font-size\":\"15px\"}})]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.note.title),expression:\"note.title\"}],ref:\"title\",domProps:{\"value\":(_vm.note.title)},on:{\"change\":_vm.updateNote,\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.note, \"title\", $event.target.value)}}}),_c('div',{staticClass:\"header-close\",on:{\"click\":function($event){_vm.visible = false}}},[_c('i',{staticClass:\"far fa-window-close\"})])])}}],null,false,1320213373)},[_c('div',{staticClass:\"modal-body\"},[_c('textarea',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.note.text),expression:\"note.text\"}],ref:\"textarea\",style:({ height: _vm.calcHeight() }),domProps:{\"value\":(_vm.note.text)},on:{\"change\":_vm.updateNote,\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.note, \"text\", $event.target.value)}}})]),_c('div',{staticClass:\"modal-footer\"},[_c('button',{on:{\"click\":_vm.removeNote}},[_c('i',{staticClass:\"far fa-trash-alt\"}),_vm._v(\" Remove \")])])]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\nimport Game from \"@/game/game.vue\";\r\n\r\nimport { Note } from \"@/game/comm/types/general\";\r\nimport { gameStore } from \"@/game/store\";\r\n\r\n@Component({\r\n    components: {\r\n        Modal,\r\n    },\r\n})\r\nexport default class NoteDialog extends Vue {\r\n    visible = false;\r\n    note: Note | null = null;\r\n\r\n    open(note: Note) {\r\n        this.visible = true;\r\n        this.note = note;\r\n    }\r\n    calcHeight() {\r\n        if (this.$refs.textarea) {\r\n            const el = <HTMLElement>this.$refs.textarea;\r\n            el.style.height = \"auto\";\r\n            el.style.height = el.scrollHeight + \"px\";\r\n            // Using the return value without the above did not achieve what I want, so hey /shrug\r\n            return el.scrollHeight + \"px\";\r\n        }\r\n        return \"100px\";\r\n    }\r\n    updateNote() {\r\n        if (this.note) gameStore.updateNote({ note: this.note, sync: true });\r\n    }\r\n    removeNote() {\r\n        (<Game>this.$parent).$refs.confirm.open(\"Are you sure you wish to remove this?\").then(\r\n            (result: boolean) => {\r\n                if (result && this.note) {\r\n                    gameStore.removeNote({ note: this.note, sync: true });\r\n                    this.visible = false;\r\n                }\r\n            },\r\n            () => {},\r\n        );\r\n    }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./note.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./note.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./note.vue?vue&type=template&id=3f88adb2&scoped=true&\"\nimport script from \"./note.vue?vue&type=script&lang=ts&\"\nexport * from \"./note.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./note.vue?vue&type=style&index=0&id=3f88adb2&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3f88adb2\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.shapes.length > 0),expression:\"shapes.length > 0\"}]},_vm._l((_vm.shapes),function(shape){return _c('div',{key:shape.uuid},[_c('div',{attrs:{\"id\":\"selection-menu\"}},[_c('div',{attrs:{\"id\":\"selection-edit-button\"},on:{\"click\":_vm.openEditDialog}},[_c('i',{staticClass:\"fas fa-edit\"})]),_c('div',{attrs:{\"id\":\"selection-name\"}},[_vm._v(_vm._s(shape.name))]),_c('div',{attrs:{\"id\":\"selection-trackers\"}},[_vm._l((_vm.visibleTrackers),function(tracker){return [_c('div',{key:'name-' + tracker.uuid},[_vm._v(_vm._s(tracker.name))]),_c('div',{key:'value-' + tracker.uuid,staticClass:\"selection-tracker-value\",on:{\"click\":function($event){return _vm.changeValue(tracker, false)}}},[(tracker.maxvalue === 0)?[_vm._v(\" \"+_vm._s(tracker.value)+\" \")]:[_vm._v(_vm._s(tracker.value)+\" / \"+_vm._s(tracker.maxvalue))]],2)]})],2),_c('div',{attrs:{\"id\":\"selection-auras\"}},[_vm._l((_vm.visibleAuras),function(aura){return [_c('div',{key:'name-' + aura.uuid},[_vm._v(_vm._s(aura.name))]),_c('div',{key:'value-' + aura.uuid,staticClass:\"selection-tracker-value\",on:{\"click\":function($event){return _vm.changeValue(aura, true)}}},[(aura.dim === 0)?[_vm._v(\" \"+_vm._s(aura.value)+\" \")]:[_vm._v(_vm._s(aura.value)+\" / \"+_vm._s(aura.dim))]],2)]})],2)]),_c('edit-dialog',{ref:\"editDialog\",refInFor:true,attrs:{\"shape\":shape}})],1)}),0)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Modal',{attrs:{\"visible\":_vm.visible,\"mask\":false},on:{\"close\":function($event){_vm.visible = false}},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_c('div',[_vm._v(\"Edit asset\")]),_c('div',{staticClass:\"header-close\",on:{\"click\":function($event){_vm.visible = false}}},[_c('i',{staticClass:\"far fa-window-close\"})])])}}])},[_c('div',{staticClass:\"modal-body\"},[_c('div',{staticClass:\"grid\"},[_c('label',{attrs:{\"for\":\"shapeselectiondialog-name\"}},[_vm._v(\"Name\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.shape.name),expression:\"shape.name\"}],staticStyle:{\"grid-column\":\"numerator / remove\"},attrs:{\"type\":\"text\",\"id\":\"shapeselectiondialog-name\",\"disabled\":!_vm.owned},domProps:{\"value\":(_vm.shape.name)},on:{\"change\":function($event){return _vm.updateShape(false)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.shape, \"name\", $event.target.value)}}}),_c('div',{style:({ opacity: _vm.shape.nameVisible ? 1.0 : 0.3, textAlign: 'center' }),attrs:{\"disabled\":!_vm.owned},on:{\"click\":function($event){_vm.shape.nameVisible = !_vm.shape.nameVisible;\n                    _vm.updateShape(false);}}},[_c('i',{staticClass:\"fas fa-eye\"})]),_c('label',{attrs:{\"for\":\"shapeselectiondialog-istoken\"}},[_vm._v(\"Is a token\")]),_c('input',{staticClass:\"styled-checkbox\",staticStyle:{\"grid-column-start\":\"remove\"},attrs:{\"type\":\"checkbox\",\"id\":\"shapeselectiondialog-istoken\",\"disabled\":!_vm.owned},domProps:{\"checked\":_vm.shape.isToken},on:{\"click\":_vm.setToken}}),_c('label',{attrs:{\"for\":\"shapeselectiondialog-visionblocker\"}},[_vm._v(\"Blocks vision/light\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.shape.visionObstruction),expression:\"shape.visionObstruction\"}],staticStyle:{\"grid-column-start\":\"remove\"},attrs:{\"type\":\"checkbox\",\"id\":\"shapeselectiondialog-visionblocker\",\"disabled\":!_vm.owned},domProps:{\"checked\":Array.isArray(_vm.shape.visionObstruction)?_vm._i(_vm.shape.visionObstruction,null)>-1:(_vm.shape.visionObstruction)},on:{\"change\":[function($event){var $$a=_vm.shape.visionObstruction,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.$set(_vm.shape, \"visionObstruction\", $$a.concat([$$v])))}else{$$i>-1&&(_vm.$set(_vm.shape, \"visionObstruction\", $$a.slice(0,$$i).concat($$a.slice($$i+1))))}}else{_vm.$set(_vm.shape, \"visionObstruction\", $$c)}},_vm.setVisionBlocker]}}),_c('label',{attrs:{\"for\":\"shapeselectiondialog-moveblocker\"}},[_vm._v(\"Blocks movement\")]),_c('input',{staticStyle:{\"grid-column-start\":\"remove\"},attrs:{\"type\":\"checkbox\",\"id\":\"shapeselectiondialog-moveblocker\",\"disabled\":!_vm.owned},domProps:{\"checked\":_vm.shape.movementObstruction},on:{\"click\":_vm.setMovementBlocker}}),_c('label',{attrs:{\"for\":\"shapeselectiondialog-strokecolour\"}},[_vm._v(\"Border colour\")]),_c('color-picker',{staticStyle:{\"grid-column-start\":\"remove\"},attrs:{\"color\":_vm.shape.strokeColour,\"disabled\":!_vm.owned},on:{\"update:color\":function($event){return _vm.$set(_vm.shape, \"strokeColour\", $event)},\"input\":function($event){return _vm.updateShape(true, true)},\"change\":function($event){return _vm.updateShape(true)}}}),_c('label',{attrs:{\"for\":\"shapeselectiondialog-fillcolour\"}},[_vm._v(\"Fill colour\")]),_c('color-picker',{staticStyle:{\"grid-column-start\":\"remove\"},attrs:{\"color\":_vm.shape.fillColour,\"disabled\":!_vm.owned},on:{\"update:color\":function($event){return _vm.$set(_vm.shape, \"fillColour\", $event)},\"input\":function($event){return _vm.updateShape(true, true)},\"change\":function($event){return _vm.updateShape(true)}}}),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Access\")]),_vm._l((_vm.shape.owners),function(owner){return [_c('input',{key:owner,staticStyle:{\"grid-column-start\":\"name\"},attrs:{\"type\":\"text\",\"placeholder\":\"name\",\"disabled\":!_vm.owned},domProps:{\"value\":owner},on:{\"change\":function($event){return _vm.updateOwner($event, owner)}}}),(owner !== '')?_c('div',{key:'remove-' + owner,style:({ opacity: _vm.owned ? 1.0 : 0.3, textAlign: 'center', gridColumnStart: 'remove' }),attrs:{\"disabled\":!_vm.owned},on:{\"click\":function($event){return _vm.removeOwner(owner)}}},[_c('i',{staticClass:\"fas fa-trash-alt\"})]):_vm._e()]}),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Trackers\")]),_vm._l((_vm.shape.trackers),function(tracker){return [_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(tracker.name),expression:\"tracker.name\"}],key:'name-' + tracker.uuid,staticStyle:{\"grid-column-start\":\"name\"},attrs:{\"type\":\"text\",\"placeholder\":\"name\",\"disabled\":!_vm.owned},domProps:{\"value\":(tracker.name)},on:{\"change\":function($event){return _vm.updateShape(false)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(tracker, \"name\", $event.target.value)}}}),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(tracker.value),expression:\"tracker.value\",modifiers:{\"number\":true}}],key:'value-' + tracker.uuid,attrs:{\"type\":\"text\",\"title\":\"Current value\",\"disabled\":!_vm.owned},domProps:{\"value\":(tracker.value)},on:{\"change\":function($event){return _vm.updateShape(false)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(tracker, \"value\", _vm._n($event.target.value))},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('span',{key:'fspan-' + tracker.uuid},[_vm._v(\"/\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(tracker.maxvalue),expression:\"tracker.maxvalue\",modifiers:{\"number\":true}}],key:'maxvalue-' + tracker.uuid,attrs:{\"type\":\"text\",\"title\":\"Current value\",\"disabled\":!_vm.owned},domProps:{\"value\":(tracker.maxvalue)},on:{\"change\":function($event){return _vm.updateShape(false)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(tracker, \"maxvalue\", _vm._n($event.target.value))},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('span',{key:'sspan-' + tracker.uuid}),_c('div',{key:'visibility-' + tracker.uuid,style:({ opacity: tracker.visible ? 1.0 : 0.3, textAlign: 'center' }),attrs:{\"disabled\":!_vm.owned},on:{\"click\":function($event){tracker.visible = !tracker.visible;\n                        _vm.updateShape(false);}}},[_c('i',{staticClass:\"fas fa-eye\"})]),_c('span',{key:'tspan-' + tracker.uuid}),(tracker.name !== '' || tracker.value !== 0)?_c('div',{key:'remove-' + tracker.uuid,style:({ opacity: _vm.owned ? 1.0 : 0.3, textAlign: 'center' }),attrs:{\"disabled\":!_vm.owned},on:{\"click\":function($event){return _vm.removeTracker(tracker.uuid)}}},[_c('i',{staticClass:\"fas fa-trash-alt\"})]):_vm._e()]}),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Auras\")]),_vm._l((_vm.shape.auras),function(aura){return [_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(aura.name),expression:\"aura.name\"}],key:'name-' + aura.uuid,staticStyle:{\"grid-column-start\":\"name\"},attrs:{\"type\":\"text\",\"placeholder\":\"name\",\"disabled\":!_vm.owned},domProps:{\"value\":(aura.name)},on:{\"change\":function($event){return _vm.updateShape(false)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(aura, \"name\", $event.target.value)}}}),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(aura.value),expression:\"aura.value\",modifiers:{\"number\":true}}],key:'value-' + aura.uuid,attrs:{\"type\":\"text\",\"title\":\"Current value\",\"disabled\":!_vm.owned},domProps:{\"value\":(aura.value)},on:{\"change\":function($event){return _vm.updateShape(true)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(aura, \"value\", _vm._n($event.target.value))},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('span',{key:'fspan-' + aura.uuid},[_vm._v(\"/\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(aura.dim),expression:\"aura.dim\",modifiers:{\"number\":true}}],key:'dimvalue-' + aura.uuid,attrs:{\"type\":\"text\",\"title\":\"Dim value\",\"disabled\":!_vm.owned},domProps:{\"value\":(aura.dim)},on:{\"change\":function($event){return _vm.updateShape(true)},\"input\":function($event){if($event.target.composing){ return; }_vm.$set(aura, \"dim\", _vm._n($event.target.value))},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('color-picker',{key:'colour-' + aura.uuid,attrs:{\"color\":aura.colour,\"disabled\":!_vm.owned},on:{\"update:color\":function($event){return _vm.$set(aura, \"colour\", $event)},\"input\":function($event){return _vm.updateAuraColour(aura, $event)},\"change\":function($event){return _vm.updateShape(true)}}}),_c('div',{key:'visibility-' + aura.uuid,style:({ opacity: aura.visible ? 1.0 : 0.3, textAlign: 'center' }),attrs:{\"disabled\":!_vm.owned},on:{\"click\":function($event){aura.visible = !aura.visible;\n                        _vm.updateShape(true);}}},[_c('i',{staticClass:\"fas fa-eye\"})]),_c('div',{key:'visionsource-' + aura.uuid,style:({ opacity: aura.visionSource ? 1.0 : 0.3, textAlign: 'center' }),attrs:{\"disabled\":!_vm.owned},on:{\"click\":function($event){return _vm.updateAuraVisionSource(aura)}}},[_c('i',{staticClass:\"fas fa-lightbulb\"})]),(aura.name !== '' || aura.value !== 0)?_c('div',{key:'remove-' + aura.uuid,style:({ opacity: _vm.owned ? 1.0 : 0.3, textAlign: 'center' }),attrs:{\"disabled\":!_vm.owned},on:{\"click\":function($event){return _vm.removeAura(aura.uuid)}}},[_c('i',{staticClass:\"fas fa-trash-alt\"})]):_vm._e()]}),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Labels\")]),_c('div',{staticClass:\"spanrow\",attrs:{\"id\":\"labels\"}},[_vm._l((_vm.shape.labels),function(label){return _c('div',{key:label.uuid,staticClass:\"label\"},[(label.category)?[_c('div',{staticClass:\"label-user\"},[_vm._v(_vm._s(label.category))]),_c('div',{staticClass:\"label-main\",on:{\"click\":function($event){return _vm.removeLabel(label.uuid)}}},[_vm._v(_vm._s(label.name))])]:_vm._e(),(!label.category)?[_c('div',{staticClass:\"label-main\",on:{\"click\":function($event){return _vm.removeLabel(label.uuid)}}},[_vm._v(_vm._s(label.name))])]:_vm._e()],2)}),(_vm.owned)?_c('div',{staticClass:\"label\",attrs:{\"id\":\"label-add\"}},[_c('div',{staticClass:\"label-main\",on:{\"click\":_vm.openLabelManager}},[_vm._v(\"+\")])]):_vm._e()],2),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Annotation\")]),_c('textarea',{staticClass:\"spanrow\",attrs:{\"disabled\":!_vm.owned},domProps:{\"value\":_vm.shape.annotation},on:{\"change\":_vm.updateAnnotation}})],2)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { Prop } from \"vue-property-decorator\";\r\n\r\nimport ColorPicker from \"@/core/components/colorpicker.vue\";\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\nimport { uuidv4 } from \"@/core/utils\";\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { visibilityStore } from \"../../visibility/store\";\r\n\r\n@Component({\r\n    components: {\r\n        Modal,\r\n        \"color-picker\": ColorPicker,\r\n    },\r\n})\r\nexport default class EditDialog extends Vue {\r\n    @Prop() shape!: Shape;\r\n\r\n    visible = false;\r\n\r\n    get owned(): boolean {\r\n        return this.shape.ownedBy();\r\n    }\r\n\r\n    mounted() {\r\n        EventBus.$on(\"EditDialog.Open\", (shape: Shape) => {\r\n            this.shape = shape;\r\n            this.visible = true;\r\n        });\r\n        EventBus.$on(\"EditDialog.AddLabel\", (label: string) => {\r\n            if (this.visible) {\r\n                this.shape.labels.push(gameStore.labels[label]);\r\n                this.updateShape(true);\r\n            }\r\n        });\r\n    }\r\n\r\n    beforeDestroy() {\r\n        EventBus.$off(\"EditDialog.Open\");\r\n        EventBus.$off(\"EditDialog.AddLabel\");\r\n    }\r\n\r\n    updated() {\r\n        this.addEmpty();\r\n    }\r\n\r\n    addEmpty() {\r\n        if (this.shape.owners[this.shape.owners.length - 1] !== \"\") this.shape.addOwner(\"\");\r\n        if (\r\n            !this.shape.trackers.length ||\r\n            this.shape.trackers[this.shape.trackers.length - 1].name !== \"\" ||\r\n            this.shape.trackers[this.shape.trackers.length - 1].value !== 0\r\n        )\r\n            this.shape.trackers.push({ uuid: uuidv4(), name: \"\", value: 0, maxvalue: 0, visible: false });\r\n        if (\r\n            !this.shape.auras.length ||\r\n            this.shape.auras[this.shape.auras.length - 1].name !== \"\" ||\r\n            this.shape.auras[this.shape.auras.length - 1].value !== 0\r\n        )\r\n            this.shape.auras.push({\r\n                uuid: uuidv4(),\r\n                name: \"\",\r\n                value: 0,\r\n                dim: 0,\r\n                visionSource: false,\r\n                colour: \"rgba(0,0,0,0)\",\r\n                visible: false,\r\n            });\r\n    }\r\n    updateShape(redraw: boolean, temporary = false) {\r\n        if (!this.owned) return;\r\n        socket.emit(\"Shape.Update\", { shape: this.shape.asDict(), redraw, temporary });\r\n        if (redraw) layerManager.invalidate();\r\n        this.addEmpty();\r\n    }\r\n    setToken(event: { target: HTMLInputElement }) {\r\n        if (!this.owned) return;\r\n        this.shape.setIsToken(event.target.checked);\r\n        this.updateShape(true);\r\n    }\r\n    setVisionBlocker(_event: { target: HTMLInputElement }) {\r\n        if (!this.owned) return;\r\n        this.shape.checkVisionSources();\r\n        this.updateShape(true);\r\n    }\r\n    setMovementBlocker(event: { target: HTMLInputElement }) {\r\n        if (!this.owned) return;\r\n        this.shape.setMovementBlock(event.target.checked);\r\n        this.updateShape(false);\r\n    }\r\n    updateAnnotation(event: { target: HTMLInputElement }) {\r\n        if (!this.owned) return;\r\n        const hadAnnotation = this.shape.annotation !== \"\";\r\n        this.shape.annotation = event.target.value;\r\n        if (this.shape.annotation !== \"\" && !hadAnnotation) {\r\n            gameStore.annotations.push(this.shape.uuid);\r\n            if (layerManager.hasLayer(\"draw\")) layerManager.getLayer(\"draw\")!.invalidate(true);\r\n        } else if (this.shape.annotation === \"\" && hadAnnotation) {\r\n            gameStore.annotations.splice(gameStore.annotations.findIndex(an => an === this.shape.uuid));\r\n            if (layerManager.hasLayer(\"draw\")) layerManager.getLayer(\"draw\")!.invalidate(true);\r\n        }\r\n        this.updateShape(false);\r\n    }\r\n    updateOwner(event: { target: HTMLInputElement }, oldValue: string) {\r\n        if (!this.owned) return;\r\n        this.shape.updateOwner(oldValue, event.target.value);\r\n        this.updateShape(gameStore.fowLOS);\r\n    }\r\n    removeOwner(value: string) {\r\n        if (!this.owned) return;\r\n        this.shape.removeOwner(value);\r\n        this.updateShape(gameStore.fowLOS);\r\n    }\r\n    removeTracker(uuid: string) {\r\n        if (!this.owned) return;\r\n        this.shape.trackers = this.shape.trackers.filter(tr => tr.uuid !== uuid);\r\n        this.updateShape(false);\r\n    }\r\n    removeAura(uuid: string) {\r\n        if (!this.owned) return;\r\n        this.shape.auras = this.shape.auras.filter(au => au.uuid !== uuid);\r\n        this.shape.checkVisionSources();\r\n        this.updateShape(true);\r\n    }\r\n    updateAuraVisionSource(aura: Aura) {\r\n        if (!this.owned) return;\r\n        aura.visionSource = !aura.visionSource;\r\n        const i = visibilityStore.visionSources.findIndex(ls => ls.aura === aura.uuid);\r\n        if (aura.visionSource && i === -1)\r\n            visibilityStore.visionSources.push({ shape: this.shape.uuid, aura: aura.uuid });\r\n        else if (!aura.visionSource && i >= 0) visibilityStore.visionSources.splice(i, 1);\r\n        this.updateShape(true);\r\n    }\r\n    updateAuraColour(aura: Aura, _colour: string) {\r\n        if (!this.owned) return;\r\n        const layer = layerManager.getLayer(this.shape.layer);\r\n        if (layer === undefined) return;\r\n        layer.invalidate(!aura.visionSource);\r\n    }\r\n    openLabelManager() {\r\n        EventBus.$emit(\"LabelManager.Open\");\r\n    }\r\n    removeLabel(uuid: string) {\r\n        if (!this.owned) return;\r\n        this.shape.labels = this.shape.labels.filter(l => l.uuid !== uuid);\r\n        this.updateShape(true);\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./edit_dialog.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./edit_dialog.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./edit_dialog.vue?vue&type=template&id=637f8f89&scoped=true&\"\nimport script from \"./edit_dialog.vue?vue&type=script&lang=ts&\"\nexport * from \"./edit_dialog.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./edit_dialog.vue?vue&type=style&index=0&id=637f8f89&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"637f8f89\",\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport Game from \"@/game/game.vue\";\r\nimport EditDialog from \"@/game/ui/selection/edit_dialog.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\n\r\n@Component({\r\n    components: {\r\n        \"edit-dialog\": EditDialog,\r\n    },\r\n})\r\nexport default class SelectionInfo extends Vue {\r\n    shape: Shape | null = null;\r\n\r\n    mounted() {\r\n        EventBus.$on(\"SelectionInfo.Shape.Set\", (shape: Shape | null) => {\r\n            this.shape = shape;\r\n        });\r\n    }\r\n\r\n    get shapes() {\r\n        if (this.shape === null) return [];\r\n        return [this.shape];\r\n    }\r\n\r\n    get visibleTrackers() {\r\n        if (this.shape === null) return [];\r\n        return this.shape.trackers.filter(tr => tr.name !== \"\" || tr.value !== 0);\r\n    }\r\n\r\n    get visibleAuras() {\r\n        if (this.shape === null) return [];\r\n        return this.shape.auras.filter(au => au.name !== \"\" || au.value !== 0);\r\n    }\r\n\r\n    beforeDestroy() {\r\n        EventBus.$off(\"SelectionInfo.Shape.Set\");\r\n    }\r\n\r\n    openEditDialog() {\r\n        (<any>this.$refs.editDialog)[0].visible = true;\r\n    }\r\n    changeValue(object: Tracker | Aura, redraw: boolean) {\r\n        if (this.shape === null) return;\r\n        (<Game>this.$parent).$refs.prompt.prompt(`New  ${object.name} value:`, `Updating ${object.name}`).then(\r\n            (value: string) => {\r\n                if (this.shape === null) return;\r\n                const ogValue = object.value;\r\n                if (value[0] === \"+\" || value[0] === \"-\") object.value += parseInt(value, 10);\r\n                else object.value = parseInt(value, 10);\r\n                if (isNaN(object.value)) object.value = ogValue;\r\n                socket.emit(\"Shape.Update\", { shape: this.shape.asDict(), redraw, temporary: false });\r\n                if (redraw) layerManager.invalidate();\r\n            },\r\n            () => {},\r\n        );\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection_info.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./selection_info.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./selection_info.vue?vue&type=template&id=394cb731&scoped=true&\"\nimport script from \"./selection_info.vue?vue&type=script&lang=ts&\"\nexport * from \"./selection_info.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./selection_info.vue?vue&type=style&index=0&id=394cb731&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"394cb731\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{attrs:{\"id\":\"toolselect\"}},[_c('ul',_vm._l((_vm.visibleTools),function(tool){return _c('li',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.toolVisible(tool)),expression:\"toolVisible(tool)\"}],key:tool,ref:tool + '-selector',refInFor:true,class:{ 'tool-selected': _vm.currentTool === tool },on:{\"mousedown\":function($event){_vm.currentTool = tool}}},[_c('a',{attrs:{\"href\":\"#\"}},[_vm._v(_vm._s(tool))])])}),0)]),_c('div',[[_c('select-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Select'),expression:\"currentTool === 'Select'\"}],ref:\"selectTool\"}),_c('pan-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Pan'),expression:\"currentTool === 'Pan'\"}]}),_c('keep-alive',[_c('draw-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Draw'),expression:\"currentTool === 'Draw'\"}]})],1),_c('ruler-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Ruler'),expression:\"currentTool === 'Ruler'\"}]}),_c('ping-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Ping'),expression:\"currentTool === 'Ping'\"}]}),_c('map-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Map'),expression:\"currentTool === 'Map'\"}]}),_c('filter-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Filter'),expression:\"currentTool === 'Filter'\"}]}),_c('vision-tool',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentTool === 'Vision'),expression:\"currentTool === 'Vision'\"}]}),_c('shape-menu',{ref:\"shapecontext\"}),_c('default-menu',{ref:\"defaultcontext\"}),_c('createtoken-dialog',{ref:\"createtokendialog\"})]],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.getActiveLayer() !== undefined)?_c('ContextMenu',{attrs:{\"visible\":_vm.visible,\"left\":_vm.x + 'px',\"top\":_vm.y + 'px'},on:{\"close\":_vm.close}},[(_vm.getLayers().length > 1)?_c('li',[_vm._v(\" Layer \"),_c('ul',_vm._l((_vm.getLayers()),function(layer){return _c('li',{key:layer.name,style:([_vm.getActiveLayer().name === layer.name ? { 'background-color': '#82c8a0' } : {}]),on:{\"click\":function($event){return _vm.setLayer(layer.name)}}},[_vm._v(\" \"+_vm._s(layer.name)+\" \")])}),0)]):_vm._e(),(_vm.locations.length > 1)?_c('li',[_vm._v(\" Location \"),_c('ul',_vm._l((_vm.locations),function(location){return _c('li',{key:location,style:([_vm.getCurrentLocation() === location ? { 'background-color': '#82c8a0' } : {}]),on:{\"click\":function($event){return _vm.setLocation(location)}}},[_vm._v(\" \"+_vm._s(location)+\" \")])}),0)]):_vm._e(),_c('li',{on:{\"click\":_vm.moveToBack}},[_vm._v(\"Move to back\")]),_c('li',{on:{\"click\":_vm.moveToFront}},[_vm._v(\"Move to front\")]),_c('li',{on:{\"click\":_vm.addInitiative}},[_vm._v(_vm._s(_vm.getInitiativeWord())+\" initiative\")]),_c('li',{on:{\"click\":_vm.deleteSelection}},[_vm._v(\"Delete shapes\")]),(_vm.hasSingleShape())?_c('li',{on:{\"click\":_vm.openEditDialog}},[_vm._v(\"Show properties\")]):_vm._e()]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { mapState } from \"vuex\";\r\n\r\nimport ContextMenu from \"@/core/components/contextmenu.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { ServerClient, ServerLocation } from \"@/game/comm/types/general\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { cutShapes, deleteShapes, pasteShapes } from \"../../shapes/utils\";\r\nimport { initiativeStore, inInitiative } from \"../initiative/store\";\r\n\r\n@Component({\r\n    components: {\r\n        ContextMenu,\r\n    },\r\n    computed: {\r\n        ...mapState(\"game\", [\"locations\", \"assets\", \"notes\"]),\r\n    },\r\n})\r\nexport default class ShapeContext extends Vue {\r\n    visible = false;\r\n    x = 0;\r\n    y = 0;\r\n    get activeLayer(): string {\r\n        const layer = layerManager.getLayer();\r\n        return layer === undefined ? \"\" : layer.name;\r\n    }\r\n    open(event: MouseEvent) {\r\n        this.visible = true;\r\n        this.x = event.pageX;\r\n        this.y = event.pageY;\r\n        this.$nextTick(() => (<HTMLElement>this.$children[0].$el).focus());\r\n    }\r\n    close() {\r\n        this.visible = false;\r\n    }\r\n    getLayers() {\r\n        return layerManager.layers.filter(l => l.selectable && (gameStore.IS_DM || l.playerEditable));\r\n    }\r\n    getActiveLayer() {\r\n        return layerManager.getLayer();\r\n    }\r\n    getCurrentLocation() {\r\n        return gameStore.locationName;\r\n    }\r\n    getInitiativeWord() {\r\n        const layer = layerManager.getLayer()!;\r\n        if (layer.selection.length === 1) {\r\n            return inInitiative(layer.selection[0].uuid) ? \"Show\" : \"Add\";\r\n        } else {\r\n            return layer.selection.every(shape => inInitiative(shape.uuid)) ? \"Show\" : \"Add all to\";\r\n        }\r\n    }\r\n    hasSingleShape(): boolean {\r\n        const layer = layerManager.getLayer()!;\r\n        return layer.selection.length === 1;\r\n    }\r\n    setLayer(newLayer: string) {\r\n        const layer = layerManager.getLayer()!;\r\n        layer.selection.forEach(shape => shape.moveLayer(newLayer, true));\r\n        this.close();\r\n    }\r\n    setLocation(newLocation: string) {\r\n        const layer = layerManager.getLayer()!;\r\n        cutShapes();\r\n        // Request change to other location\r\n        socket.emit(\"Location.Change\", newLocation);\r\n        socket.once(\"Location.Set\", (_data: Partial<ServerLocation>) => {\r\n            socket.once(\"Client.Options.Set\", (_options: ServerClient) => {\r\n                layer.selection = pasteShapes(layer.name);\r\n                layerManager.selectLayer(layer.name);\r\n            });\r\n        });\r\n        this.close();\r\n    }\r\n    moveToBack() {\r\n        const layer = this.getActiveLayer()!;\r\n        layer.selection.forEach(shape => layer.moveShapeOrder(shape, 0, true));\r\n        this.close();\r\n    }\r\n    moveToFront() {\r\n        const layer = this.getActiveLayer()!;\r\n        layer.selection.forEach(shape => layer.moveShapeOrder(shape, layer.shapes.length - 1, true));\r\n        this.close();\r\n    }\r\n    addInitiative() {\r\n        const layer = layerManager.getLayer()!;\r\n        layer.selection.forEach(shape => initiativeStore.addInitiative(shape.getInitiativeRepr()));\r\n        EventBus.$emit(\"Initiative.Show\");\r\n        this.close();\r\n    }\r\n    deleteSelection() {\r\n        deleteShapes();\r\n        this.close();\r\n    }\r\n    openEditDialog() {\r\n        const layer = layerManager.getLayer()!;\r\n        if (layer.selection.length !== 1) return;\r\n        EventBus.$emit(\"EditDialog.Open\", layer.selection[0]);\r\n        this.close();\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./shapecontext.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./shapecontext.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./shapecontext.vue?vue&type=template&id=623db654&scoped=true&\"\nimport script from \"./shapecontext.vue?vue&type=script&lang=ts&\"\nexport * from \"./shapecontext.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./shapecontext.vue?vue&type=style&index=0&id=623db654&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"623db654\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('modal',{attrs:{\"visible\":_vm.visible},on:{\"close\":function($event){_vm.visible = false}},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_vm._v(\" Create basic token \")])}}])},[_c('div',{staticClass:\"modal-body\"},[_c('label',{attrs:{\"for\":\"createtokendialog-text\"}},[_vm._v(\"Text\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.text),expression:\"text\"}],attrs:{\"type\":\"text\",\"id\":\"createtokendialog-name\"},domProps:{\"value\":(_vm.text)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.text=$event.target.value}}}),_c('label',[_vm._v(\"Colours\")]),_c('div',{staticClass:\"colours\"},[_c('span',[_vm._v(\"Fill:\")]),_c('color-picker',{attrs:{\"color\":_vm.fillColour},on:{\"update:color\":function($event){_vm.fillColour=$event}}}),_c('span',[_vm._v(\"Border:\")]),_c('color-picker',{attrs:{\"color\":_vm.borderColour},on:{\"update:color\":function($event){_vm.borderColour=$event}}})],1),_c('canvas',{ref:\"canvas\",attrs:{\"width\":\"100px\",\"height\":\"100px\"}})]),_c('div',{staticClass:\"modal-footer\"},[_c('button',{on:{\"click\":_vm.submit}},[_vm._v(\"Submit\")])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport * as tinycolor from \"tinycolor2\";\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { mapState } from \"vuex\";\r\n\r\nimport ColorPicker from \"@/core/components/colorpicker.vue\";\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\nimport { calcFontScale } from \"@/core/utils\";\r\nimport { LocalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { CircularToken } from \"@/game/shapes/circulartoken\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { getUnitDistance, l2g } from \"@/game/units\";\r\nimport { Watch } from \"vue-property-decorator\";\r\n\r\n@Component({\r\n    components: {\r\n        Modal,\r\n        \"color-picker\": ColorPicker,\r\n    },\r\n    computed: {\r\n        ...mapState(\"game\", [\"unitSize\"]),\r\n    },\r\n})\r\nexport default class CreateTokenModal extends Vue {\r\n    x = 0;\r\n    y = 0;\r\n    visible = false;\r\n    text = \"X\";\r\n    fillColour = \"rgba(255, 255, 255, 1)\";\r\n    borderColour = \"rgba(0, 0, 0, 1)\";\r\n\r\n    mounted() {\r\n        this.updatePreview();\r\n    }\r\n\r\n    @Watch(\"text\")\r\n    onTextChange(_newValue: string, _oldValue: string) {\r\n        this.updatePreview();\r\n    }\r\n    @Watch(\"fillColour\")\r\n    onFillChange(_newValue: string, _oldValue: string) {\r\n        this.updatePreview();\r\n    }\r\n    @Watch(\"borderColour\")\r\n    onBorderChange(_newValue: string, _oldValue: string) {\r\n        this.updatePreview();\r\n    }\r\n\r\n    open(x: number, y: number) {\r\n        this.visible = true;\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n    submit() {\r\n        const layer = layerManager.getLayer();\r\n        if (layer === undefined) return;\r\n        const token = new CircularToken(\r\n            l2g(new LocalPoint(this.x, this.y)),\r\n            getUnitDistance(gameStore.unitSize / 2),\r\n            this.text,\r\n            \"10px serif\",\r\n            this.fillColour,\r\n            this.borderColour,\r\n        );\r\n        token.addOwner(gameStore.username);\r\n        layer.addShape(token, true);\r\n        layer.invalidate(false);\r\n        this.visible = false;\r\n    }\r\n    updatePreview() {\r\n        const ctx = (<HTMLCanvasElement>this.$refs.canvas).getContext(\"2d\")!;\r\n        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        ctx.beginPath();\r\n        const dest = { x: ctx.canvas.width / 2, y: ctx.canvas.height / 2 };\r\n        const r = Math.min(dest.x, dest.y) * 0.9;\r\n\r\n        ctx.fillStyle = this.fillColour;\r\n\r\n        ctx.arc(dest.x, dest.y, r, 0, 2 * Math.PI);\r\n        ctx.fill();\r\n        if (this.borderColour !== \"rgba(0, 0, 0, 0)\") {\r\n            ctx.beginPath();\r\n            ctx.lineWidth = 5;\r\n            ctx.strokeStyle = this.borderColour;\r\n            ctx.arc(dest.x, dest.y, r - 2.5, 0, 2 * Math.PI);\r\n            ctx.stroke();\r\n        }\r\n        ctx.save();\r\n        ctx.textAlign = \"center\";\r\n        ctx.textBaseline = \"middle\";\r\n        const fontScale = calcFontScale(ctx, this.text, r - 2.5);\r\n        ctx.setTransform(fontScale, 0, 0, fontScale, dest.x, dest.y);\r\n        ctx.fillStyle = tinycolor.mostReadable(this.fillColour, [\"#000\", \"#fff\"]).toHexString();\r\n        ctx.fillText(this.text, 0, 0);\r\n        ctx.restore();\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./createtoken_modal.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./createtoken_modal.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./createtoken_modal.vue?vue&type=template&id=b67b425c&scoped=true&\"\nimport script from \"./createtoken_modal.vue?vue&type=script&lang=ts&\"\nexport * from \"./createtoken_modal.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./createtoken_modal.vue?vue&type=style&index=0&id=b67b425c&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"b67b425c\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ContextMenu',{attrs:{\"visible\":_vm.visible,\"left\":_vm.x + 'px',\"top\":_vm.y + 'px'},on:{\"close\":_vm.close}},[(_vm.IS_DM)?_c('li',{on:{\"click\":_vm.bringPlayers}},[_vm._v(\"Bring players\")]):_vm._e(),_c('li',{on:{\"click\":_vm.createToken}},[_vm._v(\"Create basic token\")]),_c('li',{on:{\"click\":_vm.showInitiative}},[_vm._v(\"Show initiative\")])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport ContextMenu from \"@/core/components/contextmenu.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { l2gx, l2gy } from \"@/game/units\";\r\n\r\n@Component({\r\n    components: {\r\n        ContextMenu,\r\n    },\r\n})\r\nexport default class DefaultContext extends Vue {\r\n    visible = false;\r\n    x = 0;\r\n    y = 0;\r\n\r\n    get IS_DM(): boolean {\r\n        return gameStore.IS_DM;\r\n    }\r\n\r\n    open(event: MouseEvent) {\r\n        this.visible = true;\r\n        this.x = event.pageX;\r\n        this.y = event.pageY;\r\n        this.$nextTick(() => (<HTMLElement>this.$children[0].$el).focus());\r\n    }\r\n    close() {\r\n        this.visible = false;\r\n    }\r\n    bringPlayers() {\r\n        if (!gameStore.IS_DM) return;\r\n        socket.emit(\"Players.Bring\", { x: l2gx(this.x), y: l2gy(this.y), zoom: gameStore.zoomDisplay });\r\n        this.close();\r\n    }\r\n    createToken() {\r\n        (<any>this.$parent.$refs.createtokendialog).open(this.x, this.y);\r\n        this.close();\r\n    }\r\n    showInitiative() {\r\n        EventBus.$emit(\"Initiative.Show\");\r\n        this.close();\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./defaultcontext.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./defaultcontext.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./defaultcontext.vue?vue&type=template&id=5943a1f0&scoped=true&\"\nimport script from \"./defaultcontext.vue?vue&type=script&lang=ts&\"\nexport * from \"./defaultcontext.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./defaultcontext.vue?vue&type=style&index=0&id=5943a1f0&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5943a1f0\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.selected)?_c('div',{staticClass:\"tool-detail\",style:({ '--detailRight': _vm.detailRight, '--detailArrow': _vm.detailArrow })},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.IS_DM),expression:\"IS_DM\"}]},[_vm._v(\"Mode\")]),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.IS_DM),expression:\"IS_DM\"}],staticClass:\"selectgroup\"},_vm._l((_vm.modes),function(mode){return _c('div',{key:mode,staticClass:\"option\",class:{ 'option-selected': _vm.modeSelect === mode },on:{\"click\":function($event){_vm.modeSelect = mode}}},[_vm._v(\" \"+_vm._s(mode)+\" \")])}),0),_c('div',[_vm._v(\"Shape\")]),_c('div',{staticClass:\"selectgroup\"},_vm._l((_vm.shapes),function(shape){return _c('div',{key:shape,staticClass:\"option\",class:{ 'option-selected': _vm.shapeSelect === shape },on:{\"click\":function($event){_vm.shapeSelect = shape}}},[_c('i',{staticClass:\"fas\",class:'fa-' + shape})])}),0),_c('div',[_vm._v(\"Colours\")]),_c('div',{staticClass:\"selectgroup\"},[_c('color-picker',{staticClass:\"option\",class:{ 'radius-right': !_vm.showBorderColour() },attrs:{\"color\":_vm.fillColour},on:{\"update:color\":function($event){_vm.fillColour=$event}}}),_c('color-picker',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showBorderColour()),expression:\"showBorderColour()\"}],staticClass:\"option\",attrs:{\"color\":_vm.borderColour},on:{\"update:color\":function($event){_vm.borderColour=$event}}})],1),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.shapeSelect === 'draw-polygon'),expression:\"shapeSelect === 'draw-polygon'\"}],staticStyle:{\"display\":\"flex\"}},[_c('label',{staticStyle:{\"flex\":\"5\"},attrs:{\"for\":\"polygon-close\"}},[_vm._v(\"Closed polygon?\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.closedPolygon),expression:\"closedPolygon\"}],staticStyle:{\"flex\":\"1\",\"align-self\":\"center\"},attrs:{\"type\":\"checkbox\",\"id\":\"polygon-close\"},domProps:{\"checked\":Array.isArray(_vm.closedPolygon)?_vm._i(_vm.closedPolygon,null)>-1:(_vm.closedPolygon)},on:{\"change\":function($event){var $$a=_vm.closedPolygon,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.closedPolygon=$$a.concat([$$v]))}else{$$i>-1&&(_vm.closedPolygon=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.closedPolygon=$$c}}}})]),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.hasBrushSize()),expression:\"hasBrushSize()\"}],staticStyle:{\"display\":\"flex\"}},[_c('label',{staticStyle:{\"flex\":\"5\"},attrs:{\"for\":\"brush-size\"}},[_vm._v(\"Brush size\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.brushSize),expression:\"brushSize\"}],staticStyle:{\"flex\":\"4\",\"align-self\":\"center\",\"max-width\":\"100px\"},attrs:{\"type\":\"input\",\"id\":\"brush-size\"},domProps:{\"value\":(_vm.brushSize)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.brushSize=$event.target.value}}})])]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport DefaultContext from \"@/game/ui/tools/defaultcontext.vue\";\r\n\r\n@Component\r\nexport default class Tool extends Vue {\r\n    name = \"\";\r\n    selected = false;\r\n    active = false;\r\n    get detailRight(): string {\r\n        const rect = (<any>this.$parent.$refs[this.name + \"-selector\"])[0].getBoundingClientRect();\r\n        const mid = rect.left + rect.width / 2;\r\n\r\n        return `${window.innerWidth - Math.min(window.innerWidth - 25, mid + 75)}px`;\r\n    }\r\n    get detailArrow(): string {\r\n        const rect = (<any>this.$parent.$refs[this.name + \"-selector\"])[0].getBoundingClientRect();\r\n        const mid = rect.left + rect.width / 2;\r\n        const right = Math.min(window.innerWidth - 25, mid + 75);\r\n        return `${right - mid - 14}px`; // border width\r\n    }\r\n    created() {\r\n        this.$parent.$on(\"mousedown\", (event: MouseEvent, tool: string) => {\r\n            if (tool === this.name) this.onMouseDown(event);\r\n        });\r\n        this.$parent.$on(\"mouseup\", (event: MouseEvent, tool: string) => {\r\n            if (tool === this.name) this.onMouseUp(event);\r\n        });\r\n        this.$parent.$on(\"mousemove\", (event: MouseEvent, tool: string) => {\r\n            if (tool === this.name) this.onMouseMove(event);\r\n        });\r\n        this.$parent.$on(\"contextmenu\", (event: MouseEvent, tool: string) => {\r\n            if (tool === this.name) this.onContextMenu(event);\r\n        });\r\n        this.$parent.$on(\"tools-select-change\", (newValue: string, oldValue: string) => {\r\n            if (oldValue === this.name) {\r\n                this.selected = false;\r\n                this.onDeselect();\r\n            } else if (newValue === this.name) {\r\n                this.selected = true;\r\n                this.onSelect();\r\n            }\r\n        });\r\n    }\r\n    onSelect() {}\r\n    onDeselect() {}\r\n    onMouseDown(_event: MouseEvent) {}\r\n    onMouseUp(_event: MouseEvent) {}\r\n    onMouseMove(_event: MouseEvent) {}\r\n    onContextMenu(event: MouseEvent) {\r\n        (<DefaultContext>this.$parent.$refs.defaultcontext).open(event);\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tool.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tool.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./tool.vue?vue&type=template&id=72bf1516&\"\nimport script from \"./tool.vue?vue&type=script&lang=ts&\"\nexport * from \"./tool.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./tool.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { Watch } from \"vue-property-decorator\";\r\nimport { mapGetters } from \"vuex\";\r\n\r\nimport ColorPicker from \"@/core/components/colorpicker.vue\";\r\nimport DefaultContext from \"@/game/ui/tools/defaultcontext.vue\";\r\nimport Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Circle } from \"@/game/shapes/circle\";\r\nimport { Line } from \"@/game/shapes/line\";\r\nimport { Polygon } from \"@/game/shapes/polygon\";\r\nimport { Rect } from \"@/game/shapes/rect\";\r\nimport { Shape } from \"@/game/shapes/shape\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { getUnitDistance, l2g } from \"@/game/units\";\r\nimport { getMouse } from \"@/game/utils\";\r\nimport { visibilityStore } from \"../../visibility/store\";\r\nimport Tools from \"./tools.vue\";\r\n\r\n@Component({\r\n    components: {\r\n        \"color-picker\": ColorPicker,\r\n    },\r\n    computed: {\r\n        ...mapGetters(\"game\", [\"selectedLayer\"]),\r\n    },\r\n})\r\nexport default class DrawTool extends Tool {\r\n    selectedLayer!: string;\r\n\r\n    name = \"Draw\";\r\n    active = false;\r\n\r\n    startPoint: GlobalPoint | null = null;\r\n    shape: Shape | null = null;\r\n    brushHelper: Circle | null = null;\r\n    ruler: Line | null = null;\r\n\r\n    fillColour = \"rgba(0, 0, 0, 1)\";\r\n    borderColour = \"rgba(255, 255, 255, 0)\";\r\n\r\n    shapeSelect = \"square\";\r\n    shapes = [\"square\", \"circle\", \"draw-polygon\", \"paint-brush\"];\r\n    modeSelect = \"normal\";\r\n    modes = [\"normal\", \"reveal\", \"hide\"];\r\n\r\n    brushSize = getUnitDistance(gameStore.unitSize);\r\n    closedPolygon = false;\r\n\r\n    mounted() {\r\n        window.addEventListener(\"keyup\", this.onKeyUp);\r\n    }\r\n\r\n    destroyed() {\r\n        window.removeEventListener(\"keyup\", this.onKeyUp);\r\n    }\r\n\r\n    get helperSize(): number {\r\n        if (this.hasBrushSize()) return this.brushSize / 2;\r\n        return getUnitDistance(this.unitSize) / 8;\r\n    }\r\n    get IS_DM(): boolean {\r\n        return gameStore.IS_DM;\r\n    }\r\n    get unitSize(): number {\r\n        return gameStore.unitSize;\r\n    }\r\n    get useGrid(): boolean {\r\n        return gameStore.useGrid;\r\n    }\r\n\r\n    onKeyUp(event: KeyboardEvent): void {\r\n        if (event.defaultPrevented) return;\r\n        if (event.key === \"Escape\" && this.active) {\r\n            this.onDeselect();\r\n            this.onSelect();\r\n        }\r\n        event.preventDefault();\r\n    }\r\n\r\n    hasBrushSize(): boolean {\r\n        return [\"paint-brush\", \"draw-polygon\"].includes(this.shapeSelect);\r\n    }\r\n\r\n    showBorderColour(): boolean {\r\n        if (this.shapeSelect === \"paint-brush\") return false;\r\n        if (this.shapeSelect === \"draw-polygon\" && !this.closedPolygon) return false;\r\n        return true;\r\n    }\r\n\r\n    @Watch(\"closedPolygon\")\r\n    onChangePolygonCloseBehaviour(closedPolygon: boolean) {\r\n        if (this.shape !== null && this.active) (<Polygon>this.shape).openPolygon = !closedPolygon;\r\n    }\r\n\r\n    @Watch(\"fillColour\")\r\n    onFillChange() {\r\n        if (this.brushHelper) this.brushHelper.fillColour = this.fillColour;\r\n    }\r\n\r\n    @Watch(\"modeSelect\")\r\n    onModeUpdate(newValue: string, oldValue: string) {\r\n        this.onModeChange(newValue, oldValue);\r\n    }\r\n\r\n    @Watch(\"selectedLayer\")\r\n    onLayerChange(newValue: string, oldValue: string) {\r\n        if ((<Tools>this.$parent).currentTool === this.name) {\r\n            this.onDeselect(oldValue);\r\n            this.onSelect();\r\n        }\r\n    }\r\n\r\n    setupBrush() {\r\n        if (this.brushHelper === null) return;\r\n        if (this.modeSelect === \"reveal\" || this.modeSelect === \"hide\") {\r\n            this.brushHelper.options.set(\"preFogShape\", true);\r\n            this.brushHelper.options.set(\"skipDraw\", true);\r\n            this.brushHelper.fillColour = \"rgba(0, 0, 0, 1)\";\r\n\r\n            if (this.modeSelect === \"reveal\") this.brushHelper.globalCompositeOperation = \"source-over\";\r\n            else if (this.modeSelect === \"hide\") this.brushHelper.globalCompositeOperation = \"destination-out\";\r\n        } else {\r\n            this.brushHelper.options.delete(\"preFogShape\");\r\n            this.brushHelper.options.delete(\"skipDraw\");\r\n            this.brushHelper.globalCompositeOperation = \"source-over\";\r\n            this.brushHelper.fillColour = this.fillColour;\r\n        }\r\n    }\r\n    onModeChange(newValue: string, oldValue: string) {\r\n        if (this.brushHelper === null) return;\r\n\r\n        const fowLayer = layerManager.getLayer(\"fow\");\r\n        const normalLayer = layerManager.getLayer();\r\n        if (fowLayer === undefined || normalLayer === undefined) return;\r\n\r\n        this.setupBrush();\r\n\r\n        if (newValue !== \"normal\" && oldValue === \"normal\") {\r\n            normalLayer.removeShape(this.brushHelper, false);\r\n            fowLayer.addShape(this.brushHelper, false);\r\n        } else if (newValue === \"normal\" && oldValue !== \"normal\") {\r\n            normalLayer.addShape(this.brushHelper, false);\r\n            fowLayer.removeShape(this.brushHelper, false);\r\n        }\r\n    }\r\n    getLayer(targetLayer?: string) {\r\n        if (this.modeSelect === \"normal\") return layerManager.getLayer(targetLayer);\r\n        return layerManager.getLayer(\"fow\");\r\n    }\r\n    onMouseDown(event: MouseEvent) {\r\n        const layer = this.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        if (!this.active) {\r\n            this.startPoint = l2g(getMouse(event));\r\n            this.active = true;\r\n            switch (this.shapeSelect) {\r\n                case \"square\": {\r\n                    this.shape = new Rect(this.startPoint.clone(), 0, 0, this.fillColour, this.borderColour);\r\n                    break;\r\n                }\r\n                case \"circle\": {\r\n                    this.shape = new Circle(\r\n                        this.startPoint.clone(),\r\n                        this.helperSize,\r\n                        this.fillColour,\r\n                        this.borderColour,\r\n                    );\r\n                    break;\r\n                }\r\n                case \"paint-brush\": {\r\n                    this.shape = new Polygon(\r\n                        this.startPoint.clone(),\r\n                        [],\r\n                        undefined,\r\n                        this.fillColour,\r\n                        this.brushSize,\r\n                        true,\r\n                    );\r\n                    this.shape.fillColour = this.fillColour;\r\n                    break;\r\n                }\r\n                case \"draw-polygon\": {\r\n                    const fill = this.closedPolygon ? this.fillColour : undefined;\r\n                    const stroke = this.closedPolygon ? this.borderColour : this.fillColour;\r\n                    this.shape = new Polygon(\r\n                        this.startPoint.clone(),\r\n                        [],\r\n                        fill,\r\n                        stroke,\r\n                        this.brushSize,\r\n                        !this.closedPolygon,\r\n                    );\r\n                    break;\r\n                }\r\n                default:\r\n                    return;\r\n            }\r\n\r\n            if (this.modeSelect !== \"normal\") {\r\n                this.shape.options.set(\"preFogShape\", true);\r\n                this.shape.options.set(\"skipDraw\", true);\r\n                this.shape.fillColour = \"rgba(0, 0, 0, 1)\";\r\n            }\r\n            if (this.modeSelect === \"reveal\") this.shape.globalCompositeOperation = \"source-over\";\r\n            else if (this.modeSelect === \"hide\") this.shape.globalCompositeOperation = \"destination-out\";\r\n\r\n            this.shape.addOwner(gameStore.username);\r\n            if (layer.name === \"fow\" && this.modeSelect === \"normal\") {\r\n                this.shape.visionObstruction = true;\r\n                this.shape.movementObstruction = true;\r\n            }\r\n            layer.addShape(this.shape, true, false, false);\r\n\r\n            // Push brushhelper to back\r\n            this.pushBrushBack();\r\n        } else if (this.shape !== null && this.shapeSelect === \"draw-polygon\" && this.shape instanceof Polygon) {\r\n            // For polygon draw\r\n            this.shape._vertices.push(l2g(getMouse(event)));\r\n        }\r\n        if (this.shape !== null && this.shapeSelect === \"draw-polygon\" && this.shape instanceof Polygon) {\r\n            const lastPoint = l2g(getMouse(event));\r\n            if (this.ruler === null) {\r\n                this.ruler = new Line(lastPoint, lastPoint, this.brushSize, this.fillColour);\r\n                layer.addShape(this.ruler, false);\r\n            } else {\r\n                this.ruler.refPoint = lastPoint;\r\n                this.ruler.endPoint = lastPoint;\r\n            }\r\n            if (this.shape.visionObstruction) visibilityStore.recalculateVision();\r\n            layer.invalidate(false);\r\n            socket.emit(\"Shape.Update\", { shape: this.shape!.asDict(), redraw: true, temporary: true });\r\n        }\r\n    }\r\n    onMouseMove(event: MouseEvent) {\r\n        const endPoint = l2g(getMouse(event));\r\n        const layer = this.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n\r\n        if (this.brushHelper !== null) {\r\n            this.brushHelper.r = this.helperSize;\r\n            this.brushHelper.refPoint = endPoint;\r\n            if (!this.active) layer.invalidate(false);\r\n        }\r\n\r\n        if (!this.active || this.startPoint === null || this.shape === null) return;\r\n\r\n        switch (this.shapeSelect) {\r\n            case \"square\": {\r\n                (<Rect>this.shape).w = Math.abs(endPoint.x - this.startPoint.x);\r\n                (<Rect>this.shape).h = Math.abs(endPoint.y - this.startPoint.y);\r\n                this.shape.refPoint = new GlobalPoint(\r\n                    Math.min(this.startPoint.x, endPoint.x),\r\n                    Math.min(this.startPoint.y, endPoint.y),\r\n                );\r\n                break;\r\n            }\r\n            case \"circle\": {\r\n                (<Circle>this.shape).r = Math.abs(endPoint.subtract(this.startPoint).length());\r\n                break;\r\n            }\r\n            case \"paint-brush\": {\r\n                (<Polygon>this.shape)._vertices.push(endPoint);\r\n                break;\r\n            }\r\n            case \"draw-polygon\": {\r\n                this.ruler!.endPoint = endPoint;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (!(this.shapeSelect === \"draw-polygon\" && this.shape instanceof Polygon)) {\r\n            socket.emit(\"Shape.Update\", { shape: this.shape!.asDict(), redraw: true, temporary: true });\r\n            if (this.shape.visionObstruction) visibilityStore.recalculateVision();\r\n        }\r\n        layer.invalidate(false);\r\n    }\r\n    onMouseUp(event: MouseEvent) {\r\n        if (\r\n            !this.active ||\r\n            this.shape === null ||\r\n            (this.shape instanceof Polygon && this.shapeSelect === \"draw-polygon\")\r\n        )\r\n            return;\r\n        if (!event.altKey && this.useGrid) {\r\n            this.shape.resizeToGrid();\r\n        }\r\n        this.finaliseShape();\r\n    }\r\n    onContextMenu(event: MouseEvent) {\r\n        if (\r\n            this.active &&\r\n            this.shape !== null &&\r\n            this.shapeSelect === \"draw-polygon\" &&\r\n            this.shape instanceof Polygon\r\n        ) {\r\n            const layer = this.getLayer();\r\n            if (layer === undefined) {\r\n                console.log(\"No active layer!\");\r\n                return;\r\n            }\r\n            layer.removeShape(this.ruler!, false);\r\n            this.ruler = null;\r\n            this.finaliseShape();\r\n        } else if (!this.active) {\r\n            (<DefaultContext>this.$parent.$refs.defaultcontext).open(event);\r\n        }\r\n    }\r\n\r\n    private finaliseShape() {\r\n        if (this.shape === null) return;\r\n        if (this.shape.points.length <= 1) {\r\n            this.onDeselect();\r\n            this.onSelect();\r\n        } else {\r\n            if (this.shape.visionObstruction) visibilityStore.recalculateVision();\r\n            if (this.shape.movementObstruction) visibilityStore.recalculateMovement();\r\n            socket.emit(\"Shape.Update\", { shape: this.shape!.asDict(), redraw: true, temporary: false });\r\n        }\r\n        this.active = false;\r\n    }\r\n\r\n    onSelect() {\r\n        const layer = this.getLayer();\r\n        if (layer === undefined) return;\r\n        this.brushHelper = new Circle(new GlobalPoint(-1000, -1000), this.brushSize / 2, this.fillColour);\r\n        this.setupBrush();\r\n        layer.addShape(this.brushHelper, false); // during mode change the shape is already added\r\n    }\r\n    onDeselect(targetLayer?: string) {\r\n        const layer = this.getLayer(targetLayer);\r\n        if (this.brushHelper !== null && layer !== undefined) {\r\n            layer.removeShape(this.brushHelper, false);\r\n            this.brushHelper = null;\r\n        }\r\n        if (this.ruler !== null && layer !== undefined) {\r\n            layer.removeShape(this.ruler, false);\r\n            this.ruler = null;\r\n        }\r\n        if (this.active && layer !== undefined && this.shape !== null) {\r\n            layer.removeShape(this.shape, true, false);\r\n            this.shape = null;\r\n            this.active = false;\r\n            layer.invalidate(false);\r\n        }\r\n    }\r\n\r\n    private pushBrushBack() {\r\n        const layer = this.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        if (this.brushHelper !== null) layer.removeShape(this.brushHelper, false);\r\n        this.brushHelper = new Circle(new GlobalPoint(-1000, -1000), this.brushSize / 2, this.fillColour);\r\n        this.setupBrush();\r\n        layer.addShape(this.brushHelper, false); // during mode change the shape is already added\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./draw.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./draw.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./draw.vue?vue&type=template&id=790caf6c&scoped=true&\"\nimport script from \"./draw.vue?vue&type=script&lang=ts&\"\nexport * from \"./draw.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./draw.vue?vue&type=style&index=0&id=790caf6c&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"790caf6c\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.selected)?_c('div',{staticClass:\"tool-detail\",style:({ '--detailRight': _vm.detailRight, '--detailArrow': _vm.detailArrow })},[_c('div',{attrs:{\"id\":\"accordion-container\"}},_vm._l((_vm.categories),function(category){return _c('accordion',{key:category,attrs:{\"title\":category === '' ? 'no category' : category,\"showArrow\":false,\"items\":_vm.labels[category],\"initialValues\":_vm.initalValues[category]},on:{\"selectionupdate\":_vm.updateSelection}})}),1)]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"accordion\"},[_c('div',{attrs:{\"id\":\"header\"},on:{\"click\":function($event){$event.preventDefault();return _vm.toggleDisplay($event)}}},[_c('input',{ref:\"overall\",attrs:{\"type\":\"checkbox\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.toggleCategory($event)}}}),_c('strong',[_vm._v(_vm._s(_vm.title))]),(_vm.showArrow)?[_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showArrow && !_vm.active),expression:\"showArrow && !active\"}],staticClass:\"down-Arrow\"},[_vm._v(\"▼\")]),_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showArrow && _vm.active),expression:\"showArrow && active\"}],staticClass:\"up-Arrow\"},[_vm._v(\"▲\")])]:_vm._e()],2),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.active),expression:\"active\"}],attrs:{\"id\":\"body\"}},_vm._l((_vm.items),function(item){return _c('div',{key:item[0],staticClass:\"item\",on:{\"click\":function($event){return _vm.toggleSelection(item[0])}}},[_c('input',{attrs:{\"type\":\"checkbox\"},domProps:{\"checked\":_vm.selected.includes(item[0])},on:{\"click\":function($event){$event.preventDefault();}}}),_vm._v(\" \"+_vm._s(item[1])+\" \")])}),0)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { Prop } from \"vue-property-decorator\";\r\n\r\n@Component\r\nexport default class Accordion extends Vue {\r\n    @Prop(String) title!: string;\r\n    @Prop({ default: true, type: Boolean }) showArrow!: boolean;\r\n    @Prop({ default: () => [] }) items!: [string, string][];\r\n    @Prop({ default: () => [] }) initialValues!: string[];\r\n\r\n    selected: string[] = [];\r\n\r\n    active = false;\r\n\r\n    mounted() {\r\n        this.selected = this.initialValues;\r\n        this.updateCategory();\r\n    }\r\n\r\n    toggleDisplay(_event: MouseEvent) {\r\n        this.active = !this.active;\r\n    }\r\n\r\n    toggleCategory() {\r\n        const overall = this.$refs.overall as HTMLInputElement;\r\n        if (overall.checked) this.selected = this.items.map(i => i[0]);\r\n        else this.selected = [];\r\n        this.$emit(\"selectionupdate\", { title: this.title, selection: this.selected });\r\n    }\r\n\r\n    updateCategory() {\r\n        const overall = this.$refs.overall as HTMLInputElement;\r\n        if (this.selected.length === 0) {\r\n            overall.checked = false;\r\n            overall.indeterminate = false;\r\n        } else if (this.selected.length === this.items.length) {\r\n            overall.checked = true;\r\n            overall.indeterminate = false;\r\n        } else {\r\n            overall.checked = false;\r\n            overall.indeterminate = true;\r\n        }\r\n    }\r\n\r\n    toggleSelection(item: string) {\r\n        const found = this.selected.indexOf(item);\r\n        if (found === -1) this.selected.push(item);\r\n        else this.selected.splice(found, 1);\r\n        this.updateCategory();\r\n        this.$emit(\"selectionupdate\", { title: this.title, selection: this.selected });\r\n    }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./accordion.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./accordion.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./accordion.vue?vue&type=template&id=32e257d0&scoped=true&\"\nimport script from \"./accordion.vue?vue&type=script&lang=ts&\"\nexport * from \"./accordion.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./accordion.vue?vue&type=style&index=0&id=32e257d0&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"32e257d0\",\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Component from \"vue-class-component\";\r\n\r\nimport Accordion from \"@/core/components/accordion.vue\";\r\nimport Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\n\r\n@Component({\r\n    components: {\r\n        accordion: Accordion,\r\n    },\r\n})\r\nexport default class FilterTool extends Tool {\r\n    name = \"Filter\";\r\n    active = false;\r\n\r\n    get labels() {\r\n        const cat: { [category: string]: [string, string][] } = { \"\": [] };\r\n        for (const uuid of Object.keys(gameStore.labels)) {\r\n            const label = gameStore.labels[uuid];\r\n            if (!label.category) cat[\"\"].push([label.uuid, label.name]);\r\n            else {\r\n                if (!(label.category in cat)) cat[label.category] = [];\r\n                cat[label.category].push([label.uuid, label.name]);\r\n                cat[label.category].sort((a, b) => a[1].localeCompare(b[1]));\r\n            }\r\n        }\r\n        return cat;\r\n    }\r\n\r\n    get initalValues() {\r\n        const values: { [category: string]: string[] } = {};\r\n        for (const cat of Object.keys(this.labels)) {\r\n            values[cat] = gameStore.labelFilters.filter(f => this.labels[cat].map(l => l[0]).includes(f));\r\n        }\r\n        return values;\r\n    }\r\n\r\n    get categories() {\r\n        return Object.keys(this.labels).sort();\r\n    }\r\n\r\n    isFilter(uuid: string): boolean {\r\n        return gameStore.labelFilters.includes(uuid);\r\n    }\r\n\r\n    toggleFilter(uuid: string) {\r\n        const i = gameStore.labelFilters.indexOf(uuid);\r\n        if (i >= 0) gameStore.labelFilters.splice(i, 1);\r\n        else gameStore.labelFilters.push(uuid);\r\n        layerManager.invalidate();\r\n    }\r\n\r\n    toggleUnlabeled() {\r\n        gameStore.toggleUnlabeledFilter();\r\n        layerManager.invalidate();\r\n    }\r\n\r\n    updateSelection(data: { title: string; selection: string[] }) {\r\n        if (!(data.title in this.labels)) return;\r\n        for (const [uuid, _] of this.labels[data.title]) {\r\n            const idx = gameStore.labelFilters.indexOf(uuid);\r\n            const selected = data.selection.includes(uuid);\r\n            if (idx >= 0 && !selected) {\r\n                gameStore.labelFilters.splice(idx, 1);\r\n                socket.emit(\"Labels.Filter.Remove\", uuid);\r\n            } else if (idx < 0 && selected) {\r\n                gameStore.labelFilters.push(uuid);\r\n                socket.emit(\"Labels.Filter.Add\", uuid);\r\n            }\r\n        }\r\n        layerManager.invalidate();\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./filter.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./filter.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./filter.vue?vue&type=template&id=75b63661&scoped=true&\"\nimport script from \"./filter.vue?vue&type=script&lang=ts&\"\nexport * from \"./filter.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./filter.vue?vue&type=style&index=0&lang=css&\"\nimport style1 from \"./filter.vue?vue&type=style&index=1&id=75b63661&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"75b63661\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.selected)?_c('div',{staticClass:\"tool-detail\",style:({ '--detailRight': _vm.detailRight, '--detailArrow': _vm.detailArrow })},[_c('div',[_vm._v(\"#X\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.xCount),expression:\"xCount\"}],attrs:{\"type\":\"text\"},domProps:{\"value\":(_vm.xCount)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.xCount=$event.target.value}}}),_c('div',[_vm._v(\"#Y\")]),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.yCount),expression:\"yCount\"}],attrs:{\"type\":\"text\"},domProps:{\"value\":(_vm.yCount)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.yCount=$event.target.value}}})]):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\r\nimport Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { BaseRect } from \"@/game/shapes/baserect\";\r\nimport { Rect } from \"@/game/shapes/rect\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { l2g } from \"@/game/units\";\r\nimport { getMouse } from \"@/game/utils\";\r\nimport Component from \"vue-class-component\";\r\n\r\n@Component\r\nexport default class MapTool extends Tool {\r\n    name = \"Map\";\r\n    active = false;\r\n    xCount = 3;\r\n    yCount = 3;\r\n    startPoint: GlobalPoint | null = null;\r\n    rect: Rect | null = null;\r\n\r\n    onMouseDown(event: MouseEvent) {\r\n        const layer = layerManager.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        this.active = true;\r\n\r\n        this.startPoint = l2g(getMouse(event));\r\n        this.rect = new Rect(this.startPoint.clone(), 0, 0, \"rgba(0,0,0,0)\", \"black\");\r\n        layer.addShape(this.rect, false, false);\r\n    }\r\n    onMouseMove(event: MouseEvent) {\r\n        if (!this.active || this.rect === null || this.startPoint === null) return;\r\n        const layer = layerManager.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n\r\n        const endPoint = l2g(getMouse(event));\r\n\r\n        this.rect.w = Math.abs(endPoint.x - this.startPoint.x);\r\n        this.rect.h = Math.abs(endPoint.y - this.startPoint.y);\r\n        this.rect.refPoint = new GlobalPoint(\r\n            Math.min(this.startPoint.x, endPoint.x),\r\n            Math.min(this.startPoint.y, endPoint.y),\r\n        );\r\n        layer.invalidate(false);\r\n    }\r\n    onMouseUp(_event: MouseEvent) {\r\n        if (!this.active || this.rect === null) return;\r\n        const layer = layerManager.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        this.active = false;\r\n\r\n        if (layer.selection.length !== 1) {\r\n            layer.removeShape(this.rect, false, false);\r\n            return;\r\n        }\r\n\r\n        const w = this.rect.w;\r\n        const h = this.rect.h;\r\n        const sel = layer.selection[0];\r\n\r\n        if (sel instanceof BaseRect) {\r\n            sel.w *= (this.xCount * gameStore.gridSize) / w;\r\n            sel.h *= (this.yCount * gameStore.gridSize) / h;\r\n        }\r\n\r\n        layer.removeShape(this.rect, false, false);\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./map.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./map.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./map.vue?vue&type=template&id=17b6b4aa&\"\nimport script from \"./map.vue?vue&type=script&lang=ts&\"\nexport * from \"./map.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import Component from \"vue-class-component\";\r\n\r\nimport Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { sendClientOptions } from \"@/game/api/utils\";\r\nimport { LocalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { getMouse } from \"@/game/utils\";\r\n\r\n@Component\r\nexport default class PanTool extends Tool {\r\n    name = \"Pan\";\r\n    panStart = new LocalPoint(0, 0);\r\n    active = false;\r\n\r\n    onMouseDown(event: MouseEvent): void {\r\n        this.panStart = getMouse(event);\r\n        this.active = true;\r\n    }\r\n    onMouseMove(event: MouseEvent): void {\r\n        if (!this.active) return;\r\n        const mouse = getMouse(event);\r\n        const distance = mouse.subtract(this.panStart).multiply(1 / gameStore.zoomFactor);\r\n        gameStore.increasePanX(Math.round(distance.x));\r\n        gameStore.increasePanY(Math.round(distance.y));\r\n        this.panStart = mouse;\r\n        layerManager.invalidate();\r\n    }\r\n    onMouseUp(_event: MouseEvent): void {\r\n        this.active = false;\r\n        sendClientOptions(gameStore.locationOptions);\r\n    }\r\n}\r\n","\r\nimport Component from \"vue-class-component\";\r\n\r\nimport ShapeContext from \"@/game/ui/selection/shapecontext.vue\";\r\nimport DefaultContext from \"@/game/ui/tools/defaultcontext.vue\";\r\nimport Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { GlobalPoint, LocalPoint, Ray, Vector } from \"@/game/geom\";\r\nimport { Layer } from \"@/game/layers/layer\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Rect } from \"@/game/shapes/rect\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { calculateDelta } from \"@/game/ui/tools/utils\";\r\nimport { g2l, g2lx, g2ly, l2g, l2gz } from \"@/game/units\";\r\nimport { getMouse } from \"@/game/utils\";\r\nimport { EventBus } from \"../../event-bus\";\r\nimport { visibilityStore } from \"../../visibility/store\";\r\n\r\nexport enum SelectOperations {\r\n    Noop,\r\n    Resize,\r\n    Drag,\r\n    GroupSelect,\r\n}\r\n\r\nconst start = new GlobalPoint(-1000, -1000);\r\n\r\n@Component\r\nexport default class SelectTool extends Tool {\r\n    name = \"Select\";\r\n    showContextMenu = false;\r\n    active = false;\r\n\r\n    mode = SelectOperations.Noop;\r\n    resizePoint = 0;\r\n    deltaChanged = false;\r\n    // Because we never drag from the asset's (0, 0) coord and want a smoother drag experience\r\n    // we keep track of the actual offset within the asset.\r\n    dragRay = new Ray<LocalPoint>(new LocalPoint(0, 0), new Vector(0, 0));\r\n    selectionStartPoint = start;\r\n    selectionHelper = new Rect(start, 0, 0);\r\n    created() {\r\n        this.selectionHelper.globalCompositeOperation = \"source-over\";\r\n        gameStore.setSelectionHelperId(this.selectionHelper.uuid);\r\n    }\r\n    onMouseDown(event: MouseEvent) {\r\n        const layer = layerManager.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n\r\n        if (!this.selectionHelper.owners.includes(gameStore.username)) {\r\n            this.selectionHelper.addOwner(gameStore.username);\r\n        }\r\n\r\n        const mouse = getMouse(event);\r\n        const globalMouse = l2g(mouse);\r\n\r\n        let hit = false;\r\n        // The selectionStack allows for lower positioned objects that are selected to have precedence during overlap.\r\n        let selectionStack;\r\n        if (!layer.selection.length) selectionStack = layer.shapes;\r\n        else selectionStack = layer.shapes.concat(layer.selection);\r\n        for (let i = selectionStack.length - 1; i >= 0; i--) {\r\n            const shape = selectionStack[i];\r\n\r\n            this.resizePoint = shape.getPointIndex(globalMouse, l2gz(3));\r\n\r\n            // Resize case, a corner is selected\r\n            if (this.resizePoint >= 0) {\r\n                layer.selection = [shape];\r\n                EventBus.$emit(\"SelectionInfo.Shape.Set\", shape);\r\n                this.mode = SelectOperations.Resize;\r\n                layer.invalidate(true);\r\n                hit = true;\r\n                break;\r\n\r\n                // Drag case, a shape is selected\r\n            } else if (shape.contains(globalMouse)) {\r\n                const selection = shape;\r\n                if (layer.selection.indexOf(selection) === -1) {\r\n                    if (event.ctrlKey) {\r\n                        layer.selection.push(selection);\r\n                    } else {\r\n                        layer.selection = [selection];\r\n                    }\r\n                    EventBus.$emit(\"SelectionInfo.Shape.Set\", selection);\r\n                }\r\n                this.mode = SelectOperations.Drag;\r\n                const localRefPoint = g2l(selection.refPoint);\r\n                this.dragRay = new Ray<LocalPoint>(localRefPoint, mouse.subtract(localRefPoint));\r\n                layer.invalidate(true);\r\n                hit = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        // GroupSelect case, draw a selection box to select multiple shapes\r\n        if (!hit) {\r\n            this.mode = SelectOperations.GroupSelect;\r\n            for (const selection of layer.selection) EventBus.$emit(\"SelectionInfo.Shape.Set\", selection);\r\n\r\n            this.selectionStartPoint = globalMouse;\r\n\r\n            this.selectionHelper.refPoint = this.selectionStartPoint;\r\n            this.selectionHelper.w = 0;\r\n            this.selectionHelper.h = 0;\r\n\r\n            if (event.ctrlKey) {\r\n                layer.selection.push(this.selectionHelper);\r\n            } else {\r\n                layer.selection = [this.selectionHelper];\r\n            }\r\n            layer.invalidate(true);\r\n        }\r\n        this.active = true;\r\n    }\r\n    onMouseMove(event: MouseEvent) {\r\n        // if (!this.active) return;   we require mousemove for the resize cursor\r\n        const layer = layerManager.getLayer();\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        const mouse = getMouse(event);\r\n        const globalMouse = l2g(mouse);\r\n        this.deltaChanged = false;\r\n\r\n        if (this.mode === SelectOperations.GroupSelect) {\r\n            // Currently draw on active layer\r\n            const endPoint = globalMouse;\r\n\r\n            this.selectionHelper.w = Math.abs(endPoint.x - this.selectionStartPoint.x);\r\n            this.selectionHelper.h = Math.abs(endPoint.y - this.selectionStartPoint.y);\r\n            this.selectionHelper.refPoint = new GlobalPoint(\r\n                Math.min(this.selectionStartPoint.x, endPoint.x),\r\n                Math.min(this.selectionStartPoint.y, endPoint.y),\r\n            );\r\n            layer.invalidate(true);\r\n        } else if (layer.selection.length) {\r\n            const og = g2l(layer.selection[layer.selection.length - 1].refPoint);\r\n            const origin = og.add(this.dragRay.direction);\r\n            let delta = mouse.subtract(origin).multiply(1 / gameStore.zoomFactor);\r\n            const ogDelta = delta;\r\n            if (this.mode === SelectOperations.Drag) {\r\n                // If we are on the tokens layer do a movement block check.\r\n                if (layer.name === \"tokens\" && !(event.shiftKey && gameStore.IS_DM)) {\r\n                    for (const sel of layer.selection) {\r\n                        if (!sel.ownedBy()) continue;\r\n                        if (sel.uuid === this.selectionHelper.uuid) continue; // the selection helper should not be treated as a real shape.\r\n                        delta = calculateDelta(delta, sel);\r\n                        if (delta !== ogDelta) this.deltaChanged = true;\r\n                    }\r\n                }\r\n                // Actually apply the delta on all shapes\r\n                for (const sel of layer.selection) {\r\n                    if (!sel.ownedBy()) continue;\r\n                    sel.refPoint = sel.refPoint.add(delta);\r\n                    if (sel !== this.selectionHelper) {\r\n                        if (sel.visionObstruction) visibilityStore.recalculateVision();\r\n                        socket.emit(\"Shape.Update\", { shape: sel.asDict(), redraw: true, temporary: true });\r\n                    }\r\n                }\r\n                layer.invalidate(false);\r\n            } else if (this.mode === SelectOperations.Resize) {\r\n                for (const sel of layer.selection) {\r\n                    if (!sel.ownedBy()) continue;\r\n                    sel.resize(this.resizePoint, mouse);\r\n                    if (sel !== this.selectionHelper) {\r\n                        if (sel.visionObstruction) visibilityStore.recalculateVision();\r\n                        socket.emit(\"Shape.Update\", { shape: sel.asDict(), redraw: true, temporary: true });\r\n                    }\r\n                    layer.invalidate(false);\r\n                    this.updateCursor(layer, globalMouse);\r\n                }\r\n            } else {\r\n                this.updateCursor(layer, globalMouse);\r\n            }\r\n        } else {\r\n            document.body.style.cursor = \"default\";\r\n        }\r\n    }\r\n    onMouseUp(e: MouseEvent): void {\r\n        if (!this.active) return;\r\n        if (layerManager.getLayer() === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        const layer = layerManager.getLayer()!;\r\n\r\n        if (this.mode === SelectOperations.GroupSelect) {\r\n            if (e.ctrlKey) {\r\n                // If either control or shift are pressed, do not remove selection\r\n            } else {\r\n                layer.clearSelection();\r\n            }\r\n            for (const shape of layer.shapes) {\r\n                if (!shape.ownedBy()) continue;\r\n                if (shape === this.selectionHelper) continue;\r\n                const bbox = shape.getBoundingBox();\r\n                if (!shape.ownedBy()) continue;\r\n                if (\r\n                    this.selectionHelper!.refPoint.x <= bbox.topRight.x &&\r\n                    this.selectionHelper!.refPoint.x + this.selectionHelper!.w >= bbox.topLeft.x &&\r\n                    this.selectionHelper!.refPoint.y <= bbox.botLeft.y &&\r\n                    this.selectionHelper!.refPoint.y + this.selectionHelper!.h >= bbox.topLeft.y\r\n                ) {\r\n                    if (layer.selection.find(it => it === shape) === undefined) {\r\n                        layer.selection.push(shape);\r\n                    }\r\n                }\r\n            }\r\n            layer.selection = layer.selection.filter(it => it !== this.selectionHelper);\r\n            layer.invalidate(true);\r\n        } else if (layer.selection.length) {\r\n            for (const sel of layer.selection) {\r\n                if (!sel.ownedBy()) continue;\r\n                if (this.mode === SelectOperations.Drag) {\r\n                    if (\r\n                        this.dragRay.origin!.x === g2lx(sel.refPoint.x) &&\r\n                        this.dragRay.origin!.y === g2ly(sel.refPoint.y)\r\n                    )\r\n                        continue;\r\n\r\n                    if (gameStore.useGrid && !e.altKey && !this.deltaChanged) {\r\n                        sel.snapToGrid();\r\n                    }\r\n\r\n                    if (sel !== this.selectionHelper) {\r\n                        if (sel.visionObstruction) visibilityStore.recalculateVision();\r\n                        if (sel.movementObstruction) visibilityStore.recalculateMovement();\r\n                        socket.emit(\"Shape.Update\", { shape: sel.asDict(), redraw: true, temporary: false });\r\n                    }\r\n                    layer.invalidate(false);\r\n                }\r\n                if (this.mode === SelectOperations.Resize) {\r\n                    if (gameStore.useGrid && !e.altKey) {\r\n                        sel.resizeToGrid();\r\n                    }\r\n                    if (sel !== this.selectionHelper) {\r\n                        if (sel.visionObstruction) visibilityStore.recalculateVision();\r\n                        if (sel.movementObstruction) visibilityStore.recalculateMovement();\r\n                        socket.emit(\"Shape.Update\", { shape: sel.asDict(), redraw: true, temporary: false });\r\n                    }\r\n                    layer.invalidate(false);\r\n                }\r\n            }\r\n        }\r\n        this.mode = SelectOperations.Noop;\r\n        this.active = false;\r\n    }\r\n    onContextMenu(event: MouseEvent) {\r\n        if (layerManager.getLayer() === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        const layer = layerManager.getLayer()!;\r\n        const mouse = getMouse(event);\r\n        const globalMouse = l2g(mouse);\r\n        for (const shape of layer.selection) {\r\n            if (shape.contains(globalMouse)) {\r\n                EventBus.$emit(\"SelectionInfo.Shape.Set\", shape);\r\n                layer.invalidate(true);\r\n                (<ShapeContext>this.$parent.$refs.shapecontext).open(event);\r\n                return;\r\n            }\r\n        }\r\n\r\n        // Check if any other shapes are under the mouse\r\n        for (let i = layer.shapes.length - 1; i >= 0; i--) {\r\n            const shape = layer.shapes[i];\r\n            if (shape.contains(globalMouse)) {\r\n                layer.selection = [shape];\r\n                EventBus.$emit(\"SelectionInfo.Shape.Set\", shape);\r\n                layer.invalidate(true);\r\n                (<ShapeContext>this.$parent.$refs.shapecontext).open(event);\r\n                return;\r\n            }\r\n        }\r\n        (<DefaultContext>this.$parent.$refs.defaultcontext).open(event);\r\n    }\r\n    updateCursor(layer: Layer, globalMouse: GlobalPoint) {\r\n        for (const sel of layer.selection) {\r\n            const resizePoint = sel.getPointIndex(globalMouse, l2gz(3));\r\n            if (resizePoint < 0) document.body.style.cursor = \"default\";\r\n            else {\r\n                let angle = sel.getPointOrientation(resizePoint).angle();\r\n                if (angle < 0) angle += 360;\r\n                const d = 45 / 2;\r\n                if (angle >= 315 + d || angle < d || (angle >= 135 + d && angle < 225 - d))\r\n                    document.body.style.cursor = \"ew-resize\";\r\n                if ((angle >= 45 + d && angle < 135 - d) || (angle >= 225 + d && angle < 315 - d))\r\n                    document.body.style.cursor = \"ns-resize\";\r\n                if ((angle >= d && angle < 90 - d) || (angle >= 180 + d && angle < 270 - d))\r\n                    document.body.style.cursor = \"nwse-resize\";\r\n                if ((angle >= 90 + d && angle < 180 - d) || (angle >= 270 + d && angle < 360 - d))\r\n                    document.body.style.cursor = \"nesw-resize\";\r\n            }\r\n        }\r\n    }\r\n}\r\n","var render, staticRenderFns\nimport script from \"./select.vue?vue&type=script&lang=ts&\"\nexport * from \"./select.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./select.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./select.vue?vue&type=script&lang=ts&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.selected)?_c('div',{staticClass:\"tool-detail\",style:({ '--detailRight': _vm.detailRight, '--detailArrow': _vm.detailArrow })},_vm._l((_vm.tokens),function(token){return _c('div',{key:token.uuid,staticClass:\"token\",class:{ selected: _vm.selection.includes(token.uuid) },on:{\"click\":function($event){return _vm.toggle(token.uuid)}}},[(token.src)?_c('img',{attrs:{\"src\":token.src,\"width\":\"30px\",\"height\":\"30px\"}}):_vm._e(),_c('div',[_vm._v(_vm._s(token.name))])])}),0):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Component from \"vue-class-component\";\r\n\r\nimport Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { Shape } from \"../../shapes/shape\";\r\n\r\n@Component\r\nexport default class VisionTool extends Tool {\r\n    name = \"Vision\";\r\n    active = false;\r\n\r\n    get selection(): string[] {\r\n        return gameStore.activeTokens;\r\n    }\r\n\r\n    get tokens(): Shape[] {\r\n        return gameStore.ownedtokens.map(t => layerManager.UUIDMap.get(t)!);\r\n    }\r\n\r\n    toggle(uuid: string) {\r\n        if (this.selection.includes(uuid)) gameStore.removeActiveToken(uuid);\r\n        else gameStore.addActiveToken(uuid);\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./vision.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./vision.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./vision.vue?vue&type=template&id=f995dfd4&scoped=true&\"\nimport script from \"./vision.vue?vue&type=script&lang=ts&\"\nexport * from \"./vision.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./vision.vue?vue&type=style&index=0&id=f995dfd4&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f995dfd4\",\n  null\n  \n)\n\nexport default component.exports","import Component from \"vue-class-component\";\r\n\r\nimport Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Circle } from \"@/game/shapes/circle\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { l2g } from \"@/game/units\";\r\nimport { getMouse } from \"@/game/utils\";\r\n\r\n@Component\r\nexport class PingTool extends Tool {\r\n    name = \"Ping\";\r\n    active = false;\r\n    startPoint: GlobalPoint | null = null;\r\n    ping: Circle | null = null;\r\n    border: Circle | null = null;\r\n    onMouseDown(event: MouseEvent): void {\r\n        const layer = layerManager.getLayer(\"draw\");\r\n        if (layer === undefined) {\r\n            console.log(\"No draw layer!\");\r\n            return;\r\n        }\r\n        this.active = true;\r\n        this.startPoint = l2g(getMouse(event));\r\n        this.ping = new Circle(this.startPoint, 20, gameStore.rulerColour);\r\n        this.border = new Circle(this.startPoint, 40, \"#0000\", gameStore.rulerColour);\r\n        this.ping.addOwner(gameStore.username);\r\n        this.border.addOwner(gameStore.username);\r\n        layer.addShape(this.ping, true, true);\r\n        layer.addShape(this.border, true, true);\r\n    }\r\n    onMouseMove(event: MouseEvent): void {\r\n        if (!this.active || this.ping === null || this.border === null || this.startPoint === null) return;\r\n\r\n        const layer = layerManager.getLayer(\"draw\");\r\n        if (layer === undefined) {\r\n            console.log(\"No draw layer!\");\r\n            return;\r\n        }\r\n        const endPoint = l2g(getMouse(event));\r\n\r\n        this.ping.center(endPoint);\r\n        this.border.center(endPoint);\r\n\r\n        socket.emit(\"Shape.Update\", { shape: this.ping!.asDict(), redraw: true, temporary: true });\r\n        socket.emit(\"Shape.Update\", { shape: this.border!.asDict(), redraw: true, temporary: true });\r\n\r\n        layer.invalidate(true);\r\n    }\r\n    onMouseUp(_event: MouseEvent): void {\r\n        if (!this.active || this.ping === null || this.border === null || this.startPoint === null) return;\r\n\r\n        const layer = layerManager.getLayer(\"draw\");\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        this.active = false;\r\n        layer.removeShape(this.ping, true, true);\r\n        layer.removeShape(this.border, true, true);\r\n        layer.invalidate(true);\r\n        this.ping = null;\r\n        this.startPoint = null;\r\n    }\r\n}\r\n","import Component from \"vue-class-component\";\r\n\r\nimport Tool from \"@/game/ui/tools/tool.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { GlobalPoint } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { Line } from \"@/game/shapes/line\";\r\nimport { Text } from \"@/game/shapes/text\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { l2g, l2gz } from \"@/game/units\";\r\nimport { getMouse } from \"@/game/utils\";\r\n\r\n@Component\r\nexport class RulerTool extends Tool {\r\n    name = \"Ruler\";\r\n    active = false;\r\n    startPoint: GlobalPoint | null = null;\r\n    ruler: Line | null = null;\r\n    text: Text | null = null;\r\n    onMouseDown(event: MouseEvent): void {\r\n        const layer = layerManager.getLayer(\"draw\");\r\n        if (layer === undefined) {\r\n            console.log(\"No draw layer!\");\r\n            return;\r\n        }\r\n        this.active = true;\r\n        this.startPoint = l2g(getMouse(event));\r\n        this.ruler = new Line(this.startPoint, this.startPoint, l2gz(3), gameStore.rulerColour);\r\n        this.text = new Text(this.startPoint.clone(), \"\", \"bold 20px serif\");\r\n        this.ruler.addOwner(gameStore.username);\r\n        this.text.addOwner(gameStore.username);\r\n        layer.addShape(this.ruler, true, true);\r\n        layer.addShape(this.text, true, true);\r\n    }\r\n    onMouseMove(event: MouseEvent): void {\r\n        if (!this.active || this.ruler === null || this.startPoint === null || this.text === null) return;\r\n\r\n        const layer = layerManager.getLayer(\"draw\");\r\n        if (layer === undefined) {\r\n            console.log(\"No draw layer!\");\r\n            return;\r\n        }\r\n        const endPoint = l2g(getMouse(event));\r\n\r\n        this.ruler.endPoint = endPoint;\r\n        socket.emit(\"Shape.Update\", { shape: this.ruler!.asDict(), redraw: true, temporary: true });\r\n\r\n        const diffsign = Math.sign(endPoint.x - this.startPoint.x) * Math.sign(endPoint.y - this.startPoint.y);\r\n        const xdiff = Math.abs(endPoint.x - this.startPoint.x);\r\n        const ydiff = Math.abs(endPoint.y - this.startPoint.y);\r\n        const label =\r\n            Math.round((Math.sqrt(xdiff ** 2 + ydiff ** 2) * gameStore.unitSize) / gameStore.gridSize) +\r\n            \" \" +\r\n            gameStore.unitSizeUnit;\r\n        const angle = Math.atan2(diffsign * ydiff, xdiff);\r\n        const xmid = Math.min(this.startPoint.x, endPoint.x) + xdiff / 2;\r\n        const ymid = Math.min(this.startPoint.y, endPoint.y) + ydiff / 2;\r\n        this.text.refPoint = new GlobalPoint(xmid, ymid);\r\n        this.text.text = label;\r\n        this.text.angle = angle;\r\n        socket.emit(\"Shape.Update\", { shape: this.text.asDict(), redraw: true, temporary: true });\r\n        layer.invalidate(true);\r\n    }\r\n    onMouseUp(_event: MouseEvent): void {\r\n        if (!this.active || this.ruler === null || this.startPoint === null || this.text === null) return;\r\n\r\n        const layer = layerManager.getLayer(\"draw\");\r\n        if (layer === undefined) {\r\n            console.log(\"No active layer!\");\r\n            return;\r\n        }\r\n        this.active = false;\r\n\r\n        layer.removeShape(this.ruler, true, true);\r\n        layer.removeShape(this.text, true, true);\r\n        layer.invalidate(true);\r\n        this.ruler = this.startPoint = this.text = null;\r\n    }\r\n}\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\n\r\nimport ShapeContext from \"@/game/ui/selection/shapecontext.vue\";\r\nimport CreateTokenModal from \"@/game/ui/tools/createtoken_modal.vue\";\r\nimport DefaultContext from \"@/game/ui/tools/defaultcontext.vue\";\r\nimport DrawTool from \"@/game/ui/tools/draw.vue\";\r\nimport FilterTool from \"@/game/ui/tools/filter.vue\";\r\nimport MapTool from \"@/game/ui/tools/map.vue\";\r\nimport PanTool from \"@/game/ui/tools/pan\";\r\nimport SelectTool from \"@/game/ui/tools/select.vue\";\r\nimport VisionTool from \"@/game/ui/tools/vision.vue\";\r\n\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameManager } from \"@/game/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { PingTool } from \"@/game/ui/tools/ping\";\r\nimport { RulerTool } from \"@/game/ui/tools/ruler\";\r\nimport { l2g } from \"@/game/units\";\r\nimport { getMouse } from \"@/game/utils\";\r\nimport Component from \"vue-class-component\";\r\n\r\n@Component({\r\n    components: {\r\n        \"select-tool\": SelectTool,\r\n        \"pan-tool\": PanTool,\r\n        \"draw-tool\": DrawTool,\r\n        \"ruler-tool\": RulerTool,\r\n        \"ping-tool\": PingTool,\r\n        \"map-tool\": MapTool,\r\n        \"filter-tool\": FilterTool,\r\n        \"vision-tool\": VisionTool,\r\n        \"shape-menu\": ShapeContext,\r\n        \"default-menu\": DefaultContext,\r\n        \"createtoken-dialog\": CreateTokenModal,\r\n    },\r\n    watch: {\r\n        currentTool(newValue, oldValue) {\r\n            this.$emit(\"tools-select-change\", newValue, oldValue);\r\n        },\r\n    },\r\n})\r\nexport default class Tools extends Vue {\r\n    $refs!: {\r\n        selectTool: InstanceType<typeof SelectTool>;\r\n    };\r\n\r\n    currentTool = \"Select\";\r\n    tools = [\"Select\", \"Pan\", \"Draw\", \"Ruler\", \"Ping\", \"Map\", \"Filter\", \"Vision\"];\r\n    dmTools = [\"Map\"];\r\n\r\n    get IS_DM(): boolean {\r\n        return gameStore.IS_DM;\r\n    }\r\n\r\n    get currentToolComponent(): string {\r\n        return `${this.currentTool.toLowerCase()}-tool`;\r\n    }\r\n\r\n    get visibleTools(): string[] {\r\n        return this.tools.filter(t => !this.dmTools.includes(t) || this.IS_DM);\r\n    }\r\n\r\n    toolVisible(tool: string): boolean {\r\n        if (tool === \"Filter\") {\r\n            return Object.keys(gameStore.labels).length > 0;\r\n        } else if (tool === \"Vision\") {\r\n            return gameStore.ownedtokens.length > 1;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    mousedown(event: MouseEvent) {\r\n        if ((<HTMLElement>event.target).tagName !== \"CANVAS\") return;\r\n\r\n        let targetTool = this.currentTool;\r\n        if (event.button === 1) {\r\n            targetTool = \"Pan\";\r\n        } else if (event.button !== 0) {\r\n            return;\r\n        }\r\n\r\n        this.$emit(\"mousedown\", event, targetTool);\r\n    }\r\n    mouseup(event: MouseEvent) {\r\n        if ((<HTMLElement>event.target).tagName !== \"CANVAS\") return;\r\n\r\n        let targetTool = this.currentTool;\r\n        if (event.button === 1) {\r\n            targetTool = \"Pan\";\r\n        } else if (event.button !== 0) {\r\n            return;\r\n        }\r\n\r\n        this.$emit(\"mouseup\", event, targetTool);\r\n    }\r\n    mousemove(event: MouseEvent) {\r\n        if ((<HTMLElement>event.target).tagName !== \"CANVAS\") return;\r\n\r\n        let targetTool = this.currentTool;\r\n        if ((event.buttons & 4) !== 0) {\r\n            targetTool = \"Pan\";\r\n        } else if ((event.button & 1) > 1) {\r\n            return;\r\n        }\r\n\r\n        this.$emit(\"mousemove\", event, targetTool);\r\n\r\n        // Annotation hover\r\n        let found = false;\r\n        for (const uuid of gameStore.annotations) {\r\n            if (layerManager.UUIDMap.has(uuid) && layerManager.hasLayer(\"draw\")) {\r\n                const shape = layerManager.UUIDMap.get(uuid)!;\r\n                if (shape.contains(l2g(getMouse(event)))) {\r\n                    found = true;\r\n                    gameManager.annotationManager.setActiveText(shape.annotation);\r\n                }\r\n            }\r\n        }\r\n        if (!found && gameManager.annotationManager.shown) {\r\n            gameManager.annotationManager.setActiveText(\"\");\r\n        }\r\n    }\r\n    mouseleave(event: MouseEvent) {\r\n        // When leaving the window while a mouse is pressed down, act as if it was released\r\n        if ((event.buttons & 1) !== 0) {\r\n            this.$emit(\"mouseup\", event, this.currentTool);\r\n        }\r\n    }\r\n    contextmenu(event: MouseEvent) {\r\n        if ((<HTMLElement>event.target).tagName !== \"CANVAS\") return;\r\n        if (event.button !== 2 || (<HTMLElement>event.target).tagName !== \"CANVAS\") return;\r\n        this.$emit(\"contextmenu\", event, this.currentTool);\r\n    }\r\n}\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tools.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/ts-loader/index.js??ref--14-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./tools.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./tools.vue?vue&type=template&id=5132142a&scoped=true&\"\nimport script from \"./tools.vue?vue&type=script&lang=ts&\"\nexport * from \"./tools.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./tools.vue?vue&type=style&index=0&id=5132142a&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5132142a\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Modal',{attrs:{\"visible\":_vm.visible,\"colour\":'rgba(255, 255, 255, 0.8)',\"mask\":false},on:{\"close\":function($event){_vm.visible = false}},scopedSlots:_vm._u([{key:\"header\",fn:function(m){return _c('div',{staticClass:\"modal-header\",attrs:{\"draggable\":\"true\"},on:{\"dragstart\":m.dragStart,\"dragend\":m.dragEnd}},[_c('div',[_vm._v(\"DM Settings\")]),_c('div',{staticClass:\"header-close\",on:{\"click\":function($event){_vm.visible = false}}},[_c('i',{staticClass:\"far fa-window-close\"})])])}}])},[_c('div',{staticClass:\"modal-body\",on:{\"click\":_vm.handleClick}},[_c('div',{attrs:{\"id\":\"categories\"}},_vm._l((_vm.categories),function(category,c){return _c('div',{key:category,staticClass:\"category\",class:{ selected: _vm.selection === c },on:{\"click\":function($event){_vm.selection = c}}},[_vm._v(\" \"+_vm._s(category)+\" \")])}),0),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.selection === 0),expression:\"selection === 0\"}],staticClass:\"panel\"},[_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Players\")]),_vm._l((_vm.$store.state.game.players),function(player){return _c('div',{key:player.id,staticClass:\"row smallrow\"},[_c('div',[_vm._v(_vm._s(player.name))]),_c('div',[_c('div',{on:{\"click\":function($event){return _vm.kickPlayer(player.id)}}},[_vm._v(\"Kick\")])])])}),(Object.values(_vm.$store.state.game.players).length === 0)?_c('div',{staticClass:\"row smallrow\"},[_c('div',{staticClass:\"spanrow\"},[_vm._v(\"There are no players yet, invite some using the link below!\")])]):_vm._e(),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Invite code\")]),_c('div',{staticClass:\"row\"},[_c('div',[_vm._v(\"Invitation URL:\")]),(_vm.showRefreshState)?[_c('InputCopyElement',{attrs:{\"value\":_vm.refreshState}})]:[_c('InputCopyElement',{attrs:{\"value\":_vm.invitationUrl}})]],2),_c('div',{staticClass:\"row\",on:{\"click\":_vm.refreshInviteCode}},[_c('div'),_c('div',[_c('button',[_vm._v(\"Refresh invitation code\")])])]),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Danger Zone\")]),_c('div',{staticClass:\"row\"},[_c('div',[(_vm.locked)?[_vm._v(\" Unlock \")]:[_vm._v(\" Lock \")],_vm._v(\" Session \"),_c('i',[_vm._v(\"(DM access only)\")])],2),_c('div',[_c('button',{staticClass:\"danger\",on:{\"click\":_vm.toggleSessionLock}},[(_vm.locked)?[_vm._v(\" Unlock \")]:[_vm._v(\" Lock \")],_vm._v(\" this Session \")],2)])]),_c('div',{staticClass:\"row\"},[_c('div',[_vm._v(\"Remove Session\")]),_c('div',[_c('button',{staticClass:\"danger\",on:{\"click\":_vm.deleteSession}},[_vm._v(\"Delete this Session\")])])])],2),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.selection === 1),expression:\"selection === 1\"}],staticClass:\"panel\"},[_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"useGridInput\"}},[_vm._v(\"Use grid\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.useGrid),expression:\"useGrid\"}],attrs:{\"id\":\"useGridInput\",\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.useGrid)?_vm._i(_vm.useGrid,null)>-1:(_vm.useGrid)},on:{\"change\":function($event){var $$a=_vm.useGrid,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.useGrid=$$a.concat([$$v]))}else{$$i>-1&&(_vm.useGrid=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.useGrid=$$c}}}})])]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"gridSizeInput\"}},[_vm._v(\"Grid Size (in pixels):\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.gridSize),expression:\"gridSize\",modifiers:{\"number\":true}}],attrs:{\"id\":\"gridSizeInput\",\"type\":\"number\",\"min\":\"0\"},domProps:{\"value\":(_vm.gridSize)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.gridSize=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}})])]),_c('div',{staticClass:\"row\"},[_c('div',[_c('label',{attrs:{\"for\":\"unitSizeUnit\"}},[_vm._v(\"Size Unit\")])]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.unitSizeUnit),expression:\"unitSizeUnit\"}],attrs:{\"id\":\"unitSizeUnit\",\"type\":\"text\"},domProps:{\"value\":(_vm.unitSizeUnit)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.unitSizeUnit=$event.target.value}}})])]),_c('div',{staticClass:\"row\"},[_c('div',[_c('label',{attrs:{\"for\":\"unitSizeInput\"}},[_vm._v(\"Unit Size (in \"+_vm._s(_vm.unitSizeUnit)+\")\")])]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.unitSize),expression:\"unitSize\",modifiers:{\"number\":true}}],attrs:{\"id\":\"unitSizeInput\",\"type\":\"number\"},domProps:{\"value\":(_vm.unitSize)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.unitSize=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}})])])]),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.selection === 2),expression:\"selection === 2\"}],staticClass:\"panel\"},[_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Core\")]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"fakePlayerInput\"}},[_vm._v(\"Fake player:\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.fakePlayer),expression:\"fakePlayer\"}],attrs:{\"id\":\"fakePlayerInput\",\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.fakePlayer)?_vm._i(_vm.fakePlayer,null)>-1:(_vm.fakePlayer)},on:{\"change\":function($event){var $$a=_vm.fakePlayer,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.fakePlayer=$$a.concat([$$v]))}else{$$i>-1&&(_vm.fakePlayer=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.fakePlayer=$$c}}}})])]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"useFOWInput\"}},[_vm._v(\"Fill entire canvas with FOW:\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.fullFOW),expression:\"fullFOW\"}],attrs:{\"id\":\"useFOWInput\",\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.fullFOW)?_vm._i(_vm.fullFOW,null)>-1:(_vm.fullFOW)},on:{\"change\":function($event){var $$a=_vm.fullFOW,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.fullFOW=$$a.concat([$$v]))}else{$$i>-1&&(_vm.fullFOW=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.fullFOW=$$c}}}})])]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"fowLOS\"}},[_vm._v(\"Only show lights in LoS:\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.fowLOS),expression:\"fowLOS\"}],attrs:{\"id\":\"fowLOS\",\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.fowLOS)?_vm._i(_vm.fowLOS,null)>-1:(_vm.fowLOS)},on:{\"change\":function($event){var $$a=_vm.fowLOS,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.fowLOS=$$a.concat([$$v]))}else{$$i>-1&&(_vm.fowLOS=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.fowLOS=$$c}}}})])]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"fowOpacity\"}},[_vm._v(\"FOW opacity:\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model.number\",value:(_vm.fowOpacity),expression:\"fowOpacity\",modifiers:{\"number\":true}}],attrs:{\"id\":\"fowOpacity\",\"type\":\"number\",\"min\":\"0\",\"max\":\"1\",\"step\":\"0.1\"},domProps:{\"value\":(_vm.fowOpacity)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.fowOpacity=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}})])]),_c('div',{staticClass:\"spanrow header\"},[_vm._v(\"Advanced\")]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"visionMode\"}},[_vm._v(\"Vision Mode:\")]),_c('div',[_c('select',{attrs:{\"id\":\"visionMode\"},on:{\"change\":_vm.changeVisionMode}},[_c('option',{domProps:{\"selected\":_vm.$store.state.visibility.visionMode === 'bvh'}},[_vm._v(\"BVH\")]),_c('option',{domProps:{\"selected\":_vm.$store.state.visibility.visionMode === 'triangle'}},[_vm._v(\"Triangle\")])])])]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"vmininp\"}},[_vm._v(\"Minimal full vision (\"+_vm._s(_vm.unitSizeUnit)+\"):\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model.lazy.number\",value:(_vm.visionRangeMin),expression:\"visionRangeMin\",modifiers:{\"lazy\":true,\"number\":true}}],attrs:{\"id\":\"vmininp\",\"type\":\"number\",\"min\":\"0\"},domProps:{\"value\":(_vm.visionRangeMin)},on:{\"change\":function($event){_vm.visionRangeMin=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}})])]),_c('div',{staticClass:\"row\"},[_c('label',{attrs:{\"for\":\"vmaxinp\"}},[_vm._v(\"Maximal vision (\"+_vm._s(_vm.unitSizeUnit)+\"):\")]),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model.lazy.number\",value:(_vm.visionRangeMax),expression:\"visionRangeMax\",modifiers:{\"lazy\":true,\"number\":true}}],attrs:{\"id\":\"vmaxinp\",\"type\":\"number\",\"min\":\"0\"},domProps:{\"value\":(_vm.visionRangeMax)},on:{\"change\":function($event){_vm.visionRangeMax=_vm._n($event.target.value)},\"blur\":function($event){return _vm.$forceUpdate()}}})])])])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"input-copy\"},on:{\"mouseleave\":function($event){_vm.showPopup = false}}},[_c('input',{attrs:{\"type\":\"text\",\"disabled\":\"disabled\",\"id\":\"input-element\"},domProps:{\"value\":_vm.value}}),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showPopup),expression:\"showPopup\"}],attrs:{\"id\":\"show-popup\"}},[_vm._v(_vm._s(_vm.popupString))]),_c('div',{attrs:{\"id\":\"copy-button\"},on:{\"click\":_vm.copy}},[_c('i',{staticClass:\"far fa-copy\"})])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { Prop } from \"vue-property-decorator\";\r\n\r\n@Component\r\nexport default class InputCopyElement extends Vue {\r\n    @Prop() value!: string;\r\n\r\n    borderColour = \"lightgray\";\r\n    popupString = \"\";\r\n    showPopup = false;\r\n\r\n    copy() {\r\n        (<any>navigator).clipboard.writeText(this.value).then(\r\n            () => {\r\n                this.popupString = \"Copied!\";\r\n                this.showPopup = true;\r\n            },\r\n            () => {\r\n                console.log(\"Could not copy to clipboard :(\");\r\n                this.popupString = \"Error!\";\r\n                this.showPopup = true;\r\n            },\r\n        );\r\n    }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./inputCopy.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./inputCopy.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./inputCopy.vue?vue&type=template&id=628dde30&scoped=true&\"\nimport script from \"./inputCopy.vue?vue&type=script&lang=ts&\"\nexport * from \"./inputCopy.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./inputCopy.vue?vue&type=style&index=0&id=628dde30&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"628dde30\",\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\n\r\nimport { mapState } from \"vuex\";\r\n\r\nimport InputCopyElement from \"@/core/components/inputCopy.vue\";\r\nimport Modal from \"@/core/components/modals/modal.vue\";\r\n\r\nimport { socket } from \"@/game/api/socket\";\r\nimport { EventBus } from \"@/game/event-bus\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { layerManager } from \"../layers/manager\";\r\nimport Game from \"../game.vue\";\r\nimport { visibilityStore } from \"../visibility/store\";\r\n\r\n@Component({\r\n    components: {\r\n        InputCopyElement,\r\n        Modal,\r\n    },\r\n    computed: {\r\n        ...mapState(\"game\", [\"invitationCode\"]),\r\n    },\r\n})\r\nexport default class DmSettings extends Vue {\r\n    visible = false;\r\n    categories = [\"Admin\", \"Grid\", \"Vision\"];\r\n    selection = 0;\r\n\r\n    showRefreshState = false;\r\n    refreshState = \"pending\";\r\n\r\n    mounted() {\r\n        EventBus.$on(\"DmSettings.Open\", () => {\r\n            this.visible = true;\r\n        });\r\n        EventBus.$on(\"DmSettings.RefreshedInviteCode\", () => {\r\n            this.showRefreshState = false;\r\n        });\r\n    }\r\n\r\n    beforeDestroy() {\r\n        EventBus.$off(\"DmSettings.Open\");\r\n        EventBus.$off(\"DmSettings.RefreshedInviteCode\");\r\n    }\r\n\r\n    // Admin\r\n    get invitationUrl(): string {\r\n        return window.location.protocol + \"//\" + window.location.host + \"/invite/\" + gameStore.invitationCode;\r\n    }\r\n    get locked(): boolean {\r\n        return gameStore.isLocked;\r\n    }\r\n    // Grid\r\n    get useGrid(): boolean {\r\n        return gameStore.useGrid;\r\n    }\r\n    set useGrid(value: boolean) {\r\n        gameStore.setUseGrid({ useGrid: value, sync: true });\r\n    }\r\n    get unitSize(): number {\r\n        return gameStore.unitSize;\r\n    }\r\n    set unitSize(value: number) {\r\n        if (typeof value !== \"number\") return;\r\n        gameStore.setUnitSize({ unitSize: value, sync: true });\r\n    }\r\n    get unitSizeUnit(): string {\r\n        return gameStore.unitSizeUnit;\r\n    }\r\n    set unitSizeUnit(value: string) {\r\n        gameStore.setUnitSizeUnit({ unitSizeUnit: value, sync: true });\r\n    }\r\n    get gridSize(): number {\r\n        return gameStore.gridSize;\r\n    }\r\n    set gridSize(value: number) {\r\n        if (typeof value !== \"number\") return;\r\n        gameStore.setGridSize({ gridSize: value, sync: true });\r\n    }\r\n    // Vision\r\n    get fakePlayer(): boolean {\r\n        return gameStore.FAKE_PLAYER;\r\n    }\r\n    set fakePlayer(value: boolean) {\r\n        gameStore.setFakePlayer(value);\r\n    }\r\n    get fullFOW(): boolean {\r\n        return gameStore.fullFOW;\r\n    }\r\n    set fullFOW(value: boolean) {\r\n        gameStore.setFullFOW({ fullFOW: value, sync: true });\r\n    }\r\n    get fowOpacity(): number {\r\n        return gameStore.fowOpacity;\r\n    }\r\n    set fowOpacity(value: number) {\r\n        if (typeof value !== \"number\") return;\r\n        gameStore.setFOWOpacity({ fowOpacity: value, sync: true });\r\n    }\r\n    get fowLOS(): boolean {\r\n        return gameStore.fowLOS;\r\n    }\r\n    set fowLOS(value: boolean) {\r\n        gameStore.setLineOfSight({ fowLOS: value, sync: true });\r\n    }\r\n    get visionRangeMin(): number {\r\n        return gameStore.visionRangeMin;\r\n    }\r\n    set visionRangeMin(value: number) {\r\n        if (typeof value !== \"number\") return;\r\n        gameStore.setVisionRangeMin({ value, sync: true });\r\n    }\r\n    get visionRangeMax(): number {\r\n        return gameStore.visionRangeMax;\r\n    }\r\n    set visionRangeMax(value: number) {\r\n        if (typeof value !== \"number\") return;\r\n        gameStore.setVisionRangeMax({ value, sync: true });\r\n    }\r\n    changeVisionMode(event: { target: HTMLSelectElement }) {\r\n        const value = event.target.value.toLowerCase();\r\n        if (value !== \"bvh\" && value !== \"triangle\") return;\r\n        visibilityStore.setVisionMode({ mode: value, sync: true });\r\n        visibilityStore.recalculateVision();\r\n        visibilityStore.recalculateMovement();\r\n        layerManager.invalidate();\r\n    }\r\n    handleClick(event: { target: HTMLElement }) {\r\n        const child = event.target.firstElementChild;\r\n        if (child instanceof HTMLInputElement) {\r\n            child.click();\r\n        }\r\n    }\r\n    refreshInviteCode() {\r\n        socket.emit(\"Room.Info.InviteCode.Refresh\");\r\n        this.refreshState = \"pending\";\r\n        this.showRefreshState = true;\r\n    }\r\n    kickPlayer(id: number) {\r\n        socket.emit(\"Room.Info.Players.Kick\", id);\r\n        gameStore.kickPlayer(id);\r\n    }\r\n    toggleSessionLock() {\r\n        gameStore.setIsLocked({ isLocked: !gameStore.isLocked, sync: true });\r\n    }\r\n    deleteSession() {\r\n        (<Game>this.$parent).$refs.prompt\r\n            .prompt(\r\n                `ENTER ${gameStore.roomCreator}/${gameStore.roomName} TO CONFIRM SESSION REMOVAL.`,\r\n                `DELETING SESSION`,\r\n            )\r\n            .then(\r\n                (value: string) => {\r\n                    if (value !== `${gameStore.roomCreator}/${gameStore.roomName}`) return;\r\n                    socket.emit(\"Room.Delete\");\r\n                    this.$router.push(\"/\");\r\n                },\r\n                () => {},\r\n            );\r\n    }\r\n}\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./dmsettings.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./dmsettings.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./dmsettings.vue?vue&type=template&id=61114102&scoped=true&\"\nimport script from \"./dmsettings.vue?vue&type=script&lang=ts&\"\nexport * from \"./dmsettings.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./dmsettings.vue?vue&type=style&index=0&id=61114102&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"61114102\",\n  null\n  \n)\n\nexport default component.exports","import { socket } from \"@/game/api/socket\";\r\nimport { sendClientOptions } from \"@/game/api/utils\";\r\nimport { Vector } from \"@/game/geom\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { calculateDelta } from \"@/game/ui/tools/utils\";\r\nimport { copyShapes, deleteShapes, pasteShapes } from \"../shapes/utils\";\r\nimport { visibilityStore } from \"../visibility/store\";\r\n\r\nexport function onKeyUp(event: KeyboardEvent): void {\r\n    if (event.target instanceof HTMLInputElement || event.target instanceof HTMLTextAreaElement) {\r\n        // no-op (condition is cleaner this way)\r\n    } else {\r\n        if (event.key === \"Delete\" || event.key === \"Del\" || event.key === \"Backspace\") {\r\n            deleteShapes();\r\n        }\r\n    }\r\n}\r\n\r\nexport function onKeyDown(event: KeyboardEvent): void {\r\n    if (event.target instanceof HTMLInputElement || event.target instanceof HTMLTextAreaElement) {\r\n        // Ctrl-a with a HTMLInputElement or a HTMLTextAreaElement selected - select all the text\r\n        if (event.key === \"a\" && event.ctrlKey) event.target!.select();\r\n    } else {\r\n        if (event.keyCode >= 37 && event.keyCode <= 40) {\r\n            // Arrow keys - move the selection or the camera\r\n            // todo: this should already be rounded\r\n            const gridSize = Math.round(gameStore.gridSize);\r\n            let offsetX = gridSize * (event.keyCode % 2);\r\n            let offsetY = gridSize * (event.keyCode % 2 ? 0 : 1);\r\n            if (layerManager.hasSelection()) {\r\n                const selection = layerManager.getSelection()!;\r\n                offsetX *= event.keyCode <= 38 ? -1 : 1;\r\n                offsetY *= event.keyCode <= 38 ? -1 : 1;\r\n                let delta = new Vector(offsetX, offsetY);\r\n                if (!event.shiftKey || !gameStore.IS_DM) {\r\n                    // First check for collisions.  Using the smooth wall slide collision check used on mouse move is overkill here.\r\n                    for (const sel of selection) {\r\n                        if (gameStore.selectionHelperID === sel.uuid) continue;\r\n                        delta = calculateDelta(delta, sel);\r\n                    }\r\n                }\r\n                for (const sel of selection) {\r\n                    if (gameStore.selectionHelperID === sel.uuid) continue;\r\n                    sel.refPoint = sel.refPoint.add(delta);\r\n                    // todo: Fix again\r\n                    // if (sel.refPoint.x % gridSize !== 0 || sel.refPoint.y % gridSize !== 0) sel.snapToGrid();\r\n                    socket.emit(\"Shape.Position.Update\", { shape: sel.asDict(), redraw: true, temporary: false });\r\n                }\r\n                visibilityStore.recalculateVision();\r\n                layerManager.getLayer()!.invalidate(false);\r\n            } else {\r\n                // The pan offsets should be in the opposite direction to give the correct feel.\r\n                gameStore.increasePanX(offsetX * (event.keyCode <= 38 ? 1 : -1));\r\n                gameStore.increasePanY(offsetY * (event.keyCode <= 38 ? 1 : -1));\r\n                layerManager.invalidate();\r\n                sendClientOptions(gameStore.locationOptions);\r\n            }\r\n        } else if (event.key === \"d\") {\r\n            // d - Deselect all\r\n            const layer = layerManager.getLayer();\r\n            if (layer) {\r\n                layer.clearSelection();\r\n                layer.invalidate(true);\r\n            }\r\n        } else if (event.key === \"u\" && event.ctrlKey) {\r\n            // Ctrl-u - disable and reenable the Interface\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n            gameStore.toggleUI();\r\n        } else if (event.key === \"c\" && event.ctrlKey) {\r\n            // Ctrl-c - Copy\r\n            copyShapes();\r\n        } else if (event.key === \"v\" && event.ctrlKey) {\r\n            // Ctrl-v - Paste\r\n            pasteShapes();\r\n        }\r\n    }\r\n}\r\n","import { gameStore } from \"@/game/store\";\r\nimport { l2g } from \"@/game/units\";\r\nimport { getMouse } from \"@/game/utils\";\r\n\r\nexport function scrollZoom(e: WheelEvent): void {\r\n    if (!e.target || !(<HTMLElement>e.target).tagName || (<HTMLElement>e.target).tagName !== \"CANVAS\") return;\r\n    let delta: number;\r\n    delta = Math.sign(e.deltaY) * -1;\r\n    gameStore.updateZoom({ newZoomDisplay: gameStore.zoomDisplay - 0.1 * delta, zoomLocation: l2g(getMouse(e)) });\r\n}\r\n","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\nimport throttle from \"lodash/throttle\";\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\nimport vueSlider from \"vue-slider-component\";\r\nimport \"vue-slider-component/theme/default.css\";\r\n\r\nimport \"@/game/api/events\";\r\n\r\nimport ConfirmDialog from \"@/core/components/modals/confirm.vue\";\r\nimport Prompt from \"@/core/components/modals/prompt.vue\";\r\nimport Initiative from \"@/game/ui/initiative/initiative.vue\";\r\nimport LabelManager from \"@/game/ui/labels.vue\";\r\nimport MenuBar from \"@/game/ui/menu/menu.vue\";\r\nimport NoteDialog from \"@/game/ui/note.vue\";\r\nimport SelectionInfo from \"@/game/ui/selection/selection_info.vue\";\r\nimport Tools from \"@/game/ui/tools/tools.vue\";\r\nimport DmSettings from \"./ui/dmsettings.vue\";\r\n\r\nimport { createConnection, socket } from \"@/game/api/socket\";\r\nimport { onKeyDown, onKeyUp } from \"@/game/events/keyboard\";\r\nimport { scrollZoom } from \"@/game/events/mouse\";\r\nimport { layerManager } from \"@/game/layers/manager\";\r\nimport { gameStore } from \"@/game/store\";\r\nimport { l2g } from \"@/game/units\";\r\nimport { LocalPoint } from \"./geom\";\r\nimport { dropAsset } from \"./layers/utils\";\r\n\r\n@Component({\r\n    components: {\r\n        \"tool-bar\": Tools,\r\n        \"selection-info\": SelectionInfo,\r\n        \"prompt-dialog\": Prompt,\r\n        \"confirm-dialog\": ConfirmDialog,\r\n        \"menu-bar\": MenuBar,\r\n        \"initiative-dialog\": Initiative,\r\n        \"zoom-slider\": vueSlider,\r\n        \"note-dialog\": NoteDialog,\r\n        \"label-dialog\": LabelManager,\r\n        \"dm-settings\": DmSettings,\r\n    },\r\n    beforeRouteEnter(to, from, next) {\r\n        createConnection(to);\r\n        next();\r\n    },\r\n    beforeRouteLeave(to, from, next) {\r\n        socket.disconnect();\r\n        next();\r\n    },\r\n})\r\nexport default class Game extends Vue {\r\n    $refs!: {\r\n        confirm: InstanceType<typeof ConfirmDialog>;\r\n        note: InstanceType<typeof NoteDialog>;\r\n        prompt: InstanceType<typeof Prompt>;\r\n        tools: InstanceType<typeof Tools>;\r\n    };\r\n\r\n    ready = {\r\n        manager: false,\r\n        tools: false,\r\n    };\r\n\r\n    throttledmoveSet = false;\r\n    throttledmove: (event: MouseEvent) => void = (_event: MouseEvent) => {};\r\n\r\n    get showUI(): boolean {\r\n        return gameStore.showUI;\r\n    }\r\n\r\n    get IS_DM(): boolean {\r\n        return gameStore.IS_DM;\r\n    }\r\n\r\n    get FAKE_PLAYER(): boolean {\r\n        return gameStore.FAKE_PLAYER;\r\n    }\r\n\r\n    get layers(): string[] {\r\n        return gameStore.layers;\r\n    }\r\n\r\n    get selectedLayer(): string {\r\n        return gameStore.selectedLayer;\r\n    }\r\n\r\n    get zoomDisplay(): number {\r\n        return gameStore.zoomDisplay;\r\n    }\r\n\r\n    set zoomDisplay(value: number) {\r\n        gameStore.updateZoom({\r\n            newZoomDisplay: value,\r\n            zoomLocation: l2g(new LocalPoint(window.innerWidth / 2, window.innerHeight / 2)),\r\n        });\r\n    }\r\n\r\n    mounted() {\r\n        window.addEventListener(\"resize\", this.resizeWindow);\r\n        window.addEventListener(\"keyup\", onKeyUp);\r\n        window.addEventListener(\"keydown\", onKeyDown);\r\n        this.ready.manager = true;\r\n    }\r\n\r\n    destroyed() {\r\n        window.removeEventListener(\"resize\", this.resizeWindow);\r\n        window.removeEventListener(\"keyup\", onKeyUp);\r\n        window.removeEventListener(\"keydown\", onKeyDown);\r\n        this.ready.manager = false;\r\n    }\r\n\r\n    // Window events\r\n\r\n    zoom(event: WheelEvent) {\r\n        throttle(scrollZoom)(event);\r\n    }\r\n\r\n    resizeWindow() {\r\n        layerManager.setWidth(window.innerWidth);\r\n        layerManager.setHeight(window.innerHeight);\r\n        layerManager.invalidate();\r\n    }\r\n\r\n    // Mouse events\r\n\r\n    mousedown(event: MouseEvent) {\r\n        this.$refs.tools.mousedown(event);\r\n    }\r\n    mouseup(event: MouseEvent) {\r\n        this.$refs.tools.mouseup(event);\r\n    }\r\n    mousemove(event: MouseEvent) {\r\n        if (!this.throttledmoveSet) {\r\n            this.throttledmoveSet = true;\r\n            this.throttledmove = throttle(this.$refs.tools.mousemove, 15);\r\n        }\r\n        this.throttledmove(event);\r\n    }\r\n    mouseleave(event: MouseEvent) {\r\n        this.$refs.tools.mouseleave(event);\r\n    }\r\n    contextmenu(event: MouseEvent) {\r\n        this.$refs.tools.contextmenu(event);\r\n    }\r\n    selectLayer(layer: string) {\r\n        layerManager.selectLayer(layer);\r\n    }\r\n    drop(event: DragEvent) {\r\n        if (event === null || event.dataTransfer === null) return;\r\n        if (event.dataTransfer.files.length > 0) {\r\n            this.$refs.confirm.open(\"Uploading files should be done through the asset manager.\", \"Ok\", \"\").then(\r\n                () => {},\r\n                () => {},\r\n            );\r\n        } else if (event.dataTransfer.getData(\"text/plain\") === \"\") {\r\n            return;\r\n        } else {\r\n            dropAsset(event);\r\n        }\r\n    }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./game.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./game.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./game.vue?vue&type=template&id=ec4a3cb8&scoped=true&\"\nimport script from \"./game.vue?vue&type=script&lang=ts&\"\nexport * from \"./game.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./game.vue?vue&type=style&index=0&lang=css&\"\nimport style1 from \"./game.vue?vue&type=style&index=1&id=ec4a3cb8&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"ec4a3cb8\",\n  null\n  \n)\n\nexport default component.exports","import Axios, { AxiosError, AxiosResponse } from \"axios\";\r\nimport Vue from \"vue\";\r\nimport Component from \"vue-class-component\";\r\nimport { Route } from \"vue-router\";\r\n\r\n@Component({ template: \"\" })\r\nexport default class Initiative extends Vue {\r\n    beforeRouteEnter(to: Route, from: Route, next: (nextInfo: { path: string }) => {}): void {\r\n        Axios.post(\"/api/invite\", {\r\n            code: to.params.code,\r\n        })\r\n            .then((response: AxiosResponse) => {\r\n                next({ path: response.data.sessionUrl });\r\n            })\r\n            .catch((_error: AxiosError) => {\r\n                console.error(\"Invitation code could not be redeemed\");\r\n                next({ path: \"/dashboard\" });\r\n            });\r\n    }\r\n}\r\n","// import \"./class-component-hooks\";\r\n\r\nimport axios, { AxiosResponse } from \"axios\";\r\nimport Vue from \"vue\";\r\nimport Router from \"vue-router\";\r\n\r\nVue.use(Router);\r\n\r\nimport AssetManager from \"@/assetManager/manager.vue\";\r\nimport Login from \"@/auth/login.vue\";\r\nimport Logout from \"@/auth/logout\";\r\nimport LoadComponent from \"@/core/components/load.vue\";\r\nimport Dashboard from \"@/dashboard/main.vue\";\r\nimport Game from \"@/game/game.vue\";\r\nimport Invitation from \"@/invitation/invitation\";\r\n\r\nimport { coreStore } from \"@/core/store\";\r\n// import { AssetManager } from \"./assetManager/assets\";\r\n// const AssetManager = () => import(\"./assetManager/assets\").then(m => m.AssetManager);\r\n\r\nexport const router = new Router({\r\n    mode: \"history\",\r\n    base: process.env.BASE_URL,\r\n    routes: [\r\n        {\r\n            path: \"/\",\r\n            redirect: \"/dashboard\",\r\n        },\r\n        {\r\n            path: \"/_load\",\r\n            name: \"load\",\r\n            component: LoadComponent,\r\n        },\r\n        {\r\n            path: \"/assets\",\r\n            component: AssetManager,\r\n            meta: {\r\n                auth: true,\r\n            },\r\n        },\r\n        {\r\n            path: \"/auth\",\r\n            component: { template: \"<router-view></router-view>\" },\r\n            children: [\r\n                { path: \"login\", component: Login },\r\n                { path: \"logout\", component: Logout },\r\n            ],\r\n        },\r\n        {\r\n            path: \"/invite/:code\",\r\n            component: Invitation,\r\n            meta: {\r\n                auth: true,\r\n            },\r\n        },\r\n        {\r\n            path: \"/dashboard\",\r\n            component: Dashboard,\r\n            meta: {\r\n                auth: true,\r\n            },\r\n        },\r\n        {\r\n            path: \"/game/:creator/:room\",\r\n            component: Game,\r\n            meta: {\r\n                auth: true,\r\n            },\r\n        },\r\n    ],\r\n});\r\n\r\nrouter.beforeEach((to, from, next) => {\r\n    if (!coreStore.initialized && to.path !== \"/_load\") {\r\n        next({ path: \"/_load\" });\r\n        axios\r\n            .get(\"/api/auth\")\r\n            .then((response: AxiosResponse) => {\r\n                if (response.data.auth) {\r\n                    coreStore.setAuthenticated(true);\r\n                    coreStore.setUsername(response.data.username);\r\n                }\r\n                coreStore.setInitialized(true);\r\n                router.push(to.path);\r\n            })\r\n            .catch(() => {\r\n                console.error(\"Authentication check could not be fulfilled.\");\r\n            });\r\n    } else if (to.matched.some(record => record.meta.auth) && !coreStore.authenticated) {\r\n        next({ path: \"/auth/login\", query: { redirect: to.path } });\r\n    } else {\r\n        next();\r\n    }\r\n});\r\n","import Vue from \"vue\";\r\n\r\nimport App from \"@/App.vue\";\r\nimport { router } from \"@/router\";\r\nimport { rootStore } from \"@/store\";\r\n\r\nVue.config.productionTip = false;\r\nVue.config.devtools = true;\r\nVue.config.performance = true;\r\n\r\nexport const app = new Vue({\r\n    router,\r\n    store: rootStore,\r\n    render: h => h(App),\r\n}).$mount(\"#app\");\r\n\r\n(<any>window).app = app;\r\n","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./main.vue?vue&type=style&index=0&id=f34c77ee&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./main.vue?vue&type=style&index=0&id=f34c77ee&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./filter.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./filter.vue?vue&type=style&index=0&lang=css&\"","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./inputCopy.vue?vue&type=style&index=0&id=628dde30&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./inputCopy.vue?vue&type=style&index=0&id=628dde30&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./confirm.vue?vue&type=style&index=0&id=46dc898b&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./confirm.vue?vue&type=style&index=0&id=46dc898b&scoped=true&lang=css&\""],"sourceRoot":""}