(function(e){function t(t){for(var s,o,a=t[0],l=t[1],c=t[2],u=0,d=[];u<a.length;u++)o=a[u],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&d.push(n[o][0]),n[o]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);h&&h(t);while(d.length)d.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var e,t=0;t<r.length;t++){for(var i=r[t],s=!0,a=1;a<i.length;a++){var l=i[a];0!==n[l]&&(s=!1)}s&&(r.splice(t--,1),e=o(o.s=i[0]))}return e}var s={},n={app:0},r=[];function o(t){if(s[t])return s[t].exports;var i=s[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=s,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(i,s,function(t){return e[t]}.bind(null,s));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],l=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var h=l;r.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("cd49")},"034f":function(e,t,i){"use strict";var s=i("85ec"),n=i.n(s);n.a},"0777":function(e,t,i){},"0a1c":function(e,t,i){},"0b57":function(e,t,i){"use strict";var s=i("fe8d"),n=i.n(s);n.a},"0b9a":function(e,t,i){"use strict";var s=i("cbee"),n=i.n(s);n.a},1:function(e,t){},1133:function(e,t,i){"use strict";var s=i("46cb"),n=i.n(s);n.a},"12d3":function(e,t,i){"use strict";var s=i("0777"),n=i.n(s);n.a},1397:function(e,t,i){},"1e6f":function(e,t,i){"use strict";var s=i("c302"),n=i.n(s);n.a},"223f":function(e,t,i){"use strict";var s=i("4d02"),n=i.n(s);n.a},2457:function(e,t,i){"use strict";var s=i("8d75"),n=i.n(s);n.a},"2eb7":function(e,t,i){"use strict";var s=i("1397"),n=i.n(s);n.a},"34be":function(e,t,i){"use strict";var s=i("0a1c"),n=i.n(s);n.a},"35ee":function(e,t,i){},3730:function(e,t,i){},"3abf":function(e,t,i){},"3ba3":function(e,t,i){"use strict";var s=i("a7fc"),n=i.n(s);n.a},"3cb3":function(e,t,i){"use strict";var s=i("88bf"),n=i.n(s);n.a},4122:function(e,t,i){"use strict";var s=i("de79"),n=i.n(s);n.a},"46cb":function(e,t,i){},"4a14":function(e,t,i){"use strict";var s=i("6538"),n=i.n(s);n.a},"4d02":function(e,t,i){},"561b":function(e,t,i){"use strict";var s=i("69e8"),n=i.n(s);n.a},"59fe":function(e,t,i){"use strict";var s=i("8991"),n=i.n(s);n.a},"5d8d":function(e,t,i){"use strict";var s=i("f459"),n=i.n(s);n.a},"618e":function(e,t,i){"use strict";var s=i("c58f"),n=i.n(s);n.a},6538:function(e,t,i){},"69e8":function(e,t,i){},7392:function(e,t,i){"use strict";var s=i("d4ff"),n=i.n(s);n.a},"747b":function(e,t,i){"use strict";var s=i("3abf"),n=i.n(s);n.a},"78c7":function(e,t,i){"use strict";var s=i("3730"),n=i.n(s);n.a},"7f1e":function(e,t,i){"use strict";var s=i("35ee"),n=i.n(s);n.a},"85ec":function(e,t,i){},"88bf":function(e,t,i){},8991:function(e,t,i){},"8d75":function(e,t,i){},96178:function(e,t,i){"use strict";var s=i("f0dc"),n=i.n(s);n.a},a10f:function(e,t,i){"use strict";var s=i("e7bf"),n=i.n(s);n.a},a3fa:function(e,t,i){},a7fc:function(e,t,i){},aa79:function(e,t,i){"use strict";var s=i("c76b"),n=i.n(s);n.a},ab66:function(e,t,i){"use strict";var s=i("fa96"),n=i.n(s);n.a},b831:function(e,t,i){},c302:function(e,t,i){},c58f:function(e,t,i){},c76b:function(e,t,i){},cbee:function(e,t,i){},cd49:function(e,t,i){"use strict";i.r(t);var s=i("a026"),n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("router-view",{ref:"activeComponent"})],1)},r=[],o=(i("034f"),i("2877")),a={},l=Object(o["a"])(a,n,r,!1,null,null,null),c=l.exports,h=i("bc3a"),u=i.n(h),d=i("8c4f"),p=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"AssetManager"}},[i("div",{attrs:{id:"titlebar"}},[e._v("Asset Manager")]),i("div",{attrs:{id:"main"}},[i("div",{attrs:{id:"assets"},on:{dragover:function(t){return t.preventDefault(),e.moveDrag(t)},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.stopDrag(t,e.currentFolder)}}},[i("div",{attrs:{id:"breadcrumbs"}},[i("div",[e._v("/")]),e._l(e.path,(function(t){return i("div",{key:t},[e._v(e._s(e.idMap.get(t).name))])}))],2),i("div",{attrs:{id:"actionbar"}},[i("input",{attrs:{id:"files",type:"file",multiple:"",hidden:""},on:{change:function(t){return e.upload()}}}),i("div",{attrs:{title:"Create folder"},on:{click:e.createDirectory}},[i("i",{staticClass:"fas fa-plus-square"})]),i("div",{attrs:{title:"Upload files"},on:{click:e.prepareUpload}},[i("i",{staticClass:"fas fa-upload"})])]),i("div",{attrs:{id:"explorer"}},[e.path.length?i("div",{staticClass:"inode folder",on:{dblclick:function(t){return e.changeDirectory(-1)},dragover:function(t){return t.preventDefault(),e.moveDrag(t)},dragleave:function(t){return t.preventDefault(),e.leaveDrag(t)},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.stopDrag(t,e.parentFolder)}}},[i("i",{staticClass:"fas fa-folder",staticStyle:{"font-size":"50px"}}),i("div",{staticClass:"title"},[e._v("..")])]):e._e(),e._l(e.folders,(function(t){return i("div",{key:t,staticClass:"inode folder",class:{"inode-selected":e.selected.includes(t)},attrs:{draggable:"true"},on:{click:function(i){return e.select(i,t)},dblclick:function(i){return e.changeDirectory(t)},contextmenu:function(i){return i.preventDefault(),e.$refs.cm.open(i,t)},dragstart:function(i){return e.startDrag(i,t)},dragover:function(t){return t.preventDefault(),e.moveDrag(t)},dragleave:function(t){return t.preventDefault(),e.leaveDrag(t)},drop:function(i){return i.preventDefault(),i.stopPropagation(),e.stopDrag(i,t)}}},[i("i",{staticClass:"fas fa-folder",staticStyle:{"font-size":"50px"}}),i("div",{staticClass:"title"},[e._v(e._s(e.idMap.get(t).name))])])})),e._l(e.files,(function(t){return i("div",{key:t,staticClass:"inode file",class:{"inode-selected":e.selected.includes(t)},attrs:{draggable:"true"},on:{click:function(i){return e.select(i,t)},contextmenu:function(i){return i.preventDefault(),e.$refs.cm.open(i,t)},dragstart:function(i){return e.startDrag(i,t)}}},[i("img",{attrs:{src:"/static/assets/"+e.idMap.get(t).file_hash,width:"50"}}),i("div",{staticClass:"title"},[e._v(e._s(e.idMap.get(t).name))])])}))],2)]),e.firstSelectedFile?i("div",{attrs:{id:"asset-details"}},[i("div",{attrs:{id:"asset-detail-title"}},[e._v(e._s(e.firstSelectedFile.name))]),i("img",{attrs:{src:"/static/assets/"+e.firstSelectedFile.file_hash}})]):e._e()]),i("AssetContextMenu",{ref:"cm"}),i("Prompt",{ref:"prompt"}),i("ConfirmDialog",{ref:"confirm"})],1)},v=[],f=(i("e260"),i("2532"),i("ddb0"),i("9ab4")),g=i("2fe1"),m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContextMenu",{attrs:{visible:e.visible,left:e.left+"px",top:e.top+"px"},on:{close:e.close}},[i("li",{on:{click:e.rename}},[e._v("Rename")]),i("li",{on:{click:e.remove}},[e._v("Remove")])])},b=[],y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.visible?i("div",{staticClass:"ContextMenu",style:{left:e.left,top:e.top},attrs:{tabindex:"-1"},on:{blur:function(t){return e.$emit("close")}}},[i("ul",[e._t("default")],2)]):e._e()},w=[],x=class extends s["default"]{};x=Object(f["a"])([Object(g["b"])({props:["visible","left","top"]})],x);var S=x,C=S,_=(i("7f1e"),Object(o["a"])(C,y,w,!1,null,null,null)),O=_.exports,k=i("8055"),L=i.n(k),E=i("6fc5"),I=i("2f62");s["default"].use(I["a"]);var P=new I["a"].Store({}),M=class extends E["d"]{constructor(){super(...arguments),this.root=-1,this.files=[],this.folders=[],this.idMap=new Map,this.selected=[]}clear(){this.folders=[],this.files=[]}clearSelected(){console.log("Cleared"),this.selected=[]}setRoot(e){this.root=e}};Object(f["a"])([E["c"]],M.prototype,"clear",null),Object(f["a"])([E["c"]],M.prototype,"clearSelected",null),Object(f["a"])([E["c"]],M.prototype,"setRoot",null),M=Object(f["a"])([Object(E["b"])({dynamic:!0,store:P,name:"assets",namespaced:!0})],M);var T=Object(E["e"])(M),A=L()(location.protocol+"//"+location.host+"/pa_assetmgmt",{autoConnect:!1});A.on("connect",()=>{console.log("Connected")}),A.on("disconnect",()=>{console.log("Disconnected")}),A.on("redirect",e=>{console.log("redirecting"),window.location.href=e}),A.on("Folder.Root.Set",e=>{T.setRoot(e)}),A.on("Folder.Set",e=>{if(T.clear(),e.children)for(var t of e.children)T.idMap.set(t.id,t),t.file_hash?T.files.push(t.id):T.folders.push(t.id)}),A.on("Folder.Create",e=>{T.folders.push(e.id),T.idMap.set(e.id,e)}),A.on("Asset.Upload.Finish",e=>{T.idMap.set(e.id,e),T.files.push(e.id)});var D=class extends s["default"]{constructor(){super(...arguments),this.visible=!1,this.left=0,this.top=0}get parent(){return this.$parent}open(e,t){T.selected.includes(t)||this.parent.select(e,t),this.visible=!0,this.left=e.pageX,this.top=e.pageY,this.$nextTick(()=>{this.$children[0].$el.focus()})}close(){this.visible=!1}rename(){if(1===T.selected.length){var e=T.idMap.get(T.selected[0]);this.parent.$refs.prompt.prompt("New name:","Renaming ".concat(e.name)).then(t=>{A.emit("Asset.Rename",{asset:e.id,name:t}),e.name=t,this.parent.$forceUpdate()},()=>{}),this.close()}}remove(){0!==T.selected.length&&(this.parent.$refs.confirm.open("Are you sure you wish to remove this?").then(e=>{if(e){for(var t of T.selected)A.emit("Asset.Remove",t),T.files.includes(t)?T.files.splice(T.files.indexOf(t),1):T.folders.splice(T.folders.indexOf(t),1);T.clearSelected()}},()=>{}),this.close())}};D=Object(f["a"])([Object(g["b"])({components:{ContextMenu:O}})],D);var R=D,N=R,U=Object(o["a"])(N,m,b,!1,null,null,null),j=U.exports,z=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible},on:{close:e.close},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v(" "+e._s(e.title)+" ")])}}])},[i("div",{staticClass:"modal-body"},[i("button",{ref:"confirm",on:{click:e.confirm}},[e._v(e._s(e.yes))]),e.no?i("button",{on:{click:e.deny}},[e._v(e._s(e.no))]):e._e()])])},$=[],F=(i("e6cf"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"modal"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"mask",class:{"modal-mask":e.mask,"dialog-mask":!e.mask},on:{click:e.close,dragover:function(t){return t.preventDefault(),e.dragOver(t)}}},[i("div",{ref:"container",staticClass:"modal-container",style:{"background-color":e.colour},on:{click:function(e){e.stopPropagation()}}},[e._t("header",null,{dragStart:e.dragStart,dragEnd:e.dragEnd}),e._t("default")],2)])])}),V=[],H=i("60a3"),B=class extends s["default"]{constructor(){super(...arguments),this.positioned=!1,this.offsetX=0,this.offsetY=0,this.screenX=0,this.screenY=0,this.dragging=!1}mounted(){this.updatePosition()}updated(){this.updatePosition()}close(e){this.$emit("close")}updatePosition(){if(!this.positioned){var e=this.$refs.container;if(0===e.offsetWidth&&0===e.offsetHeight)return;this.$refs.container.style.left=(window.innerWidth-e.offsetWidth)/2+"px",this.$refs.container.style.top=(window.innerHeight-e.offsetHeight)/2+"px",this.positioned=!0}}dragStart(e){null!==e&&null!==e.dataTransfer&&(e.dataTransfer.setData("Hack",""),e.dataTransfer.setDragImage(this.$refs.container,e.offsetX,e.offsetY),this.offsetX=e.offsetX,this.offsetY=e.offsetY,this.screenX=e.screenX,this.screenY=e.screenY,this.dragging=!0)}dragEnd(e){this.dragging=!1;var t=e.clientX-this.offsetX,i=e.clientY-this.offsetY;0===e.clientX&&0===e.clientY&&0===e.pageX&&0===e.pageY&&(t=parseInt(this.$refs.container.style.left,10)-(this.screenX-e.screenX),i=parseInt(this.$refs.container.style.top,10)-(this.screenY-e.screenY)),t<0&&(t=0),t>window.innerWidth-100&&(t=window.innerWidth-100),i<0&&(i=0),i>window.innerHeight-100&&(i=window.innerHeight-100),this.$refs.container.style.left=t+"px",this.$refs.container.style.top=i+"px",this.$refs.container.style.display="block"}dragOver(e){this.dragging&&(this.$refs.container.style.display="none")}};Object(f["a"])([Object(H["a"])(Boolean)],B.prototype,"visible",void 0),Object(f["a"])([Object(H["a"])({type:Boolean,default:!0})],B.prototype,"mask",void 0),Object(f["a"])([Object(H["a"])({type:String,default:"white"})],B.prototype,"colour",void 0),B=Object(f["a"])([g["b"]],B);var G=B,W=G,X=(i("618e"),Object(o["a"])(W,F,V,!1,null,"2098e4f8",null)),Y=X.exports,K=class extends s["default"]{constructor(){super(...arguments),this.visible=!1,this.yes="Yes",this.no="No",this.title="",this.resolve=e=>{},this.reject=()=>{}}confirm(){this.resolve(!0),this.close()}deny(){this.resolve(!1),this.close()}close(){this.reject(),this.visible=!1,this.title=""}open(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yes",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"no";return this.yes=t,this.no=i,this.title=e,this.visible=!0,this.$nextTick(()=>{this.$refs.confirm.focus()}),new Promise((e,t)=>{this.resolve=e,this.reject=t})}};K=Object(f["a"])([Object(g["b"])({components:{Modal:Y}})],K);var q=K,Q=q,Z=(i("fb5d"),Object(o["a"])(Q,z,$,!1,null,"46dc898b",null)),J=Z.exports,ee=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible},on:{close:e.close},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v(" "+e._s(e.title)+" ")])}}])},[i("div",{staticClass:"modal-body"},[e._v(" "+e._s(e.question)+" "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.answer,expression:"answer"}],ref:"answer",attrs:{type:"text"},domProps:{value:e.answer},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)},input:function(t){t.target.composing||(e.answer=t.target.value)}}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.submit}},[e._v("Submit")])])])},te=[],ie=class extends s["default"]{constructor(){super(...arguments),this.visible=!1,this.question="",this.answer="",this.title="",this.resolve=e=>{},this.reject=()=>{}}submit(){this.resolve(this.answer),this.close()}close(){this.reject(),this.visible=!1,this.question="",this.answer="",this.title=""}prompt(e,t){return this.question=e,this.title=t,this.visible=!0,this.$nextTick(()=>{this.$refs.answer.focus()}),new Promise((e,t)=>{this.resolve=e,this.reject=t})}};ie=Object(f["a"])([Object(g["b"])({components:{Modal:Y}})],ie);var se=ie,ne=se,re=(i("1133"),Object(o["a"])(ne,ee,te,!1,null,"391b52fc",null)),oe=re.exports;i("25f0"),i("5319"),i("1276");function ae(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{var t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16)})}function le(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1}function ce(e,t){var i=[[],[]];return e.forEach(e=>t(e)?i[1].push(e):i[0].push(e)),i}function he(e,t,i){var s=e.measureText(t).width,n=1.5*Number(e.font.split("px")[0]);return 2*Math.cos(Math.atan(n/s))*i/s}var ue=class extends s["default"]{constructor(){super(...arguments),this.path=[],this.draggingSelection=!1}get folders(){return T.folders}get files(){return T.files}get selected(){return T.selected}get idMap(){return T.idMap}get currentFolder(){return this.path.length?this.path[this.path.length-1]:T.root}get parentFolder(){var e=this.path[this.path.length-2];return void 0===e&&(e=T.root),e}get firstSelectedFile(){for(var e of T.selected)if(T.idMap.get(e).file_hash)return T.idMap.get(e);return null}changeDirectory(e){e<0?this.path.pop():this.path.push(e),T.clearSelected(),A.emit("Folder.Get",this.currentFolder)}createDirectory(){var e=window.prompt("New folder name");null!==e&&A.emit("Folder.Create",{name:e,parent:this.currentFolder})}moveInode(e,t){T.files.includes(e)?T.files.splice(T.files.indexOf(e),1):T.folders.splice(T.folders.indexOf(e),1),T.idMap.delete(e),A.emit("Inode.Move",{inode:e,target:t})}select(e,t){if(e.shiftKey&&T.selected.length>0){for(var i=[...T.files,...T.folders],s=i.indexOf(T.selected[T.selected.length-1]),n=i.indexOf(t),r=s;r!==n;s<n?r++:r--)r!==s&&T.selected.push(i[r]);T.selected.push(i[n])}else e.ctrlKey||T.clearSelected(),T.selected.push(t)}startDrag(e,t){null!==e.dataTransfer&&(e.dataTransfer.setData("Hack","ittyHack"),e.dataTransfer.dropEffect="move",T.selected.includes(t)||T.selected.push(t),this.draggingSelection=!0)}moveDrag(e){e.target.classList.contains("folder")&&e.target.classList.add("inode-selected")}leaveDrag(e){e.target.classList.contains("folder")&&e.target.classList.remove("inode-selected")}stopDrag(e,t){if(e.target.classList.remove("inode-selected"),this.draggingSelection){if((t===T.root||T.folders.includes(t))&&!T.selected.includes(t))for(var i of T.selected)this.moveInode(i,t);T.clearSelected()}else e.dataTransfer&&e.dataTransfer.files.length>0&&this.upload(e.dataTransfer.files,t);this.draggingSelection=!1}prepareUpload(){document.getElementById("files").click()}upload(e,t){var i=document.getElementById("files").files;if(void 0===e){if(!i)return;e=i}void 0===t&&(t=this.currentFolder);var s=1e5,n=function(e){for(var i=ae(),n=Math.ceil(e.size/s),r=function(r){var o=new FileReader;o.readAsArrayBuffer(e.slice(r*s,r*s+Math.min(s,e.size-r*s))),o.onload=s=>{A.emit("Asset.Upload",{name:e.name,directory:t,data:o.result,slice:r,totalSlices:n,uuid:i})}},o=0;o<n;o++)r(o)};for(var r of e)n(r)}};ue=Object(f["a"])([Object(g["b"])({components:{Prompt:oe,ConfirmDialog:J,AssetContextMenu:j},beforeRouteEnter(e,t,i){A.connect(),i()},beforeRouteLeave(e,t,i){A.disconnect(),i()}})],ue);var de=ue,pe=de,ve=(i("78c7"),Object(o["a"])(pe,p,v,!1,null,null,null)),fe=ve.exports,ge=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("form",{on:{focusin:e.focusin,focusout:e.focusout,submit:function(t){return t.preventDefault(),e.login(t)}}},[i("fieldset",[i("legend",{staticClass:"legend"},[e._v("PlanarAlly")]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{type:"text",name:"username",placeholder:"Username",autocomplete:"username",required:"",autofocus:""},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}}),e._m(0)]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password",name:"password",placeholder:"Password",autocomplete:"current-password",required:""},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),e._m(1)]),i("div",{staticStyle:{display:"flex"}},[i("button",{staticStyle:{visibility:"hidden",display:"none"},attrs:{type:"submit",name:"login"}}),i("button",{staticClass:"submit",attrs:{type:"button",name:"register",title:"Register"},on:{click:e.register}},[i("i",{staticClass:"fas fa-plus"})]),e._m(2)])]),e.error?i("div",{staticClass:"feedback"},[i("p",{staticClass:"error"},[i("strong",[e._v("Error:")]),e._v(" "+e._s(e.error)+" ")])]):e._e()])},me=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fas fa-user-circle"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fas fa-lock"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("button",{staticClass:"submit",attrs:{type:"submit",name:"login",title:"Login"}},[i("i",{staticClass:"fas fa-arrow-right"})])}],be=class extends E["d"]{constructor(){super(...arguments),this.authenticated=!1,this.initialized=!1,this.username=""}setAuthenticated(e){this.authenticated=e}setInitialized(e){this.initialized=e}setUsername(e){this.username=e}};Object(f["a"])([E["c"]],be.prototype,"setAuthenticated",null),Object(f["a"])([E["c"]],be.prototype,"setInitialized",null),Object(f["a"])([E["c"]],be.prototype,"setUsername",null),be=Object(f["a"])([Object(E["b"])({dynamic:!0,store:P,name:"core"})],be);var ye=Object(E["e"])(be),we=class extends s["default"]{constructor(){super(...arguments),this.username="",this.password="",this.error=""}login(){u.a.post("/api/login",{username:this.username,password:this.password}).then(e=>{ye.setUsername(this.username),ye.setAuthenticated(!0),this.$router.push(this.$route.query.redirect||"/")}).catch(e=>{e.response?this.error=e.response.statusText:this.error="Unknown error occured"})}register(){u.a.post("/api/register",{username:this.username,password:this.password}).then(e=>{ye.setUsername(this.username),ye.setAuthenticated(!0),this.$router.push(this.$route.query.redirect||"/")}).catch(e=>{e.response?this.error=e.response.statusText:this.error="Unknown error occured"})}focusin(e){if(e.target&&e.target.nextElementSibling){var t=e.target.nextElementSibling;t.style.opacity="0"}}focusout(e){if(e.target&&e.target.nextElementSibling){var t=e.target.nextElementSibling;t.style.opacity="1"}}};we=Object(f["a"])([g["b"]],we);var xe=we,Se=xe,Ce=(i("3cb3"),Object(o["a"])(Se,ge,me,!1,null,"986db5b0",null)),_e=Ce.exports;g["b"].registerHooks(["beforeRouteEnter"]);var Oe=class extends s["default"]{beforeRouteEnter(e,t,i){u.a.post("/api/logout").then(()=>{ye.setAuthenticated(!1),ye.setUsername(""),i({path:"/auth/login"})})}};Oe=Object(f["a"])([Object(g["b"])({})],Oe);var ke=Oe,Le=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e._v(e._s(e.message))])},Ee=[],Ie=class extends s["default"]{constructor(){super(...arguments),this.message="Loading..."}};Ie=Object(f["a"])([g["b"]],Ie);var Pe=Ie,Me=Pe,Te=Object(o["a"])(Me,Le,Ee,!1,null,null,null),Ae=Te.exports,De=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"formcontainer"}},[e.owned||e.joined?i("form",[i("fieldset",[i("legend",{staticClass:"legend"},[e._v("Your sessions")]),i("div",{staticClass:"input"},[e._l(e.owned,(function(t,s){return i("router-link",{key:"o-"+s,attrs:{to:"/game/"+encodeURIComponent(t[1])+"/"+encodeURIComponent(t[0])}},[e._v(" "+e._s(t[0])+" ")])})),e._l(e.joined,(function(t,s){return i("router-link",{key:"j-"+s,attrs:{to:"/game/"+encodeURIComponent(t[1])+"/"+encodeURIComponent(t[0])}},[e._v(" "+e._s(t[1])+"/"+e._s(t[0])+" ")])}))],2),0===e.owned.length?i("div",{staticClass:"input"},[e._v("No active sessions")]):e._e()])]):e._e(),e._m(0),i("form",{on:{submit:function(t){return t.preventDefault(),e.createRoom(t)}}},[i("fieldset",[e.owned||e.joined?i("div",{staticClass:"input"},[e._v("Create a new session")]):i("legend",{staticClass:"legend"},[e._v("Create a session")]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.newSessionName,expression:"newSessionName"}],attrs:{type:"text",name:"room_name",placeholder:"Session Name"},domProps:{value:e.newSessionName},on:{input:function(t){t.target.composing||(e.newSessionName=t.target.value)}}}),e._m(1)]),e._m(2)])]),i("div",{attrs:{id:"account-options"}},[i("form",{on:{submit:function(e){e.preventDefault()}}},[i("router-link",{staticClass:"submit",attrs:{tag:"button",title:"Account Settings",to:"/account"}},[i("i",{staticClass:"fas fa-cog"})])],1),i("form",{on:{submit:function(e){e.preventDefault()}}},[i("router-link",{staticClass:"submit",attrs:{tag:"button",title:"Logout",to:"/auth/logout"}},[i("i",{staticClass:"fas fa-sign-out-alt"})])],1)])])},Re=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("h4",[i("span",[e._v("OR")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fab fa-d-and-d"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("button",{staticClass:"submit",attrs:{type:"submit",title:"Create"}},[i("i",{staticClass:"fas fa-arrow-right"})])}];g["b"].registerHooks(["beforeRouteEnter"]);var Ne=class extends s["default"]{constructor(){super(...arguments),this.owned=[],this.joined=[],this.error="",this.newSessionName=""}beforeRouteEnter(e,t,i){u.a.get("/api/rooms").then(e=>{i(t=>{t.owned=e.data.owned,t.joined=e.data.joined})}).catch(e=>{i(t=>{t.error=e.message})})}createRoom(e){u.a.post("/api/rooms",{name:this.newSessionName}).then(e=>{this.$router.push("/game/".concat(encodeURIComponent(ye.username),"/").concat(encodeURIComponent(this.newSessionName)))}).catch(e=>{this.error=e.message})}};Ne=Object(f["a"])([g["b"]],Ne);var Ue=Ne,je=Ue,ze=(i("d9e0"),Object(o["a"])(je,De,Re,!1,null,"f34c77ee",null)),$e=ze.exports,Fe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"main"},on:{mouseleave:e.mouseleave,wheel:e.zoom}},[e.showUI?i("menu-bar"):e._e(),i("div",{attrs:{id:"board"}},[e.ready.manager?[i("tool-bar",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],ref:"tools"})]:e._e(),i("div",{attrs:{id:"layers"},on:{mousedown:e.mousedown,mouseup:e.mouseup,mousemove:e.mousemove,contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.contextmenu(t)},dragover:function(e){e.preventDefault()},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.drop(t)}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showUI&&e.layers.length>1,expression:"showUI && layers.length > 1"}],attrs:{id:"layerselect"}},[i("ul",e._l(e.layers,(function(t){return i("li",{key:t.name,class:{"layer-selected":t===e.selectedLayer},on:{mousedown:function(i){return e.selectLayer(t)}}},[i("a",{attrs:{href:"#"}},[e._v(e._s(t))])])})),0)])],2),i("selection-info",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],ref:"selectionInfo"}),i("initiative-dialog",{ref:"initiative",attrs:{id:"initiativedialog"}}),i("note-dialog",{ref:"note"}),i("label-dialog",{ref:"labels"}),e.IS_DM||e.FAKE_PLAYER?i("dm-settings",{ref:"dmsettings"}):e._e(),i("zoom-slider",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],attrs:{id:"zoomer",height:6,width:200,min:0,max:1,interval:.1,"dot-size":[8,20],"dot-options":{style:{"border-radius":"15%","z-index":11}},"tooltip-placement":"bottom",tooltip:"focus","tooltip-formatter":e.zoomDisplay.toFixed(1),"rail-style":{"background-color":"#fff","box-shadow":"0.5px 0.5px 3px 1px rgba(0, 0, 0, .36)"},"process-style":{"background-color":"#fff"}},model:{value:e.zoomDisplay,callback:function(t){e.zoomDisplay=t},expression:"zoomDisplay"}}),i("prompt-dialog",{ref:"prompt"}),i("confirm-dialog",{ref:"confirm"})],1)},Ve=[],He=i("0f32"),Be=i.n(He),Ge=i("4971"),We=i.n(Ge),Xe=(i("24df"),L()(location.protocol+"//"+location.host+"/planarally",{autoConnect:!1}));function Ye(e){Xe.io.opts.query="user=".concat(decodeURIComponent(e.params.creator),"&room=").concat(decodeURIComponent(e.params.room)),Xe.connect()}var Ke=new s["default"];class qe{constructor(e,t){this.x=e,this.y=t}static fromArray(e){return new qe(e[0],e[1])}add(e){return new this.constructor(this.x+e.x,this.y+e.y)}subtract(e){return new Je(this.x-e.x,this.y-e.y)}clone(){return new this.constructor(this.x,this.y)}get(e){return 0===e?this.x:this.y}asArray(){return[this.x,this.y]}}class Qe extends qe{static fromArray(e){return new Qe(e[0],e[1])}}class Ze extends qe{}class Je{constructor(e,t){this.x=e,this.y=t}dot(e){return this.x*e.x+this.y*e.y}inverse(){return new Je(0===this.x?0:1/this.x,0===this.y?0:1/this.y)}squaredLength(){return Math.pow(this.x,2)+Math.pow(this.y,2)}length(){return Math.sqrt(this.squaredLength())}normalize(){var e=this.length();return new Je(this.x/e,this.y/e)}reverse(){return new Je(-this.x,-this.y)}multiply(e){return new Je(this.x*e,this.y*e)}angle(){return 180*Math.atan2(this.y,this.x)/Math.PI}}class et{constructor(e,t,i){this.direction=t,this.origin=e,void 0===i&&(i=1/0),this.tMax=i}static fromPoints(e,t){var i,s=new Je(t.x-e.x,t.y-e.y);return i=Math.abs(s.x)>.01?(t.x-e.x)/s.x:(t.y-e.y)/s.y,new et(e,s,i)}get(e){return new qe(this.origin.x+e*this.direction.x,this.origin.y+e*this.direction.y)}getDistance(e,t){return Math.sqrt(Math.pow(t-e,2)*(Math.pow(this.direction.x,2)+Math.pow(this.direction.y,2)))}getT(e,t){return e+Math.sqrt(Math.pow(t,2)/(Math.pow(this.direction.x,2)+Math.pow(this.direction.y,2)))}}function tt(e){Xe.emit("Client.Options.Set",{locationOptions:e})}function it(e){var t=yt.zoomFactor,i=yt.panX,s=yt.panY;return new Ze((e.x+i)*t,(e.y+s)*t)}function st(e){return it(new Qe(e,0)).x}function nt(e){return it(new Qe(0,e)).y}function rt(e){return e*yt.zoomFactor}function ot(e){return e/yt.unitSize*yt.gridSize}function at(e){return rt(ot(e))}function lt(e){var t=yt.zoomFactor,i=yt.panX,s=yt.panY;return e instanceof Ze?new Qe(e.x/t-i,e.y/t-s):new et(lt(e.origin),e.direction.multiply(1/t),e.tMax)}function ct(e){return lt(new Ze(e,0)).x}function ht(e){return lt(new Ze(0,e)).y}function ut(e){return e/yt.zoomFactor}window.g2lx=st,window.g2ly=nt;var dt=i("66cb"),pt=i.n(dt);function vt(e){return new Ze(e.pageX,e.pageY)}function ft(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=pt()(yt.fowColour);return yt.IS_DM?t.setAlpha(e?1:yt.fowOpacity):t.setAlpha(1),t.toRgbString()}function gt(e){return 1/(-5/3+28/15*Math.exp(1.83*e))}function mt(e){return Math.log(15/28*(1/e+5/3))/1.83}var bt=class extends E["d"]{constructor(){super(...arguments),this.layers=[],this.selectedLayerIndex=-1,this.boardInitialized=!1,this.locations=[],this.assets={},this.notes=[],this.IS_DM=!1,this.FAKE_PLAYER=!1,this.isLocked=!1,this.gridSize=50,this.username="",this.roomName="",this.roomCreator="",this.invitationCode="",this.players=[],this.gridColour="rgba(0, 0, 0, 1)",this.fowColour="rgba(0, 0, 0, 1)",this.rulerColour="rgba(255, 0, 0, 1)",this.panX=0,this.panY=0,this.zoomDisplay=.5,this.unitSize=5,this.unitSizeUnit="ft",this.useGrid=!0,this.fullFOW=!1,this.fowOpacity=.3,this.fowLOS=!1,this.locationName="",this.annotations=[],this.ownedtokens=[],this._activeTokens=[],this.drawTEContour=!1,this.visionRangeMin=1640,this.visionRangeMax=3281,this.clipboard=[],this.clipboardPosition=new Qe(0,0),this.labels={},this.filterNoLabel=!1,this.labelFilters=[],this.showUI=!0,this.selectionHelperID=null}get selectedLayer(){return this.layers[this.selectedLayerIndex]}get zoomFactor(){return gt(this.zoomDisplay)}get locationOptions(){return{panX:yt.panX,panY:yt.panY,zoomFactor:yt.zoomFactor}}get activeTokens(){return 0===this._activeTokens.length?this.ownedtokens:this._activeTokens}get screenTopLeft(){return new Qe(-this.panX,-this.panY)}get screenCenter(){var e=new Je(window.innerWidth/2,window.innerHeight/2);return lt(it(this.screenTopLeft).add(e))}setSelectionHelperId(e){this.selectionHelperID=e}setFakePlayer(e){this.FAKE_PLAYER=e,this.IS_DM=!e,xt.invalidate()}setZoomDisplay(e){e!==this.zoomDisplay&&(e<0&&(e=0),e>1&&(e=1),this.zoomDisplay=e,xt.invalidate())}setBoardInitialized(e){this.boardInitialized=e}toggleUnlabeledFilter(){this.filterNoLabel=!this.filterNoLabel}addLabel(e){s["default"].set(this.labels,e.uuid,e)}setLabelFilters(e){this.labelFilters=e}setLabelVisibility(e){e.uuid in this.labels&&(this.labels[e.uuid].visible=e.visible)}deleteLabel(e){if(e.uuid in this.labels){var t=this.labels[e.uuid],i=new Set;for(var n of xt.UUIDMap.values()){var r=n.labels.indexOf(t);r>=0&&(n.labels.splice(r,1),i.add(n.layer))}for(var o of i)xt.getLayer(o).invalidate(!1);s["default"].delete(this.labels,e.uuid)}}setDM(e){this.IS_DM=e}setUsername(e){this.username=e}setRoomName(e){this.roomName=e}setRoomCreator(e){this.roomCreator=e}setInvitationCode(e){this.invitationCode=e}addLayer(e){this.layers.push(e),-1===this.selectedLayerIndex&&(this.selectedLayerIndex=this.layers.indexOf(e))}selectLayer(e){var t=this.layers.indexOf(e.name);t>=0&&(this.selectedLayerIndex=t),e.sync&&Xe.emit("Client.ActiveLayer.Set",e.name)}newNote(e){this.notes.push(e.note),e.sync&&Xe.emit("Note.New",e.note)}setAssets(e){this.assets=e}setLocations(e){this.locations=e}resetLayerInfo(){this.layers=[],this.selectedLayerIndex=-1}updateZoom(e){if(e.newZoomDisplay!==this.zoomDisplay){e.newZoomDisplay<0&&(e.newZoomDisplay=0),e.newZoomDisplay>1&&(e.newZoomDisplay=1);var t=it(e.zoomLocation);this.zoomDisplay=e.newZoomDisplay;var i=lt(t),s=i.subtract(e.zoomLocation);this.panX+=s.x,this.panY+=s.y,xt.invalidate(),tt(yt.locationOptions)}}setGridColour(e){this.gridColour=e.colour,xt.getGridLayer().drawGrid(),e.sync&&Xe.emit("Client.Options.Set",{gridColour:e.colour})}setFOWColour(e){this.fowColour=e.colour,xt.invalidate(),e.sync&&Xe.emit("Client.Options.Set",{fowColour:e.colour})}setRulerColour(e){this.rulerColour=e.colour,e.sync&&Xe.emit("Client.Options.Set",{rulerColour:e.colour})}setPanX(e){this.panX=e}setPanY(e){this.panY=e}increasePanX(e){this.panX+=e}increasePanY(e){this.panY+=e}setUnitSize(e){this.unitSize!==e.unitSize&&e.unitSize>0&&e.unitSize<1/0&&(this.unitSize=e.unitSize,xt.invalidate(),e.sync&&Xe.emit("Location.Options.Set",{unit_size:e.unitSize}))}setUnitSizeUnit(e){this.unitSizeUnit!==e.unitSizeUnit&&(this.unitSizeUnit=e.unitSizeUnit,xt.invalidate(),e.sync&&Xe.emit("Location.Options.Set",{unit_size_unit:e.unitSizeUnit}))}setUseGrid(e){if(this.useGrid!==e.useGrid){this.useGrid=e.useGrid;var t=xt.getGridLayer();e.useGrid?t.canvas.style.display="block":t.canvas.style.display="none",e.sync&&Xe.emit("Location.Options.Set",{use_grid:e.useGrid})}}setGridSize(e){if(this.gridSize!==e.gridSize&&e.gridSize>0){this.gridSize=e.gridSize;var t=xt.getGridLayer();void 0!==t&&t.drawGrid(),e.sync&&Xe.emit("Gridsize.Set",e.gridSize)}}setVisionRangeMin(e){this.visionRangeMin=e.value,xt.invalidateLight(),e.sync&&Xe.emit("Location.Options.Set",{vision_min_range:e.value})}setVisionRangeMax(e){this.visionRangeMax=Math.max(e.value,this.visionRangeMin),xt.invalidateLight(),e.sync&&Xe.emit("Location.Options.Set",{vision_max_range:this.visionRangeMax})}setFullFOW(e){this.fullFOW!==e.fullFOW&&(this.fullFOW=e.fullFOW,xt.invalidateLight(),e.sync&&Xe.emit("Location.Options.Set",{full_fow:e.fullFOW}))}setFOWOpacity(e){this.fowOpacity=e.fowOpacity,xt.invalidateLight(),e.sync&&Xe.emit("Location.Options.Set",{fow_opacity:e.fowOpacity})}setLineOfSight(e){this.fowLOS!==e.fowLOS&&(this.fowLOS=e.fowLOS,xt.invalidate(),e.sync&&Xe.emit("Location.Options.Set",{fow_los:e.fowLOS}))}setLocationName(e){this.locationName=e}updateNote(e){var t=this.notes.find(t=>t.uuid===e.note.uuid);void 0!==t&&(t.title=e.note.title,t.text=e.note.text,e.sync&&Xe.emit("Note.Update",t))}removeNote(e){this.notes=this.notes.filter(t=>t.uuid!==e.note.uuid),e.sync&&Xe.emit("Note.Remove",e.note.uuid)}toggleUI(){this.showUI=!this.showUI}setClipboard(e){this.clipboard=e}setClipboardPosition(e){this.clipboardPosition=e}setActiveTokens(e){this._activeTokens=e,xt.invalidateLight()}addActiveToken(e){this._activeTokens.push(e),xt.invalidateLight()}removeActiveToken(e){0===this._activeTokens.length&&(this._activeTokens=[...this.ownedtokens]),this._activeTokens.splice(this._activeTokens.indexOf(e),1),xt.invalidateLight()}setPlayers(e){this.players=e}addPlayer(e){this.players.push(e)}kickPlayer(e){this.players=this.players.filter(t=>t.id!==e)}setIsLocked(e){this.isLocked=e.isLocked,e.sync&&Xe.emit("Room.Info.Set.Locked",this.isLocked)}clear(){this.ownedtokens=[],this.annotations=[],this.notes=[]}};Object(f["a"])([E["c"]],bt.prototype,"setSelectionHelperId",null),Object(f["a"])([E["c"]],bt.prototype,"setFakePlayer",null),Object(f["a"])([E["c"]],bt.prototype,"setZoomDisplay",null),Object(f["a"])([E["c"]],bt.prototype,"setBoardInitialized",null),Object(f["a"])([E["c"]],bt.prototype,"toggleUnlabeledFilter",null),Object(f["a"])([E["c"]],bt.prototype,"addLabel",null),Object(f["a"])([E["c"]],bt.prototype,"setLabelFilters",null),Object(f["a"])([E["c"]],bt.prototype,"setLabelVisibility",null),Object(f["a"])([E["c"]],bt.prototype,"deleteLabel",null),Object(f["a"])([E["c"]],bt.prototype,"setDM",null),Object(f["a"])([E["c"]],bt.prototype,"setUsername",null),Object(f["a"])([E["c"]],bt.prototype,"setRoomName",null),Object(f["a"])([E["c"]],bt.prototype,"setRoomCreator",null),Object(f["a"])([E["c"]],bt.prototype,"setInvitationCode",null),Object(f["a"])([E["c"]],bt.prototype,"addLayer",null),Object(f["a"])([E["c"]],bt.prototype,"selectLayer",null),Object(f["a"])([E["c"]],bt.prototype,"newNote",null),Object(f["a"])([E["c"]],bt.prototype,"setAssets",null),Object(f["a"])([E["c"]],bt.prototype,"setLocations",null),Object(f["a"])([E["c"]],bt.prototype,"resetLayerInfo",null),Object(f["a"])([E["c"]],bt.prototype,"updateZoom",null),Object(f["a"])([E["c"]],bt.prototype,"setGridColour",null),Object(f["a"])([E["c"]],bt.prototype,"setFOWColour",null),Object(f["a"])([E["c"]],bt.prototype,"setRulerColour",null),Object(f["a"])([E["c"]],bt.prototype,"setPanX",null),Object(f["a"])([E["c"]],bt.prototype,"setPanY",null),Object(f["a"])([E["c"]],bt.prototype,"increasePanX",null),Object(f["a"])([E["c"]],bt.prototype,"increasePanY",null),Object(f["a"])([E["c"]],bt.prototype,"setUnitSize",null),Object(f["a"])([E["c"]],bt.prototype,"setUnitSizeUnit",null),Object(f["a"])([E["c"]],bt.prototype,"setUseGrid",null),Object(f["a"])([E["c"]],bt.prototype,"setGridSize",null),Object(f["a"])([E["c"]],bt.prototype,"setVisionRangeMin",null),Object(f["a"])([E["c"]],bt.prototype,"setVisionRangeMax",null),Object(f["a"])([E["c"]],bt.prototype,"setFullFOW",null),Object(f["a"])([E["c"]],bt.prototype,"setFOWOpacity",null),Object(f["a"])([E["c"]],bt.prototype,"setLineOfSight",null),Object(f["a"])([E["c"]],bt.prototype,"setLocationName",null),Object(f["a"])([E["c"]],bt.prototype,"updateNote",null),Object(f["a"])([E["c"]],bt.prototype,"removeNote",null),Object(f["a"])([E["c"]],bt.prototype,"toggleUI",null),Object(f["a"])([E["c"]],bt.prototype,"setClipboard",null),Object(f["a"])([E["c"]],bt.prototype,"setClipboardPosition",null),Object(f["a"])([E["c"]],bt.prototype,"setActiveTokens",null),Object(f["a"])([E["c"]],bt.prototype,"addActiveToken",null),Object(f["a"])([E["c"]],bt.prototype,"removeActiveToken",null),Object(f["a"])([E["c"]],bt.prototype,"setPlayers",null),Object(f["a"])([E["c"]],bt.prototype,"addPlayer",null),Object(f["a"])([E["c"]],bt.prototype,"kickPlayer",null),Object(f["a"])([E["c"]],bt.prototype,"setIsLocked",null),Object(f["a"])([E["c"]],bt.prototype,"clear",null),bt=Object(f["a"])([Object(E["b"])({dynamic:!0,store:P,name:"game",namespaced:!0})],bt);var yt=Object(E["e"])(bt);class wt{constructor(){this.layers=[],this.width=window.innerWidth,this.height=window.innerHeight,this.UUIDMap=new Map,this.interval=30,this.drawLoop=()=>{for(var e=this.layers.length-1;e>=0;e--)this.layers[e].draw();requestAnimationFrame(this.drawLoop)},requestAnimationFrame(this.drawLoop)}reset(){this.layers=[],this.UUIDMap=new Map}setWidth(e){for(var t of(this.width=e,this.layers))t.canvas.width=e,t.width=e}setHeight(e){for(var t of(this.height=e,this.layers))t.canvas.height=e,t.height=e}addLayer(e){this.layers.push(e),(yt.IS_DM||e.playerEditable)&&e.selectable&&yt.addLayer(e.name)}hasLayer(e){return this.layers.some(t=>t.name===e)}getLayer(e){for(var t of(e=void 0===e?yt.selectedLayer:e,this.layers))if(t.name===e)return t}selectLayer(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!1;for(var s of this.layers)s.selectable&&(i&&"fow"!==s.name?s.ctx.globalAlpha=.3:s.ctx.globalAlpha=1,e===s.name&&(yt.selectLayer({name:e,sync:t}),i=!0),s.clearSelection(),s.invalidate(!0))}getGridLayer(){return this.getLayer("grid")}hasSelection(){var e=this.getSelection();return void 0!==e&&e.length>0}getSelection(){var e=this.getLayer();if(void 0!==e)return e.selection}invalidate(){for(var e=this.layers.length-1;e>=0;e--)this.layers[e].invalidate(!0)}invalidateLight(){for(var e=this.layers.length-1;e>=0;e--)this.layers[e].isVisionLayer&&this.layers[e].invalidate(!0)}}var xt=new wt;window.lm=xt;i("2b3d"),i("2ca0");class St{constructor(e,t,i){this.w=t,this.h=i,this.topLeft=e,this.topRight=new Qe(e.x+t,e.y),this.botRight=new Qe(e.x+t,e.y+i),this.botLeft=new Qe(e.x,e.y+i)}contains(e){return this.topLeft.x<=e.x&&this.topRight.x>=e.x&&this.topLeft.y<=e.y&&this.botLeft.y>=e.y}get points(){return 0===this.w||0===this.h?[[this.topLeft.x,this.topLeft.y]]:[[this.topLeft.x,this.topLeft.y],[this.botLeft.x,this.botLeft.y],[this.botRight.x,this.botRight.y],[this.topRight.x,this.topRight.y]]}offset(e){return new St(this.topLeft.add(e),this.w,this.h)}union(e){var t=Math.min(this.topLeft.x,e.topLeft.x),i=Math.max(this.topRight.x,e.topRight.x),s=Math.min(this.topLeft.y,e.topLeft.y),n=Math.max(this.botLeft.y,e.botLeft.y);return new St(new Qe(t,s),i-t,n-s)}getDiagCorner(e){return e?this.botRight:this.topLeft}intersectsWith(e){return!(e.topLeft.x>this.topRight.x||e.topRight.x<this.topLeft.x||e.topLeft.y>this.botLeft.y||e.botLeft.y<this.topLeft.y)}intersectsWithInner(e){return!(e.topLeft.x>=this.topRight.x||e.topRight.x<=this.topLeft.x||e.topLeft.y>=this.botLeft.y||e.botLeft.y<=this.topLeft.y)}intersectP(e,t,i){var s=t.x*(this.getDiagCorner(i[0]).x-e.origin.x),n=t.x*(this.getDiagCorner(!i[0]).x-e.origin.x),r=t.y*(this.getDiagCorner(i[1]).y-e.origin.y),o=t.y*(this.getDiagCorner(!i[1]).y-e.origin.y);return s>o||r>n?{hit:!1,min:s,max:n}:(r>s&&(s=r),o<n&&(n=o),{hit:s<e.tMax&&n>0,min:s,max:n})}center(){return this.topLeft.add(new Je(this.w/2,this.h/2))}getMaxExtent(){return this.w>this.h?0:1}visibleInCanvas(e){var t=!(st(this.topLeft.x)>e.width||nt(this.topLeft.y)>e.height||st(this.topRight.x)<0||nt(this.botRight.y)<0);return!!t}}var Ct=e=>{var t=[];for(var i of e)t.push({uuid:i.uuid,visionSource:i.vision_source,visible:i.visible,name:i.name,value:i.value,dim:i.dim,colour:i.colour});return t},_t=e=>{var t=[];for(var i of e)t.push({uuid:i.uuid,vision_source:i.visionSource,visible:i.visible,name:i.name,value:i.value,dim:i.dim,colour:i.colour});return t};class Ot{constructor(e,t){this.children=[],this.nPrimitives=e,this.bbox=t}}class kt extends Ot{constructor(e,t,i){super(t,i),this.firstPrimOffset=e}}class Lt extends Ot{constructor(e,t,i){super(0,t.bbox.union(i.bbox)),this.dimension=e,this.children.push(t),this.children.push(i)}}class Et{constructor(e){if(this.totalNodes=0,this.buildData=[],this.orderedPrims=[],this.nodes=[],this.offset=0,this.shapes=e,0===this.shapes.length)return this.root=null,void(this.nodes=[]);for(var t=0;t<e.length;t++){var i=xt.UUIDMap.get(e[t]);this.buildData.push({index:t,bbox:i.getBoundingBox(),center:new St(i.center(),0,0)})}this.root=this.recursiveBuild(0,e.length),this.compact()}draw(){var e=xt.getLayer("draw").ctx;for(var t of this.nodes){var i=t.bbox;e.strokeRect(st(i.topLeft.x),nt(i.topLeft.y),rt(i.w),rt(i.h))}}recursiveBuild(e,t){this.totalNodes++;for(var i=this.buildData[e].bbox,s=e+1;s<t;s++)i=i.union(this.buildData[s].bbox);var n=t-e;if(1===n)return this.createLeaf(e,t,n,i);for(var r=this.buildData[e].center,o=e;o<t;o++)r=r.union(this.buildData[o].center);var a=r.getMaxExtent();if(r.botRight.get(a)===r.topLeft.get(a))return this.createLeaf(e,t,n,i);var l=.5*(r.topLeft.get(a)+r.botRight.get(a)),c=ce(this.buildData.slice(e,t),e=>e.center.center().get(a)<l),h=[].concat.apply([],c);0!==c[0].length&&0!==c[1].length||console.log("EMPTY"),this.buildData.splice(e,h.length,...h);var u=c[0].length+e;return new Lt(a,this.recursiveBuild(e,u),this.recursiveBuild(u,t))}intersect(e,t){if(0===this.nodes.length)return{hit:!1,intersect:e.get(0),tMin:0,tMax:e.tMax};void 0===t&&(t=!1);var i=!1,s=0,n=e.tMax,r=0,o=0,a=[],l=e.direction.inverse(),c=[l.x<0,l.y<0];while(1){var h=this.nodes[o],u=h.bbox.intersectP(e,l,c);if(u.hit)if(h.nPrimitives>0){if(i=!0,s=e.tMax=u.min,n=u.max,0===r||t)break;o=a[--r]}else c[h.dimension]?(a[r++]=o+1,o=h.secondChildOffset):(a[r++]=h.secondChildOffset,o++);else{if(0===r)break;o=a[--r]}}return{hit:i,intersect:e.get(s),tMin:s,tMax:n}}compact(){this.offset=0,null!==this.root&&this.flatten(this.root)}flatten(e){var t=this.offset,i=this.offset++;if(0===e.nPrimitives){this.flatten(e.children[0]);var s=this.flatten(e.children[1]),n={bbox:e.bbox,dimension:e.dimension,nPrimitives:0,secondChildOffset:s};this.nodes[t]=n}else{var r={bbox:e.bbox,primitivesOffset:e.firstPrimOffset,nPrimitives:e.nPrimitives};this.nodes[t]=r}return i}createLeaf(e,t,i,s){for(var n=this.orderedPrims.length,r=e;r<t;r++)this.orderedPrims.push(this.shapes[this.buildData[r].index]);return new kt(n,i,s)}}var It;i("26e9"),i("4e82");function Pt(e){return(e+2)%3}function Mt(e){return(e+1)%3}function Tt(e,t){var i=new ci(e,null);if(i.valid)do{var s=3-i.t.indexV(e)-i.ri,n=i.t.vertices[s];if(!n.infinite){if(n===t)return{includes:!0,vi:t,fr:i.t,i:i.ri};var r=Rt(e.point,t.point,n.point);if(r===ti.COLLINEAR&&At(e.point,n.point,t.point))return{includes:!0,vi:n,fr:i.t,i:i.ri}}}while(i.next());return{includes:!1}}function At(e,t,i){var s,n;return Dt(0,e,i)===ti.EQUAL?(s=Dt(1,e,t),n=Dt(1,t,i)):(s=Dt(0,e,t),n=Dt(0,t,i)),s===ti.SMALLER&&n===ti.SMALLER||s===ti.LARGER&&n===ti.LARGER}function Dt(e,t,i){return t[e]<i[e]?ti.SMALLER:t[e]>i[e]?ti.LARGER:ti.EQUAL}function Rt(e,t,i){var s=e[0],n=e[1],r=t[0],o=t[1],a=i[0],l=i[1],c=r-s,h=o-n,u=a-s,d=l-n,p=Nt(c,h,u,d),v=Math.abs(c),f=Math.abs(h),g=Math.abs(u),m=Math.abs(d);if(v<g&&(v=g),f<m&&(f=m),v>f&&([v,f]=[f,v]),v<2e-162&&0===v)return ti.ZERO;if(f<1e153){var b=Number.EPSILON*v*f;if(p>b)return ti.POSITIVE;if(p<-b)return ti.NEGATIVE}return ti.ZERO}function Nt(e,t,i,s){return e*s-t*i}function Ut(e,t,i){return Nt(t[0]-e[0],t[1]-e[1],i[0]-e[0],i[1]-e[1])<0}function jt(e,t,i){if(!e.isInfinite())return zt(e.vertices[0].point,e.vertices[1].point,e.vertices[2].point,t,i);throw new Error("SSS")}function zt(e,t,i,s,n){var r=Ht(e,t,i,s);if(r!==ti.ON_ORIENTED_BOUNDARY||!n)return r;var o=[e,t,i,s];for(var a of(o.sort((e,t)=>e[0]-t[0]||e[1]-t[1]),o.reverse())){if(a===s)return ti.ON_NEGATIVE_SIDE;var l=Rt(e,t,s);if(a===i&&l!==ti.COLLINEAR)return l;if(l=Rt(e,s,i),a===t&&l!==ti.COLLINEAR)return l;if(l=Rt(s,t,i),a===e&&l!==ti.COLLINEAR)return l}return ti.ON_NEGATIVE_SIDE}function $t(e,t){return e[0]===t[0]&&e[1]===t[1]}function Ft(e,t){return e[0]<t[0]||e[0]===t[0]&&e[1]<t[1]}function Vt(e,t){return Ft(e,t)?ti.SMALLER:$t(e,t)?ti.EQUAL:ti.LARGER}function Ht(e,t,i,s){var n=t[0]-e[0],r=t[1]-e[1],o=i[0]-e[0],a=i[1]-e[1],l=s[0]-e[0],c=s[1]-e[1],h=s[0]-t[0],u=s[1]-t[1],d=i[0]-t[0],p=i[1]-t[1],v=Nt(n*c-r*l,l*h+c*u,n*a-r*o,o*d+a*p),f=Math.abs(n),g=Math.abs(r),m=Math.abs(o),b=Math.abs(a),y=Math.abs(h),w=Math.abs(u),x=Math.abs(l),S=Math.abs(c),C=Math.abs(d),_=Math.abs(p);if(f<m&&(f=m),f<x&&(f=x),f<y&&(f=y),f<C&&(f=C),g<b&&(g=b),g<S&&(g=S),g<w&&(g=w),g<_&&(g=_),f>g&&([f,g]=[g,f]),f<1e-73&&0===f)return ti.ON_ORIENTED_BOUNDARY;if(g<1e76){var O=Number.EPSILON*f*g*(g*g);if(v>O)return ti.ON_POSITIVE_SIDE;if(v<-O)return ti.ON_NEGATIVE_SIDE}return ti.ZERO}function Bt(e,t,i,s){switch(Rt(e,t,i)){case ti.LEFT_TURN:return Rt(i,s,t)!==ti.RIGHT_TURN;case ti.RIGHT_TURN:return Rt(i,s,t)!==ti.LEFT_TURN;case ti.COLLINEAR:return!0}}function Gt(e,t,i,s){switch(Rt(e,t,i)){case ti.LEFT_TURN:return Rt(e,t,s)!==ti.LEFT_TURN;case ti.RIGHT_TURN:return Rt(e,t,s)!==ti.RIGHT_TURN;case ti.COLLINEAR:return!0}}function Wt(e,t,i,s){var n=Yt(e,t,i,s);switch(n.intersectionType){case It.POINT:return n.point;case It.NO_INTERSECTION:return null}throw new Error("sdfgighowen")}function Xt(e,t){if(e[0]===t[0])return[1,0,-e[0]];if(e[1]===t[1])return[0,1,-e[1]];var i=t[0]-e[0],s=t[1]-e[1];return[-s,i,-i*e[1]+s*e[0]]}function Yt(e,t,i,s){if(!qt(e,t,i,s))return{intersectionType:It.NO_INTERSECTION,point:null};var n=Xt(e,t),r=Xt(i,s),o=Kt(n,r);switch(o.intersectionType){case It.POINT:return o}throw new Error("gzseuihgpib")}function Kt(e,t){var i=e[0]*t[1]-t[0]*e[1],s=e[1]*t[2]-t[1]*e[2],n=t[0]*e[2]-e[0]*t[2];return{intersectionType:It.POINT,point:[s/i,n/i]}}function qt(e,t,i,s){if(Ft(e,t)){if(Ft(i,s)){if(Ft(t,i)||Ft(s,e))return!1}else if(Ft(t,s)||Ft(i,e))return!1}else if(Ft(i,s)){if(Ft(e,i)||Ft(s,t))return!1}else if(Ft(e,s)||Ft(i,t))return!1;if(Ft(e,t))if(Ft(i,s))switch(Vt(e,i)){case ti.SMALLER:switch(Vt(t,i)){case ti.SMALLER:return!1;case ti.EQUAL:return!0;default:switch(Vt(t,s)){case ti.SMALLER:return Bt(e,t,i,s);case ti.EQUAL:return!0;default:return Gt(e,t,i,s)}}case ti.EQUAL:return!0;default:switch(Vt(s,e)){case ti.SMALLER:return!1;case ti.EQUAL:return!0;default:switch(Vt(s,t)){case ti.SMALLER:return Bt(i,s,e,t);case ti.EQUAL:return!0;default:return Gt(i,s,e,t)}}}else switch(Vt(e,s)){case ti.SMALLER:switch(Vt(t,s)){case ti.SMALLER:return!1;case ti.EQUAL:return!0;default:switch(Vt(t,i)){case ti.SMALLER:return Bt(e,t,s,i);case ti.EQUAL:return!0;default:return Gt(e,t,s,i)}}case ti.EQUAL:return!0;default:switch(Vt(i,e)){case ti.SMALLER:return!1;case ti.EQUAL:return!0;default:switch(Vt(i,t)){case ti.SMALLER:return Bt(s,i,e,t);case ti.EQUAL:return!0;default:return Gt(s,i,e,t)}}}else if(Ft(i,s))switch(Vt(t,i)){case ti.SMALLER:switch(Vt(e,i)){case ti.SMALLER:return!1;case ti.EQUAL:return!0;default:switch(Vt(e,s)){case ti.SMALLER:return Bt(t,e,i,s);case ti.EQUAL:return!0;default:return Gt(t,e,i,s)}}case ti.EQUAL:return!0;default:switch(Vt(s,t)){case ti.SMALLER:return!1;case ti.EQUAL:return!0;default:switch(Vt(s,e)){case ti.SMALLER:return Bt(i,s,t,e);case ti.EQUAL:return!0;default:return Gt(i,s,t,e)}}}else switch(Vt(t,s)){case ti.SMALLER:switch(Vt(e,s)){case ti.SMALLER:return!1;case ti.EQUAL:return!0;default:switch(Vt(e,i)){case ti.SMALLER:return Bt(t,e,s,i);case ti.EQUAL:return!0;default:return Gt(t,e,s,i)}}case ti.EQUAL:return!0;default:switch(Vt(i,t)){case ti.SMALLER:return!1;case ti.EQUAL:return!0;default:switch(Vt(i,e)){case ti.SMALLER:return Bt(s,i,t,e);case ti.EQUAL:return!0;default:return Gt(s,i,t,e)}}}}function Qt(e){if(e!==e)return e;if(e===-1/0)return-Number.MAX_VALUE;if(e===1/0)return 1/0;if(e===+Number.MAX_VALUE)return 1/0;var t=e*(e<0?1-Number.EPSILON/2:1+Number.EPSILON);t===e&&(t=Number.MIN_VALUE*Number.EPSILON>0?e+Number.MIN_VALUE*Number.EPSILON:e+Number.MIN_VALUE),t===1/0&&(t=+Number.MAX_VALUE);var i=e+(t-e)/2;e<i&&i<t&&(t=i);var s=(t+e)/2;return e<s&&s<t&&(t=s),0===t?-0:t}function Zt(e){return e<0?Qt(e)-e:e+Qt(-e)}function Jt(e,t,i,s){var n=et.fromPoints(i,s),r=et.fromPoints(e,i),o=n.direction.dot(n.direction),a=2*r.direction.dot(n.direction),l=r.direction.dot(r.direction)-Math.pow(t,2),c=Math.pow(a,2)-4*o*l;if(c<0)return[];var h=[];c=Math.sqrt(c);var u=(-a-c)/(2*o),d=(-a+c)/(2*o);return u>=0&&u<=1&&h.push(n.get(u)),d>=0&&d<=1&&h.push(n.get(d)),h}(function(e){e[e["NO_INTERSECTION"]=0]="NO_INTERSECTION",e[e["POINT"]=1]="POINT",e[e["SEGMENT"]=2]="SEGMENT"})(It||(It={}));var ei,ti,ii,si,ni,ri=-Infinity;function oi(){return[ri,ri]}(function(e){e[e["NEGATIVE"]=-1]="NEGATIVE",e[e["ZERO"]=0]="ZERO",e[e["POSITIVE"]=1]="POSITIVE",e[e["RIGHT_TURN"]=-1]="RIGHT_TURN",e[e["LEFT_TURN"]=1]="LEFT_TURN",e[e["SMALLER"]=-1]="SMALLER",e[e["EQUAL"]=0]="EQUAL",e[e["LARGER"]=1]="LARGER",e[e["CLOCKWISE"]=-1]="CLOCKWISE",e[e["COUNTERCLOCKWISE"]=1]="COUNTERCLOCKWISE",e[e["COLLINEAR"]=0]="COLLINEAR",e[e["COPLANAR"]=0]="COPLANAR",e[e["DEGENERATE"]=0]="DEGENERATE",e[e["ON_NEGATIVE_SIDE"]=-1]="ON_NEGATIVE_SIDE",e[e["ON_ORIENTED_BOUNDARY"]=0]="ON_ORIENTED_BOUNDARY",e[e["ON_POSITIVE_SIDE"]=1]="ON_POSITIVE_SIDE"})(ti||(ti={})),function(e){e[e["UNDEFINED"]=-1]="UNDEFINED",e[e["VERTEX_VERTEX"]=0]="VERTEX_VERTEX",e[e["VERTEX_EDGE"]=1]="VERTEX_EDGE",e[e["EDGE_VERTEX"]=2]="EDGE_VERTEX",e[e["EDGE_EDGE"]=3]="EDGE_EDGE"}(ii||(ii={}));class ai{constructor(){this.vertices=[],this.neighbours=[null,null,null],this.constraints=[!1,!1,!1],this.uid=ai._counter++;for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.vertices=t}from(e){return this.vertices=e.vertices.slice(0,e.vertices.length),this.neighbours=e.neighbours.slice(0,e.neighbours.length),this.constraints=e.constraints.slice(0,e.constraints.length),this}get dimension(){return this.vertices.length-1}addVertex(e){void 0===e&&console.log("UNDEFINED HIERE"),this.vertices.push(e),e.triangle=this}isConstrained(e){return this.constraints[e]}reorient(){this.vertices=[this.vertices[1],this.vertices[0],this.vertices[2]].slice(0,this.vertices.length),this.neighbours=[this.neighbours[1],this.neighbours[0],this.neighbours[2]],this.constraints=[this.constraints[1],this.constraints[0],this.constraints[2]]}indexV(e){return this.vertices.indexOf(e)}indexT(e){return this.neighbours.indexOf(e)}isInfinite(e){return void 0===e?this.vertices.includes(ei):this.vertices[Mt(e)].infinite||this.vertices[Pt(e)].infinite}contains(e){var t=-this.vertices[1].point[1]*this.vertices[2].point[0]+this.vertices[0].point[1]*(-this.vertices[1].point[0]+this.vertices[2].point[0])+this.vertices[0].point[0]*(this.vertices[1].point[1]-this.vertices[2].point[1])+this.vertices[1].point[0]*this.vertices[2].point[1],i=t<0?-1:1,s=(this.vertices[0].point[1]*this.vertices[2].point[0]-this.vertices[0].point[0]*this.vertices[2].point[1]+(this.vertices[2].point[1]-this.vertices[0].point[1])*e[0]+(this.vertices[0].point[0]-this.vertices[2].point[0])*e[1])*i;if(s<0)return!1;var n=(this.vertices[0].point[0]*this.vertices[1].point[1]-this.vertices[0].point[1]*this.vertices[1].point[0]+(this.vertices[0].point[1]-this.vertices[1].point[1])*e[0]+(this.vertices[1].point[0]-this.vertices[0].point[0])*e[1])*i;return n>0&&s+n<t*i}}ai._counter=0;class li{constructor(e){this.infinite=!1,this._point=e}get point(){return this._point}set point(e){this._point=e,this.infinite=!1}}class ci{constructor(e,t){if(this.v=e,this.t=t,null===e?this.t=null:null===t&&(this.t=e.triangle),null==this.t||this.t.dimension<1)this.ri=0,this.v=null,this.t=null;else{var i=this.t.indexV(e);2===this.t.dimension?this.ri=Mt(i):this.ri=2}this._ri=this.ri,this._v=this.v,this._t=this.t}get valid(){return null!==this.t&&null!==this.v}next(){var e=this.t.indexV(this.v);return 1===this.t.dimension?this.t=this.t.neighbours[0===e?1:0]:(this.t=this.t.neighbours[Mt(e)],e=this.t.indexV(this.v),this.ri=Mt(e)),this.ri!==this._ri||this.v!==this._v||this.t!==this._t}}class hi{constructor(e){if(this.i=0,this.edge=new pi,this._es=0,this.tds=e,this.edge.second=0,e.dimension<=0)this.pos=null;else{this.pos=e.triangles[0],1===e.dimension&&(this.edge.second=2);while(null!==this.pos&&!this.associatedEdge())throw new Error("[poi");1===e.dimension&&(this._es=2)}}get valid(){return(null!==this.pos||this._es!==this.edge.second)&&this.pos.isInfinite(this.edge.second)}next(){do{this.increment()}while(null!==this.pos&&!this.associatedEdge())}collect(){return this.edge.first=this.pos,this.edge}associatedEdge(){return 1===this.tds.dimension||this.tds.triangles.indexOf(this.pos)<this.tds.triangles.indexOf(this.pos.neighbours[this.edge.second])}increment(){1===this.tds.dimension?(this.i++,this.tds.triangles.length<=this.i?this.pos=null:this.pos=this.tds.triangles[this.i]):2===this.edge.second?(this.edge.second=0,this.i++,this.tds.triangles.length<=this.i?this.pos=null:this.pos=this.tds.triangles[this.i]):this.edge.second++}}class ui{constructor(e,t){this.v=e,this.t=t,null===e?this.t=null:null===t&&(this.t=e.triangle),(null==this.t||this.t.dimension<2)&&(this.v=null,this.t=null),this._v=this.v,this._t=this.t}get valid(){return null!==this.t&&null!==this.v}prev(){var e=this.t.indexV(this.v);this.t=this.t.neighbours[Pt(e)]}next(){var e=this.t.indexV(this.v);return this.t=this.t.neighbours[Mt(e)],this.v!==this._v||this.t!==this._t}}class di{constructor(e,t,i){this.i=0,this.pos=null,this.s=ii.UNDEFINED,this._tr=t,this.p=e.point,this.q=i;var s=new ui(e,null),n=s.t.indexV(e),r=s.t.vertices[Pt(n)];while(e===ei||Rt(this.p,this.q,r.point)!==ti.LEFT_TURN)if(s.next(),n=s.t.indexV(e),r=s.t.vertices[Pt(n)],!s.valid)return;var o=s.t.vertices[Mt(n)],a=ti.RIGHT_TURN;while(o!==ei&&(a=Rt(this.p,this.q,o.point))===ti.LEFT_TURN)s.prev(),n=s.t.indexV(e),o=s.t.vertices[Mt(n)];if(n=s.t.indexV(e),r=s.t.vertices[Pt(n)],o===ei)switch(s.prev(),n=s.t.indexV(e),o=s.t.vertices[Mt(n)],a=Rt(this.p,this.q,o.point),a){case ti.RIGHT_TURN:case ti.COLLINEAR:s.next(),n=s.t.indexV(ei),this.pos=s.t,this.s=ii.VERTEX_VERTEX,this.i=n;break;case ti.LEFT_TURN:break}else a===ti.COLLINEAR?(this.pos=s.t,this.s=ii.VERTEX_VERTEX,this.i=Mt(n)):(this.pos=s.t,this.s=ii.VERTEX_EDGE,this.i=n)}next(){this.increment()}increment(){var e;if(this.s===ii.VERTEX_VERTEX||this.s===ii.EDGE_VERTEX){do{var t=this.pos.neighbours[Pt(this.i)];if(this.i=t.indexT(this.pos),this.pos=t,this.pos.vertices[this.i]===ei){e=ti.COLLINEAR,this.i=Pt(this.i);break}e=Rt(this.p,this.q,this.pos.vertices[this.i].point),this.i=Pt(this.i)}while(e===ti.LEFT_TURN);e===ti.COLLINEAR?(this.s=ii.VERTEX_VERTEX,this.i=Mt(this.i)):this.s=ii.VERTEX_EDGE}else{var i=this.pos.neighbours[this.i],s=i.indexT(this.pos);switch(this.pos=i,e=this.pos.vertices[s]===ei?ti.COLLINEAR:Rt(this.p,this.q,this.pos.vertices[s].point),e){case ti.LEFT_TURN:this.s=ii.EDGE_EDGE,this.i=Mt(s);break;case ti.RIGHT_TURN:this.s=ii.EDGE_EDGE,this.i=Pt(s);break;default:this.s=ii.EDGE_VERTEX,this.i=s}}}}class pi{constructor(){this.first=null,this.second=0}}(function(e){e[e["VERTEX"]=0]="VERTEX",e[e["EDGE"]=1]="EDGE",e[e["FACE"]=2]="FACE",e[e["OUTSIDE_CONVEX_HULL"]=3]="OUTSIDE_CONVEX_HULL",e[e["OUTSIDE_AFFINE_HULL"]=4]="OUTSIDE_AFFINE_HULL"})(si||(si={}));class vi{constructor(){this.dimension=-1,this.vertices=[],this.triangles=[],this._infinite=this.createVertex(),ei=this._infinite;var e=new ai;e.addVertex(this._infinite),this.triangles.push(e)}createVertex(){var e=this.infiniteVertex;return void 0===e&&console.log("UNDEFINED HIERE"),this.vertices.push(e),e}createTriangle(e,t,i,s,n,r){var o=new ai(e,t,i);return o.neighbours[0]=s,o.neighbours[1]=n,o.neighbours[2]=r,this.triangles.push(o),o}deleteTriangle(e){this.triangles=this.triangles.filter(t=>t!==e)}setAdjacency(e,t,i,s){e.neighbours[t]=i,i.neighbours[s]=e}get finiteVertex(){return this.vertices[1]}get infiniteVertex(){var e=new li(oi());return e.infinite=!0,e}get finiteEdge(){if(this.dimension<1)throw new Error("aspo");var e=new hi(this);while(e.valid)e.next();return e.collect()}insertDimUp(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new li,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.createVertex();switch(this.dimension++,this.dimension){case 0:e=this.triangles[0],t=new ai(n),this.triangles.push(t),this.setAdjacency(e,0,t,0),n.triangle=t;break;case 1:case 2:var r=[],o=this.triangles.slice(0,this.triangles.length);for(var a of o){var l=(new ai).from(a);this.triangles.push(l),a.vertices[this.dimension]=n,l.vertices[this.dimension]=i,this.setAdjacency(a,this.dimension,l,this.dimension),a.vertices.includes(i)&&r.push(l)}for(var c of o)for(var h=c.neighbours[this.dimension],u=0;u<this.dimension;++u)h.neighbours[u]=c.neighbours[u].neighbours[this.dimension];var d=0;if(1===this.dimension)s?(o[d].reorient(),d++,o[d].neighbours[1].reorient()):(o[d].neighbours[1].reorient(),d++,o[d].reorient());else for(var p of o)s?p.neighbours[2].reorient():p.reorient();for(var v of r){var f=1;v.vertices[0]===i&&(f=0),e=v.neighbours[this.dimension];var g=this.mirrorIndex(v,this.dimension);t=v.neighbours[f];var m=this.mirrorIndex(v,f);this.setAdjacency(e,g,t,m),this.deleteTriangle(v)}n.triangle=o[0];break;default:throw new Error("Dimension unknown")}return n}mirrorIndex(e,t){if(1===e.dimension){var i=e.neighbours[t].indexV(e.vertices[0===t?1:0]);return 0===i?1:0}return Mt(e.neighbours[t].indexV(e.vertices[Mt(t)]))}insertInFace(e){var t=this.createVertex(),i=e.vertices[0],s=e.vertices[1],n=e.vertices[2],r=e.neighbours[1],o=e.neighbours[2],a=this.createTriangle(i,t,n,e,r,null),l=this.createTriangle(i,s,t,e,null,o);if(this.setAdjacency(a,2,l,1),null!==r){var c=this.mirrorIndex(e,1);r.neighbours[c]=a}if(null!==o){var h=this.mirrorIndex(e,2);o.neighbours[h]=l}return e.vertices[0]=t,e.neighbours[1]=a,e.neighbours[2]=l,i.triangle===e&&(i.triangle=l),t.triangle=e,t}flip(e,t){var i=e.neighbours[t],s=this.mirrorIndex(e,t),n=e.vertices[Pt(t)],r=e.vertices[Mt(t)],o=e.neighbours[Mt(t)],a=this.mirrorIndex(e,Mt(t)),l=i.neighbours[Mt(s)],c=this.mirrorIndex(i,Mt(s));e.vertices[Pt(t)]=i.vertices[s],i.vertices[Pt(s)]=e.vertices[t],this.setAdjacency(e,t,l,c),this.setAdjacency(e,Mt(t),i,Mt(s)),this.setAdjacency(i,s,o,a),n.triangle===e&&(n.triangle=i),r.triangle===i&&(r.triangle=e)}insertInEdge(e,t){var i;if(1===this.dimension){i=this.createVertex();var s=e.neighbours[0],n=e.vertices[1],r=this.createTriangle(i,n,null,s,e,null);e.vertices[1]=i,e.neighbours[0]=r,s.neighbours[1]=r,i.triangle=r,n.triangle=s}else{var o=e.neighbours[t],a=this.mirrorIndex(e,t);i=this.insertInFace(e),this.flip(o,a)}return i}}class fi{constructor(e){this.x1=e[0],this.y1=e[1],this.x2=e[0],this.y2=e[1]}dilate(e){this.x1-=e*Zt(this.x1),this.y1-=e*Zt(this.y1),this.x2+=e*Zt(this.x2),this.y2+=e*Zt(this.y2)}overlaps(e){return!(this.x2<e.x1||e.x2<this.x1)&&!(this.y2<e.y1||e.y2<this.y1)}}class gi{constructor(){this.tds=new vi}insertConstraint(e,t){var i=this.insert(e),s=this.insert(t);i!==s&&this.insertConstraintV(i,s)}insertConstraintV(e,t){var i=[[e,t]];while(i.length>0){var s=i.pop(),n=Tt(s[0],s[1]);if(n.includes)this.markConstraint(n.fr,n.i),n.vi!==s[1]&&i.push([n.vi,s[1]]);else{var r=this.findIntersectedFaces(s[0],s[1]);r.found?r.vi!==s[0]&&r.vi!==s[1]?(i.push([s[0],r.vi]),i.push([r.vi,s[1]])):i.push(s):(this.triangulateHole(r.intersectedFaces,r.listAB,r.listBA),r.vi!==s[1]&&i.push([r.vi,s[1]]))}}}triangulateHole(e,t,i){var s=[];this.triangulateHole2(e,t,i,s),this.propagatingFlipE(s)}triangulateHole2(e,t,i,s){if(t.length>0){this.triangulateHalfHole(t,s),this.triangulateHalfHole(i,s);var n=t[0][0],r=i[0][0];n.neighbours[2]=r,r.neighbours[2]=n,n.constraints[2]=!0,r.constraints[2]=!0;while(e.length>0)this.tds.deleteTriangle(e.shift())}}triangulateHalfHole(e,t){var i,s,n,r,o,a,l,c,h=0,u=()=>e[h],d=()=>e[i],p=u()[0].vertices[Mt(u()[1])];i=h,++i;do{r=u()[0],l=u()[1],null!==r.neighbours[l]&&(n=r.neighbours[l],a=Pt(n.indexV(r.vertices[Pt(l)])),r=n.neighbours[a],l=this.tds.mirrorIndex(n,a)),o=d()[0],c=d()[1],null!==o.neighbours[c]&&(n=o.neighbours[c],a=Pt(n.indexV(o.vertices[Pt(c)])),o=n.neighbours[a],c=this.tds.mirrorIndex(n,a));var v=r.vertices[Mt(l)],f=r.vertices[Pt(l)],g=o.vertices[Pt(c)],m=Rt(v.point,f.point,g.point);switch(m){case ti.RIGHT_TURN:var b=this.tds.createTriangle(v,g,f,null,null,null);t.push([b,2]),b.neighbours[1]=r,b.neighbours[0]=o,r.neighbours[l]=b,o.neighbours[c]=b,r.isConstrained(l)&&(b.constraints[1]=!0),o.isConstrained(c)&&(b.constraints[0]=!0),v.triangle=b,f.triangle=b,g.triangle=b,s=h+1,e.splice(h,0,[b,2]),e.splice(Math.max(s,i),1),e.splice(Math.min(s,i),1),i=h,v!==p?--h:++i;break;case ti.LEFT_TURN:case ti.COLLINEAR:++h,++i;break}}while(i<e.length)}findIntersectedFaces(e,t){var i,s=e.point,n=t.point,r=[],o=[],a=[],l=new di(e,this,n),c=l.pos.indexV(e);if(l.pos.isConstrained(c))return i=this.intersect(l.pos,c,e,t),{found:!0,vi:i,listAB:r,listBA:o,intersectedFaces:a};var h=l.pos.neighbours[Mt(c)],u=l.pos.neighbours[Pt(c)];r.push([h,h.indexT(l.pos)]),o.unshift([u,u.indexT(l.pos)]),a.unshift(l.pos);var d=l.pos;l.next(),c=l.pos.indexT(d);var p=l.pos.vertices[c],v=!1;while(p!==t&&!v){var f=void 0,g=void 0,m=Rt(s,n,p.point);switch(m){case ti.COLLINEAR:v=!0;break;case ti.LEFT_TURN:case ti.RIGHT_TURN:if(m===ti.LEFT_TURN?(f=Mt(c),g=Pt(c)):(f=Pt(c),g=Mt(c)),l.pos.isConstrained(f))return i=this.intersect(l.pos,f,e,t),{found:!0,vi:i,listAB:r,listBA:o,intersectedFaces:a};h=l.pos.neighbours[g],a.unshift(l.pos),m===ti.LEFT_TURN?r.push([h,h.indexT(l.pos)]):o.unshift([h,h.indexT(l.pos)]),d=l.pos,l.next(),c=l.pos.indexT(d),p=l.pos.vertices[c];break}}return i=p,a.unshift(l.pos),h=l.pos.neighbours[Pt(c)],r.push([h,h.indexT(l.pos)]),u=l.pos.neighbours[Mt(c)],o.unshift([u,u.indexT(l.pos)]),{found:!1,vi:i,listAB:r,listBA:o,intersectedFaces:a}}intersect(e,t,i,s){var n,r=e.vertices[Pt(t)],o=e.vertices[Mt(t)],a=i.point,l=s.point,c=r.point,h=o.point,u=Wt(a,l,c,h);if(u!==a&&u!==l&&u!==c&&u!==h){var d=new fi(u);d.dilate(4),d.overlaps(new fi(a))&&(u=a),d.overlaps(new fi(l))&&(u=l),d.overlaps(new fi(c))&&(u=c),d.overlaps(new fi(h))&&(u=h)}if(null===u)throw new Error("what");return this.removeConstrainedEdge(e,t),n=this.insert(u,e),n!==r&&n!==o?(this.insertConstraintV(r,n),this.insertConstraintV(n,o)):this.insertConstraintV(r,o),n}removeConstrainedEdge(e,t){e.constraints[t]=!1,2===this.tds.dimension&&(e.neighbours[t].constraints[this.tds.mirrorIndex(e,t)]=!1)}updateConstraintsOpposite(e){var t,i=e.triangle,s=i;do{t=i.indexV(e),i.neighbours[t].constraints[this.tds.mirrorIndex(i,t)]?i.constraints[t]=!0:i.constraints[t]=!1,i=i.neighbours[Mt(t)]}while(i!==s)}markConstraint(e,t){1===this.tds.dimension?e.constraints[2]=!0:(e.constraints[t]=!0,e.neighbours[t].constraints[this.tds.mirrorIndex(e,t)]=!0)}insert(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.locate(e,this.iLocate(e,t)),s=this.insertb(e,i.loc,i.lt,i.li);return this.flipAround(s),s}flipAround(e){if(!(this.tds.dimension<=1)){var t,i,s=e.triangle,n=s;do{t=s.indexV(e),i=s.neighbours[Mt(t)],this.propagatingFlip(s,t),s=i}while(i!==n)}}propagatingFlip(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.isFlipable(e,t)){var s=100;if(i===s)throw new Error("maxde");var n=e.neighbours[t];this.flip(e,t),this.propagatingFlip(e,t,i+1),t=n.indexV(e.vertices[t]),this.propagatingFlip(n,t,i+1)}}lessEdge(e,t){var i=e[1],s=t[1];return e[0].uid<t[0].uid||e[0].uid===t[0].uid&&i<s}propagatingFlipE(e){var t,i,s,n,r,o,a,l=this,c=0,h=[];while(c<e.length)t=e[c][0],i=e[c][1],this.isFlipable(t,i)&&(s=[t.neighbours[i],this.tds.mirrorIndex(t,i)],this.lessEdge(e[c],s)?h.push(e[c]):h.push(s)),++c;var u=[null,null,null,null];while(h.length>0){t=h[0][0],n=h[0][1],r=t.neighbours[n],o=this.tds.mirrorIndex(t,n),a=[t,n],h.splice(h.findIndex(e=>e[0]===a[0]&&e[1]===a[1]),1),u[0]=[t,Pt(n)],u[1]=[t,Mt(n)],u[2]=[r,Pt(o)],u[3]=[r,Mt(o)];var d=function(e){var t=e[0],i=e[1];s=[t.neighbours[i],l.tds.mirrorIndex(t,i)],l.lessEdge(e,s)?h.splice(h.findIndex(t=>t[0]===e[0]&&t[1]===e[1]),1):h.splice(h.findIndex(e=>e[0]===s[0]&&e[1]===s[1]),1)};for(var p of u)d(p);for(var v of(this.flip(t,n),u)){var f=v[0],g=v[1];this.isFlipable(f,g)&&(s=[f.neighbours[g],this.tds.mirrorIndex(f,g)],this.lessEdge(v,s)?h.push(v):h.push(s))}}}flip(e,t){var i=e.neighbours[t],s=this.tds.mirrorIndex(e,t),n=e.neighbours[Pt(t)],r=this.tds.mirrorIndex(e,Pt(t)),o=e.neighbours[Mt(t)],a=this.tds.mirrorIndex(e,Mt(t)),l=i.neighbours[Pt(s)],c=this.tds.mirrorIndex(i,Pt(s)),h=i.neighbours[Mt(s)],u=this.tds.mirrorIndex(i,Mt(s));this.tds.flip(e,t),e.constraints[e.indexT(i)]=!1,i.constraints[i.indexT(e)]=!1,n.neighbours[r].constraints[this.tds.mirrorIndex(n,r)]=n.constraints[r],o.neighbours[a].constraints[this.tds.mirrorIndex(o,a)]=o.constraints[a],l.neighbours[c].constraints[this.tds.mirrorIndex(l,c)]=l.constraints[c],h.neighbours[u].constraints[this.tds.mirrorIndex(h,u)]=h.constraints[u]}isFlipable(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=e.neighbours[t];return!e.isInfinite()&&!s.isInfinite()&&(!e.constraints[t]&&jt(s,e.vertices[t].point,i)===ti.ON_POSITIVE_SIDE)}insertb(e,t,i,s){var n,r,o=!1;i===si.EDGE&&t.isConstrained(s)&&(o=!0,n=t.vertices[Mt(s)],r=t.vertices[Pt(s)]);var a=this.insertc(e,t,i,s);return o?this.updateConstraintsIncident(a,n,r):i!==si.VERTEX&&this.clearConstraintsIncident(a),2===this.tds.dimension&&this.updateConstraintsOpposite(a),a}updateConstraintsIncident(e,t,i){if(0!==this.tds.dimension)if(1===this.tds.dimension){var s=new ci(e,null);do{s.t.constraints[2]=!0}while(s.next())}else{var n=new ui(e,null);do{var r=n.t.indexV(e),o=Pt(r),a=Mt(r);n.t.vertices[o]===t||n.t.vertices[o]===i?(n.t.constraints[a]=!0,n.t.constraints[o]=!1):(n.t.constraints[a]=!1,n.t.constraints[o]=!0)}while(n.next())}}clearConstraintsIncident(e){var t=new ci(e,null);if(t.valid)do{var i=t.t,s=t.ri;i.constraints[s]=!1,2===this.tds.dimension&&(i.neighbours[s].constraints[this.tds.mirrorIndex(i,s)]=!1)}while(t.next())}insertc(e,t,i,s){if(1===this.tds.vertices.length)return this.insertFirst(e);if(2===this.tds.vertices.length)return i===si.VERTEX?this.tds.finiteVertex:this.insertSecond(e);switch(i){case si.VERTEX:return t.vertices[s];case si.OUTSIDE_AFFINE_HULL:return this.insertOutsideAffineHull(e);case si.OUTSIDE_CONVEX_HULL:return this.insertOutsideConvexHull(e,t);case si.EDGE:return this.insertInEdge(e,t,s);case si.FACE:return this.insertInFace(e,t)}throw new Error("qwe")}insertInEdge(e,t,i){var s=this.tds.insertInEdge(t,i);return s.point=e,s}insertInFace(e,t){var i=this.tds.insertInFace(t);return i.point=e,i}insertFirst(e){var t=this.tds.insertDimUp();return t.point=e,t}insertSecond(e){var t=this.tds.insertDimUp(this.tds._infinite,!0);return t.point=e,t}insertOutsideAffineHull(e){var t=!1;if(1===this.tds.dimension){var i=this.tds.finiteEdge.first,s=Rt(i.vertices[0].point,i.vertices[1].point,e);t=s===ti.COUNTERCLOCKWISE}var n=this.tds.insertDimUp(this.tds._infinite,t);return n.point=e,n}insertOutsideConvexHull(e,t){var i;if(1===this.tds.dimension)throw new Error("sdfasdasd");return i=this.insertOutsideConvexHull2(e,t),i.point=e,i}insertOutsideConvexHull2(e,t){var i=t.indexV(this.tds._infinite),s=[],n=[],r=new ui(this.tds._infinite,t),o=!1;while(!o){r.prev(),i=r.t.indexV(this.tds._infinite);var a=r.t.vertices[Mt(i)].point,l=r.t.vertices[Pt(i)].point;Rt(e,a,l)===ti.LEFT_TURN?s.push(r.t):o=!0}r=new ui(this.tds._infinite,t),o=!1;while(!o){r.next(),i=r.t.indexV(this.tds._infinite);var c=r.t.vertices[Mt(i)].point,h=r.t.vertices[Pt(i)].point;Rt(e,c,h)===ti.LEFT_TURN?n.push(r.t):o=!0}var u,d=this.tds.insertInFace(t);d.point=e;while(s.length>0)u=s[0],i=Mt(u.indexV(this.tds._infinite)),this.tds.flip(u,i),s.shift();while(n.length>0)u=n[0],i=Pt(u.indexV(this.tds._infinite)),this.tds.flip(u,i),n.shift();r=new ui(d,null);while(!r.t.isInfinite())r.next();return this.tds._infinite.triangle=r.t,d}locate(e,t){var i=0,s=0;if(this.tds.dimension<0)return i=si.OUTSIDE_AFFINE_HULL,s=4,{loc:null,lt:i,li:s};if(0===this.tds.dimension)return i=$t(e,this.tds.finiteVertex.triangle.vertices[0].point)?si.VERTEX:si.OUTSIDE_AFFINE_HULL,s=4,{loc:null,lt:i,li:s};if(1===this.tds.dimension)return this.marchLocate1D(e);if(null===t){var n=this.tds._infinite.triangle;t=n.neighbours[n.indexV(this.tds._infinite)]}else t.isInfinite()&&(t=t.neighbours[t.indexV(this.tds._infinite)]);return this.marchLocate2D(t,e)}marchLocate1D(e){var t=this.tds._infinite.triangle,i=t.indexV(this.tds._infinite),s=t.neighbours[i],n=Rt(s.vertices[0].point,s.vertices[1].point,e);if(n===ti.RIGHT_TURN||n===ti.LEFT_TURN)return{loc:new ai,lt:si.OUTSIDE_AFFINE_HULL,li:4};var r=s.indexT(t);if(At(e,s.vertices[1-r].point,s.vertices[r].point))return{loc:t,lt:si.OUTSIDE_CONVEX_HULL,li:i};if($t(e,s.vertices[1-r].point))return{loc:s,lt:si.VERTEX,li:1-r};if(t=t.neighbours[1-i],i=t.indexV(this.tds._infinite),s=t.neighbours[i],r=s.indexT(t),At(e,s.vertices[1-r].point,s.vertices[r].point))return{loc:t,lt:si.OUTSIDE_CONVEX_HULL,li:i};if($t(e,s.vertices[1-r].point))return{loc:s,lt:si.VERTEX,li:1-r};throw new Error("sdfsdf")}marchLocate2D(e,t){var i,s,n=null,r=!0;while(1){if(e.isInfinite())return{loc:e,lt:si.OUTSIDE_CONVEX_HULL,li:e.indexV(this.tds._infinite)};var o=0,a=e.vertices[0].point,l=e.vertices[1].point,c=e.vertices[2].point,h=void 0,u=void 0,d=void 0;if(r){if(n=e,r=!1,h=Rt(a,l,t),h===ti.NEGATIVE){e=e.neighbours[2];continue}if(u=Rt(l,c,t),u===ti.NEGATIVE){e=e.neighbours[0];continue}if(d=Rt(c,a,t),d===ti.NEGATIVE){e=e.neighbours[1];continue}}else if(o)if(e.neighbours[0]===n){if(n=e,h=Rt(a,l,t),h===ti.NEGATIVE){e=e.neighbours[2];continue}if(d=Rt(c,a,t),d===ti.NEGATIVE){e=e.neighbours[1];continue}u=ti.POSITIVE}else if(e.neighbours[1]===n){if(n=e,u=Rt(l,c,t),u===ti.NEGATIVE){e=e.neighbours[0];continue}if(h=Rt(a,l,t),h===ti.NEGATIVE){e=e.neighbours[2];continue}d=ti.POSITIVE}else{if(n=e,d=Rt(c,a,t),d===ti.NEGATIVE){e=e.neighbours[1];continue}if(u=Rt(l,c,t),u===ti.NEGATIVE){e=e.neighbours[0];continue}h=ti.POSITIVE}else if(e.neighbours[0]===n){if(n=e,d=Rt(c,a,t),d===ti.NEGATIVE){e=e.neighbours[1];continue}if(h=Rt(a,l,t),h===ti.NEGATIVE){e=e.neighbours[2];continue}u=ti.POSITIVE}else if(e.neighbours[1]===n){if(n=e,h=Rt(a,l,t),h===ti.NEGATIVE){e=e.neighbours[2];continue}if(u=Rt(l,c,t),u===ti.NEGATIVE){e=e.neighbours[0];continue}d=ti.POSITIVE}else{if(n=e,u=Rt(l,c,t),u===ti.NEGATIVE){e=e.neighbours[0];continue}if(d=Rt(c,a,t),d===ti.NEGATIVE){e=e.neighbours[1];continue}h=ti.POSITIVE}var p=(h===ti.COLLINEAR?1:0)+(u===ti.COLLINEAR?1:0)+(d===ti.COLLINEAR?1:0);switch(p){case 0:i=si.FACE,s=4;break;case 1:i=si.EDGE,s=h===ti.COLLINEAR?2:u===ti.COLLINEAR?0:1;break;case 2:i=si.VERTEX,s=h!==ti.COLLINEAR?2:u!==ti.COLLINEAR?0:1;break}if(void 0===i||void 0===s)throw new Error("ert");return{loc:e,lt:i,li:s}}}iLocate(e,t){if(this.tds.dimension<2)return t;if(null===t){var i=this.tds._infinite.triangle;t=i.neighbours[i.indexV(this.tds._infinite)]}else t.isInfinite()&&(t=t.neighbours[t.indexV(this.tds._infinite)]);var s=null,n=t,r=!0,o=2500;while(1){if(!o--)return n;if(n.isInfinite())return n;var a=n.vertices[0].point,l=n.vertices[1].point,c=n.vertices[2].point;if(r){if(s=n,r=!1,Ut(a,l,e)){n=n.neighbours[2];continue}if(Ut(l,c,e)){n=n.neighbours[0];continue}if(Ut(c,a,e)){n=n.neighbours[1];continue}}else if(n.neighbours[0]===s){if(s=n,Ut(a,l,e)){n=n.neighbours[2];continue}if(Ut(c,a,e)){n=n.neighbours[1];continue}}else if(n.neighbours[1]===s){if(s=n,Ut(a,l,e)){n=n.neighbours[2];continue}if(Ut(l,c,e)){n=n.neighbours[0];continue}}else{if(s=n,Ut(c,a,e)){n=n.neighbours[1];continue}if(Ut(l,c,e)){n=n.neighbours[0];continue}}break}return n}}(function(e){e["VISION"]="vision",e["MOVEMENT"]="movement"})(ni||(ni={}));var mi={vision:new gi,movement:new gi};function bi(e){var t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=new gi;for(var n of(mi[e]=s,t="vision"===e?wi.visionBlockers:wi.movementblockers,t)){var r=xt.UUIDMap.get(n);if(!i||r.visibleInCanvas(xt.getLayer().canvas))for(var o=r.isClosed?0:1,a=0;a<r.points.length-o;a++)s.insertConstraint(r.points[a],r.points[(a+1)%r.points.length])}s.insertConstraint([-1e8,-1e8],[-1e8,1e8]),s.insertConstraint([-1e8,1e8],[-1e11,1e8]),s.insertConstraint([-1e11,1e8],[-1e11,-1e8]),s.insertConstraint([-1e11,-1e8],[-1e8,-1e8]),s.insertConstraint([-1e8,-1e8],[1e8,-1e8]),s.insertConstraint([1e8,-1e8],[1e8,-1e11]),s.insertConstraint([1e8,-1e11],[-1e8,-1e11]),s.insertConstraint([-1e8,-1e11],[-1e8,-1e8]),s.insertConstraint([1e8,-1e8],[1e8,1e8]),s.insertConstraint([1e8,1e8],[1e11,1e8]),s.insertConstraint([1e11,1e8],[1e11,-1e8]),s.insertConstraint([1e11,-1e8],[1e8,-1e8]),s.insertConstraint([-1e8,1e8],[1e8,1e8]),s.insertConstraint([1e8,1e8],[1e8,1e11]),s.insertConstraint([1e8,1e11],[-1e8,1e11]),s.insertConstraint([-1e8,1e11],[-1e8,1e8]),window.CDT=mi}var yi=class extends E["d"]{constructor(){super(...arguments),this.BV=Object.freeze(new Et([])),this.visionMode="bvh",this.visionBlockers=[],this.movementblockers=[],this.visionSources=[]}setVisionMode(e){this.visionMode=e.mode,e.sync&&Xe.emit("Location.Options.Set",{vision_mode:e.mode})}recalculateVision(){"triangle"===this.visionMode?bi(ni.VISION):this.BV=Object.freeze(new Et(this.visionBlockers))}recalculateMovement(){"triangle"===this.visionMode&&bi(ni.MOVEMENT)}clear(){this.context.state.visionBlockers=[],this.context.state.visionSources=[],this.context.state.movementblockers=[],this.context.commit("recalculateVision"),this.context.commit("recalculateMovement")}};Object(f["a"])([E["c"]],yi.prototype,"setVisionMode",null),Object(f["a"])([E["c"]],yi.prototype,"recalculateVision",null),Object(f["a"])([E["c"]],yi.prototype,"recalculateMovement",null),Object(f["a"])([E["a"]],yi.prototype,"clear",null),yi=Object(f["a"])([Object(E["b"])({dynamic:!0,store:P,name:"visibility",namespaced:!0})],yi);var wi=Object(E["e"])(yi);class xi{constructor(e,t,i,s){this.fillColour="#000",this.strokeColour="rgba(0,0,0,0)",this.name="Unknown shape",this.nameVisible=!0,this.trackers=[],this.auras=[],this.labels=[],this._owners=[],this.visionObstruction=!1,this.movementObstruction=!1,this.isToken=!1,this.showHighlight=!1,this.annotation="",this.globalCompositeOperation="source-over",this.options=new Map,this._refPoint=e,this.uuid=s||ae(),void 0!==t&&(this.fillColour=t),void 0!==i&&(this.strokeColour=i)}get isClosed(){return!0}get refPoint(){return this._refPoint}set refPoint(e){this._refPoint=e}visibleInCanvas(e){return!1}getPointIndex(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(var[i,s]of this.points.entries())if(Math.abs(e.x-s[0])<=t&&Math.abs(e.y-s[1])<=t)return i;return-1}getPointOrientation(e){var t=Qe.fromArray(this.points[(this.points.length+e-1)%this.points.length]),i=Qe.fromArray(this.points[e]),s=Qe.fromArray(this.points[(e+1)%this.points.length]),n=s.subtract(t),r=t.add(n.multiply(.5));return i.subtract(r).normalize()}invalidate(e){var t=xt.getLayer(this.layer);t&&t.invalidate(e)}checkVisionSources(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this,i=wi.visionBlockers.indexOf(this.uuid),s=!1;this.visionObstruction&&-1===i?(wi.visionBlockers.push(this.uuid),s=!0):!this.visionObstruction&&i>=0&&(wi.visionBlockers.splice(i,1),s=!0),s&&e&&wi.recalculateVision();var n=function(e){var i=wi.visionSources,s=i.findIndex(t=>t.aura===e.uuid);e.visionSource&&-1===s?i.push({shape:t.uuid,aura:e.uuid}):!e.visionSource&&s>=0&&i.splice(s,1)};for(var r of this.auras)n(r);for(var o=function(e){var i=wi.visionSources[e];i.shape===t.uuid&&(t.auras.some(e=>e.uuid===i.aura&&e.visionSource)||wi.visionSources.splice(e,1))},a=wi.visionSources.length-1;a>=0;a--)o(a)}setMovementBlock(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.movementObstruction=e||!1;var i=wi.movementblockers.indexOf(this.uuid),s=!1;this.movementObstruction&&-1===i?(wi.movementblockers.push(this.uuid),s=!0):!this.movementObstruction&&i>=0&&(wi.movementblockers.splice(i,1),s=!0),s&&t&&wi.recalculateMovement()}setIsToken(e){if(this.isToken=e,this.ownedBy()){var t=yt.ownedtokens.indexOf(this.uuid);this.isToken&&-1===t?yt.ownedtokens.push(this.uuid):!this.isToken&&t>=0&&yt.ownedtokens.splice(t,1)}}getBaseDict(){return{type_:this.type,uuid:this.uuid,x:this.refPoint.x,y:this.refPoint.y,layer:this.layer,draw_operator:this.globalCompositeOperation,movement_obstruction:this.movementObstruction,vision_obstruction:this.visionObstruction,auras:_t(this.auras),trackers:this.trackers,labels:this.labels,owners:this._owners,fill_colour:this.fillColour,stroke_colour:this.strokeColour,name:this.name,name_visible:this.nameVisible,annotation:this.annotation,is_token:this.isToken,options:JSON.stringify([...this.options])}}fromDict(e){this.layer=e.layer,this.globalCompositeOperation=e.draw_operator,this.movementObstruction=e.movement_obstruction,this.visionObstruction=e.vision_obstruction,this.auras=Ct(e.auras),this.trackers=e.trackers,this.labels=e.labels,this._owners=e.owners,this.isToken=e.is_token,this.nameVisible=e.name_visible,e.annotation&&(this.annotation=e.annotation),e.name&&(this.name=e.name),e.options&&(this.options=new Map(JSON.parse(e.options)))}draw(e){if(void 0!==this.globalCompositeOperation?e.globalCompositeOperation=this.globalCompositeOperation:e.globalCompositeOperation="source-over",this.showHighlight){var t=this.getBoundingBox();e.strokeStyle="red",e.strokeRect(st(t.topLeft.x)-5,nt(t.topLeft.y)-5,rt(t.w)+10,rt(t.h)+10)}}drawAuras(e){for(var t of this.auras){if(0===t.value&&0===t.dim)return;e.beginPath();var i=it(this.center()),s=at(t.value+t.dim);if(0===t.dim)e.fillStyle=t.colour;else{var n=e.createRadialGradient(i.x,i.y,at(t.value),i.x,i.y,at(t.value+t.dim)),r=pt()(t.colour);e.fillStyle=n,n.addColorStop(0,t.colour),n.addColorStop(1,r.setAlpha(0).toRgbString())}if(t.visionSource&&void 0!==t.lastPath)try{e.fill(t.lastPath)}catch(o){e.arc(i.x,i.y,s,0,2*Math.PI),e.fill(),console.warn(o)}else e.arc(i.x,i.y,s,0,2*Math.PI),e.fill()}}drawSelection(e){e.globalCompositeOperation=this.globalCompositeOperation;var t=yt.zoomFactor,i=this.getBoundingBox();for(var s of(e.strokeRect(st(i.topLeft.x),nt(i.topLeft.y),i.w*t,i.h*t),this.points))e.beginPath(),e.arc(st(s[0]),nt(s[1]),3,0,2*Math.PI),e.fill();e.beginPath(),e.moveTo(st(this.points[0][0]),nt(this.points[0][1]));for(var n=this.isClosed?0:1,r=1;r<=this.points.length-n;r++){var o=this.points[r%this.points.length];e.lineTo(st(o[0]),nt(o[1]))}e.stroke()}getInitiativeRepr(){return{uuid:this.uuid,visible:!yt.IS_DM,group:!1,source:this.name,has_img:!1,effects:[],index:1/0}}moveLayer(e,t){var i=xt.getLayer(this.layer),s=xt.getLayer(e);void 0!==i&&void 0!==s&&(this.layer=e,i.shapes.splice(i.shapes.indexOf(this),1),s.shapes.push(this),i.invalidate(!0),s.invalidate(!1),t&&Xe.emit("Shape.Layer.Change",{uuid:this.uuid,layer:e}))}get owners(){return Object.freeze(this._owners.slice())}ownedBy(e){return void 0===e&&(e=yt.username),yt.IS_DM||this._owners.includes(e)||yt.FAKE_PLAYER&&yt.activeTokens.includes(this.uuid)}addOwner(e){this._owners.includes(e)||this._owners.push(e)}updateOwner(e,t){var i=this._owners.findIndex(t=>t===e);i>=0?this._owners.splice(i,1,t):this.addOwner(t)}removeOwner(e){var t=this._owners.findIndex(t=>t===e);this._owners.splice(t,1)}}function Si(e,t,i){if(0===e.x&&0===e.y)return e;if("bvh"===wi.visionMode){void 0===i&&(i=[]);var s=t.getBoundingBox(),n=s.offset(e),r=!1;for(var o of wi.movementblockers)if(!i.includes(o)){var a=xt.UUIDMap.get(o),l=a.getBoundingBox(),c=l.intersectsWithInner(n);if(!c){var h=et.fromPoints(s.topLeft.add(e.normalize()),n.topLeft),u=h.direction.inverse(),d=[u.x<0,u.y<0];c=l.intersectP(h,u,d).hit}if(c){var p=l.center(),v=s.center(),f=v.subtract(p),g=new Je(1,0),m=new Je(0,1),b=f.dot(g),y=f.dot(m);b>l.w/2&&(b=l.w/2),b<-l.w/2&&(b=-l.w/2),y>l.h/2&&(y=l.h/2),y<-l.h/2&&(y=-l.h/2);var w=p.add(g.multiply(b)).add(m.multiply(y));w.x===s.topLeft.x||w.x===s.topRight.x?e=new Je(0,e.y):w.y===s.topLeft.y||w.y===s.botLeft.y?e=new Je(e.x,0):w.x<s.topLeft.x?e=new Je(w.x-s.topLeft.x,e.y):w.x>s.topRight.x?e=new Je(w.x-s.topRight.x,e.y):w.y<s.topLeft.y?e=new Je(e.x,w.y-s.topLeft.y):w.y>s.botLeft.y&&(e=new Je(e.x,w.y-s.botLeft.y)),r=!0,i.push(o);break}}return r&&(e=Si(e,t,i)),e}var x=mi.movement.locate(t.center().asArray(),null).loc;for(var S of t.points){var C=mi.movement.locate(S,x),_=C.loc;null!==_&&(e=Ci(S,_,e))}return e}function Ci(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=new Qe(e[0],e[1]),r=n.add(i).asArray();if(t.contains(r))return i;s.push(t);for(var o=0;o<3;o++)if(!s.includes(t.neighbours[o])){var a=t.vertices[Pt(o)].point,l=t.vertices[Mt(o)].point,c=Wt(e,r,a,l);if(null!==c){if(!t.isConstrained(o))return Ci(e,t.neighbours[o],i,s);if(c[0]===n.x&&c[1]===n.y){var h=Rt(e,r,l);if(h===ti.LEFT_TURN)continue;if(h===ti.ZERO)continue}var u=new Qe(c[0],c[1]).subtract(n).multiply(.8);u.length()<1&&(u=new Je(0,0)),u.length()<i.length()&&(i=u)}}return i}class _i extends xi{constructor(e,t,i,s,n,r){super(e,s,n,r),this.w=t,this.h=i}getBaseDict(){return Object.assign(super.getBaseDict(),{width:this.w,height:this.h})}getBoundingBox(){return new St(this.refPoint,this.w,this.h)}get points(){if(0===this.w||0===this.h)return[[this.refPoint.x,this.refPoint.y]];var e=this.refPoint.add(new Je(0,this.h)),t=this.refPoint.add(new Je(this.w,this.h)),i=this.refPoint.add(new Je(this.w,0));return[[this.refPoint.x,this.refPoint.y],[e.x,e.y],[t.x,t.y],[i.x,i.y]]}contains(e){return this.refPoint.x<=e.x&&this.refPoint.x+this.w>=e.x&&this.refPoint.y<=e.y&&this.refPoint.y+this.h>=e.y}center(e){if(void 0===e)return this.refPoint.add(new Je(this.w/2,this.h/2));this.refPoint=new Qe(e.x-this.w/2,e.y-this.h/2)}visibleInCanvas(e){if(super.visibleInCanvas(e))return!0;var t=!(st(this.refPoint.x)>e.width||nt(this.refPoint.y)>e.height||st(this.refPoint.x+this.w)<0||nt(this.refPoint.y+this.h)<0);return!!t}snapToGrid(){var e,t,i=yt.gridSize,s=this.center(),n=s.x,r=s.y;e=this.w/i%2===0?Math.round(n/i)*i-this.w/2:(Math.round((n+i/2)/i)-.5)*i-this.w/2,t=this.h/i%2===0?Math.round(r/i)*i-this.h/2:(Math.round((r+i/2)/i)-.5)*i-this.h/2;var o=Si(new Je(e-this.refPoint.x,t-this.refPoint.y),this);this.refPoint=this.refPoint.add(o),this.invalidate(!1)}resizeToGrid(){var e=yt.gridSize;this.refPoint=new Qe(Math.round(this.refPoint.x/e)*e,Math.round(this.refPoint.y/e)*e),this.w=Math.max(Math.round(this.w/e)*e,e),this.h=Math.max(Math.round(this.h/e)*e,e),this.invalidate(!1)}resize(e,t){var i=yt.zoomFactor;switch(e){case 0:this.w=st(this.refPoint.x)+this.w*i-t.x,this.h=nt(this.refPoint.y)+this.h*i-t.y,this.refPoint=lt(t);break;case 1:this.w=st(this.refPoint.x)+this.w*i-t.x,this.h=t.y-nt(this.refPoint.y),this.refPoint=new Qe(ct(t.x),this.refPoint.y);break;case 2:this.w=t.x-st(this.refPoint.x),this.h=t.y-nt(this.refPoint.y);break;case 3:this.w=t.x-st(this.refPoint.x),this.h=nt(this.refPoint.y)+this.h*i-t.y,this.refPoint=new Qe(this.refPoint.x,ht(t.y));break}this.w/=i,this.h/=i,this.w<0&&(this.refPoint=this.refPoint.add(new Je(this.w,0)),this.w=Math.abs(this.w)),this.h<0&&(this.refPoint=this.refPoint.add(new Je(0,this.h)),this.h=Math.abs(this.h))}}class Oi extends _i{constructor(e,t,i,s,n){super(t,i,s,void 0,void 0,n),this.type="assetrect",this.src="",this.img=e}asDict(){return Object.assign(this.getBaseDict(),{src:this.src})}fromDict(e){super.fromDict(e),this.src=e.src}draw(e){super.draw(e);try{e.drawImage(this.img,st(this.refPoint.x),nt(this.refPoint.y),rt(this.w),rt(this.h))}catch(t){console.warn("Shape ".concat(this.uuid," could not load the image ").concat(this.src))}}getInitiativeRepr(){return{uuid:this.uuid,visible:!yt.IS_DM,group:!1,source:this.src,has_img:!0,effects:[],index:1/0}}}class ki extends xi{constructor(e,t,i,s,n){super(e,i,s,n),this.type="circle",this.r=t||1}asDict(){return Object.assign(this.getBaseDict(),{radius:this.r})}fromDict(e){super.fromDict(e),this.r=e.radius}getBoundingBox(){return new St(new Qe(this.refPoint.x-this.r,this.refPoint.y-this.r),2*this.r,2*this.r)}get points(){return this.getBoundingBox().points}draw(e){super.draw(e),e.beginPath(),"fog"===this.fillColour?e.fillStyle=ft():e.fillStyle=this.fillColour;var t=it(this.refPoint);if(e.arc(t.x,t.y,rt(this.r),0,2*Math.PI),e.fill(),"rgba(0, 0, 0, 0)"!==this.strokeColour){var i=5;e.beginPath(),e.lineWidth=rt(i),e.strokeStyle=this.strokeColour,e.arc(t.x,t.y,Math.max(i/2,rt(this.r-i/2)),0,2*Math.PI),e.stroke()}}contains(e){return Math.pow(e.x-this.refPoint.x,2)+Math.pow(e.y-this.refPoint.y,2)<Math.pow(this.r,2)}center(e){if(void 0===e)return this.refPoint;this.refPoint=e}visibleInCanvas(e){return this.getBoundingBox().visibleInCanvas(e)}snapToGrid(){var e,t,i=yt.gridSize;e=2*this.r/i%2===0?Math.round(this.refPoint.x/i)*i:Math.round((this.refPoint.x-i/2)/i)*i+this.r,t=2*this.r/i%2===0?Math.round(this.refPoint.y/i)*i:Math.round((this.refPoint.y-i/2)/i)*i+this.r;var s=Si(new Je(e-this.refPoint.x,t-this.refPoint.y),this);this.refPoint=this.refPoint.add(s),this.invalidate(!1)}resizeToGrid(){var e=yt.gridSize;this.r=Math.max(Math.round(this.r/e)*e,e/2),this.invalidate(!1)}resize(e,t){var i=lt(t).subtract(this.refPoint);this.r=Math.sqrt(Math.pow(i.length(),2)/2)}}class Li extends ki{constructor(e,t,i,s,n,r,o){super(e,t,n,r,o),this.type="circulartoken",this.text=i,this.font=s}asDict(){return Object.assign(this.getBaseDict(),{radius:this.r,text:this.text,font:this.font})}fromDict(e){super.fromDict(e),this.r=e.radius,this.text=e.text,this.font=e.font}draw(e){super.draw(e),e.font=this.font,e.save();var t=it(this.center());e.textAlign="center",e.textBaseline="middle";var i=he(e,this.text,rt(this.r-5));e.setTransform(i,0,0,i,t.x,t.y),e.fillStyle=dt["mostReadable"](this.fillColour,["#000","#fff"]).toHexString(),e.fillText(this.text,0,0),e.restore()}getInitiativeRepr(){return{uuid:this.uuid,visible:!yt.IS_DM,group:!1,source:""===this.name||"Unknown shape"===this.name?this.text:this.name,has_img:!1,effects:[],index:1/0}}}class Ei extends xi{constructor(e,t,i,s,n){super(e,"rgba(0, 0, 0, 0)",s||"#000",n),this.type="line",this.endPoint=t,this.lineWidth=void 0===i?1:i}get isClosed(){return!1}asDict(){return Object.assign(this.getBaseDict(),{x2:this.endPoint.x,y2:this.endPoint.y,line_width:this.lineWidth})}get points(){return[[this.refPoint.x,this.refPoint.y],[this.endPoint.x,this.endPoint.y]]}getBoundingBox(){return new St(new Qe(Math.min(this.refPoint.x,this.endPoint.x),Math.min(this.refPoint.y,this.endPoint.y)),Math.abs(this.refPoint.x-this.endPoint.x),Math.abs(this.refPoint.y-this.endPoint.y))}draw(e){super.draw(e),e.strokeStyle=this.strokeColour,e.beginPath(),e.moveTo(st(this.refPoint.x),nt(this.refPoint.y)),e.lineTo(st(this.endPoint.x),nt(this.endPoint.y)),e.lineWidth=rt(this.lineWidth),e.stroke()}contains(e){return!1}center(e){}visibleInCanvas(e){return this.getBoundingBox().visibleInCanvas(e)}snapToGrid(){}resizeToGrid(){}resize(e,t){0===e?this.refPoint=lt(t):this.endPoint=lt(t)}}class Ii extends _i{constructor(e,t,i,s,n,r){super(e,t,i,s,n,r),this.type="rect"}asDict(){return super.getBaseDict()}draw(e){super.draw(e),"fog"===this.fillColour?e.fillStyle=ft():e.fillStyle=this.fillColour;var t=yt.zoomFactor,i=it(this.refPoint);e.fillRect(i.x,i.y,this.w*t,this.h*t),"rgba(0, 0, 0, 0)"!==this.strokeColour&&(e.strokeStyle=this.strokeColour,e.lineWidth=5,e.strokeRect(i.x,i.y,this.w*t,this.h*t))}}class Pi extends xi{constructor(e,t,i,s,n,r,o){super(e,n,r,o),this.type="text",this.text=t,this.font=i,this.angle=s||0}asDict(){return Object.assign(this.getBaseDict(),{text:this.text,font:this.font,angle:this.angle})}get points(){return[[this.refPoint.x,this.refPoint.y]]}getBoundingBox(){return new St(this.refPoint,5,5)}draw(e){super.draw(e),e.font=this.font,e.fillStyle=this.fillColour,e.save();var t=it(this.refPoint);e.translate(t.x,t.y),e.rotate(this.angle),e.textAlign="center",this.getLines(e).map(t=>e.fillText(t.text,t.x,t.y)),e.restore()}contains(e){return!1}center(e){}visibleInCanvas(e){return this.getBoundingBox().visibleInCanvas(e)}snapToGrid(){}resizeToGrid(){}resize(e,t){}getMaxHeight(e){var t=this.getLines(e),i=30;return i*t.length}getMaxWidth(e){var t=this.getLines(e),i=t.map(t=>e.measureText(t.text).width);return Math.max(...i)}getLines(e){var t=this.text.split("\n"),i=[],s=e.canvas.width,n=30,r=0,o=0;for(var a of t){var l="",c=a.split(" ");for(var h of c){var u=l+h+" ",d=e.measureText(u),p=d.width;p>s?(e.fillText(l,r,o),i.push({text:l,x:r,y:o}),l=h+" ",o+=n):l=u}i.push({text:l,x:r,y:o}),o+=n}return i}}class Mi extends xi{constructor(e,t,i,s,n){var r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6?arguments[6]:void 0;super(e,i,s,o),this.type="polygon",this._vertices=[],this.openPolygon=!1,this._vertices=t||[],this.openPolygon=r,this.lineWidth=n||2}get isClosed(){return!this.openPolygon}get refPoint(){return this._refPoint}set refPoint(e){var t=e.subtract(this._refPoint);this._refPoint=e;for(var i=0;i<this._vertices.length;i++)this._vertices[i]=this._vertices[i].add(t)}get vertices(){return[this._refPoint,...this._vertices]}asDict(){return Object.assign(this.getBaseDict(),{vertices:this._vertices.map(e=>({x:e.x,y:e.y})),open_polygon:this.openPolygon,line_width:this.lineWidth})}fromDict(e){super.fromDict(e),this._vertices=e.vertices.map(e=>new Qe(e.x,e.y)),this.openPolygon=e.open_polygon,this.lineWidth=e.line_width}get points(){return this.vertices.map(e=>[e.x,e.y])}draw(e){super.draw(e),e.lineCap="round",e.lineJoin="round",e.lineWidth=rt(this.lineWidth),"fog"===this.strokeColour?e.strokeStyle=ft():e.strokeStyle=this.strokeColour,"fog"===this.fillColour?e.fillStyle=ft():e.fillStyle=this.fillColour,e.beginPath(),e.moveTo(st(this.vertices[0].x),nt(this.vertices[0].y));for(var t=1;t<=this.vertices.length-(this.openPolygon?1:0);t++){var i=this.vertices[t%this.vertices.length];e.lineTo(st(i.x),nt(i.y))}this.openPolygon||e.fill(),e.stroke()}contains(e){return this.getBoundingBox().contains(e)}center(e){return this.getBoundingBox().center()}visibleInCanvas(e){return this.getBoundingBox().visibleInCanvas(e)}snapToGrid(){}resizeToGrid(){}resize(e,t){0===e?this._refPoint=lt(t):this._vertices[e-1]=lt(t)}getBoundingBox(){var e=this.refPoint.x,t=this.refPoint.x,i=this.refPoint.y,s=this.refPoint.y;for(var n of this._vertices)n.x<e&&(e=n.x),n.x>t&&(t=n.x),n.y<i&&(i=n.y),n.y>s&&(s=n.y);return new St(new Qe(e,i),t-e,s-i)}}function Ti(e){var t,i=new Qe(e.x,e.y);if("rect"===e.type_){var s=e;t=new Ii(i,s.width,s.height,s.fill_colour,s.stroke_colour,s.uuid)}else if("circle"===e.type_){var n=e;t=new ki(i,n.radius,n.fill_colour,n.stroke_colour,n.uuid)}else if("circulartoken"===e.type_){var r=e;t=new Li(i,r.radius,r.text,r.font,r.fill_colour,r.stroke_colour,r.uuid)}else if("line"===e.type_){var o=e;t=new Ei(i,new Qe(o.x2,o.y2),o.line_width,o.stroke_colour,o.uuid)}else if("polygon"===e.type_){var a=e;t=new Mi(i,a.vertices.map(e=>new Qe(e.x,e.y)),a.fill_colour,a.stroke_colour,a.line_width,a.open_polygon,a.uuid)}else if("text"===e.type_){var l=e;t=new Pi(i,l.text,l.font,l.angle,l.fill_colour,l.stroke_colour,l.uuid)}else{if("assetrect"!==e.type_)return;var c=e,h=new Image(c.width,c.height);c.src.startsWith("http")?h.src=new URL(c.src).pathname:h.src=c.src,t=new Oi(h,i,c.width,c.height,c.uuid),h.onload=()=>{xt.getLayer(e.layer).invalidate(!1)}}return t.fromDict(e),t}function Ai(){var e=xt.getLayer();if(e&&e.selection){var t=[];for(var i of e.selection)yt.selectionHelperID!==i.uuid&&t.push(i.asDict());yt.setClipboard(t),yt.setClipboardPosition(yt.screenCenter)}}function Di(e){var t=xt.getLayer(e);if(!t)return[];if(!yt.clipboard)return[];t.selection=[];var i=yt.screenCenter.subtract(yt.clipboardPosition);for(var s of(yt.setClipboardPosition(yt.screenCenter),i.squaredLength()<200&&(i=new Je(10,10)),yt.clipboard)){s.x+=i.x,s.y+=i.y,s.uuid=ae();var n=s.trackers;for(var r of(s.trackers=[],n)){var o=Object.assign(Object.assign({},r),{uuid:ae()});s.trackers.push(o)}var a=s.auras;for(var l of(s.auras=[],a)){var c=Object.assign(Object.assign({},l),{uuid:ae()});s.auras.push(c)}var h=Ti(s);void 0!==h&&(t.addShape(h,!0),t.selection.push(h))}return 1===t.selection.length?Ke.$emit("SelectionInfo.Shape.Set",t.selection[0]):Ke.$emit("SelectionInfo.Shape.Set",null),t.invalidate(!1),t.selection}function Ri(){if(void 0!==xt.getLayer)for(var e=xt.getLayer(),t=e.selection.length-1;t>=0;t--){var i=e.selection[t];yt.selectionHelperID!==i.uuid?(e.removeShape(i,!0,!1),Ke.$emit("SelectionInfo.Shape.Set",null),Ke.$emit("Initiative.Remove",i.uuid)):e.selection.splice(t,1)}else console.log("No active layer selected for delete operation")}function Ni(){Ai(),Ri()}class Ui{constructor(e,t){this.selectable=!1,this.playerEditable=!1,this.isVisionLayer=!1,this.valid=!1,this.shapes=[],this.selection=[],this.selectionColor="#CC0000",this.selectionWidth=2,this.canvas=e,this.name=t,this.width=e.width,this.height=e.height,this.ctx=e.getContext("2d")}invalidate(e){this.valid=!1,e||xt.invalidateLight()}addShape(e,t,i){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];void 0===i&&(i=!1),e.layer=this.name,this.shapes.push(e),xt.UUIDMap.set(e.uuid,e),e.checkVisionSources(s),e.setMovementBlock(e.movementObstruction,s),e.ownedBy(yt.username)&&e.isToken&&yt.ownedtokens.push(e.uuid),e.annotation.length&&yt.annotations.push(e.uuid),t&&Xe.emit("Shape.Add",{shape:e.asDict(),temporary:i}),s&&this.invalidate(!t)}setShapes(e){for(var t of e){var i=Ti(t);if(void 0===i)return void console.log("Shape with unknown type ".concat(t.type_," could not be added"));this.addShape(i,!1,!1,!1)}this.clearSelection(),this.invalidate(!1)}removeShape(e,t,i){void 0===i&&(i=!1);var s=this.shapes.indexOf(e);if(s<0)console.error("attempted to remove shape not in layer.");else{this.shapes.splice(s,1),t&&Xe.emit("Shape.Remove",{shape:e.asDict(),temporary:i});var n=wi.visionSources.findIndex(t=>t.shape===e.uuid),r=wi.visionBlockers.findIndex(t=>t===e.uuid),o=wi.movementblockers.findIndex(t=>t===e.uuid),a=yt.annotations.findIndex(t=>t===e.uuid);n>=0&&wi.visionSources.splice(n,1),r>=0&&wi.visionBlockers.splice(r,1),o>=0&&wi.movementblockers.splice(o,1),a>=0&&yt.annotations.splice(a,1);var l=yt.annotations.indexOf(e.uuid);l>=0&&yt.annotations.splice(l,1);var c=yt.ownedtokens.indexOf(e.uuid);c>=0&&yt.ownedtokens.splice(c,1),xt.UUIDMap.delete(e.uuid);var h=this.selection.indexOf(e);h>=0&&this.selection.splice(h,1),r>=0&&wi.recalculateVision(),o>=0&&wi.recalculateMovement(),this.invalidate(!t)}}clear(){this.ctx.clearRect(0,0,this.width,this.height)}clearSelection(){this.selection=[],Ke.$emit("SelectionInfo.Shape.Set",null)}draw(e){if(!this.valid){var t=this.ctx,i=t.globalCompositeOperation;e=void 0===e||e,e&&this.clear();var s=this;for(var n of this.shapes)n.options.has("skipDraw")&&n.options.get("skipDraw")||void 0!==xt.getLayer()&&n.visibleInCanvas(s.canvas)&&("fow"===s.name&&xt.getLayer().name!==s.name||n.drawAuras(t));for(var r of this.shapes)r.options.has("skipDraw")&&r.options.get("skipDraw")||0===r.labels.length&&yt.filterNoLabel||r.labels.length&&yt.labelFilters.length&&!r.labels.some(e=>yt.labelFilters.includes(e.uuid))||void 0!==xt.getLayer()&&r.visibleInCanvas(s.canvas)&&("fow"===s.name&&xt.getLayer().name!==s.name||r.draw(t));if(null!=this.selection)for(var o of(t.fillStyle=this.selectionColor,t.strokeStyle=this.selectionColor,t.lineWidth=this.selectionWidth,this.selection))o.drawSelection(t);t.globalCompositeOperation=i,this.valid=!0}}moveShapeOrder(e,t,i){var s=this.shapes.indexOf(e);s!==t&&(this.shapes.splice(s,1),this.shapes.splice(t,0,e),i&&Xe.emit("Shape.Order.Set",{shape:e.asDict(),index:t}),this.invalidate(!0))}}class ji{}function zi(e,t){var i=xt.getLayer("draw");if(void 0!==i){var s=i.ctx;for(var n of(s.lineJoin="round",s.lineJoin="round",s.beginPath(),s.strokeStyle=void 0===t?"rgb(".concat(255*Math.random(),", ").concat(255*Math.random(),", ").concat(255*Math.random(),")"):t,s.moveTo(st(e[0][0]),nt(e[0][1])),e))s.lineTo(st(n[0]),nt(n[1]));s.closePath(),s.stroke()}}function $i(e,t){var i=xt.getLayer("draw");if(void 0!==i){var s=i.ctx;for(var n of(s.lineJoin="round",s.lineJoin="round",s.beginPath(),s.strokeStyle=void 0===t?"rgb(".concat(255*Math.random(),", ").concat(255*Math.random(),", ").concat(255*Math.random(),")"):t,s.moveTo(e[0][0],e[0][1]),e))s.lineTo(n[0],n[1]);s.closePath(),s.stroke()}}function Fi(e,t){return t?e:st(e)}function Vi(e,t){return t?e:nt(e)}ji.angleSteps=4,ji.drawAngleLines=!1,ji.drawFirstLightHit=!1,ji.skipPlayerFOW=!1,ji.skipLightFOW=!1,ji.tempFill="fog";var Hi=0,Bi=0;function Gi(e,t,i,s,n){e.beginPath(),e.strokeStyle=s?"rgba(255, 0, 0, 0.30)":"rgba(0, 0, 0, 0.30)",e.moveTo(Fi(t[0],n),Vi(t[1],n)),e.lineTo(Fi(i[0],n),Vi(i[1],n)),e.closePath(),e.stroke()}function Wi(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Hi=0,Bi=0;var n=0,r=xt.getLayer("draw");if(void 0!==r){var o=r.ctx;i&&o.clearRect(0,0,2e3,1e3),o.lineJoin="round",o.lineJoin="round";var a=new hi(e);while(a.valid)a.next(),a.collect();a.collect();do{var l=a.edge.first.vertices[Mt(a.edge.second)].point,c=a.edge.first.vertices[Pt(a.edge.second)].point;if(s>0){if(l[0]===-1/0||c[0]===-1/0){a.next();continue}Bi++,a.edge.first.constraints[a.edge.second]?(Hi++,2===s&&console.log("Edge: (*) ".concat(l," > ").concat(c))):2===s&&console.log("Edge: ".concat(l," > ").concat(c))}do{a.next(),a.collect()}while(a.valid)}while(null!==a.pos);for(var h of e.triangles)if(!h.isInfinite()){n++;var u=[];o.fillStyle="red",void 0!==h.vertices[0]&&(u.push(h.vertices[0].point),o.beginPath(),o.arc(Fi(h.vertices[0].point[0],t),Vi(h.vertices[0].point[1],t),5,0,2*Math.PI),o.closePath(),o.fill()),void 0!==h.vertices[1]&&(u.push(h.vertices[1].point),o.arc(Fi(h.vertices[1].point[0],t),Vi(h.vertices[1].point[1],t),5,0,2*Math.PI),o.closePath(),o.fill()),void 0!==h.vertices[2]&&(u.push(h.vertices[2].point),o.arc(Fi(h.vertices[2].point[0],t),Vi(h.vertices[2].point[1],t),5,0,2*Math.PI),o.closePath(),o.fill()),2===s&&console.log("[T] ",...u,h.constraints),o.moveTo(Fi(h.vertices[0].point[0],t),Vi(h.vertices[0].point[1],t)),void 0!==h.vertices[0]&&void 0!==h.vertices[1]&&Gi(o,h.vertices[0].point,h.vertices[1].point,h.constraints[2],t),void 0!==h.vertices[1]&&void 0!==h.vertices[2]&&Gi(o,h.vertices[1].point,h.vertices[2].point,h.constraints[0],t),void 0!==h.vertices[2]&&void 0!==h.vertices[0]&&Gi(o,h.vertices[2].point,h.vertices[0].point,h.constraints[1],t)}s>0&&(console.log("Edges: ".concat(Hi,"/").concat(Bi)),console.log("Faces: ".concat(n)))}}function Xi(e,t,i){void 0===i&&(i=yt.drawTEContour);var s=[e.x,e.y],n=[],r=mi[t].locate(s,null).loc;return null===r?(console.error("Triangle not found"),[]):(n.push(r.vertices[1].point),r.isConstrained(0)||Yi(s,r.vertices[2].point,r.vertices[1].point,r,0,n),n.push(r.vertices[2].point),r.isConstrained(1)||Yi(s,r.vertices[0].point,r.vertices[2].point,r,1,n),n.push(r.vertices[0].point),r.isConstrained(2)||Yi(s,r.vertices[1].point,r.vertices[0].point,r,2,n),i&&zi(n,"red"),n)}function Yi(e,t,i,s,n,r){var o=s.neighbours[n],a=o.indexT(s),l=Mt(a),c=Pt(a),h=o.vertices[a],u=o.vertices[c],d=o.vertices[l],p=[o,l],v=[o,c],f=Rt(e,i,h.point),g=Rt(e,t,h.point);if(f===ti.COUNTERCLOCKWISE)if(p[0].isConstrained(p[1]))i!==u.point&&r.push(Ki(e,i,h.point,u.point)),g===ti.COUNTERCLOCKWISE&&r.push(Ki(e,t,h.point,u.point));else{if(g===ti.COUNTERCLOCKWISE)return Yi(e,t,i,o,l,r);Yi(e,h.point,i,o,l,r)}if(f!==ti.CLOCKWISE&&g!==ti.COUNTERCLOCKWISE&&r.push(h.point),g===ti.CLOCKWISE)return v[0].isConstrained(v[1])?(f===ti.CLOCKWISE&&r.push(Ki(e,i,h.point,d.point)),void(t!==d.point&&r.push(Ki(e,t,h.point,d.point)))):f===ti.CLOCKWISE?Yi(e,t,i,o,c,r):Yi(e,t,h.point,o,c,r)}function Ki(e,t,i,s){var n=(s[1]-i[1])*(t[0]-e[0])-(s[0]-i[0])*(t[1]-e[1]),r=((s[0]-i[0])*(e[1]-i[1])-(s[1]-i[1])*(e[0]-i[0]))/n,o=e[0]+r*(t[0]-e[0]),a=e[1]+r*(t[1]-e[1]);return[o,a]}window.DP=zi,window.DPL=$i,window.DPT=Wi;class qi extends Ui{constructor(e,t){super(e,t),this.isVisionLayer=!0,this.preFogShapes=[],this.virtualCanvas=document.createElement("canvas"),this.virtualCanvas.width=window.innerWidth,this.virtualCanvas.height=window.innerHeight,this.vCtx=this.virtualCanvas.getContext("2d")}addShape(e,t,i){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super.addShape(e,t,i,s),e.options.has("preFogShape")&&e.options.get("preFogShape")&&this.preFogShapes.push(e)}removeShape(e,t,i){if(e.options.has("preFogShape")&&e.options.get("preFogShape")){var s=this.preFogShapes.findIndex(t=>t.uuid===e.uuid);this.preFogShapes.splice(s,1)}super.removeShape(e,t,i)}draw(){var e=this;if(!this.valid){var t=this.ctx;if(ji.skipLightFOW)return t.clearRect(0,0,this.canvas.width,this.canvas.height),void(this.valid=!0);var i=t.globalCompositeOperation;t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle="rgba(0, 0, 0, 1)";var s=xt.getLayer("draw").ctx;if((ji.drawAngleLines||ji.drawFirstLightHit)&&s.clearRect(0,0,s.canvas.width,s.canvas.height),yt.fullFOW&&xt.hasLayer("tokens"))for(var n of xt.getLayer("tokens").shapes)if(n.ownedBy()&&n.isToken){var r=n.getBoundingBox(),o=it(n.center()),a=.8*rt(r.w);t.beginPath(),t.arc(o.x,o.y,a,0,2*Math.PI);var l=t.createRadialGradient(o.x,o.y,a/2,o.x,o.y,a);l.addColorStop(0,"rgba(0, 0, 0, 1)"),l.addColorStop(1,"rgba(0, 0, 0, 0)"),t.fillStyle=l,t.fill()}this.vCtx.clearRect(0,0,window.innerWidth,window.innerHeight);var c=function(i){var n=xt.UUIDMap.get(i.shape);if(void 0===n)return"continue";var r=n.auras.find(e=>e.uuid===i.aura);if(void 0===r)return"continue";var o=ot(r.value+r.dim),a=n.center(),l=it(a),c=new ki(a,o);if(!c.visibleInCanvas(t.canvas))return"continue";if("bvh"===wi.visionMode){var h,u=-1,d=new Path2D;d.moveTo(l.x,l.y);for(var p=0;p<2*Math.PI;p+=ji.angleSteps/180*Math.PI){var v=new Qe(a.x+o*Math.cos(p),a.y+o*Math.sin(p));ji.drawAngleLines&&(s.beginPath(),s.moveTo(st(a.x),nt(a.y)),s.lineTo(st(v.x),nt(v.y)),s.stroke());var f=et.fromPoints(a,v),g=wi.BV.intersect(f);if(0===p&&(h=g.hit?g.intersect:v),g.hit)-1!==u&&(d.arc(l.x,l.y,at(r.value+r.dim),u,p),u=-1),d.lineTo(st(g.intersect.x),nt(g.intersect.y));else if(-1===u){u=p;var m=it(v);t.lineTo(m.x,m.y)}}if(-1===u?d.lineTo(st(h.x),nt(h.y)):d.arc(l.x,l.y,at(r.value+r.dim),u,2*Math.PI),yt.fullFOW){if(r.dim>0){var b=t.createRadialGradient(l.x,l.y,at(r.value),l.x,l.y,at(r.value+r.dim));b.addColorStop(0,"rgba(0, 0, 0, 1)"),b.addColorStop(1,"rgba(0, 0, 0, 0)"),t.fillStyle=b}else t.fillStyle="rgba(0, 0, 0, 1)";t.fill(d)}r.lastPath=d}else{e.vCtx.globalCompositeOperation="source-over",e.vCtx.fillStyle="rgba(0, 0, 0, 1)";var y=Xi(a,ni.VISION);for(var w of(e.vCtx.beginPath(),e.vCtx.moveTo(st(y[0][0]),nt(y[0][1])),y))e.vCtx.lineTo(st(w[0]),nt(w[1]));if(e.vCtx.closePath(),e.vCtx.fill(),r.dim>0){var x=e.vCtx.createRadialGradient(l.x,l.y,at(r.value),l.x,l.y,at(r.value+r.dim));x.addColorStop(0,"rgba(0, 0, 0, 1)"),x.addColorStop(1,"rgba(0, 0, 0, 0)"),e.vCtx.fillStyle=x}else e.vCtx.fillStyle="rgba(0, 0, 0, 1)";e.vCtx.globalCompositeOperation="source-in",e.vCtx.beginPath(),e.vCtx.arc(l.x,l.y,at(r.value+r.dim),0,2*Math.PI),e.vCtx.fill(),t.drawImage(e.virtualCanvas,0,0),r.lastPath=e.updateAuraPath(y,c),n.invalidate(!0)}};for(var h of wi.visionSources)c(h);for(var u of(yt.fowLOS&&(t.globalCompositeOperation="source-in",t.drawImage(xt.getLayer("fow-players").canvas,0,0)),this.preFogShapes))if(u.visibleInCanvas(this.canvas)){var d=u.globalCompositeOperation;yt.fullFOW||("source-over"===u.globalCompositeOperation?u.globalCompositeOperation="destination-out":"destination-out"===u.globalCompositeOperation&&(u.globalCompositeOperation="source-over")),u.draw(t),u.globalCompositeOperation=d}yt.fullFOW&&(t.globalCompositeOperation="source-out",t.fillStyle=ft(),t.fillRect(0,0,t.canvas.width,t.canvas.height)),super.draw(!1),t.globalCompositeOperation=i}}updateAuraPath(e,t){var i=new Path2D,s=it(t.center()),n=rt(t.r),r=null,o=null,a=[];for(var[l,c]of e.map(e=>Qe.fromArray(e)).entries()){var h=Qe.fromArray(e[(l+1)%e.length]),u=it(c),d=it(h),p=Jt(t.center(),t.r,c,h).map(e=>it(e));if(0===p.length){if(!t.contains(c))continue;p.push(u,d)}else if(1===p.length){if($t(p[0].asArray(),u.asArray())||$t(p[0].asArray(),d.asArray()))continue;t.contains(c)?p.unshift(u):p.push(d)}if(a.length>0){var v=a[a.length-1];if($t(v[0].asArray(),p[1].asArray())&&$t(v[1].asArray(),p[0].asArray()))continue;if($t(v[0].asArray(),p[0].asArray())&&$t(v[1].asArray(),p[1].asArray()))continue}a.push(p)}if(a.length<=1)return i.arc(s.x,s.y,n,0,2*Math.PI),i;for(var f of a){var g=Math.atan2(f[0].y-s.y,f[0].x-s.x);null===o?(i.moveTo(f[0].x,f[0].y),r=Math.atan2(f[0].y-s.y,f[0].x-s.x)):o!==g&&i.arc(s.x,s.y,n,o,g),o=Math.atan2(f[1].y-s.y,f[1].x-s.x),i.lineTo(f[1].x,f[1].y)}return r&&o?r!==o&&i.arc(s.x,s.y,n,o,r):i.arc(s.x,s.y,n,0,2*Math.PI),i}}class Qi extends Ui{constructor(){super(...arguments),this.isVisionLayer=!0}draw(){if(!this.valid){var e=this.ctx;if(!yt.fowLOS||ji.skipPlayerFOW)return e.clearRect(0,0,this.canvas.width,this.canvas.height),void(this.valid=!0);e.clearRect(0,0,this.canvas.width,this.canvas.height);var t=e.globalCompositeOperation;e.fillStyle="rgba(0, 0, 0, 1)",yt.IS_DM||super.draw(!yt.fullFOW);var i=e.canvas.width+e.canvas.height;for(var s of yt.activeTokens){var n=xt.UUIDMap.get(s);if(void 0!==n){var r=n.center(),o=it(r);if("bvh"===wi.visionMode){e.beginPath();for(var a=-1,l=0;l<2*Math.PI;l+=ji.angleSteps/2/180*Math.PI){var c=Math.cos(l),h=Math.sin(l),u=new et(r,new Je(c,h)),d=wi.BV.intersect(u);d.hit?(-1!==a&&(e.arc(o.x,o.y,i,a,l),a=-1),e.lineTo(st(d.intersect.x),nt(d.intersect.y))):-1===a&&(e.lineTo(o.x+i*c,o.y+i*h),a=l)}-1!==a?e.arc(o.x,o.y,i,a,2*Math.PI):e.closePath(),e.fill()}else{var p=e.createRadialGradient(o.x,o.y,at(yt.visionRangeMin),o.x,o.y,at(yt.visionRangeMax));p.addColorStop(0,"rgba(0, 0, 0, 1)"),p.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=p;try{var v=Xi(n.center(),ni.VISION);for(var f of(e.beginPath(),e.moveTo(st(v[0][0]),nt(v[0][1])),v))e.lineTo(st(f[0]),nt(f[1]));e.closePath(),e.fill()}catch(g){}}}}yt.IS_DM&&super.draw(!yt.fullFOW),e.globalCompositeOperation=t}}}class Zi extends Ui{invalidate(){this.valid=!1}draw(e){this.valid||this.drawGrid()}drawGrid(){var e=this.ctx;this.clear(),e.beginPath();for(var t=yt.gridSize,i=0;i<this.width;i+=t*yt.zoomFactor)e.moveTo(i+yt.panX%t*yt.zoomFactor,0),e.lineTo(i+yt.panX%t*yt.zoomFactor,this.height),e.moveTo(0,i+yt.panY%t*yt.zoomFactor),e.lineTo(this.width,i+yt.panY%t*yt.zoomFactor);e.strokeStyle=yt.gridColour,e.lineWidth=1,e.stroke(),this.valid=!0}}function Ji(e){var t,i=document.createElement("canvas");i.style.zIndex=xt.layers.length.toString(),i.width=window.innerWidth,i.height=window.innerHeight,t="grid"===e.type_?new Zi(i,e.name):"fow"===e.type_?new qi(i,e.name):"fow-players"===e.type_?new Qi(i,e.name):new Ui(i,e.name),t.selectable=e.selectable,t.playerEditable=e.player_editable,xt.addLayer(t);var s=document.getElementById("layers");null!==s?("fow-players"!==e.name&&s.appendChild(i),"grid"===e.type_&&e.size&&yt.setGridSize({gridSize:e.size,sync:!1}),t.setShapes(e.shapes)):console.warn("Layers div is missing, this will prevent the main game board from loading!")}function es(e){var t=xt.getLayer();if(void 0!==t&&null!==e&&null!==e.dataTransfer){var i=document.createElement("img");i.src=e.dataTransfer.getData("text/plain");var s=new Oi(i,new Qe(ct(e.clientX),ht(e.clientY)),ut(i.width),ut(i.height));if(s.src=new URL(i.src).pathname,yt.useGrid){var n=yt.gridSize;s.refPoint=new Qe(Math.round(s.refPoint.x/n)*n,Math.round(s.refPoint.y/n)*n),s.w=Math.max(Math.round(s.w/n)*n,n),s.h=Math.max(Math.round(s.h/n)*n,n)}t.addShape(s,!0)}}class ts{constructor(){this.shown=!1;var e=new Qe(0,0);this.annotationText=new Pi(e,"","bold 20px serif",0,"rgba(230, 230, 230, 1)"),this.annotationRect=new Ii(e,0,0,"rgba(0, 0, 0, 0.6)")}setActiveText(e){if(void 0===this.layer){if(!xt.hasLayer("draw"))return void console.warn("There is no draw layer to draw annotations on!");this.layer=xt.getLayer("draw"),this.layer.addShape(this.annotationRect,!1),this.layer.addShape(this.annotationText,!1)}this.shown=""!==e,this.annotationText.refPoint=lt(new Ze(this.layer.canvas.width/2,50)),this.annotationText.text=e;var t=this.shown?this.annotationText.getMaxWidth(this.layer.ctx)+10:0,i=this.shown?this.annotationText.getMaxHeight(this.layer.ctx)+10:0;this.annotationRect.refPoint=lt(new Ze(this.layer.canvas.width/2-t/2,30)),this.annotationRect.w=t/yt.zoomFactor,this.annotationRect.h=i/yt.zoomFactor,this.layer.invalidate(!0)}}class is{constructor(){this.selectedTool=0,this.annotationManager=new ts}addShape(e){if(xt.hasLayer(e.layer)){var t=xt.getLayer(e.layer),i=Ti(e);void 0!==i?(t.addShape(i,!1),t.invalidate(!1)):console.log("Shape with unknown type ".concat(e.type_," could not be added"))}else console.log("Shape with unknown layer ".concat(e.layer," could not be added"))}updateShape(e){if(xt.hasLayer(e.shape.layer)){var t=Ti(e.shape);if(void 0!==t){var i=xt.UUIDMap.get(e.shape.uuid);if(void 0!==i){var s=t.owners!==i.owners,n=Object.assign(i,t);n.checkVisionSources(),n.setMovementBlock(n.movementObstruction),n.setIsToken(n.isToken),e.redraw&&(n.visionObstruction&&wi.recalculateVision(),xt.getLayer(e.shape.layer).invalidate(!1),n.movementObstruction&&wi.recalculateMovement()),s&&Ke.$emit("Initiative.ForceUpdate")}else console.log("Shape with unknown id could not be updated")}else console.log("Shape with unknown type ".concat(e.shape.type_," could not be added"))}else console.log("Shape with unknown layer ".concat(e.shape.layer," could not be added"))}setCenterPosition(e){var t=it(e);yt.increasePanX((window.innerWidth/2-t.x)/yt.zoomFactor),yt.increasePanY((window.innerHeight/2-t.y)/yt.zoomFactor),xt.invalidate(),tt(yt.locationOptions)}}var ss=new is;window.gameManager=ss,Xe.on("connect",()=>{console.log("Connected")}),Xe.on("disconnect",()=>{console.log("Disconnected")}),Xe.on("connect_error",e=>{console.error("Could not connect to game session."),po.push("/dashboard")}),Xe.on("error",e=>{console.error("Game session does not exist."),po.push("/dashboard")}),Xe.on("redirect",e=>{console.log("redirecting"),po.push(e)}),Xe.on("Room.Info.Set",e=>{yt.setRoomName(e.name),yt.setRoomCreator(e.creator),yt.setInvitationCode(e.invitationCode),yt.setIsLocked({isLocked:e.isLocked,sync:!1}),yt.setPlayers(e.players)}),Xe.on("Room.Info.InvitationCode.Set",e=>{yt.setInvitationCode(e),Ke.$emit("DmSettings.RefreshedInviteCode")}),Xe.on("Room.Info.Players.Add",e=>{yt.addPlayer(e)}),Xe.on("Username.Set",e=>{yt.setUsername(e),yt.setDM(e===decodeURIComponent(window.location.pathname.split("/")[2]))}),Xe.on("Client.Options.Set",e=>{yt.setGridColour({colour:e.grid_colour,sync:!1}),yt.setFOWColour({colour:e.fow_colour,sync:!1}),yt.setRulerColour({colour:e.ruler_colour,sync:!1}),yt.setPanX(e.pan_x),yt.setPanY(e.pan_y),yt.setZoomDisplay(mt(e.zoom_factor)),e.active_layer&&xt.selectLayer(e.active_layer,!1),void 0!==xt.getGridLayer()&&xt.getGridLayer().invalidate()}),Xe.on("Location.Set",e=>{void 0!==e.name&&yt.setLocationName(e.name),void 0!==e.unit_size&&yt.setUnitSize({unitSize:e.unit_size,sync:!1}),void 0!==e.unit_size_unit&&yt.setUnitSizeUnit({unitSizeUnit:e.unit_size_unit,sync:!1}),void 0!==e.use_grid&&yt.setUseGrid({useGrid:e.use_grid,sync:!1}),void 0!==e.full_fow&&yt.setFullFOW({fullFOW:e.full_fow,sync:!1}),void 0!==e.fow_opacity&&yt.setFOWOpacity({fowOpacity:e.fow_opacity,sync:!1}),void 0!==e.fow_los&&yt.setLineOfSight({fowLOS:e.fow_los,sync:!1}),void 0!==e.vision_min_range&&yt.setVisionRangeMin({value:e.vision_min_range,sync:!1}),void 0!==e.vision_max_range&&yt.setVisionRangeMax({value:e.vision_max_range,sync:!1}),void 0!==e.vision_mode&&(wi.setVisionMode({mode:e.vision_mode,sync:!1}),wi.recalculateVision(),wi.recalculateMovement())}),Xe.on("Position.Set",e=>{yt.setZoomDisplay(e.zoom),ss.setCenterPosition(new Qe(e.x,e.y))}),Xe.on("Notes.Set",e=>{for(var t of e)yt.newNote({note:t,sync:!1})}),Xe.on("Asset.List.Set",e=>{yt.setAssets(e)}),Xe.on("Board.Set",e=>{for(var t of(yt.clear(),wi.clear(),yt.setLocations(e.locations),document.getElementById("layers").innerHTML="",yt.resetLayerInfo(),xt.reset(),e.layers))Ji(t);xt.selectLayer(xt.getLayer().name,!1),Ke.$emit("Initiative.Clear"),wi.recalculateVision(),wi.recalculateMovement(),yt.setBoardInitialized(!0)}),Xe.on("Gridsize.Set",e=>{yt.setGridSize({gridSize:e,sync:!1})}),Xe.on("Shape.Add",e=>{ss.addShape(e)}),Xe.on("Shape.Remove",e=>{if(xt.UUIDMap.has(e.uuid))if(xt.hasLayer(e.layer)){var t=xt.getLayer(e.layer);t.removeShape(xt.UUIDMap.get(e.uuid),!1),t.invalidate(!1)}else console.log("Attempted to remove shape from an unknown layer ".concat(e.layer));else console.log("Attempted to remove an unknown shape")}),Xe.on("Shape.Order.Set",e=>{if(xt.UUIDMap.has(e.shape.uuid))if(xt.hasLayer(e.shape.layer)){var t=xt.UUIDMap.get(e.shape.uuid),i=xt.getLayer(t.layer);i.moveShapeOrder(t,e.index,!1)}else console.log("Attempted to remove shape from an unknown layer ".concat(e.shape.layer));else console.log("Attempted to move the shape order of an unknown shape")}),Xe.on("Shape.Layer.Change",e=>{var t=xt.UUIDMap.get(e.uuid);void 0!==t&&t.moveLayer(e.layer,!1)}),Xe.on("Shape.Update",e=>{ss.updateShape(e)}),Xe.on("Temp.Clear",e=>{for(var t of e)if(xt.UUIDMap.has(t)){var i=xt.UUIDMap.get(t);if(xt.hasLayer(i.layer)){var s=xt.UUIDMap.get(i.uuid);xt.getLayer(i.layer).removeShape(s,!1)}else console.log("Attempted to remove shape from an unknown layer ".concat(i.layer))}else console.log("Attempted to remove an unknown temporary shape")}),Xe.on("Labels.Set",e=>{for(var t of e)yt.addLabel(t)}),Xe.on("Label.Visibility.Set",e=>{yt.setLabelVisibility(e)}),Xe.on("Label.Add",e=>{yt.addLabel(e)}),Xe.on("Label.Delete",e=>{yt.deleteLabel(e)}),Xe.on("Labels.Filter.Add",e=>{yt.labelFilters.push(e),xt.invalidate()}),Xe.on("Labels.Filter.Remove",e=>{var t=yt.labelFilters.indexOf(e);t>=0&&(yt.labelFilters.splice(t,1),xt.invalidate())}),Xe.on("Labels.Filters.Set",e=>{yt.setLabelFilters(e)});var ns=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Initiative")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("draggable",{attrs:{id:"initiative-list",setData:e.fakeSetData,disabled:!e.$store.state.game.IS_DM},on:{change:e.updateOrder},model:{value:e.$store.state.initiative.data,callback:function(t){e.$set(e.$store.state.initiative,"data",t)},expression:"$store.state.initiative.data"}},[e._l(e.$store.state.initiative.data,(function(t){return[i("div",{key:t.uuid,staticStyle:{display:"flex","flex-direction":"column","align-items":"flex-end"}},[i("div",{staticClass:"initiative-actor",class:{"initiative-selected":e.$store.state.initiative.currentActor===t.uuid},style:{cursor:e.$store.state.game.IS_DM&&"move"},on:{mouseenter:function(i){return e.toggleHighlight(t,!0)},mouseleave:function(i){return e.toggleHighlight(t,!1)}}},[t.has_img?[i("img",{attrs:{src:t.source,width:"30px",height:"30px"}})]:[i("span",{staticStyle:{width:"auto"}},[e._v(e._s(t.source))])],i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:t.initiative,expression:"actor.initiative",modifiers:{lazy:!0,number:!0}}],class:{notAllowed:!e.owns(t)},attrs:{type:"text",placeholder:"value",disabled:!e.owns(t)},domProps:{value:t.initiative},on:{change:[function(i){e.$set(t,"initiative",e._n(i.target.value))},function(i){return e.syncInitiative(t)}],blur:function(t){return e.$forceUpdate()}}}),i("div",{staticClass:"initiative-effects-icon",class:{notAllowed:!e.owns(t)},staticStyle:{opacity:"0.6"},on:{click:function(i){e.createEffect(t,e.getDefaultEffect(),!0)}}},[i("i",{staticClass:"fas fa-stopwatch"}),t.effects?[e._v(" "+e._s(t.effects.length)+" ")]:[e._v(" 0 ")]],2),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:t.visible?"1.0":"0.3"},on:{click:function(i){return e.toggleOption(t,"visible")}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:t.group?"1.0":"0.3"},on:{click:function(i){return e.toggleOption(t,"group")}}},[i("i",{staticClass:"fas fa-users"})]),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:e.owns(t)?"1.0":"0.3"},on:{click:function(i){return e.removeInitiative(t.uuid,!0,!0)}}},[i("i",{staticClass:"fas fa-trash-alt"})])],2),t.effects?i("div",{staticClass:"initiative-effect"},e._l(t.effects,(function(s){return i("div",{key:s.uuid},[i("input",{directives:[{name:"model",rawName:"v-model",value:s.name,expression:"effect.name"}],attrs:{type:"text",size:s.name.length||1},domProps:{value:s.name},on:{change:function(i){return e.updateEffect(t.uuid,s,!0)},input:function(t){t.target.composing||e.$set(s,"name",t.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model",value:s.turns,expression:"effect.turns"}],attrs:{type:"text",size:s.turns.toString().length||1},domProps:{value:s.turns},on:{change:function(i){return e.updateEffect(t.uuid,s,!0)},input:function(t){t.target.composing||e.$set(s,"turns",t.target.value)}}})])})),0):e._e()])]}))],2),i("div",{attrs:{id:"initiative-bar"}},[i("div",{attrs:{id:"initiative-round"}},[e._v("Round "+e._s(e.$store.state.initiative.roundCounter))]),i("div",{staticStyle:{display:"flex"}}),i("div",{staticClass:"initiative-bar-button",style:e.visionLock?"background-color: #82c8a0":"",on:{click:e.toggleVisionLock}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{staticClass:"initiative-bar-button",style:e.cameraLock?"background-color: #82c8a0":"",on:{click:function(t){e.cameraLock=!e.cameraLock}}},[i("i",{staticClass:"fas fa-video"})]),i("div",{staticClass:"initiative-bar-button",class:{notAllowed:!e.$store.state.game.IS_DM},on:{click:function(t){e.setRound(0,!0),e.updateTurn(e.$store.state.initiative.data[0].uuid,!0)}}},[i("i",{staticClass:"fas fa-sync-alt"})]),i("div",{staticClass:"initiative-bar-button",class:{notAllowed:!e.$store.state.game.IS_DM},on:{click:e.nextTurn}},[i("i",{staticClass:"fas fa-chevron-right"})])])],1)])},rs=[],os=i("310e"),as=i.n(os);function ls(e){return hs.data.some(t=>t.uuid===e)}var cs=class extends E["d"]{constructor(){super(...arguments),this.data=[],this.currentActor=null,this.roundCounter=0}clear(){this.data=[],this.currentActor=null}setCurrentActor(e){this.currentActor=e}setData(e){this.data=e}addInitiative(e){var t=this.data.findIndex(t=>t.uuid===e.uuid);t>=0||(void 0===e.initiative&&(e.initiative=0),Xe.emit("Initiative.Update",e))}setRoundCounter(e){this.roundCounter=e}setTurn(e){this.currentActor=e}};Object(f["a"])([E["c"]],cs.prototype,"clear",null),Object(f["a"])([E["c"]],cs.prototype,"setCurrentActor",null),Object(f["a"])([E["c"]],cs.prototype,"setData",null),Object(f["a"])([E["c"]],cs.prototype,"addInitiative",null),Object(f["a"])([E["c"]],cs.prototype,"setRoundCounter",null),Object(f["a"])([E["c"]],cs.prototype,"setTurn",null),cs=Object(f["a"])([Object(E["b"])({dynamic:!0,store:P,name:"initiative",namespaced:!0})],cs);var hs=Object(E["e"])(cs);s["default"].component("draggable",as.a);var us=class extends s["default"]{constructor(){super(...arguments),this.visible=!1,this.visionLock=!1,this.cameraLock=!1,this._activeTokens=[]}mounted(){Ke.$on("Initiative.Clear",hs.clear),Ke.$on("Initiative.Remove",e=>this.removeInitiative(e)),Ke.$on("Initiative.Show",()=>this.visible=!0),Ke.$on("Initiative.ForceUpdate",()=>this.$forceUpdate()),Xe.on("Initiative.Set",hs.setData),Xe.on("Initiative.Turn.Set",e=>this.setTurn(e)),Xe.on("Initiative.Turn.Update",e=>this.updateTurn(e,!1)),Xe.on("Initiative.Round.Update",e=>this.setRound(e,!1)),Xe.on("Initiative.Effect.New",e=>{var t=this.getActor(e.actor);void 0!==t&&this.createEffect(t,e.effect,!1)}),Xe.on("Initiative.Effect.Update",e=>this.updateEffect(e.actor,e.effect,!1))}beforeDestroy(){Ke.$off("Initiative.Clear"),Ke.$off("Initiative.Remove"),Ke.$off("Initiative.Show"),Xe.off("Initiative.Set"),Xe.off("Initiative.Turn.Set"),Xe.off("Initiative.Turn.Update"),Xe.off("Initiative.Round.Update"),Xe.off("Initiative.Effect.New"),Xe.off("Initiative.Effect.Update")}getActor(e){return hs.data.find(t=>t.uuid===e)}owns(e){if(yt.IS_DM)return!0;var t=xt.UUIDMap.get(e.uuid);return void 0!==t&&t.owners.includes(yt.username)}getDefaultEffect(){return{uuid:ae(),name:"New Effect",turns:10}}fakeSetData(e){e.setData("Hack","")}syncInitiative(e){Xe.emit("Initiative.Update",e)}removeInitiative(e){var t=hs.data.findIndex(t=>t.uuid===e);if(!(t<0||hs.data[t].group)){this.syncInitiative({uuid:e});var i=xt.UUIDMap.get(e);void 0!==i&&i.showHighlight&&(i.showHighlight=!1,xt.getLayer(i.layer).invalidate(!0))}}updateOrder(){yt.IS_DM&&Xe.emit("Initiative.Set",hs.data.map(e=>e.uuid))}updateTurn(e,t){if(yt.IS_DM||!t){hs.setCurrentActor(e);var i=hs.data.find(t=>t.uuid===e);if(void 0!==i){if(i.effects)for(var s=i.effects.length-1;s>=0;s--)i.effects[s].turns<=0?i.effects.splice(s,1):i.effects[s].turns--;if(this.visionLock&&(null!==e&&yt.ownedtokens.includes(e)?yt.setActiveTokens([e]):yt.setActiveTokens([])),this.cameraLock&&null!==e){var n=xt.UUIDMap.get(e);void 0!==n&&n.ownedBy()&&ss.setCenterPosition(n.center())}t&&Xe.emit("Initiative.Turn.Update",e)}}}setRound(e,t){!yt.IS_DM&&t||(hs.setRoundCounter(e),t&&Xe.emit("Initiative.Round.Update",e))}setTurn(e){hs.setTurn(e)}nextTurn(){if(yt.IS_DM){var e=hs.data,t=e[(e.findIndex(e=>e.uuid===hs.currentActor)+1)%e.length];hs.data[0].uuid===t.uuid&&this.setRound(hs.roundCounter+1,!0),this.updateTurn(t.uuid,!0)}}toggleHighlight(e,t){var i=xt.UUIDMap.get(e.uuid);void 0!==i&&(i.showHighlight=t,xt.getLayer(i.layer).invalidate(!0))}toggleOption(e,t){this.owns(e)&&(e[t]=!e[t],this.syncInitiative(e))}createEffect(e,t,i){this.owns(e)&&(e.effects.push(t),i&&Xe.emit("Initiative.Effect.New",{actor:e.uuid,effect:t}))}syncEffect(e,t){this.owns(e)&&Xe.emit("Initiative.Effect.Update",{actor:e.uuid,effect:t})}updateEffect(e,t,i){var s=hs.data.find(t=>t.uuid===e);if(void 0!==s){var n=s.effects.findIndex(e=>e.uuid===t.uuid);void 0!==n&&(s.effects[n]=t,i?this.syncEffect(s,t):this.$forceUpdate())}}toggleVisionLock(){this.visionLock=!this.visionLock,this.visionLock?(this._activeTokens=[...yt._activeTokens],null!==hs.currentActor&&yt.ownedtokens.includes(hs.currentActor)&&yt.setActiveTokens([hs.currentActor])):yt.setActiveTokens(this._activeTokens)}};us=Object(f["a"])([Object(g["b"])({components:{Modal:Y,draggable:as.a}})],us);var ds=us,ps=ds,vs=(i("96178"),Object(o["a"])(ps,ns,rs,!1,null,"3f1843d1",null)),fs=vs.exports,gs=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Label manager")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("div",{staticClass:"grid"},[i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Category"}},[e._v("Cat.")])]),i("div",{staticClass:"header name"},[e._v("Name")]),i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Visible"}},[e._v("Vis.")])]),i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Delete"}},[e._v("Del.")])]),i("div",{staticClass:"separator spanrow",staticStyle:{margin:"0 0 7px"}}),i("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],ref:"search",staticClass:"spanrow",attrs:{type:"text",placeholder:"search"},domProps:{value:e.search},on:{input:function(t){t.target.composing||(e.search=t.target.value)}}})]),i("div",{staticClass:"grid scroll"},[e._l(e.categories,(function(t){return[e._l(e.labels[t],(function(t){return[i("div",{key:"row-"+t.uuid,staticClass:"row",on:{click:function(i){return e.selectLabel(t.uuid)}}},[t.category?[i("div",{key:"cat-"+t.uuid},[e._v(e._s(t.category))]),i("div",{key:"name-"+t.uuid,staticClass:"name"},[e._v(e._s(t.name))])]:e._e(),t.category?e._e():[i("div",{key:"cat-"+t.uuid}),i("div",{key:"name-"+t.uuid,staticClass:"name"},[e._v(e._s(t.name))])],i("div",{key:"visible-"+t.uuid,class:{"lower-opacity":!t.visible},style:{textAlign:"center"},on:{click:function(i){return i.stopPropagation(),e.toggleVisibility(t)}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{key:"delete-"+t.uuid,on:{click:function(i){return i.stopPropagation(),e.deleteLabel(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})])],2)]}))]})),0===e.labels.length?[i("div",{attrs:{id:"no-labels"}},[e._v("No labels exist yet")])]:e._e()],2),i("div",{staticClass:"grid"},[i("div",{staticClass:"separator spanrow"}),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.newCategory,expression:"newCategory",modifiers:{trim:!0}}],attrs:{type:"text"},domProps:{value:e.newCategory},on:{input:function(t){t.target.composing||(e.newCategory=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.newName,expression:"newName",modifiers:{trim:!0}}],attrs:{type:"text"},domProps:{value:e.newName},on:{input:function(t){t.target.composing||(e.newName=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),i("button",{attrs:{id:"addLabelButton"},on:{click:function(t){return t.stopPropagation(),e.addLabel(t)}}},[e._v("Add")])])])])},ms=[],bs=(i("841c"),class extends s["default"]{constructor(){super(...arguments),this.visible=!1,this.newCategory="",this.newName="",this.search=""}mounted(){Ke.$on("LabelManager.Open",()=>{this.visible=!0,this.newCategory="",this.newName="",this.$nextTick(()=>this.$refs.search.focus())})}beforeDestroy(){Ke.$off("LabelManager.Open")}get labels(){var e={"":[]};for(var t of Object.keys(yt.labels)){var i=yt.labels[t];this.search.length&&"".concat(i.category.toLowerCase()).concat(i.name.toLowerCase()).search(this.search.toLowerCase())<0||i.user===yt.username&&(i.category?(i.category in e||(e[i.category]=[]),e[i.category].push(i),e[i.category].sort((e,t)=>e.name.localeCompare(t.name))):e[""].push(i))}return e}get categories(){return Object.keys(this.labels).sort()}selectLabel(e){Ke.$emit("EditDialog.AddLabel",e),this.visible=!1}toggleVisibility(e){e.visible=!e.visible,Xe.emit("Label.Visibility.Set",{uuid:e.uuid,visible:e.visible})}addLabel(){if(""!==this.newName){var e={uuid:ae(),category:this.newCategory,name:this.newName,visible:!1,user:yt.username};yt.addLabel(e),Xe.emit("Label.Add",e),this.newCategory="",this.newName=""}}deleteLabel(e){yt.deleteLabel({uuid:e,user:yt.username}),Xe.emit("Label.Delete",e)}});bs=Object(f["a"])([Object(g["b"])({components:{Modal:Y}})],bs);var ys=bs,ws=ys,xs=(i("ab66"),Object(o["a"])(ws,gs,ms,!1,null,"3261513c",null)),Ss=xs.exports,Cs=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"menuContainer"}},[i("div",{ref:"rm",style:{left:e.visible.settings?"200px":"0",top:e.visible.locations?"100px":"0"},attrs:{id:"radialmenu"}},[i("div",{staticClass:"rm-wrapper"},[i("div",{staticClass:"rm-toggler"},[i("ul",{staticClass:"rm-list",class:{"rm-list-dm":e.IS_DM}},[e.IS_DM?i("li",{staticClass:"rm-item",attrs:{id:"rm-locations"},on:{click:function(t){e.visible.locations=!e.visible.locations}}},[e._m(0)]):e._e(),i("li",{staticClass:"rm-item",attrs:{id:"rm-settings"},on:{click:function(t){e.visible.settings=!e.visible.settings}}},[e._m(1)])])]),e._m(2)])]),i("transition",{attrs:{name:"settings"},on:{enter:function(t){e.$refs.rm.style.transition="left 500ms"}}},[e.visible.settings?i("div",{ref:"settings",attrs:{id:"menu"},on:{click:e.settingsClick}},[i("div",{staticStyle:{width:"200px",height:"90%","overflow-y":"auto","overflow-x":"hidden"}},[e.IS_DM?[i("button",{staticClass:"menu-accordion"},[e._v("Assets")]),i("div",{staticClass:"menu-accordion-panel"},[i("a",{staticClass:"actionButton",attrs:{href:"/assets",target:"blank",title:"Open asset manager"}},[i("i",{staticClass:"fas fa-external-link-alt"})]),i("div",{staticClass:"directory",attrs:{id:"menu-tokens"}},[i("asset-node",{attrs:{asset:e.assets}}),e.assets?e._e():i("div",[e._v("No assets")])],1)]),i("button",{staticClass:"menu-accordion"},[e._v("Notes")]),i("div",{staticClass:"menu-accordion-panel"},[i("div",{staticClass:"menu-accordion-subpanel",attrs:{id:"menu-notes"}},[i("a",{staticClass:"actionButton",on:{click:e.createNote}},[i("i",{staticClass:"far fa-plus-square"})]),e._l(e.notes,(function(t){return i("div",{key:t.uuid,staticStyle:{cursor:"pointer"},on:{click:function(i){return e.openNote(t)}}},[e._v(" "+e._s(t.title||"[?]")+" ")])})),e.notes.length?e._e():i("div",[e._v("No notes")])],2)]),i("button",{staticClass:"menu-accordion",on:{click:e.openDmSettings}},[e._v("DM Options")])]:e._e(),i("button",{staticClass:"menu-accordion"},[e._v("Client Options")]),i("div",{staticClass:"menu-accordion-panel"},[i("div",{staticClass:"menu-accordion-subpanel"},[i("label",{attrs:{for:"gridColour"}},[e._v("Grid Colour:")]),i("color-picker",{attrs:{id:"gridColour",color:e.gridColour},on:{"update:color":function(t){e.gridColour=t}}}),i("label",{attrs:{for:"fowColour"}},[e._v("FOW Colour:")]),i("color-picker",{attrs:{id:"fowColour",color:e.fowColour},on:{"update:color":function(t){e.fowColour=t}}}),i("label",{attrs:{for:"rulerColour"}},[e._v("Ruler Colour:")]),i("color-picker",{attrs:{id:"rulerColour",color:e.rulerColour},on:{"update:color":function(t){e.rulerColour=t}}})],1)])],2),i("router-link",{staticClass:"menu-accordion",staticStyle:{"text-decoration":"none",display:"inline-block",position:"absolute",bottom:"0"},attrs:{to:"/dashboard"}},[e._v(" Exit ")])],1):e._e()]),i("transition",{attrs:{name:"locations"},on:{enter:function(t){e.$refs.rm.style.transition="top 500ms"}}},[e.IS_DM&&e.visible.locations?i("div",{attrs:{id:"locations-menu"}},[i("div",[e._l(e.locations,(function(t){return i("div",{key:t,style:[e.getCurrentLocation()===t?{"background-color":"#82c8a0"}:{}],on:{click:function(i){return e.changeLocation(t)}}},[e._v(" "+e._s(t)+" ")])})),i("div",{on:{click:e.createLocation}},[i("i",{staticClass:"fas fa-plus"})])],2)]):e._e()]),i("img",{attrs:{id:"dragImage"}})],1)},_s=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{attrs:{href:"#"}},[i("i",{staticClass:"far fa-compass"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{attrs:{href:"#"}},[i("i",{staticClass:"fas fa-cog"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"rm-topper"},[i("i",{staticClass:"icon-share-alt"})])}],Os=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"outer",on:{click:function(t){return t.target!==t.currentTarget?null:e.open(t)}}},[i("div",{staticClass:"current-color",style:e.transparent?"background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)":"background-color:"+e.color,on:{click:function(t){return t.target!==t.currentTarget?null:e.open(t)}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.display,expression:"display"}],staticClass:"mask",on:{click:function(t){return t.target!==t.currentTarget?null:e.closePicker(t)}}}),i("chrome-picker",{directives:[{name:"show",rawName:"v-show",value:e.display,expression:"display"}],ref:"chromePicker",style:{position:"fixed",left:e.left+"px",top:e.top+"px","z-index":9999},attrs:{value:e.color,tabindex:"-1"},on:{input:e.updateColor}})],1)},ks=[],Ls=i("c345"),Es=class extends s["default"]{constructor(){super(...arguments),this.display=!1,this.left=0,this.top=0,this.transparent=!1}mounted(){this.transparent=0===this.$refs.chromePicker.val.rgba.a,this.setPosition()}open(){this.display||this.disabled||(this.setPosition(),this.display=!0,this.$nextTick(()=>this.$children[0].$el.focus()))}updateColor(e){this.transparent=0===e.rgba.a;var t=pt()(e.rgba).toRgbString();this.$emit("update:color",t),this.$emit("input",t)}closePicker(){this.display=!1,this.$emit("change",this.color)}setPosition(){var e=this.$el.getBoundingClientRect();e.right+224>window.innerWidth?this.left=e.left-224:this.left=e.right,e.bottom+242>window.innerHeight?this.top=e.top-242:this.top=e.bottom}};Object(f["a"])([Object(H["a"])(String)],Es.prototype,"color",void 0),Object(f["a"])([Object(H["a"])(Boolean)],Es.prototype,"disabled",void 0),Es=Object(f["a"])([Object(g["b"])({components:{"chrome-picker":Ls["Chrome"]}})],Es);var Is=Es,Ps=Is,Ms=(i("0b9a"),Object(o["a"])(Ps,Os,ks,!1,null,"e45ccc1a",null)),Ts=Ms.exports,As=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ul",[e._l(e.folders,(function(t){return i("li",{key:t,staticClass:"folder",on:{click:function(t){return t.stopPropagation(),e.toggle(t)}}},[e._v(" "+e._s(t)+" "),i("asset-node",{attrs:{asset:e.asset[t]}})],1)})),e._l(e.files,(function(t){return i("li",{key:t.name,staticClass:"file draggable token",attrs:{draggable:"true"},on:{mouseover:function(i){e.showImage=t.hash},mouseout:function(t){e.showImage=null},dragstart:function(i){return e.dragStart(i,"/static/assets/"+t.hash)}}},[e._v(" "+e._s(t.name)+" "),e.showImage==t.hash?i("div",{staticClass:"preview"},[i("img",{staticClass:"asset-preview-image",attrs:{src:"/static/assets/"+t.hash}})]):e._e()])}))],2)},Ds=[],Rs=class extends s["default"]{constructor(){super(...arguments),this.showImage=null}get folders(){return Object.keys(this.asset).filter(e=>!["__files"].includes(e)).sort(le)}get files(){return this.asset.__files?this.asset.__files.concat().sort((e,t)=>e.name.toLowerCase()>t.name.toLowerCase()?1:-1):[]}toggle(e){for(var t=0;t<e.target.children.length;t++){var i=e.target.children[t];i.style.display=""===i.style.display?"block":""}}dragStart(e,t){if(this.showImage=null,null!==e&&null!==e.dataTransfer){var i=e.target.querySelector(".preview");e.dataTransfer.setDragImage(i,0,0),e.dataTransfer.setData("text/plain",t)}}};Object(f["a"])([Object(H["a"])()],Rs.prototype,"asset",void 0),Rs=Object(f["a"])([Object(g["b"])({name:"asset-node"})],Rs);var Ns=Rs,Us=Ns,js=(i("3ba3"),Object(o["a"])(Us,As,Ds,!1,null,"03f9ac64",null)),zs=js.exports,$s=class extends s["default"]{constructor(){super(...arguments),this.visible={settings:!1,locations:!1}}get IS_DM(){return yt.IS_DM||yt.FAKE_PLAYER}get gridColour(){return yt.gridColour}set gridColour(e){yt.setGridColour({colour:e,sync:!0})}get fowColour(){return yt.fowColour}set fowColour(e){yt.setFOWColour({colour:e,sync:!0})}get rulerColour(){return yt.rulerColour}set rulerColour(e){yt.setRulerColour({colour:e,sync:!0})}settingsClick(e){if(e.target.classList.contains("menu-accordion")){e.target.classList.toggle("menu-accordion-active");var t=e.target.nextElementSibling;null!==t&&(t.style.display=""===t.style.display?"block":"")}}getCurrentLocation(){return yt.locationName}changeLocation(e){Xe.emit("Location.Change",e)}createLocation(){this.$parent.$refs.prompt.prompt("New location name:","Create new location").then(e=>{Xe.emit("Location.New",e)},()=>{})}createNote(){var e={title:"New note",text:"",uuid:ae()};yt.newNote({note:e,sync:!0}),this.openNote(e)}openNote(e){this.$parent.$refs.note.open(e)}openDmSettings(){Ke.$emit("DmSettings.Open")}};$s=Object(f["a"])([Object(g["b"])({components:{"color-picker":Ts,"asset-node":zs},computed:Object.assign({},Object(I["c"])("game",["locations","assets","notes"]))})],$s);var Fs=$s,Vs=Fs,Hs=(i("747b"),Object(o["a"])(Vs,Cs,_s,!1,null,"5fbaa291",null)),Bs=Hs.exports,Gs=function(){var e=this,t=e.$createElement,i=e._self._c||t;return null!==e.note?i("modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("span",{on:{click:function(t){return e.$refs.title.select()}}},[i("i",{staticClass:"fas fa-pencil-alt",staticStyle:{"font-size":"15px"}})]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.note.title,expression:"note.title"}],ref:"title",domProps:{value:e.note.title},on:{change:e.updateNote,input:function(t){t.target.composing||e.$set(e.note,"title",t.target.value)}}}),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}],null,!1,1320213373)},[i("div",{staticClass:"modal-body"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.note.text,expression:"note.text"}],ref:"textarea",style:{height:e.calcHeight()},domProps:{value:e.note.text},on:{change:e.updateNote,input:function(t){t.target.composing||e.$set(e.note,"text",t.target.value)}}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.removeNote}},[i("i",{staticClass:"far fa-trash-alt"}),e._v(" Remove ")])])]):e._e()},Ws=[],Xs=class extends s["default"]{constructor(){super(...arguments),this.visible=!1,this.note=null}open(e){this.visible=!0,this.note=e}calcHeight(){if(this.$refs.textarea){var e=this.$refs.textarea;return e.style.height="auto",e.style.height=e.scrollHeight+"px",e.scrollHeight+"px"}return"100px"}updateNote(){this.note&&yt.updateNote({note:this.note,sync:!0})}removeNote(){this.$parent.$refs.confirm.open("Are you sure you wish to remove this?").then(e=>{e&&this.note&&(yt.removeNote({note:this.note,sync:!0}),this.visible=!1)},()=>{})}};Xs=Object(f["a"])([Object(g["b"])({components:{Modal:Y}})],Xs);var Ys=Xs,Ks=Ys,qs=(i("4122"),Object(o["a"])(Ks,Gs,Ws,!1,null,"3f88adb2",null)),Qs=qs.exports,Zs=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.shapes.length>0,expression:"shapes.length > 0"}]},e._l(e.shapes,(function(t){return i("div",{key:t.uuid},[i("div",{attrs:{id:"selection-menu"}},[i("div",{attrs:{id:"selection-edit-button"},on:{click:e.openEditDialog}},[i("i",{staticClass:"fas fa-edit"})]),i("div",{attrs:{id:"selection-name"}},[e._v(e._s(t.name))]),i("div",{attrs:{id:"selection-trackers"}},[e._l(e.visibleTrackers,(function(t){return[i("div",{key:"name-"+t.uuid},[e._v(e._s(t.name))]),i("div",{key:"value-"+t.uuid,staticClass:"selection-tracker-value",on:{click:function(i){return e.changeValue(t,!1)}}},[0===t.maxvalue?[e._v(" "+e._s(t.value)+" ")]:[e._v(e._s(t.value)+" / "+e._s(t.maxvalue))]],2)]}))],2),i("div",{attrs:{id:"selection-auras"}},[e._l(e.visibleAuras,(function(t){return[i("div",{key:"name-"+t.uuid},[e._v(e._s(t.name))]),i("div",{key:"value-"+t.uuid,staticClass:"selection-tracker-value",on:{click:function(i){return e.changeValue(t,!0)}}},[0===t.dim?[e._v(" "+e._s(t.value)+" ")]:[e._v(e._s(t.value)+" / "+e._s(t.dim))]],2)]}))],2)]),i("edit-dialog",{ref:"editDialog",refInFor:!0,attrs:{shape:t}})],1)})),0)},Js=[],en=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Edit asset")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("div",{staticClass:"grid"},[i("label",{attrs:{for:"shapeselectiondialog-name"}},[e._v("Name")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.shape.name,expression:"shape.name"}],staticStyle:{"grid-column":"numerator / remove"},attrs:{type:"text",id:"shapeselectiondialog-name",disabled:!e.owned},domProps:{value:e.shape.name},on:{change:function(t){return e.updateShape(!1)},input:function(t){t.target.composing||e.$set(e.shape,"name",t.target.value)}}}),i("div",{style:{opacity:e.shape.nameVisible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(t){e.shape.nameVisible=!e.shape.nameVisible,e.updateShape(!1)}}},[i("i",{staticClass:"fas fa-eye"})]),i("label",{attrs:{for:"shapeselectiondialog-istoken"}},[e._v("Is a token")]),i("input",{staticClass:"styled-checkbox",staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-istoken",disabled:!e.owned},domProps:{checked:e.shape.isToken},on:{click:e.setToken}}),i("label",{attrs:{for:"shapeselectiondialog-visionblocker"}},[e._v("Blocks vision/light")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.shape.visionObstruction,expression:"shape.visionObstruction"}],staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-visionblocker",disabled:!e.owned},domProps:{checked:Array.isArray(e.shape.visionObstruction)?e._i(e.shape.visionObstruction,null)>-1:e.shape.visionObstruction},on:{change:[function(t){var i=e.shape.visionObstruction,s=t.target,n=!!s.checked;if(Array.isArray(i)){var r=null,o=e._i(i,r);s.checked?o<0&&e.$set(e.shape,"visionObstruction",i.concat([r])):o>-1&&e.$set(e.shape,"visionObstruction",i.slice(0,o).concat(i.slice(o+1)))}else e.$set(e.shape,"visionObstruction",n)},e.setVisionBlocker]}}),i("label",{attrs:{for:"shapeselectiondialog-moveblocker"}},[e._v("Blocks movement")]),i("input",{staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-moveblocker",disabled:!e.owned},domProps:{checked:e.shape.movementObstruction},on:{click:e.setMovementBlocker}}),i("label",{attrs:{for:"shapeselectiondialog-strokecolour"}},[e._v("Border colour")]),i("color-picker",{staticStyle:{"grid-column-start":"remove"},attrs:{color:e.shape.strokeColour,disabled:!e.owned},on:{"update:color":function(t){return e.$set(e.shape,"strokeColour",t)},input:function(t){return e.updateShape(!0,!0)},change:function(t){return e.updateShape(!0)}}}),i("label",{attrs:{for:"shapeselectiondialog-fillcolour"}},[e._v("Fill colour")]),i("color-picker",{staticStyle:{"grid-column-start":"remove"},attrs:{color:e.shape.fillColour,disabled:!e.owned},on:{"update:color":function(t){return e.$set(e.shape,"fillColour",t)},input:function(t){return e.updateShape(!0,!0)},change:function(t){return e.updateShape(!0)}}}),i("div",{staticClass:"spanrow header"},[e._v("Access")]),e._l(e.shape.owners,(function(t){return[i("input",{key:t,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t},on:{change:function(i){return e.updateOwner(i,t)}}}),""!==t?i("div",{key:"remove-"+t,style:{opacity:e.owned?1:.3,textAlign:"center",gridColumnStart:"remove"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeOwner(t)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]})),i("div",{staticClass:"spanrow header"},[e._v("Trackers")]),e._l(e.shape.trackers,(function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"tracker.name"}],key:"name-"+t.uuid,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t.name},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"name",i.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.value,expression:"tracker.value",modifiers:{number:!0}}],key:"value-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.value},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"value",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"fspan-"+t.uuid},[e._v("/")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.maxvalue,expression:"tracker.maxvalue",modifiers:{number:!0}}],key:"maxvalue-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.maxvalue},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"maxvalue",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"sspan-"+t.uuid}),i("div",{key:"visibility-"+t.uuid,style:{opacity:t.visible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){t.visible=!t.visible,e.updateShape(!1)}}},[i("i",{staticClass:"fas fa-eye"})]),i("span",{key:"tspan-"+t.uuid}),""!==t.name||0!==t.value?i("div",{key:"remove-"+t.uuid,style:{opacity:e.owned?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeTracker(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]})),i("div",{staticClass:"spanrow header"},[e._v("Auras")]),e._l(e.shape.auras,(function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"aura.name"}],key:"name-"+t.uuid,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t.name},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"name",i.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.value,expression:"aura.value",modifiers:{number:!0}}],key:"value-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.value},on:{change:function(t){return e.updateShape(!0)},input:function(i){i.target.composing||e.$set(t,"value",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"fspan-"+t.uuid},[e._v("/")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.dim,expression:"aura.dim",modifiers:{number:!0}}],key:"dimvalue-"+t.uuid,attrs:{type:"text",title:"Dim value",disabled:!e.owned},domProps:{value:t.dim},on:{change:function(t){return e.updateShape(!0)},input:function(i){i.target.composing||e.$set(t,"dim",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("color-picker",{key:"colour-"+t.uuid,attrs:{color:t.colour,disabled:!e.owned},on:{"update:color":function(i){return e.$set(t,"colour",i)},input:function(i){return e.updateAuraColour(t,i)},change:function(t){return e.updateShape(!0)}}}),i("div",{key:"visibility-"+t.uuid,style:{opacity:t.visible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){t.visible=!t.visible,e.updateShape(!0)}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{key:"visionsource-"+t.uuid,style:{opacity:t.visionSource?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.updateAuraVisionSource(t)}}},[i("i",{staticClass:"fas fa-lightbulb"})]),""!==t.name||0!==t.value?i("div",{key:"remove-"+t.uuid,style:{opacity:e.owned?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeAura(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]})),i("div",{staticClass:"spanrow header"},[e._v("Labels")]),i("div",{staticClass:"spanrow",attrs:{id:"labels"}},[e._l(e.shape.labels,(function(t){return i("div",{key:t.uuid,staticClass:"label"},[t.category?[i("div",{staticClass:"label-user"},[e._v(e._s(t.category))]),i("div",{staticClass:"label-main",on:{click:function(i){return e.removeLabel(t.uuid)}}},[e._v(e._s(t.name))])]:e._e(),t.category?e._e():[i("div",{staticClass:"label-main",on:{click:function(i){return e.removeLabel(t.uuid)}}},[e._v(e._s(t.name))])]],2)})),e.owned?i("div",{staticClass:"label",attrs:{id:"label-add"}},[i("div",{staticClass:"label-main",on:{click:e.openLabelManager}},[e._v("+")])]):e._e()],2),i("div",{staticClass:"spanrow header"},[e._v("Annotation")]),i("textarea",{staticClass:"spanrow",attrs:{disabled:!e.owned},domProps:{value:e.shape.annotation},on:{change:e.updateAnnotation}})],2)])])},tn=[],sn=class extends s["default"]{constructor(){super(...arguments),this.visible=!1}get owned(){return this.shape.ownedBy()}mounted(){Ke.$on("EditDialog.Open",e=>{this.shape=e,this.visible=!0}),Ke.$on("EditDialog.AddLabel",e=>{this.visible&&(this.shape.labels.push(yt.labels[e]),this.updateShape(!0))})}beforeDestroy(){Ke.$off("EditDialog.Open"),Ke.$off("EditDialog.AddLabel")}updated(){this.addEmpty()}addEmpty(){""!==this.shape.owners[this.shape.owners.length-1]&&this.shape.addOwner(""),this.shape.trackers.length&&""===this.shape.trackers[this.shape.trackers.length-1].name&&0===this.shape.trackers[this.shape.trackers.length-1].value||this.shape.trackers.push({uuid:ae(),name:"",value:0,maxvalue:0,visible:!1}),this.shape.auras.length&&""===this.shape.auras[this.shape.auras.length-1].name&&0===this.shape.auras[this.shape.auras.length-1].value||this.shape.auras.push({uuid:ae(),name:"",value:0,dim:0,visionSource:!1,colour:"rgba(0,0,0,0)",visible:!1})}updateShape(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.owned&&(Xe.emit("Shape.Update",{shape:this.shape.asDict(),redraw:e,temporary:t}),e&&xt.invalidate(),this.addEmpty())}setToken(e){this.owned&&(this.shape.setIsToken(e.target.checked),this.updateShape(!0))}setVisionBlocker(e){this.owned&&(this.shape.checkVisionSources(),this.updateShape(!0))}setMovementBlocker(e){this.owned&&(this.shape.setMovementBlock(e.target.checked),this.updateShape(!1))}updateAnnotation(e){if(this.owned){var t=""!==this.shape.annotation;this.shape.annotation=e.target.value,""===this.shape.annotation||t?""===this.shape.annotation&&t&&(yt.annotations.splice(yt.annotations.findIndex(e=>e===this.shape.uuid)),xt.hasLayer("draw")&&xt.getLayer("draw").invalidate(!0)):(yt.annotations.push(this.shape.uuid),xt.hasLayer("draw")&&xt.getLayer("draw").invalidate(!0)),this.updateShape(!1)}}updateOwner(e,t){this.owned&&(this.shape.updateOwner(t,e.target.value),this.updateShape(yt.fowLOS))}removeOwner(e){this.owned&&(this.shape.removeOwner(e),this.updateShape(yt.fowLOS))}removeTracker(e){this.owned&&(this.shape.trackers=this.shape.trackers.filter(t=>t.uuid!==e),this.updateShape(!1))}removeAura(e){this.owned&&(this.shape.auras=this.shape.auras.filter(t=>t.uuid!==e),this.shape.checkVisionSources(),this.updateShape(!0))}updateAuraVisionSource(e){if(this.owned){e.visionSource=!e.visionSource;var t=wi.visionSources.findIndex(t=>t.aura===e.uuid);e.visionSource&&-1===t?wi.visionSources.push({shape:this.shape.uuid,aura:e.uuid}):!e.visionSource&&t>=0&&wi.visionSources.splice(t,1),this.updateShape(!0)}}updateAuraColour(e,t){if(this.owned){var i=xt.getLayer(this.shape.layer);void 0!==i&&i.invalidate(!e.visionSource)}}openLabelManager(){Ke.$emit("LabelManager.Open")}removeLabel(e){this.owned&&(this.shape.labels=this.shape.labels.filter(t=>t.uuid!==e),this.updateShape(!0))}};Object(f["a"])([Object(H["a"])()],sn.prototype,"shape",void 0),sn=Object(f["a"])([Object(g["b"])({components:{Modal:Y,"color-picker":Ts}})],sn);var nn=sn,rn=nn,on=(i("5d8d"),Object(o["a"])(rn,en,tn,!1,null,"637f8f89",null)),an=on.exports,ln=class extends s["default"]{constructor(){super(...arguments),this.shape=null}mounted(){Ke.$on("SelectionInfo.Shape.Set",e=>{this.shape=e})}get shapes(){return null===this.shape?[]:[this.shape]}get visibleTrackers(){return null===this.shape?[]:this.shape.trackers.filter(e=>""!==e.name||0!==e.value)}get visibleAuras(){return null===this.shape?[]:this.shape.auras.filter(e=>""!==e.name||0!==e.value)}beforeDestroy(){Ke.$off("SelectionInfo.Shape.Set")}openEditDialog(){this.$refs.editDialog[0].visible=!0}changeValue(e,t){null!==this.shape&&this.$parent.$refs.prompt.prompt("New  ".concat(e.name," value:"),"Updating ".concat(e.name)).then(i=>{if(null!==this.shape){var s=e.value;"+"===i[0]||"-"===i[0]?e.value+=parseInt(i,10):e.value=parseInt(i,10),isNaN(e.value)&&(e.value=s),Xe.emit("Shape.Update",{shape:this.shape.asDict(),redraw:t,temporary:!1}),t&&xt.invalidate()}},()=>{})}};ln=Object(f["a"])([Object(g["b"])({components:{"edit-dialog":an}})],ln);var cn=ln,hn=cn,un=(i("2457"),Object(o["a"])(hn,Zs,Js,!1,null,"394cb731",null)),dn=un.exports,pn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{attrs:{id:"toolselect"}},[i("ul",e._l(e.visibleTools,(function(t){return i("li",{directives:[{name:"show",rawName:"v-show",value:e.toolVisible(t),expression:"toolVisible(tool)"}],key:t,ref:t+"-selector",refInFor:!0,class:{"tool-selected":e.currentTool===t},on:{mousedown:function(i){e.currentTool=t}}},[i("a",{attrs:{href:"#"}},[e._v(e._s(t))])])})),0)]),i("div",[[i("select-tool",{directives:[{name:"show",rawName:"v-show",value:"Select"===e.currentTool,expression:"currentTool === 'Select'"}],ref:"selectTool"}),i("pan-tool",{directives:[{name:"show",rawName:"v-show",value:"Pan"===e.currentTool,expression:"currentTool === 'Pan'"}]}),i("keep-alive",[i("draw-tool",{directives:[{name:"show",rawName:"v-show",value:"Draw"===e.currentTool,expression:"currentTool === 'Draw'"}]})],1),i("ruler-tool",{directives:[{name:"show",rawName:"v-show",value:"Ruler"===e.currentTool,expression:"currentTool === 'Ruler'"}]}),i("ping-tool",{directives:[{name:"show",rawName:"v-show",value:"Ping"===e.currentTool,expression:"currentTool === 'Ping'"}]}),i("map-tool",{directives:[{name:"show",rawName:"v-show",value:"Map"===e.currentTool,expression:"currentTool === 'Map'"}]}),i("filter-tool",{directives:[{name:"show",rawName:"v-show",value:"Filter"===e.currentTool,expression:"currentTool === 'Filter'"}]}),i("vision-tool",{directives:[{name:"show",rawName:"v-show",value:"Vision"===e.currentTool,expression:"currentTool === 'Vision'"}]}),i("shape-menu",{ref:"shapecontext"}),i("default-menu",{ref:"defaultcontext"}),i("createtoken-dialog",{ref:"createtokendialog"})]],2)])},vn=[],fn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return void 0!==e.getActiveLayer()?i("ContextMenu",{attrs:{visible:e.visible,left:e.x+"px",top:e.y+"px"},on:{close:e.close}},[e.getLayers().length>1?i("li",[e._v(" Layer "),i("ul",e._l(e.getLayers(),(function(t){return i("li",{key:t.name,style:[e.getActiveLayer().name===t.name?{"background-color":"#82c8a0"}:{}],on:{click:function(i){return e.setLayer(t.name)}}},[e._v(" "+e._s(t.name)+" ")])})),0)]):e._e(),e.locations.length>1?i("li",[e._v(" Location "),i("ul",e._l(e.locations,(function(t){return i("li",{key:t,style:[e.getCurrentLocation()===t?{"background-color":"#82c8a0"}:{}],on:{click:function(i){return e.setLocation(t)}}},[e._v(" "+e._s(t)+" ")])})),0)]):e._e(),i("li",{on:{click:e.moveToBack}},[e._v("Move to back")]),i("li",{on:{click:e.moveToFront}},[e._v("Move to front")]),i("li",{on:{click:e.addInitiative}},[e._v(e._s(e.getInitiativeWord())+" initiative")]),i("li",{on:{click:e.deleteSelection}},[e._v("Delete shapes")]),e.hasSingleShape()?i("li",{on:{click:e.openEditDialog}},[e._v("Show properties")]):e._e()]):e._e()},gn=[],mn=class extends s["default"]{constructor(){super(...arguments),this.visible=!1,this.x=0,this.y=0}get activeLayer(){var e=xt.getLayer();return void 0===e?"":e.name}open(e){this.visible=!0,this.x=e.pageX,this.y=e.pageY,this.$nextTick(()=>this.$children[0].$el.focus())}close(){this.visible=!1}getLayers(){return xt.layers.filter(e=>e.selectable&&(yt.IS_DM||e.playerEditable))}getActiveLayer(){return xt.getLayer()}getCurrentLocation(){return yt.locationName}getInitiativeWord(){var e=xt.getLayer();return 1===e.selection.length?ls(e.selection[0].uuid)?"Show":"Add":e.selection.every(e=>ls(e.uuid))?"Show":"Add all to"}hasSingleShape(){var e=xt.getLayer();return 1===e.selection.length}setLayer(e){var t=xt.getLayer();t.selection.forEach(t=>t.moveLayer(e,!0)),this.close()}setLocation(e){var t=xt.getLayer();Ni(),Xe.emit("Location.Change",e),Xe.once("Location.Set",e=>{Xe.once("Client.Options.Set",e=>{t.selection=Di(t.name),xt.selectLayer(t.name)})}),this.close()}moveToBack(){var e=this.getActiveLayer();e.selection.forEach(t=>e.moveShapeOrder(t,0,!0)),this.close()}moveToFront(){var e=this.getActiveLayer();e.selection.forEach(t=>e.moveShapeOrder(t,e.shapes.length-1,!0)),this.close()}addInitiative(){var e=xt.getLayer();e.selection.forEach(e=>hs.addInitiative(e.getInitiativeRepr())),Ke.$emit("Initiative.Show"),this.close()}deleteSelection(){Ri(),this.close()}openEditDialog(){var e=xt.getLayer();1===e.selection.length&&(Ke.$emit("EditDialog.Open",e.selection[0]),this.close())}};mn=Object(f["a"])([Object(g["b"])({components:{ContextMenu:O},computed:Object.assign({},Object(I["c"])("game",["locations","assets","notes"]))})],mn);var bn=mn,yn=bn,wn=(i("223f"),Object(o["a"])(yn,fn,gn,!1,null,"623db654",null)),xn=wn.exports,Sn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v(" Create basic token ")])}}])},[i("div",{staticClass:"modal-body"},[i("label",{attrs:{for:"createtokendialog-text"}},[e._v("Text")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"text"}],attrs:{type:"text",id:"createtokendialog-name"},domProps:{value:e.text},on:{input:function(t){t.target.composing||(e.text=t.target.value)}}}),i("label",[e._v("Colours")]),i("div",{staticClass:"colours"},[i("span",[e._v("Fill:")]),i("color-picker",{attrs:{color:e.fillColour},on:{"update:color":function(t){e.fillColour=t}}}),i("span",[e._v("Border:")]),i("color-picker",{attrs:{color:e.borderColour},on:{"update:color":function(t){e.borderColour=t}}})],1),i("canvas",{ref:"canvas",attrs:{width:"100px",height:"100px"}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.submit}},[e._v("Submit")])])])},Cn=[],_n=class extends s["default"]{constructor(){super(...arguments),this.x=0,this.y=0,this.visible=!1,this.text="X",this.fillColour="rgba(255, 255, 255, 1)",this.borderColour="rgba(0, 0, 0, 1)"}mounted(){this.updatePreview()}onTextChange(e,t){this.updatePreview()}onFillChange(e,t){this.updatePreview()}onBorderChange(e,t){this.updatePreview()}open(e,t){this.visible=!0,this.x=e,this.y=t}submit(){var e=xt.getLayer();if(void 0!==e){var t=new Li(lt(new Ze(this.x,this.y)),ot(yt.unitSize/2),this.text,"10px serif",this.fillColour,this.borderColour);t.addOwner(yt.username),e.addShape(t,!0),e.invalidate(!1),this.visible=!1}}updatePreview(){var e=this.$refs.canvas.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath();var t={x:e.canvas.width/2,y:e.canvas.height/2},i=.9*Math.min(t.x,t.y);e.fillStyle=this.fillColour,e.arc(t.x,t.y,i,0,2*Math.PI),e.fill(),"rgba(0, 0, 0, 0)"!==this.borderColour&&(e.beginPath(),e.lineWidth=5,e.strokeStyle=this.borderColour,e.arc(t.x,t.y,i-2.5,0,2*Math.PI),e.stroke()),e.save(),e.textAlign="center",e.textBaseline="middle";var s=he(e,this.text,i-2.5);e.setTransform(s,0,0,s,t.x,t.y),e.fillStyle=dt["mostReadable"](this.fillColour,["#000","#fff"]).toHexString(),e.fillText(this.text,0,0),e.restore()}};Object(f["a"])([Object(H["b"])("text")],_n.prototype,"onTextChange",null),Object(f["a"])([Object(H["b"])("fillColour")],_n.prototype,"onFillChange",null),Object(f["a"])([Object(H["b"])("borderColour")],_n.prototype,"onBorderChange",null),_n=Object(f["a"])([Object(g["b"])({components:{Modal:Y,"color-picker":Ts},computed:Object.assign({},Object(I["c"])("game",["unitSize"]))})],_n);var On=_n,kn=On,Ln=(i("34be"),Object(o["a"])(kn,Sn,Cn,!1,null,"b67b425c",null)),En=Ln.exports,In=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContextMenu",{attrs:{visible:e.visible,left:e.x+"px",top:e.y+"px"},on:{close:e.close}},[e.IS_DM?i("li",{on:{click:e.bringPlayers}},[e._v("Bring players")]):e._e(),i("li",{on:{click:e.createToken}},[e._v("Create basic token")]),i("li",{on:{click:e.showInitiative}},[e._v("Show initiative")])])},Pn=[],Mn=class extends s["default"]{constructor(){super(...arguments),this.visible=!1,this.x=0,this.y=0}get IS_DM(){return yt.IS_DM}open(e){this.visible=!0,this.x=e.pageX,this.y=e.pageY,this.$nextTick(()=>this.$children[0].$el.focus())}close(){this.visible=!1}bringPlayers(){yt.IS_DM&&(Xe.emit("Players.Bring",{x:ct(this.x),y:ht(this.y),zoom:yt.zoomDisplay}),this.close())}createToken(){this.$parent.$refs.createtokendialog.open(this.x,this.y),this.close()}showInitiative(){Ke.$emit("Initiative.Show"),this.close()}};Mn=Object(f["a"])([Object(g["b"])({components:{ContextMenu:O}})],Mn);var Tn=Mn,An=Tn,Dn=(i("a10f"),Object(o["a"])(An,In,Pn,!1,null,"5943a1f0",null)),Rn=Dn.exports,Nn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.IS_DM,expression:"IS_DM"}]},[e._v("Mode")]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.IS_DM,expression:"IS_DM"}],staticClass:"selectgroup"},e._l(e.modes,(function(t){return i("div",{key:t,staticClass:"option",class:{"option-selected":e.modeSelect===t},on:{click:function(i){e.modeSelect=t}}},[e._v(" "+e._s(t)+" ")])})),0),i("div",[e._v("Shape")]),i("div",{staticClass:"selectgroup"},e._l(e.shapes,(function(t){return i("div",{key:t,staticClass:"option",class:{"option-selected":e.shapeSelect===t},on:{click:function(i){e.shapeSelect=t}}},[i("i",{staticClass:"fas",class:"fa-"+t})])})),0),i("div",[e._v("Colours")]),i("div",{staticClass:"selectgroup"},[i("color-picker",{staticClass:"option",class:{"radius-right":!e.showBorderColour()},attrs:{color:e.fillColour},on:{"update:color":function(t){e.fillColour=t}}}),i("color-picker",{directives:[{name:"show",rawName:"v-show",value:e.showBorderColour(),expression:"showBorderColour()"}],staticClass:"option",attrs:{color:e.borderColour},on:{"update:color":function(t){e.borderColour=t}}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"draw-polygon"===e.shapeSelect,expression:"shapeSelect === 'draw-polygon'"}],staticStyle:{display:"flex"}},[i("label",{staticStyle:{flex:"5"},attrs:{for:"polygon-close"}},[e._v("Closed polygon?")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.closedPolygon,expression:"closedPolygon"}],staticStyle:{flex:"1","align-self":"center"},attrs:{type:"checkbox",id:"polygon-close"},domProps:{checked:Array.isArray(e.closedPolygon)?e._i(e.closedPolygon,null)>-1:e.closedPolygon},on:{change:function(t){var i=e.closedPolygon,s=t.target,n=!!s.checked;if(Array.isArray(i)){var r=null,o=e._i(i,r);s.checked?o<0&&(e.closedPolygon=i.concat([r])):o>-1&&(e.closedPolygon=i.slice(0,o).concat(i.slice(o+1)))}else e.closedPolygon=n}}})]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.hasBrushSize(),expression:"hasBrushSize()"}],staticStyle:{display:"flex"}},[i("label",{staticStyle:{flex:"5"},attrs:{for:"brush-size"}},[e._v("Brush size")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.brushSize,expression:"brushSize"}],staticStyle:{flex:"4","align-self":"center","max-width":"100px"},attrs:{type:"input",id:"brush-size"},domProps:{value:e.brushSize},on:{input:function(t){t.target.composing||(e.brushSize=t.target.value)}}})])]):e._e()},Un=[],jn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div")},zn=[],$n=class extends s["default"]{constructor(){super(...arguments),this.name="",this.selected=!1,this.active=!1}get detailRight(){var e=this.$parent.$refs[this.name+"-selector"][0].getBoundingClientRect(),t=e.left+e.width/2;return"".concat(window.innerWidth-Math.min(window.innerWidth-25,t+75),"px")}get detailArrow(){var e=this.$parent.$refs[this.name+"-selector"][0].getBoundingClientRect(),t=e.left+e.width/2,i=Math.min(window.innerWidth-25,t+75);return"".concat(i-t-14,"px")}created(){this.$parent.$on("mousedown",(e,t)=>{t===this.name&&this.onMouseDown(e)}),this.$parent.$on("mouseup",(e,t)=>{t===this.name&&this.onMouseUp(e)}),this.$parent.$on("mousemove",(e,t)=>{t===this.name&&this.onMouseMove(e)}),this.$parent.$on("contextmenu",(e,t)=>{t===this.name&&this.onContextMenu(e)}),this.$parent.$on("tools-select-change",(e,t)=>{t===this.name?(this.selected=!1,this.onDeselect()):e===this.name&&(this.selected=!0,this.onSelect())})}onSelect(){}onDeselect(){}onMouseDown(e){}onMouseUp(e){}onMouseMove(e){}onContextMenu(e){this.$parent.$refs.defaultcontext.open(e)}};$n=Object(f["a"])([g["b"]],$n);var Fn=$n,Vn=Fn,Hn=(i("12d3"),Object(o["a"])(Vn,jn,zn,!1,null,null,null)),Bn=Hn.exports,Gn=class extends Bn{constructor(){super(...arguments),this.name="Draw",this.active=!1,this.startPoint=null,this.shape=null,this.brushHelper=null,this.ruler=null,this.fillColour="rgba(0, 0, 0, 1)",this.borderColour="rgba(255, 255, 255, 0)",this.shapeSelect="square",this.shapes=["square","circle","draw-polygon","paint-brush"],this.modeSelect="normal",this.modes=["normal","reveal","hide"],this.brushSize=ot(yt.unitSize),this.closedPolygon=!1}mounted(){window.addEventListener("keyup",this.onKeyUp)}destroyed(){window.removeEventListener("keyup",this.onKeyUp)}get helperSize(){return this.hasBrushSize()?this.brushSize/2:ot(this.unitSize)/8}get IS_DM(){return yt.IS_DM}get unitSize(){return yt.unitSize}get useGrid(){return yt.useGrid}onKeyUp(e){e.defaultPrevented||("Escape"===e.key&&this.active&&(this.onDeselect(),this.onSelect()),e.preventDefault())}hasBrushSize(){return["paint-brush","draw-polygon"].includes(this.shapeSelect)}showBorderColour(){return"paint-brush"!==this.shapeSelect&&!("draw-polygon"===this.shapeSelect&&!this.closedPolygon)}onChangePolygonCloseBehaviour(e){null!==this.shape&&this.active&&(this.shape.openPolygon=!e)}onFillChange(){this.brushHelper&&(this.brushHelper.fillColour=this.fillColour)}onModeUpdate(e,t){this.onModeChange(e,t)}onLayerChange(e,t){this.$parent.currentTool===this.name&&(this.onDeselect(t),this.onSelect())}setupBrush(){null!==this.brushHelper&&("reveal"===this.modeSelect||"hide"===this.modeSelect?(this.brushHelper.options.set("preFogShape",!0),this.brushHelper.options.set("skipDraw",!0),this.brushHelper.fillColour="rgba(0, 0, 0, 1)","reveal"===this.modeSelect?this.brushHelper.globalCompositeOperation="source-over":"hide"===this.modeSelect&&(this.brushHelper.globalCompositeOperation="destination-out")):(this.brushHelper.options.delete("preFogShape"),this.brushHelper.options.delete("skipDraw"),this.brushHelper.globalCompositeOperation="source-over",this.brushHelper.fillColour=this.fillColour))}onModeChange(e,t){if(null!==this.brushHelper){var i=xt.getLayer("fow"),s=xt.getLayer();void 0!==i&&void 0!==s&&(this.setupBrush(),"normal"!==e&&"normal"===t?(s.removeShape(this.brushHelper,!1),i.addShape(this.brushHelper,!1)):"normal"===e&&"normal"!==t&&(s.addShape(this.brushHelper,!1),i.removeShape(this.brushHelper,!1)))}}getLayer(e){return"normal"===this.modeSelect?xt.getLayer(e):xt.getLayer("fow")}onMouseDown(e){var t=this.getLayer();if(void 0!==t){if(this.active)null!==this.shape&&"draw-polygon"===this.shapeSelect&&this.shape instanceof Mi&&this.shape._vertices.push(lt(vt(e)));else{switch(this.startPoint=lt(vt(e)),this.active=!0,this.shapeSelect){case"square":this.shape=new Ii(this.startPoint.clone(),0,0,this.fillColour,this.borderColour);break;case"circle":this.shape=new ki(this.startPoint.clone(),this.helperSize,this.fillColour,this.borderColour);break;case"paint-brush":this.shape=new Mi(this.startPoint.clone(),[],void 0,this.fillColour,this.brushSize,!0),this.shape.fillColour=this.fillColour;break;case"draw-polygon":var i=this.closedPolygon?this.fillColour:void 0,s=this.closedPolygon?this.borderColour:this.fillColour;this.shape=new Mi(this.startPoint.clone(),[],i,s,this.brushSize,!this.closedPolygon);break;default:return}"normal"!==this.modeSelect&&(this.shape.options.set("preFogShape",!0),this.shape.options.set("skipDraw",!0),this.shape.fillColour="rgba(0, 0, 0, 1)"),"reveal"===this.modeSelect?this.shape.globalCompositeOperation="source-over":"hide"===this.modeSelect&&(this.shape.globalCompositeOperation="destination-out"),this.shape.addOwner(yt.username),"fow"===t.name&&"normal"===this.modeSelect&&(this.shape.visionObstruction=!0,this.shape.movementObstruction=!0),t.addShape(this.shape,!0,!1,!1),this.pushBrushBack()}if(null!==this.shape&&"draw-polygon"===this.shapeSelect&&this.shape instanceof Mi){var n=lt(vt(e));null===this.ruler?(this.ruler=new Ei(n,n,this.brushSize,this.fillColour),t.addShape(this.ruler,!1)):(this.ruler.refPoint=n,this.ruler.endPoint=n),this.shape.visionObstruction&&wi.recalculateVision(),t.invalidate(!1),Xe.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!0})}}else console.log("No active layer!")}onMouseMove(e){var t=lt(vt(e)),i=this.getLayer();if(void 0!==i){if(null!==this.brushHelper&&(this.brushHelper.r=this.helperSize,this.brushHelper.refPoint=t,this.active||i.invalidate(!1)),this.active&&null!==this.startPoint&&null!==this.shape){switch(this.shapeSelect){case"square":this.shape.w=Math.abs(t.x-this.startPoint.x),this.shape.h=Math.abs(t.y-this.startPoint.y),this.shape.refPoint=new Qe(Math.min(this.startPoint.x,t.x),Math.min(this.startPoint.y,t.y));break;case"circle":this.shape.r=Math.abs(t.subtract(this.startPoint).length());break;case"paint-brush":this.shape._vertices.push(t);break;case"draw-polygon":this.ruler.endPoint=t;break}"draw-polygon"===this.shapeSelect&&this.shape instanceof Mi||(Xe.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!0}),this.shape.visionObstruction&&wi.recalculateVision()),i.invalidate(!1)}}else console.log("No active layer!")}onMouseUp(e){!this.active||null===this.shape||this.shape instanceof Mi&&"draw-polygon"===this.shapeSelect||(!e.altKey&&this.useGrid&&this.shape.resizeToGrid(),this.finaliseShape())}onContextMenu(e){if(this.active&&null!==this.shape&&"draw-polygon"===this.shapeSelect&&this.shape instanceof Mi){var t=this.getLayer();if(void 0===t)return void console.log("No active layer!");t.removeShape(this.ruler,!1),this.ruler=null,this.finaliseShape()}else this.active||this.$parent.$refs.defaultcontext.open(e)}finaliseShape(){null!==this.shape&&(this.shape.points.length<=1?(this.onDeselect(),this.onSelect()):(this.shape.visionObstruction&&wi.recalculateVision(),this.shape.movementObstruction&&wi.recalculateMovement(),Xe.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!1})),this.active=!1)}onSelect(){var e=this.getLayer();void 0!==e&&(this.brushHelper=new ki(new Qe(-1e3,-1e3),this.brushSize/2,this.fillColour),this.setupBrush(),e.addShape(this.brushHelper,!1))}onDeselect(e){var t=this.getLayer(e);null!==this.brushHelper&&void 0!==t&&(t.removeShape(this.brushHelper,!1),this.brushHelper=null),null!==this.ruler&&void 0!==t&&(t.removeShape(this.ruler,!1),this.ruler=null),this.active&&void 0!==t&&null!==this.shape&&(t.removeShape(this.shape,!0,!1),this.shape=null,this.active=!1,t.invalidate(!1))}pushBrushBack(){var e=this.getLayer();void 0!==e?(null!==this.brushHelper&&e.removeShape(this.brushHelper,!1),this.brushHelper=new ki(new Qe(-1e3,-1e3),this.brushSize/2,this.fillColour),this.setupBrush(),e.addShape(this.brushHelper,!1)):console.log("No active layer!")}};Object(f["a"])([Object(H["b"])("closedPolygon")],Gn.prototype,"onChangePolygonCloseBehaviour",null),Object(f["a"])([Object(H["b"])("fillColour")],Gn.prototype,"onFillChange",null),Object(f["a"])([Object(H["b"])("modeSelect")],Gn.prototype,"onModeUpdate",null),Object(f["a"])([Object(H["b"])("selectedLayer")],Gn.prototype,"onLayerChange",null),Gn=Object(f["a"])([Object(g["b"])({components:{"color-picker":Ts},computed:Object.assign({},Object(I["b"])("game",["selectedLayer"]))})],Gn);var Wn=Gn,Xn=Wn,Yn=(i("2eb7"),Object(o["a"])(Xn,Nn,Un,!1,null,"790caf6c",null)),Kn=Yn.exports,qn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",{attrs:{id:"accordion-container"}},e._l(e.categories,(function(t){return i("accordion",{key:t,attrs:{title:""===t?"no category":t,showArrow:!1,items:e.labels[t],initialValues:e.initalValues[t]},on:{selectionupdate:e.updateSelection}})})),1)]):e._e()},Qn=[],Zn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"accordion"},[i("div",{attrs:{id:"header"},on:{click:function(t){return t.preventDefault(),e.toggleDisplay(t)}}},[i("input",{ref:"overall",attrs:{type:"checkbox"},on:{click:function(t){return t.stopPropagation(),e.toggleCategory(t)}}}),i("strong",[e._v(e._s(e.title))]),e.showArrow?[i("span",{directives:[{name:"show",rawName:"v-show",value:e.showArrow&&!e.active,expression:"showArrow && !active"}],staticClass:"down-Arrow"},[e._v("▼")]),i("span",{directives:[{name:"show",rawName:"v-show",value:e.showArrow&&e.active,expression:"showArrow && active"}],staticClass:"up-Arrow"},[e._v("▲")])]:e._e()],2),i("div",{directives:[{name:"show",rawName:"v-show",value:e.active,expression:"active"}],attrs:{id:"body"}},e._l(e.items,(function(t){return i("div",{key:t[0],staticClass:"item",on:{click:function(i){return e.toggleSelection(t[0])}}},[i("input",{attrs:{type:"checkbox"},domProps:{checked:e.selected.includes(t[0])},on:{click:function(e){e.preventDefault()}}}),e._v(" "+e._s(t[1])+" ")])})),0)])},Jn=[],er=class extends s["default"]{constructor(){super(...arguments),this.selected=[],this.active=!1}mounted(){this.selected=this.initialValues,this.updateCategory()}toggleDisplay(e){this.active=!this.active}toggleCategory(){var e=this.$refs.overall;e.checked?this.selected=this.items.map(e=>e[0]):this.selected=[],this.$emit("selectionupdate",{title:this.title,selection:this.selected})}updateCategory(){var e=this.$refs.overall;0===this.selected.length?(e.checked=!1,e.indeterminate=!1):this.selected.length===this.items.length?(e.checked=!0,e.indeterminate=!1):(e.checked=!1,e.indeterminate=!0)}toggleSelection(e){var t=this.selected.indexOf(e);-1===t?this.selected.push(e):this.selected.splice(t,1),this.updateCategory(),this.$emit("selectionupdate",{title:this.title,selection:this.selected})}};Object(f["a"])([Object(H["a"])(String)],er.prototype,"title",void 0),Object(f["a"])([Object(H["a"])({default:!0,type:Boolean})],er.prototype,"showArrow",void 0),Object(f["a"])([Object(H["a"])({default:()=>[]})],er.prototype,"items",void 0),Object(f["a"])([Object(H["a"])({default:()=>[]})],er.prototype,"initialValues",void 0),er=Object(f["a"])([g["b"]],er);var tr=er,ir=tr,sr=(i("aa79"),Object(o["a"])(ir,Zn,Jn,!1,null,"32e257d0",null)),nr=sr.exports,rr=class extends Bn{constructor(){super(...arguments),this.name="Filter",this.active=!1}get labels(){var e={"":[]};for(var t of Object.keys(yt.labels)){var i=yt.labels[t];i.category?(i.category in e||(e[i.category]=[]),e[i.category].push([i.uuid,i.name]),e[i.category].sort((e,t)=>e[1].localeCompare(t[1]))):e[""].push([i.uuid,i.name])}return e}get initalValues(){var e=this,t={},i=function(i){t[i]=yt.labelFilters.filter(t=>e.labels[i].map(e=>e[0]).includes(t))};for(var s of Object.keys(this.labels))i(s);return t}get categories(){return Object.keys(this.labels).sort()}isFilter(e){return yt.labelFilters.includes(e)}toggleFilter(e){var t=yt.labelFilters.indexOf(e);t>=0?yt.labelFilters.splice(t,1):yt.labelFilters.push(e),xt.invalidate()}toggleUnlabeled(){yt.toggleUnlabeledFilter(),xt.invalidate()}updateSelection(e){if(e.title in this.labels){for(var[t,i]of this.labels[e.title]){var s=yt.labelFilters.indexOf(t),n=e.selection.includes(t);s>=0&&!n?(yt.labelFilters.splice(s,1),Xe.emit("Labels.Filter.Remove",t)):s<0&&n&&(yt.labelFilters.push(t),Xe.emit("Labels.Filter.Add",t))}xt.invalidate()}}};rr=Object(f["a"])([Object(g["b"])({components:{accordion:nr}})],rr);var or=rr,ar=or,lr=(i("e3f5"),i("4a14"),Object(o["a"])(ar,qn,Qn,!1,null,"75b63661",null)),cr=lr.exports,hr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",[e._v("#X")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.xCount,expression:"xCount"}],attrs:{type:"text"},domProps:{value:e.xCount},on:{input:function(t){t.target.composing||(e.xCount=t.target.value)}}}),i("div",[e._v("#Y")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.yCount,expression:"yCount"}],attrs:{type:"text"},domProps:{value:e.yCount},on:{input:function(t){t.target.composing||(e.yCount=t.target.value)}}})]):e._e()},ur=[],dr=class extends Bn{constructor(){super(...arguments),this.name="Map",this.active=!1,this.xCount=3,this.yCount=3,this.startPoint=null,this.rect=null}onMouseDown(e){var t=xt.getLayer();void 0!==t?(this.active=!0,this.startPoint=lt(vt(e)),this.rect=new Ii(this.startPoint.clone(),0,0,"rgba(0,0,0,0)","black"),t.addShape(this.rect,!1,!1)):console.log("No active layer!")}onMouseMove(e){if(this.active&&null!==this.rect&&null!==this.startPoint){var t=xt.getLayer();if(void 0!==t){var i=lt(vt(e));this.rect.w=Math.abs(i.x-this.startPoint.x),this.rect.h=Math.abs(i.y-this.startPoint.y),this.rect.refPoint=new Qe(Math.min(this.startPoint.x,i.x),Math.min(this.startPoint.y,i.y)),t.invalidate(!1)}else console.log("No active layer!")}}onMouseUp(e){if(this.active&&null!==this.rect){var t=xt.getLayer();if(void 0!==t)if(this.active=!1,1===t.selection.length){var i=this.rect.w,s=this.rect.h,n=t.selection[0];n instanceof _i&&(n.w*=this.xCount*yt.gridSize/i,n.h*=this.yCount*yt.gridSize/s),t.removeShape(this.rect,!1,!1)}else t.removeShape(this.rect,!1,!1);else console.log("No active layer!")}}};dr=Object(f["a"])([g["b"]],dr);var pr=dr,vr=pr,fr=Object(o["a"])(vr,hr,ur,!1,null,null,null),gr=fr.exports,mr=class extends Bn{constructor(){super(...arguments),this.name="Pan",this.panStart=new Ze(0,0),this.active=!1}onMouseDown(e){this.panStart=vt(e),this.active=!0}onMouseMove(e){if(this.active){var t=vt(e),i=t.subtract(this.panStart).multiply(1/yt.zoomFactor);yt.increasePanX(Math.round(i.x)),yt.increasePanY(Math.round(i.y)),this.panStart=t,xt.invalidate()}}onMouseUp(e){this.active=!1,tt(yt.locationOptions)}};mr=Object(f["a"])([g["b"]],mr);var br,yr=mr;(function(e){e[e["Noop"]=0]="Noop",e[e["Resize"]=1]="Resize",e[e["Drag"]=2]="Drag",e[e["GroupSelect"]=3]="GroupSelect"})(br||(br={}));var wr=new Qe(-1e3,-1e3),xr=class extends Bn{constructor(){super(...arguments),this.name="Select",this.showContextMenu=!1,this.active=!1,this.mode=br.Noop,this.resizePoint=0,this.deltaChanged=!1,this.dragRay=new et(new Ze(0,0),new Je(0,0)),this.selectionStartPoint=wr,this.selectionHelper=new Ii(wr,0,0)}created(){this.selectionHelper.globalCompositeOperation="source-over",yt.setSelectionHelperId(this.selectionHelper.uuid)}onMouseDown(e){var t=xt.getLayer();if(void 0!==t){this.selectionHelper.owners.includes(yt.username)||this.selectionHelper.addOwner(yt.username);var i,s=vt(e),n=lt(s),r=!1;i=t.selection.length?t.shapes.concat(t.selection):t.shapes;for(var o=i.length-1;o>=0;o--){var a=i[o];if(this.resizePoint=a.getPointIndex(n,ut(3)),this.resizePoint>=0){t.selection=[a],Ke.$emit("SelectionInfo.Shape.Set",a),this.mode=br.Resize,t.invalidate(!0),r=!0;break}if(a.contains(n)){var l=a;-1===t.selection.indexOf(l)&&(e.ctrlKey?t.selection.push(l):t.selection=[l],Ke.$emit("SelectionInfo.Shape.Set",l)),this.mode=br.Drag;var c=it(l.refPoint);this.dragRay=new et(c,s.subtract(c)),t.invalidate(!0),r=!0;break}}if(!r){for(var h of(this.mode=br.GroupSelect,t.selection))Ke.$emit("SelectionInfo.Shape.Set",h);this.selectionStartPoint=n,this.selectionHelper.refPoint=this.selectionStartPoint,this.selectionHelper.w=0,this.selectionHelper.h=0,e.ctrlKey?t.selection.push(this.selectionHelper):t.selection=[this.selectionHelper],t.invalidate(!0)}this.active=!0}else console.log("No active layer!")}onMouseMove(e){var t=xt.getLayer();if(void 0!==t){var i=vt(e),s=lt(i);if(this.deltaChanged=!1,this.mode===br.GroupSelect){var n=s;this.selectionHelper.w=Math.abs(n.x-this.selectionStartPoint.x),this.selectionHelper.h=Math.abs(n.y-this.selectionStartPoint.y),this.selectionHelper.refPoint=new Qe(Math.min(this.selectionStartPoint.x,n.x),Math.min(this.selectionStartPoint.y,n.y)),t.invalidate(!0)}else if(t.selection.length){var r=it(t.selection[t.selection.length-1].refPoint),o=r.add(this.dragRay.direction),a=i.subtract(o).multiply(1/yt.zoomFactor),l=a;if(this.mode===br.Drag){if("tokens"===t.name&&(!e.shiftKey||!yt.IS_DM))for(var c of t.selection)c.ownedBy()&&c.uuid!==this.selectionHelper.uuid&&(a=Si(a,c),a!==l&&(this.deltaChanged=!0));for(var h of t.selection)h.ownedBy()&&(h.refPoint=h.refPoint.add(a),h!==this.selectionHelper&&(h.visionObstruction&&wi.recalculateVision(),Xe.emit("Shape.Update",{shape:h.asDict(),redraw:!0,temporary:!0})));t.invalidate(!1)}else if(this.mode===br.Resize)for(var u of t.selection)u.ownedBy()&&(u.resize(this.resizePoint,i),u!==this.selectionHelper&&(u.visionObstruction&&wi.recalculateVision(),Xe.emit("Shape.Update",{shape:u.asDict(),redraw:!0,temporary:!0})),t.invalidate(!1),this.updateCursor(t,s));else this.updateCursor(t,s)}else document.body.style.cursor="default"}else console.log("No active layer!")}onMouseUp(e){var t=this;if(this.active)if(void 0!==xt.getLayer()){var i=xt.getLayer();if(this.mode===br.GroupSelect){e.ctrlKey||i.clearSelection();var s=function(e){if(!e.ownedBy())return"continue";if(e===t.selectionHelper)return"continue";var s=e.getBoundingBox();if(!e.ownedBy())return"continue";t.selectionHelper.refPoint.x<=s.topRight.x&&t.selectionHelper.refPoint.x+t.selectionHelper.w>=s.topLeft.x&&t.selectionHelper.refPoint.y<=s.botLeft.y&&t.selectionHelper.refPoint.y+t.selectionHelper.h>=s.topLeft.y&&void 0===i.selection.find(t=>t===e)&&i.selection.push(e)};for(var n of i.shapes)s(n);i.selection=i.selection.filter(e=>e!==this.selectionHelper),i.invalidate(!0)}else if(i.selection.length)for(var r of i.selection)if(r.ownedBy()){if(this.mode===br.Drag){if(this.dragRay.origin.x===st(r.refPoint.x)&&this.dragRay.origin.y===nt(r.refPoint.y))continue;!yt.useGrid||e.altKey||this.deltaChanged||r.snapToGrid(),r!==this.selectionHelper&&(r.visionObstruction&&wi.recalculateVision(),r.movementObstruction&&wi.recalculateMovement(),Xe.emit("Shape.Update",{shape:r.asDict(),redraw:!0,temporary:!1})),i.invalidate(!1)}this.mode===br.Resize&&(yt.useGrid&&!e.altKey&&r.resizeToGrid(),r!==this.selectionHelper&&(r.visionObstruction&&wi.recalculateVision(),r.movementObstruction&&wi.recalculateMovement(),Xe.emit("Shape.Update",{shape:r.asDict(),redraw:!0,temporary:!1})),i.invalidate(!1))}this.mode=br.Noop,this.active=!1}else console.log("No active layer!")}onContextMenu(e){if(void 0!==xt.getLayer()){var t=xt.getLayer(),i=vt(e),s=lt(i);for(var n of t.selection)if(n.contains(s))return Ke.$emit("SelectionInfo.Shape.Set",n),t.invalidate(!0),void this.$parent.$refs.shapecontext.open(e);for(var r=t.shapes.length-1;r>=0;r--){var o=t.shapes[r];if(o.contains(s))return t.selection=[o],Ke.$emit("SelectionInfo.Shape.Set",o),t.invalidate(!0),void this.$parent.$refs.shapecontext.open(e)}this.$parent.$refs.defaultcontext.open(e)}else console.log("No active layer!")}updateCursor(e,t){for(var i of e.selection){var s=i.getPointIndex(t,ut(3));if(s<0)document.body.style.cursor="default";else{var n=i.getPointOrientation(s).angle();n<0&&(n+=360);var r=22.5;(n>=315+r||n<r||n>=135+r&&n<225-r)&&(document.body.style.cursor="ew-resize"),(n>=45+r&&n<135-r||n>=225+r&&n<315-r)&&(document.body.style.cursor="ns-resize"),(n>=r&&n<90-r||n>=180+r&&n<270-r)&&(document.body.style.cursor="nwse-resize"),(n>=90+r&&n<180-r||n>=270+r&&n<360-r)&&(document.body.style.cursor="nesw-resize")}}}};xr=Object(f["a"])([g["b"]],xr);var Sr,Cr,_r=xr,Or=_r,kr=Object(o["a"])(Or,Sr,Cr,!1,null,null,null),Lr=kr.exports,Er=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},e._l(e.tokens,(function(t){return i("div",{key:t.uuid,staticClass:"token",class:{selected:e.selection.includes(t.uuid)},on:{click:function(i){return e.toggle(t.uuid)}}},[t.src?i("img",{attrs:{src:t.src,width:"30px",height:"30px"}}):e._e(),i("div",[e._v(e._s(t.name))])])})),0):e._e()},Ir=[],Pr=class extends Bn{constructor(){super(...arguments),this.name="Vision",this.active=!1}get selection(){return yt.activeTokens}get tokens(){return yt.ownedtokens.map(e=>xt.UUIDMap.get(e))}toggle(e){this.selection.includes(e)?yt.removeActiveToken(e):yt.addActiveToken(e)}};Pr=Object(f["a"])([g["b"]],Pr);var Mr=Pr,Tr=Mr,Ar=(i("7392"),Object(o["a"])(Tr,Er,Ir,!1,null,"f995dfd4",null)),Dr=Ar.exports,Rr=class extends Bn{constructor(){super(...arguments),this.name="Ping",this.active=!1,this.startPoint=null,this.ping=null,this.border=null}onMouseDown(e){var t=xt.getLayer("draw");void 0!==t?(this.active=!0,this.startPoint=lt(vt(e)),this.ping=new ki(this.startPoint,20,yt.rulerColour),this.border=new ki(this.startPoint,40,"#0000",yt.rulerColour),this.ping.addOwner(yt.username),this.border.addOwner(yt.username),t.addShape(this.ping,!0,!0),t.addShape(this.border,!0,!0)):console.log("No draw layer!")}onMouseMove(e){if(this.active&&null!==this.ping&&null!==this.border&&null!==this.startPoint){var t=xt.getLayer("draw");if(void 0!==t){var i=lt(vt(e));this.ping.center(i),this.border.center(i),Xe.emit("Shape.Update",{shape:this.ping.asDict(),redraw:!0,temporary:!0}),Xe.emit("Shape.Update",{shape:this.border.asDict(),redraw:!0,temporary:!0}),t.invalidate(!0)}else console.log("No draw layer!")}}onMouseUp(e){if(this.active&&null!==this.ping&&null!==this.border&&null!==this.startPoint){var t=xt.getLayer("draw");void 0!==t?(this.active=!1,t.removeShape(this.ping,!0,!0),t.removeShape(this.border,!0,!0),t.invalidate(!0),this.ping=null,this.startPoint=null):console.log("No active layer!")}}};Rr=Object(f["a"])([g["b"]],Rr);var Nr=class extends Bn{constructor(){super(...arguments),this.name="Ruler",this.active=!1,this.startPoint=null,this.ruler=null,this.text=null}onMouseDown(e){var t=xt.getLayer("draw");void 0!==t?(this.active=!0,this.startPoint=lt(vt(e)),this.ruler=new Ei(this.startPoint,this.startPoint,ut(3),yt.rulerColour),this.text=new Pi(this.startPoint.clone(),"","bold 20px serif"),this.ruler.addOwner(yt.username),this.text.addOwner(yt.username),t.addShape(this.ruler,!0,!0),t.addShape(this.text,!0,!0)):console.log("No draw layer!")}onMouseMove(e){if(this.active&&null!==this.ruler&&null!==this.startPoint&&null!==this.text){var t=xt.getLayer("draw");if(void 0!==t){var i=lt(vt(e));this.ruler.endPoint=i,Xe.emit("Shape.Update",{shape:this.ruler.asDict(),redraw:!0,temporary:!0});var s=Math.sign(i.x-this.startPoint.x)*Math.sign(i.y-this.startPoint.y),n=Math.abs(i.x-this.startPoint.x),r=Math.abs(i.y-this.startPoint.y),o=Math.round(Math.sqrt(Math.pow(n,2)+Math.pow(r,2))*yt.unitSize/yt.gridSize)+" "+yt.unitSizeUnit,a=Math.atan2(s*r,n),l=Math.min(this.startPoint.x,i.x)+n/2,c=Math.min(this.startPoint.y,i.y)+r/2;this.text.refPoint=new Qe(l,c),this.text.text=o,this.text.angle=a,Xe.emit("Shape.Update",{shape:this.text.asDict(),redraw:!0,temporary:!0}),t.invalidate(!0)}else console.log("No draw layer!")}}onMouseUp(e){if(this.active&&null!==this.ruler&&null!==this.startPoint&&null!==this.text){var t=xt.getLayer("draw");void 0!==t?(this.active=!1,t.removeShape(this.ruler,!0,!0),t.removeShape(this.text,!0,!0),t.invalidate(!0),this.ruler=this.startPoint=this.text=null):console.log("No active layer!")}}};Nr=Object(f["a"])([g["b"]],Nr);var Ur=class extends s["default"]{constructor(){super(...arguments),this.currentTool="Select",this.tools=["Select","Pan","Draw","Ruler","Ping","Map","Filter","Vision"],this.dmTools=["Map"]}get IS_DM(){return yt.IS_DM}get currentToolComponent(){return"".concat(this.currentTool.toLowerCase(),"-tool")}get visibleTools(){return this.tools.filter(e=>!this.dmTools.includes(e)||this.IS_DM)}toolVisible(e){return"Filter"===e?Object.keys(yt.labels).length>0:"Vision"!==e||yt.ownedtokens.length>1}mousedown(e){if("CANVAS"===e.target.tagName){var t=this.currentTool;if(1===e.button)t="Pan";else if(0!==e.button)return;this.$emit("mousedown",e,t)}}mouseup(e){if("CANVAS"===e.target.tagName){var t=this.currentTool;if(1===e.button)t="Pan";else if(0!==e.button)return;this.$emit("mouseup",e,t)}}mousemove(e){if("CANVAS"===e.target.tagName){var t=this.currentTool;if(0!==(4&e.buttons))t="Pan";else if((1&e.button)>1)return;this.$emit("mousemove",e,t);var i=!1;for(var s of yt.annotations)if(xt.UUIDMap.has(s)&&xt.hasLayer("draw")){var n=xt.UUIDMap.get(s);n.contains(lt(vt(e)))&&(i=!0,ss.annotationManager.setActiveText(n.annotation))}!i&&ss.annotationManager.shown&&ss.annotationManager.setActiveText("")}}mouseleave(e){0!==(1&e.buttons)&&this.$emit("mouseup",e,this.currentTool)}contextmenu(e){"CANVAS"===e.target.tagName&&2===e.button&&"CANVAS"===e.target.tagName&&this.$emit("contextmenu",e,this.currentTool)}};Ur=Object(f["a"])([Object(g["b"])({components:{"select-tool":Lr,"pan-tool":yr,"draw-tool":Kn,"ruler-tool":Nr,"ping-tool":Rr,"map-tool":gr,"filter-tool":cr,"vision-tool":Dr,"shape-menu":xn,"default-menu":Rn,"createtoken-dialog":En},watch:{currentTool(e,t){this.$emit("tools-select-change",e,t)}}})],Ur);var jr=Ur,zr=jr,$r=(i("0b57"),Object(o["a"])(zr,pn,vn,!1,null,"5132142a",null)),Fr=$r.exports,Vr=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,colour:"rgba(255, 255, 255, 0.8)",mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("DM Settings")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body",on:{click:e.handleClick}},[i("div",{attrs:{id:"categories"}},e._l(e.categories,(function(t,s){return i("div",{key:t,staticClass:"category",class:{selected:e.selection===s},on:{click:function(t){e.selection=s}}},[e._v(" "+e._s(t)+" ")])})),0),i("div",{directives:[{name:"show",rawName:"v-show",value:0===e.selection,expression:"selection === 0"}],staticClass:"panel"},[i("div",{staticClass:"spanrow header"},[e._v("Players")]),e._l(e.$store.state.game.players,(function(t){return i("div",{key:t.id,staticClass:"row smallrow"},[i("div",[e._v(e._s(t.name))]),i("div",[i("div",{on:{click:function(i){return e.kickPlayer(t.id)}}},[e._v("Kick")])])])})),0===Object.values(e.$store.state.game.players).length?i("div",{staticClass:"row smallrow"},[i("div",{staticClass:"spanrow"},[e._v("There are no players yet, invite some using the link below!")])]):e._e(),i("div",{staticClass:"spanrow header"},[e._v("Invite code")]),i("div",{staticClass:"row"},[i("div",[e._v("Invitation URL:")]),e.showRefreshState?[i("InputCopyElement",{attrs:{value:e.refreshState}})]:[i("InputCopyElement",{attrs:{value:e.invitationUrl}})]],2),i("div",{staticClass:"row",on:{click:e.refreshInviteCode}},[i("div"),i("div",[i("button",[e._v("Refresh invitation code")])])]),i("div",{staticClass:"spanrow header"},[e._v("Danger Zone")]),i("div",{staticClass:"row"},[i("div",[e.locked?[e._v(" Unlock ")]:[e._v(" Lock ")],e._v(" Session "),i("i",[e._v("(DM access only)")])],2),i("div",[i("button",{staticClass:"danger",on:{click:e.toggleSessionLock}},[e.locked?[e._v(" Unlock ")]:[e._v(" Lock ")],e._v(" this Session ")],2)])]),i("div",{staticClass:"row"},[i("div",[e._v("Remove Session")]),i("div",[i("button",{staticClass:"danger",on:{click:e.deleteSession}},[e._v("Delete this Session")])])])],2),i("div",{directives:[{name:"show",rawName:"v-show",value:1===e.selection,expression:"selection === 1"}],staticClass:"panel"},[i("div",{staticClass:"row"},[i("label",{attrs:{for:"useGridInput"}},[e._v("Use grid")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.useGrid,expression:"useGrid"}],attrs:{id:"useGridInput",type:"checkbox"},domProps:{checked:Array.isArray(e.useGrid)?e._i(e.useGrid,null)>-1:e.useGrid},on:{change:function(t){var i=e.useGrid,s=t.target,n=!!s.checked;if(Array.isArray(i)){var r=null,o=e._i(i,r);s.checked?o<0&&(e.useGrid=i.concat([r])):o>-1&&(e.useGrid=i.slice(0,o).concat(i.slice(o+1)))}else e.useGrid=n}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"gridSizeInput"}},[e._v("Grid Size (in pixels):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.gridSize,expression:"gridSize",modifiers:{number:!0}}],attrs:{id:"gridSizeInput",type:"number",min:"0"},domProps:{value:e.gridSize},on:{input:function(t){t.target.composing||(e.gridSize=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"row"},[i("div",[i("label",{attrs:{for:"unitSizeUnit"}},[e._v("Size Unit")])]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.unitSizeUnit,expression:"unitSizeUnit"}],attrs:{id:"unitSizeUnit",type:"text"},domProps:{value:e.unitSizeUnit},on:{input:function(t){t.target.composing||(e.unitSizeUnit=t.target.value)}}})])]),i("div",{staticClass:"row"},[i("div",[i("label",{attrs:{for:"unitSizeInput"}},[e._v("Unit Size (in "+e._s(e.unitSizeUnit)+")")])]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.unitSize,expression:"unitSize",modifiers:{number:!0}}],attrs:{id:"unitSizeInput",type:"number"},domProps:{value:e.unitSize},on:{input:function(t){t.target.composing||(e.unitSize=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:2===e.selection,expression:"selection === 2"}],staticClass:"panel"},[i("div",{staticClass:"spanrow header"},[e._v("Core")]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fakePlayerInput"}},[e._v("Fake player:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fakePlayer,expression:"fakePlayer"}],attrs:{id:"fakePlayerInput",type:"checkbox"},domProps:{checked:Array.isArray(e.fakePlayer)?e._i(e.fakePlayer,null)>-1:e.fakePlayer},on:{change:function(t){var i=e.fakePlayer,s=t.target,n=!!s.checked;if(Array.isArray(i)){var r=null,o=e._i(i,r);s.checked?o<0&&(e.fakePlayer=i.concat([r])):o>-1&&(e.fakePlayer=i.slice(0,o).concat(i.slice(o+1)))}else e.fakePlayer=n}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"useFOWInput"}},[e._v("Fill entire canvas with FOW:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fullFOW,expression:"fullFOW"}],attrs:{id:"useFOWInput",type:"checkbox"},domProps:{checked:Array.isArray(e.fullFOW)?e._i(e.fullFOW,null)>-1:e.fullFOW},on:{change:function(t){var i=e.fullFOW,s=t.target,n=!!s.checked;if(Array.isArray(i)){var r=null,o=e._i(i,r);s.checked?o<0&&(e.fullFOW=i.concat([r])):o>-1&&(e.fullFOW=i.slice(0,o).concat(i.slice(o+1)))}else e.fullFOW=n}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fowLOS"}},[e._v("Only show lights in LoS:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fowLOS,expression:"fowLOS"}],attrs:{id:"fowLOS",type:"checkbox"},domProps:{checked:Array.isArray(e.fowLOS)?e._i(e.fowLOS,null)>-1:e.fowLOS},on:{change:function(t){var i=e.fowLOS,s=t.target,n=!!s.checked;if(Array.isArray(i)){var r=null,o=e._i(i,r);s.checked?o<0&&(e.fowLOS=i.concat([r])):o>-1&&(e.fowLOS=i.slice(0,o).concat(i.slice(o+1)))}else e.fowLOS=n}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fowOpacity"}},[e._v("FOW opacity:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.fowOpacity,expression:"fowOpacity",modifiers:{number:!0}}],attrs:{id:"fowOpacity",type:"number",min:"0",max:"1",step:"0.1"},domProps:{value:e.fowOpacity},on:{input:function(t){t.target.composing||(e.fowOpacity=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"spanrow header"},[e._v("Advanced")]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"visionMode"}},[e._v("Vision Mode:")]),i("div",[i("select",{attrs:{id:"visionMode"},on:{change:e.changeVisionMode}},[i("option",{domProps:{selected:"bvh"===e.$store.state.visibility.visionMode}},[e._v("BVH")]),i("option",{domProps:{selected:"triangle"===e.$store.state.visibility.visionMode}},[e._v("Triangle")])])])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"vmininp"}},[e._v("Minimal full vision ("+e._s(e.unitSizeUnit)+"):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:e.visionRangeMin,expression:"visionRangeMin",modifiers:{lazy:!0,number:!0}}],attrs:{id:"vmininp",type:"number",min:"0"},domProps:{value:e.visionRangeMin},on:{change:function(t){e.visionRangeMin=e._n(t.target.value)},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"vmaxinp"}},[e._v("Maximal vision ("+e._s(e.unitSizeUnit)+"):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:e.visionRangeMax,expression:"visionRangeMax",modifiers:{lazy:!0,number:!0}}],attrs:{id:"vmaxinp",type:"number",min:"0"},domProps:{value:e.visionRangeMax},on:{change:function(t){e.visionRangeMax=e._n(t.target.value)},blur:function(t){return e.$forceUpdate()}}})])])])])])},Hr=[],Br=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"input-copy"},on:{mouseleave:function(t){e.showPopup=!1}}},[i("input",{attrs:{type:"text",disabled:"disabled",id:"input-element"},domProps:{value:e.value}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showPopup,expression:"showPopup"}],attrs:{id:"show-popup"}},[e._v(e._s(e.popupString))]),i("div",{attrs:{id:"copy-button"},on:{click:e.copy}},[i("i",{staticClass:"far fa-copy"})])])},Gr=[],Wr=class extends s["default"]{constructor(){super(...arguments),this.borderColour="lightgray",this.popupString="",this.showPopup=!1}copy(){navigator.clipboard.writeText(this.value).then(()=>{this.popupString="Copied!",this.showPopup=!0},()=>{console.log("Could not copy to clipboard :("),this.popupString="Error!",this.showPopup=!0})}};Object(f["a"])([Object(H["a"])()],Wr.prototype,"value",void 0),Wr=Object(f["a"])([g["b"]],Wr);var Xr=Wr,Yr=Xr,Kr=(i("e60f"),Object(o["a"])(Yr,Br,Gr,!1,null,"628dde30",null)),qr=Kr.exports,Qr=class extends s["default"]{constructor(){super(...arguments),this.visible=!1,this.categories=["Admin","Grid","Vision"],this.selection=0,this.showRefreshState=!1,this.refreshState="pending"}mounted(){Ke.$on("DmSettings.Open",()=>{this.visible=!0}),Ke.$on("DmSettings.RefreshedInviteCode",()=>{this.showRefreshState=!1})}beforeDestroy(){Ke.$off("DmSettings.Open"),Ke.$off("DmSettings.RefreshedInviteCode")}get invitationUrl(){return window.location.protocol+"//"+window.location.host+"/invite/"+yt.invitationCode}get locked(){return yt.isLocked}get useGrid(){return yt.useGrid}set useGrid(e){yt.setUseGrid({useGrid:e,sync:!0})}get unitSize(){return yt.unitSize}set unitSize(e){"number"===typeof e&&yt.setUnitSize({unitSize:e,sync:!0})}get unitSizeUnit(){return yt.unitSizeUnit}set unitSizeUnit(e){yt.setUnitSizeUnit({unitSizeUnit:e,sync:!0})}get gridSize(){return yt.gridSize}set gridSize(e){"number"===typeof e&&yt.setGridSize({gridSize:e,sync:!0})}get fakePlayer(){return yt.FAKE_PLAYER}set fakePlayer(e){yt.setFakePlayer(e)}get fullFOW(){return yt.fullFOW}set fullFOW(e){yt.setFullFOW({fullFOW:e,sync:!0})}get fowOpacity(){return yt.fowOpacity}set fowOpacity(e){"number"===typeof e&&yt.setFOWOpacity({fowOpacity:e,sync:!0})}get fowLOS(){return yt.fowLOS}set fowLOS(e){yt.setLineOfSight({fowLOS:e,sync:!0})}get visionRangeMin(){return yt.visionRangeMin}set visionRangeMin(e){"number"===typeof e&&yt.setVisionRangeMin({value:e,sync:!0})}get visionRangeMax(){return yt.visionRangeMax}set visionRangeMax(e){"number"===typeof e&&yt.setVisionRangeMax({value:e,sync:!0})}changeVisionMode(e){var t=e.target.value.toLowerCase();"bvh"!==t&&"triangle"!==t||(wi.setVisionMode({mode:t,sync:!0}),wi.recalculateVision(),wi.recalculateMovement(),xt.invalidate())}handleClick(e){var t=e.target.firstElementChild;t instanceof HTMLInputElement&&t.click()}refreshInviteCode(){Xe.emit("Room.Info.InviteCode.Refresh"),this.refreshState="pending",this.showRefreshState=!0}kickPlayer(e){Xe.emit("Room.Info.Players.Kick",e),yt.kickPlayer(e)}toggleSessionLock(){yt.setIsLocked({isLocked:!yt.isLocked,sync:!0})}deleteSession(){this.$parent.$refs.prompt.prompt("ENTER ".concat(yt.roomCreator,"/").concat(yt.roomName," TO CONFIRM SESSION REMOVAL."),"DELETING SESSION").then(e=>{e==="".concat(yt.roomCreator,"/").concat(yt.roomName)&&(Xe.emit("Room.Delete"),this.$router.push("/"))},()=>{})}};Qr=Object(f["a"])([Object(g["b"])({components:{InputCopyElement:qr,Modal:Y},computed:Object.assign({},Object(I["c"])("game",["invitationCode"]))})],Qr);var Zr=Qr,Jr=Zr,eo=(i("59fe"),Object(o["a"])(Jr,Vr,Hr,!1,null,"61114102",null)),to=eo.exports;function io(e){e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||"Delete"!==e.key&&"Del"!==e.key&&"Backspace"!==e.key||Ri()}function so(e){if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)"a"===e.key&&e.ctrlKey&&e.target.select();else if(e.keyCode>=37&&e.keyCode<=40){var t=Math.round(yt.gridSize),i=t*(e.keyCode%2),s=t*(e.keyCode%2?0:1);if(xt.hasSelection()){var n=xt.getSelection();i*=e.keyCode<=38?-1:1,s*=e.keyCode<=38?-1:1;var r=new Je(i,s);if(!e.shiftKey||!yt.IS_DM)for(var o of n)yt.selectionHelperID!==o.uuid&&(r=Si(r,o));for(var a of n)yt.selectionHelperID!==a.uuid&&(a.refPoint=a.refPoint.add(r),Xe.emit("Shape.Position.Update",{shape:a.asDict(),redraw:!0,temporary:!1}));wi.recalculateVision(),xt.getLayer().invalidate(!1)}else yt.increasePanX(i*(e.keyCode<=38?1:-1)),yt.increasePanY(s*(e.keyCode<=38?1:-1)),xt.invalidate(),tt(yt.locationOptions)}else if("d"===e.key){var l=xt.getLayer();l&&(l.clearSelection(),l.invalidate(!0))}else"u"===e.key&&e.ctrlKey?(e.preventDefault(),e.stopPropagation(),yt.toggleUI()):"c"===e.key&&e.ctrlKey?Ai():"v"===e.key&&e.ctrlKey&&Di()}function no(e){var t;e.target&&e.target.tagName&&"CANVAS"===e.target.tagName&&(t=-1*Math.sign(e.deltaY),yt.updateZoom({newZoomDisplay:yt.zoomDisplay-.1*t,zoomLocation:lt(vt(e))}))}var ro=class extends s["default"]{constructor(){super(...arguments),this.ready={manager:!1,tools:!1},this.throttledmoveSet=!1,this.throttledmove=e=>{}}get showUI(){return yt.showUI}get IS_DM(){return yt.IS_DM}get FAKE_PLAYER(){return yt.FAKE_PLAYER}get layers(){return yt.layers}get selectedLayer(){return yt.selectedLayer}get zoomDisplay(){return yt.zoomDisplay}set zoomDisplay(e){yt.updateZoom({newZoomDisplay:e,zoomLocation:lt(new Ze(window.innerWidth/2,window.innerHeight/2))})}mounted(){window.addEventListener("resize",this.resizeWindow),window.addEventListener("keyup",io),window.addEventListener("keydown",so),this.ready.manager=!0}destroyed(){window.removeEventListener("resize",this.resizeWindow),window.removeEventListener("keyup",io),window.removeEventListener("keydown",so),this.ready.manager=!1}zoom(e){Be()(no)(e)}resizeWindow(){xt.setWidth(window.innerWidth),xt.setHeight(window.innerHeight),xt.invalidate()}mousedown(e){this.$refs.tools.mousedown(e)}mouseup(e){this.$refs.tools.mouseup(e)}mousemove(e){this.throttledmoveSet||(this.throttledmoveSet=!0,this.throttledmove=Be()(this.$refs.tools.mousemove,15)),this.throttledmove(e)}mouseleave(e){this.$refs.tools.mouseleave(e)}contextmenu(e){this.$refs.tools.contextmenu(e)}selectLayer(e){xt.selectLayer(e)}drop(e){if(null!==e&&null!==e.dataTransfer)if(e.dataTransfer.files.length>0)this.$refs.confirm.open("Uploading files should be done through the asset manager.","Ok","").then(()=>{},()=>{});else{if(""===e.dataTransfer.getData("text/plain"))return;es(e)}}};ro=Object(f["a"])([Object(g["b"])({components:{"tool-bar":Fr,"selection-info":dn,"prompt-dialog":oe,"confirm-dialog":J,"menu-bar":Bs,"initiative-dialog":fs,"zoom-slider":We.a,"note-dialog":Qs,"label-dialog":Ss,"dm-settings":to},beforeRouteEnter(e,t,i){Ye(e),i()},beforeRouteLeave(e,t,i){Xe.disconnect(),i()}})],ro);var oo=ro,ao=oo,lo=(i("561b"),i("1e6f"),Object(o["a"])(ao,Fe,Ve,!1,null,"ec4a3cb8",null)),co=lo.exports,ho=class extends s["default"]{beforeRouteEnter(e,t,i){u.a.post("/api/invite",{code:e.params.code}).then(e=>{i({path:e.data.sessionUrl})}).catch(e=>{console.error("Invitation code could not be redeemed"),i({path:"/dashboard"})})}};ho=Object(f["a"])([Object(g["b"])({template:""})],ho);var uo=ho;s["default"].use(d["a"]);var po=new d["a"]({mode:"history",base:"/",routes:[{path:"/",redirect:"/dashboard"},{path:"/_load",name:"load",component:Ae},{path:"/assets",component:fe,meta:{auth:!0}},{path:"/auth",component:{template:"<router-view></router-view>"},children:[{path:"login",component:_e},{path:"logout",component:ke}]},{path:"/invite/:code",component:uo,meta:{auth:!0}},{path:"/dashboard",component:$e,meta:{auth:!0}},{path:"/game/:creator/:room",component:co,meta:{auth:!0}}]});po.beforeEach((e,t,i)=>{ye.initialized||"/_load"===e.path?e.matched.some(e=>e.meta.auth)&&!ye.authenticated?i({path:"/auth/login",query:{redirect:e.path}}):i():(i({path:"/_load"}),u.a.get("/api/auth").then(t=>{t.data.auth&&(ye.setAuthenticated(!0),ye.setUsername(t.data.username)),ye.setInitialized(!0),po.push(e.path)}).catch(()=>{console.error("Authentication check could not be fulfilled.")}))}),i.d(t,"app",(function(){return vo})),s["default"].config.productionTip=!1,s["default"].config.devtools=!0,s["default"].config.performance=!0;var vo=new s["default"]({router:po,store:P,render:e=>e(c)}).$mount("#app");window.app=vo},d267:function(e,t,i){},d4ff:function(e,t,i){},d9e0:function(e,t,i){"use strict";var s=i("d267"),n=i.n(s);n.a},de79:function(e,t,i){},e3f5:function(e,t,i){"use strict";var s=i("b831"),n=i.n(s);n.a},e60f:function(e,t,i){"use strict";var s=i("e9b7"),n=i.n(s);n.a},e7bf:function(e,t,i){},e9b7:function(e,t,i){},f0dc:function(e,t,i){},f459:function(e,t,i){},fa96:function(e,t,i){},fb5d:function(e,t,i){"use strict";var s=i("a3fa"),n=i.n(s);n.a},fe8d:function(e,t,i){}});
//# sourceMappingURL=app.abe3d30e.js.map