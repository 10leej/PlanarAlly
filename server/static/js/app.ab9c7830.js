(function(e){function t(t){for(var o,n,r=t[0],l=t[1],c=t[2],d=0,h=[];d<r.length;d++)n=r[d],s[n]&&h.push(s[n][0]),s[n]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);u&&u(t);while(h.length)h.shift()();return a.push.apply(a,c||[]),i()}function i(){for(var e,t=0;t<a.length;t++){for(var i=a[t],o=!0,r=1;r<i.length;r++){var l=i[r];0!==s[l]&&(o=!1)}o&&(a.splice(t--,1),e=n(n.s=i[0]))}return e}var o={},s={app:0},a=[];function n(t){if(o[t])return o[t].exports;var i=o[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=o,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var u=l;a.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("cd49")},"0167":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v("Create basic token")])}}])},[i("div",{staticClass:"modal-body"},[i("label",{attrs:{for:"createtokendialog-text"}},[e._v("Text")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"text"}],attrs:{type:"text",id:"createtokendialog-name"},domProps:{value:e.text},on:{input:function(t){t.target.composing||(e.text=t.target.value)}}}),i("label",[e._v("Colours")]),i("div",{staticClass:"colours"},[i("span",[e._v("Fill:")]),i("color-picker",{attrs:{color:e.fillColour},on:{"update:color":function(t){e.fillColour=t}}}),i("span",[e._v("Border:")]),i("color-picker",{attrs:{color:e.borderColour},on:{"update:color":function(t){e.borderColour=t}}})],1),i("canvas",{ref:"canvas",attrs:{width:"100px",height:"100px"}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.submit}},[e._v("Submit")])])])},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"0180":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("8db6"),s=i("2469"),a=i("92b1");class n extends s.Shape{constructor(e,t,i,o,s,a,n){super(e,s,a,n),this.type="text",this.text=t,this.font=i,this.angle=o||0}asDict(){return Object.assign(this.getBaseDict(),{text:this.text,font:this.font,angle:this.angle})}getBoundingBox(){return new o.BoundingRect(this.refPoint,5,5)}draw(e){super.draw(e),e.font=this.font,e.fillStyle=this.fillColour,e.save();const t=a.g2l(this.refPoint);e.translate(t.x,t.y),e.rotate(this.angle),e.textAlign="center",this.getLines(e).map(t=>e.fillText(t.text,t.x,t.y)),e.restore()}contains(e){return!1}center(e){}getCorner(e){return""}visibleInCanvas(e){return!0}snapToGrid(){}resizeToGrid(){}resize(e,t){}getMaxHeight(e){const t=this.getLines(e),i=30;return i*t.length}getMaxWidth(e){const t=this.getLines(e),i=t.map(t=>e.measureText(t.text).width);return Math.max(...i)}getLines(e){const t=this.text.split("\n"),i=[],o=e.canvas.width,s=30,a=0;let n=0;for(const r of t){let t="";const l=r.split(" ");for(const r of l){const l=t+r+" ",c=e.measureText(l),u=c.width;u>o?(e.fillText(t,a,n),i.push({text:t,x:a,y:n}),t=r+" ",n+=s):t=l}i.push({text:t,x:a,y:n}),n+=s}return i}}t.Text=n},"033f":function(e,t,i){"use strict";i.r(t);var o=i("4124"),s=i("a68b");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("c85f");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"0dac178b",null);r.options.__file="shapecontext.vue",t["default"]=r.exports},"034f":function(e,t,i){"use strict";var o=i("64a9"),s=i.n(o);s.a},"0634":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("66cb")),a=o.__importDefault(i("a026")),n=o.__importDefault(i("65d9")),r=i("c345a"),l=i("60a3");let c=class extends a.default{constructor(){super(...arguments),this.display=!1,this.left=0,this.top=0,this.transparent=!1}mounted(){this.transparent=0===this.$refs.chromePicker.val.rgba.a,this.setPosition()}open(){this.display||(this.setPosition(),this.display=!0,this.$nextTick(()=>this.$children[0].$el.focus()))}updateColor(e){this.transparent=0===e.rgba.a;const t=s.default(e.rgba).toRgbString();this.$emit("update:color",t),this.$emit("input",t)}closePicker(){this.display=!1,this.$emit("change",this.color)}setPosition(){const e=this.$el.getBoundingClientRect();e.right+224>window.innerWidth?this.left=e.left-224:this.left=e.right,e.bottom+242>window.innerHeight?this.top=e.top-242:this.top=e.bottom}};o.__decorate([l.Prop(String)],c.prototype,"color",void 0),c=o.__decorate([n.default({components:{"chrome-picker":r.Chrome}})],c),t.default=c},"07f5":function(e,t,i){"use strict";i.r(t);var o=i("22b9"),s=i("d588");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("561b"),i("d811");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"07e4e47f",null);r.options.__file="game.vue",t["default"]=r.exports},"0bc6":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("8055"));function a(e){t.socket.io.opts.query=`user=${e.params.creator}&room=${e.params.room}`,t.socket.connect()}t.socket=s.default(location.protocol+"//"+location.host+"/planarally",{autoConnect:!1}),t.createConnection=a},"0bdb":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{attrs:{id:"toolselect"}},[i("ul",e._l(e.tools,function(t){return!e.dmTools.includes(t)||e.IS_DM?i("li",{key:t,ref:t+"-selector",refInFor:!0,class:{"tool-selected":e.currentTool===t},on:{click:function(i){e.currentTool=t}}},[i("a",{attrs:{href:"#"}},[e._v(e._s(t))])]):e._e()}))]),i("div",[[i("select-tool",{directives:[{name:"show",rawName:"v-show",value:"Select"===e.currentTool,expression:"currentTool === 'Select'"}],ref:"selectTool"}),i("pan-tool",{directives:[{name:"show",rawName:"v-show",value:"Pan"===e.currentTool,expression:"currentTool === 'Pan'"}]}),i("keep-alive",[i("draw-tool",{directives:[{name:"show",rawName:"v-show",value:"Draw"===e.currentTool,expression:"currentTool === 'Draw'"}]})],1),i("ruler-tool",{directives:[{name:"show",rawName:"v-show",value:"Ruler"===e.currentTool,expression:"currentTool === 'Ruler'"}]}),i("map-tool",{directives:[{name:"show",rawName:"v-show",value:"Map"===e.currentTool,expression:"currentTool === 'Map'"}]}),i("shape-menu",{ref:"shapecontext"}),i("createtoken-dialog",{ref:"createtokendialog"})]],2)])},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"0cf7":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9")),n=o.__importDefault(i("4aec")),r=o.__importDefault(i("a535")),l=o.__importDefault(i("cec2")),c=i("5338"),u=i("2d5b"),d=i("4a5b");let h=class extends s.default{constructor(){super(...arguments),this.path=[],this.draggingSelection=!1}get folders(){return u.assetStore.folders}get files(){return u.assetStore.files}get selected(){return u.assetStore.selected}get idMap(){return u.assetStore.idMap}get currentFolder(){return this.path.length?this.path[this.path.length-1]:u.assetStore.root}get parentFolder(){let e=this.path[this.path.length-2];return void 0===e&&(e=u.assetStore.root),e}get firstSelectedFile(){for(const e of u.assetStore.selected)if(u.assetStore.idMap.get(e).file_hash)return u.assetStore.idMap.get(e);return null}changeDirectory(e){e<0?this.path.pop():this.path.push(e),u.assetStore.clearSelected(),c.socket.emit("Folder.Get",this.currentFolder)}createDirectory(){const e=window.prompt("New folder name");null!==e&&c.socket.emit("Folder.Create",{name:e,parent:this.currentFolder})}moveInode(e,t){u.assetStore.isFile(e)?u.assetStore.files.splice(u.assetStore.files.indexOf(e),1):u.assetStore.folders.splice(u.assetStore.folders.indexOf(e),1),u.assetStore.idMap.delete(e),c.socket.emit("Inode.Move",{inode:e,target:t})}select(e,t){if(e.shiftKey&&u.assetStore.selected.length>0){const e=[...u.assetStore.files,...u.assetStore.folders],i=e.indexOf(u.assetStore.selected[u.assetStore.selected.length-1]),o=e.indexOf(t);for(let t=i;t!==o;i<o?t++:t--)u.assetStore.selected.push(e[t]);u.assetStore.selected.push(e[o])}else e.ctrlKey||u.assetStore.clearSelected(),u.assetStore.selected.push(t)}startDrag(e,t){null!==e.dataTransfer&&(e.dataTransfer.setData("Hack","ittyHack"),e.dataTransfer.dropEffect="move",u.assetStore.selected.includes(t)||u.assetStore.selected.push(t),this.draggingSelection=!0)}moveDrag(e){e.target.classList.contains("folder")&&e.target.classList.add("inode-selected")}leaveDrag(e){e.target.classList.contains("folder")&&e.target.classList.remove("inode-selected")}stopDrag(e,t){if(e.target.classList.remove("inode-selected"),this.draggingSelection){if((t===u.assetStore.root||u.assetStore.folders.includes(t))&&!u.assetStore.selected.includes(t))for(const e of u.assetStore.selected)this.moveInode(e,t);u.assetStore.clearSelected()}else e.dataTransfer&&e.dataTransfer.files.length>0&&this.upload(e.dataTransfer.files,t);this.draggingSelection=!1}prepareUpload(){document.getElementById("files").click()}upload(e,t){const i=document.getElementById("files").files;if(void 0===e){if(!i)return;e=i}void 0===t&&(t=this.currentFolder);const o=1e5;for(const s of e){const e=d.uuidv4(),i=Math.ceil(s.size/o);for(let a=0;a<i;a++){const n=new FileReader;n.readAsArrayBuffer(s.slice(a*o,a*o+Math.min(o,s.size-a*o))),n.onload=(o=>{c.socket.emit("Asset.Upload",{name:s.name,directory:t,data:n.result,slice:a,totalSlices:i,uuid:e})})}}}};h=o.__decorate([a.default({components:{Prompt:l.default,ConfirmDialog:r.default,AssetContextMenu:n.default},beforeRouteEnter(e,t,i){c.socket.connect(),i()},beforeRouteLeave(e,t,i){c.socket.disconnect(),i()}})],h),t.default=h},"0dd2":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.visible?i("div",{staticClass:"ContextMenu",style:{left:e.left,top:e.top},attrs:{tabindex:"-1"},on:{blur:function(t){e.$emit("close")}}},[i("ul",[e._t("default")],2)]):e._e()},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"0ddd":function(e,t,i){"use strict";i.r(t);var o=i("396d"),s=i("4bc3");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("5c63");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"03d8fe61",null);r.options.__file="asset_node.vue",t["default"]=r.exports},1:function(e,t){},1077:function(e,t,i){"use strict";i.r(t);var o=i("33f4"),s=i("1eee");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("c43c");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"0df3c2c8",null);r.options.__file="login.vue",t["default"]=r.exports},1094:function(e,t,i){"use strict";var o=i("8e25"),s=i.n(o);s.a},"11c8":function(e,t,i){"use strict";var o=i("2923"),s=i.n(o);s.a},"12d3":function(e,t,i){"use strict";var o=i("a260"),s=i.n(o);s.a},1327:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importStar(i("66cb")),a=i("4a5b"),n=i("4709"),r=i("f10f"),l=i("92b1");class c extends n.Circle{constructor(e,t,i,o,s,a,n){super(e,t,s,a,n),this.type="circulartoken",this.text=i,this.font=o}asDict(){return Object.assign(this.getBaseDict(),{radius:this.r,text:this.text,font:this.font})}fromDict(e){super.fromDict(e),this.r=e.radius,this.text=e.text,this.font=e.font}draw(e){super.draw(e),e.font=this.font,e.save();const t=l.g2l(this.center());e.textAlign="center",e.textBaseline="middle";const i=a.calcFontScale(e,this.text,l.g2lz(this.r),l.g2lz(this.r)),o=0;e.transform(i,o,-o,i,t.x,t.y),e.fillStyle=s.mostReadable(this.fillColour,["#000","#fff"]).toHexString(),e.fillText(this.text,0,0),e.restore()}getInitiativeRepr(){return{uuid:this.uuid,visible:!r.gameStore.IS_DM,group:!1,source:""===this.name||"Unknown shape"===this.name?this.text:this.name,has_img:!1,effects:[],index:1/0}}}t.CircularToken=c},1517:function(e,t,i){},1625:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("8f0a"),s=i("6f92"),a=i("b2ed"),n=i("0180"),r=i("f10f"),l=i("92b1");class c{constructor(){this.shown=!1;const e=new o.GlobalPoint(0,0);this.annotationText=new n.Text(e,"","bold 20px serif",0,"rgba(230, 230, 230, 1)"),this.annotationRect=new a.Rect(e,0,0,"rgba(0, 0, 0, 0.6)")}setActiveText(e){if(void 0===this.layer){if(!s.layerManager.hasLayer("draw"))return void console.warn("There is no draw layer to draw annotations on!");this.layer=s.layerManager.getLayer("draw"),this.layer.addShape(this.annotationRect,!1),this.layer.addShape(this.annotationText,!1)}this.shown=""!==e,this.annotationText.refPoint=l.l2g(new o.LocalPoint(this.layer.canvas.width/2,50)),this.annotationText.text=e;const t=this.shown?this.annotationText.getMaxWidth(this.layer.ctx)+10:0,i=this.shown?this.annotationText.getMaxHeight(this.layer.ctx)+10:0;this.annotationRect.refPoint=l.l2g(new o.LocalPoint(this.layer.canvas.width/2-t/2,30)),this.annotationRect.w=t/r.gameStore.zoomFactor,this.annotationRect.h=i/r.gameStore.zoomFactor,this.layer.invalidate(!0)}}t.AnnotationManager=c},"19f9":function(e,t,i){"use strict";i.r(t);var o=i("1ad0"),s=i("8cd4");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("8954");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"56348a0e",null);r.options.__file="menu.vue",t["default"]=r.exports},"1ad0":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"menuContainer"}},[i("div",{ref:"rm",style:{left:e.visible.settings?"200px":"0",top:e.visible.locations?"100px":"0"},attrs:{id:"radialmenu"}},[i("div",{staticClass:"rm-wrapper"},[i("div",{staticClass:"rm-toggler"},[i("ul",{staticClass:"rm-list",class:{"rm-list-dm":e.IS_DM}},[e.IS_DM?i("li",{staticClass:"rm-item",attrs:{id:"rm-locations"},on:{click:function(t){e.visible.locations=!e.visible.locations}}},[e._m(0)]):e._e(),i("li",{staticClass:"rm-item",attrs:{id:"rm-settings"},on:{click:function(t){e.visible.settings=!e.visible.settings}}},[e._m(1)])])]),e._m(2)])]),i("transition",{attrs:{name:"settings"},on:{enter:function(t){e.$refs.rm.style.transition="left 500ms"}}},[e.visible.settings?i("div",{ref:"settings",attrs:{id:"menu"},on:{click:e.settingsClick}},[i("div",{staticStyle:{width:"200px",height:"90%","overflow-y":"auto","overflow-x":"hidden"}},[e.IS_DM?[i("button",{staticClass:"accordion"},[e._v("Assets")]),i("div",{staticClass:"accordion-panel"},[i("a",{staticClass:"actionButton",attrs:{href:"/assets",target:"blank"}},[i("i",{staticClass:"fas fa-external-link-alt"})]),i("div",{staticClass:"directory",attrs:{id:"menu-tokens"}},[i("asset-node",{attrs:{asset:e.assets}})],1)]),i("button",{staticClass:"accordion"},[e._v("Notes")]),i("div",{staticClass:"accordion-panel"},[i("div",{staticClass:"accordion-subpanel",attrs:{id:"menu-notes"}},[i("a",{staticClass:"actionButton",on:{click:e.createNote}},[i("i",{staticClass:"far fa-plus-square"})]),e._l(e.notes,function(t){return i("div",{key:t.uuid,staticStyle:{cursor:"pointer"},on:{click:function(i){e.openNote(t)}}},[e._v(e._s(t.title||"[?]"))])}),e.notes.length?e._e():i("div",[e._v("No notes")])],2)]),i("button",{staticClass:"accordion"},[e._v("DM Options")]),i("div",{staticClass:"accordion-panel"},[i("div",{staticClass:"accordion-subpanel"},[i("label",{attrs:{for:"useGridInput"}},[e._v("Use grid:")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.useGrid,expression:"useGrid"}],attrs:{id:"useGridInput",type:"checkbox",checked:"checked"},domProps:{checked:Array.isArray(e.useGrid)?e._i(e.useGrid,null)>-1:e.useGrid},on:{change:function(t){var i=e.useGrid,o=t.target,s=!!o.checked;if(Array.isArray(i)){var a=null,n=e._i(i,a);o.checked?n<0&&(e.useGrid=i.concat([a])):n>-1&&(e.useGrid=i.slice(0,n).concat(i.slice(n+1)))}else e.useGrid=s}}}),i("label",{attrs:{for:"useFOWInput"}},[e._v("Fill entire canvas with FOW:")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.fullFOW,expression:"fullFOW"}],attrs:{id:"useFOWInput",type:"checkbox"},domProps:{checked:Array.isArray(e.fullFOW)?e._i(e.fullFOW,null)>-1:e.fullFOW},on:{change:function(t){var i=e.fullFOW,o=t.target,s=!!o.checked;if(Array.isArray(i)){var a=null,n=e._i(i,a);o.checked?n<0&&(e.fullFOW=i.concat([a])):n>-1&&(e.fullFOW=i.slice(0,n).concat(i.slice(n+1)))}else e.fullFOW=s}}}),i("label",{attrs:{for:"fowOpacity"}},[e._v("FOW opacity:")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.fowOpacity,expression:"fowOpacity",modifiers:{number:!0}}],attrs:{id:"fowOpacity",type:"number",min:"0",max:"1",step:"0.1"},domProps:{value:e.fowOpacity},on:{input:function(t){t.target.composing||(e.fowOpacity=e._n(t.target.value))},blur:function(t){e.$forceUpdate()}}}),i("label",{attrs:{for:"fowLOS"}},[e._v("Only show lights in LoS:")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.fowLOS,expression:"fowLOS"}],attrs:{id:"fowLOS",type:"checkbox"},domProps:{checked:Array.isArray(e.fowLOS)?e._i(e.fowLOS,null)>-1:e.fowLOS},on:{change:function(t){var i=e.fowLOS,o=t.target,s=!!o.checked;if(Array.isArray(i)){var a=null,n=e._i(i,a);o.checked?n<0&&(e.fowLOS=i.concat([a])):n>-1&&(e.fowLOS=i.slice(0,n).concat(i.slice(n+1)))}else e.fowLOS=s}}}),i("label",{attrs:{for:"unitSizeInput"}},[e._v("Unit Size (in ft.):")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.unitSize,expression:"unitSize",modifiers:{number:!0}}],attrs:{id:"unitSizeInput",type:"number"},domProps:{value:e.unitSize},on:{input:function(t){t.target.composing||(e.unitSize=e._n(t.target.value))},blur:function(t){e.$forceUpdate()}}}),i("label",{attrs:{for:"gridSizeInput"}},[e._v("Grid Size (in pixels):")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.gridSize,expression:"gridSize",modifiers:{number:!0}}],attrs:{id:"gridSizeInput",type:"number",min:"0"},domProps:{value:e.gridSize},on:{input:function(t){t.target.composing||(e.gridSize=e._n(t.target.value))},blur:function(t){e.$forceUpdate()}}}),i("label",{attrs:{for:"invitation"}},[e._v("Invitation Code:")]),i("input",{attrs:{id:"invitation",type:"text",readonly:"readonly"},domProps:{value:e.invitationCode}})])])]:e._e(),i("button",{staticClass:"accordion"},[e._v("Client Options")]),i("div",{staticClass:"accordion-panel"},[i("div",{staticClass:"accordion-subpanel"},[i("label",{attrs:{for:"gridColour"}},[e._v("Grid Colour:")]),i("color-picker",{attrs:{id:"gridColour",color:e.gridColour},on:{"update:color":function(t){e.gridColour=t}}}),i("label",{attrs:{for:"fowColour"}},[e._v("FOW Colour:")]),i("color-picker",{attrs:{id:"fowColour",color:e.fowColour},on:{"update:color":function(t){e.fowColour=t}}}),i("label",{attrs:{for:"rulerColour"}},[e._v("Ruler Colour:")]),i("color-picker",{attrs:{id:"rulerColour",color:e.rulerColour},on:{"update:color":function(t){e.rulerColour=t}}})],1)])],2),i("router-link",{staticClass:"accordion",staticStyle:{"text-decoration":"none",display:"inline-block",position:"absolute",bottom:"0"},attrs:{to:"/dashboard"}},[e._v("Exit")])],1):e._e()]),i("transition",{attrs:{name:"locations"},on:{enter:function(t){e.$refs.rm.style.transition="top 500ms"}}},[e.IS_DM&&e.visible.locations?i("div",{attrs:{id:"locations-menu"}},[i("div",[e._l(e.locations,function(t){return i("div",{key:t,on:{click:function(i){e.changeLocation(t)}}},[e._v(e._s(t))])}),i("div",{on:{click:e.createLocation}},[i("i",{staticClass:"fas fa-plus"})])],2)]):e._e()]),i("img",{attrs:{id:"dragImage"}})],1)},s=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{attrs:{href:"#"}},[i("i",{staticClass:"far fa-compass"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{attrs:{href:"#"}},[i("i",{staticClass:"fas fa-cog"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"rm-topper"},[i("i",{staticClass:"icon-share-alt"})])}];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"1b1f":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContextMenu",{attrs:{visible:e.visible,left:e.x+"px",top:e.y+"px"},on:{close:e.close}},[e.IS_DM?i("li",{on:{click:e.bringPlayers}},[e._v("Bring players")]):e._e(),i("li",{on:{click:e.createToken}},[e._v("Create basic token")]),i("li",{on:{click:e.showInitiative}},[e._v("Show initiative")])])},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"1b45":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible},on:{close:e.close},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v(e._s(e.title))])}}])},[i("div",{staticClass:"modal-body"},[i("button",{ref:"confirm",on:{click:e.confirm}},[e._v(e._s(e.yes))]),e.no?i("button",{on:{click:e.deny}},[e._v(e._s(e.no))]):e._e()])])},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"1c76":function(e,t,i){"use strict";i.r(t);var o=i("0dd2"),s=i("300e");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("7f1e");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,null,null);r.options.__file="contextmenu.vue",t["default"]=r.exports},"1dd6":function(e,t,i){"use strict";i.r(t);var o=i("5ae5"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},"1eee":function(e,t,i){"use strict";i.r(t);var o=i("d30b"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},"206a":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("8f0a"),s=i("6f92"),a=i("6c30"),n=i("4709"),r=i("1327"),l=i("5e7c"),c=i("574e"),u=i("b2ed"),d=i("0180");function h(e,t){if(void 0===t&&(t=!1),!t&&s.layerManager.UUIDMap.has(e.uuid))return s.layerManager.UUIDMap.get(e.uuid);let i;const h=new o.GlobalPoint(e.x,e.y);if("rect"===e.type_){const t=e;i=new u.Rect(h,t.width,t.height,t.fill_colour,t.stroke_colour,t.uuid)}else if("circle"===e.type_){const t=e;i=new n.Circle(h,t.radius,t.fill_colour,t.stroke_colour,t.uuid)}else if("circulartoken"===e.type_){const t=e;i=new r.CircularToken(h,t.radius,t.text,t.font,t.fill_colour,t.stroke_colour,t.uuid)}else if("line"===e.type_){const t=e;i=new l.Line(h,new o.GlobalPoint(t.x2,t.y2),t.line_width,t.stroke_colour,t.uuid)}else if("multiline"===e.type_){const t=e;i=new c.MultiLine(h,t.points.map(e=>new o.GlobalPoint(e.x,e.y)),t.line_width,t.stroke_colour,t.uuid)}else if("text"===e.type_){const t=e;i=new d.Text(h,t.text,t.font,t.angle,t.fill_colour,t.stroke_colour,t.uuid)}else{if("assetrect"!==e.type_)return;{const t=e,o=new Image(t.width,t.height);t.src.startsWith("http")?o.src=new URL(t.src).pathname:o.src=t.src,i=new a.Asset(o,h,t.width,t.height,t.uuid),o.onload=(()=>{s.layerManager.getLayer(e.layer).invalidate(!1)})}}return i.fromDict(e),i}t.createShapeFromDict=h},"22b9":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"main"},on:{mouseleave:e.mouseleave}},[i("menu-bar"),i("div",{attrs:{id:"board"}},[e.ready.manager?[i("tool-bar",{ref:"tools"})]:e._e(),i("div",{attrs:{id:"layers"},on:{mousedown:e.mousedown,mouseup:e.mouseup,mousemove:e.mousemove,contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.contextmenu(t)},dragover:function(e){e.preventDefault()},drop:e.drop}}),e.layers.length>1?i("div",{attrs:{id:"layerselect"}},[i("ul",e._l(e.layers,function(t){return i("li",{key:t.name,class:{"layer-selected":t===e.selectedLayer},on:{click:function(i){e.selectLayer(t)}}},[i("a",{attrs:{href:"#"}},[e._v(e._s(t))])])}))]):e._e()],2),i("selection-info",{ref:"selectionInfo"}),i("initiative-dialog",{ref:"initiative",attrs:{id:"initiativedialog"}}),i("note-dialog",{ref:"note"}),i("zoom-slider",{attrs:{id:"zoomer",height:6,width:200,min:.1,max:5,interval:.1,"dot-width":8,"dot-height":20,"tooltip-dir":"bottom",tooltip:"hover",formatter:e.zoomFactor.toFixed(1),"slider-style":{"border-radius":"15%"},"bg-style":{"background-color":"#fff","box-shadow":"0.5px 0.5px 3px 1px rgba(0, 0, 0, .36)"},"process-style":{"background-color":"#fff"}},model:{value:e.zoomFactor,callback:function(t){e.zoomFactor=t},expression:"zoomFactor"}}),i("prompt-dialog",{ref:"prompt"}),i("confirm-dialog",{ref:"confirm"})],1)},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"241d":function(e,t,i){},2469:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("66cb")),a=i("4a5b"),n=i("0bc6"),r=i("f312"),l=i("6f92"),c=i("f10f"),u=i("92b1");class d{constructor(e,t,i,o){this.fillColour="#000",this.strokeColour="rgba(0,0,0,0)",this.name="Unknown shape",this.trackers=[],this.auras=[],this.owners=[],this.visionObstruction=!1,this.movementObstruction=!1,this.isToken=!1,this.showHighlight=!1,this.annotation="",this.globalCompositeOperation="source-over",this.options=new Map,this.refPoint=e,this.uuid=o||a.uuidv4(),void 0!==t&&(this.fillColour=t),void 0!==i&&(this.strokeColour=i)}visibleInCanvas(e){return!1}invalidate(e){const t=l.layerManager.getLayer(this.layer);t&&t.invalidate(e)}checkVisionSources(){const e=this,t=c.gameStore.visionBlockers.indexOf(this.uuid);let i=!1;this.visionObstruction&&-1===t?(c.gameStore.visionBlockers.push(this.uuid),i=!0):!this.visionObstruction&&t>=0&&(c.gameStore.visionBlockers.splice(t,1),i=!0),i&&c.gameStore.recalculateBV(),this.auras.forEach(t=>{const i=c.gameStore.visionSources,o=i.findIndex(e=>e.aura===t.uuid);t.visionSource&&-1===o?i.push({shape:e.uuid,aura:t.uuid}):!t.visionSource&&o>=0&&i.splice(o,1)});for(let o=c.gameStore.visionSources.length-1;o>=0;o--){const t=c.gameStore.visionSources[o];t.shape===e.uuid&&(e.auras.some(e=>e.uuid===t.aura&&e.visionSource)||c.gameStore.visionSources.splice(o,1))}}setMovementBlock(e){this.movementObstruction=e||!1;const t=c.gameStore.movementblockers.indexOf(this.uuid);this.movementObstruction&&-1===t?c.gameStore.movementblockers.push(this.uuid):!this.movementObstruction&&t>=0&&c.gameStore.movementblockers.splice(t,1)}setIsToken(e){if(this.isToken=e,this.ownedBy()){const e=c.gameStore.ownedtokens.indexOf(this.uuid);this.isToken&&-1===e?c.gameStore.ownedtokens.push(this.uuid):!this.isToken&&e>=0&&c.gameStore.ownedtokens.splice(e,1)}}ownedBy(e){return void 0===e&&(e=c.gameStore.username),c.gameStore.IS_DM||this.owners.includes(e)}getBaseDict(){return{type_:this.type,uuid:this.uuid,x:this.refPoint.x,y:this.refPoint.y,layer:this.layer,draw_operator:this.globalCompositeOperation,movement_obstruction:this.movementObstruction,vision_obstruction:this.visionObstruction,auras:r.aurasToServer(this.auras),trackers:this.trackers,owners:this.owners,fill_colour:this.fillColour,stroke_colour:this.strokeColour,name:this.name,annotation:this.annotation,is_token:this.isToken,options:JSON.stringify([...this.options])}}fromDict(e){this.layer=e.layer,this.globalCompositeOperation=e.draw_operator,this.movementObstruction=e.movement_obstruction,this.visionObstruction=e.vision_obstruction,this.auras=r.aurasFromServer(e.auras),this.trackers=e.trackers,this.owners=e.owners,this.isToken=e.is_token,e.annotation&&(this.annotation=e.annotation),e.name&&(this.name=e.name),e.options&&(this.options=new Map(JSON.parse(e.options)))}draw(e){if(void 0!==this.globalCompositeOperation?e.globalCompositeOperation=this.globalCompositeOperation:e.globalCompositeOperation="source-over",this.showHighlight){const t=this.getBoundingBox();e.strokeStyle="red",e.strokeRect(u.g2lx(t.topLeft.x)-5,u.g2ly(t.topLeft.y)-5,u.g2lz(t.w)+10,u.g2lz(t.h)+10)}}drawAuras(e){for(const i of this.auras){if(0===i.value&&0===i.dim)return;e.beginPath();const o=u.g2l(this.center()),a=u.g2lr(i.value+i.dim);if(0===i.dim)e.fillStyle=i.colour;else{const t=e.createRadialGradient(o.x,o.y,u.g2lr(i.value),o.x,o.y,u.g2lr(i.value+i.dim)),a=s.default(i.colour);e.fillStyle=t,t.addColorStop(0,i.colour),t.addColorStop(1,a.setAlpha(0).toRgbString())}if(i.visionSource&&void 0!==i.lastPath)try{e.fill(i.lastPath)}catch(t){e.arc(o.x,o.y,a,0,2*Math.PI),e.fill(),console.warn(t)}else e.arc(o.x,o.y,a,0,2*Math.PI),e.fill()}}getInitiativeRepr(){return{uuid:this.uuid,visible:!c.gameStore.IS_DM,group:!1,source:this.name,has_img:!1,effects:[],index:1/0}}moveLayer(e,t){const i=l.layerManager.getLayer(this.layer),o=l.layerManager.getLayer(e);void 0!==i&&void 0!==o&&(this.layer=e,i.shapes.splice(i.shapes.indexOf(this),1),o.shapes.push(this),i.invalidate(!0),o.invalidate(!1),t&&n.socket.emit("Shape.Layer.Change",{uuid:this.uuid,layer:e}))}}t.Shape=d},"255e":function(e,t,i){"use strict";i.r(t);var o=i("851c"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},2756:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("496c")),a=o.__importDefault(i("ea6a")),n=i("4a5b"),r=i("0bc6"),l=i("8f0a"),c=i("6f92"),u=i("b2ed"),d=i("f10f"),h=i("2838"),f=i("92b1"),p=i("5a5c"),g=o.__importDefault(i("65d9"));var m;(function(e){e[e["Noop"]=0]="Noop",e[e["Resize"]=1]="Resize",e[e["Drag"]=2]="Drag",e[e["GroupSelect"]=3]="GroupSelect"})(m=t.SelectOperations||(t.SelectOperations={}));const v=new l.GlobalPoint(-1e3,-1e3);let y=class extends a.default{constructor(){super(...arguments),this.name="Select",this.showContextMenu=!1,this.active=!1,this.mode=m.Noop,this.resizeDirection="",this.deltaChanged=!1,this.dragRay=new l.Ray(new l.LocalPoint(0,0),new l.Vector(0,0)),this.selectionStartPoint=v,this.selectionHelper=new u.Rect(v,0,0)}created(){this.selectionHelper.globalCompositeOperation="source-over"}onMouseDown(e){const t=c.layerManager.getLayer();if(void 0===t)return void console.log("No active layer!");this.selectionHelper.owners.includes(d.gameStore.username)||this.selectionHelper.owners.push(d.gameStore.username);const i=p.getMouse(e),o=f.l2g(i);let s,a=!1;s=t.selection.length?t.shapes.concat(t.selection):t.shapes;for(let r=s.length-1;r>=0;r--){const e=s[r];if(!e.ownedBy())continue;const c=e.getBoundingBox().getCorner(o);if(void 0!==c){t.selection=[e],n.getRef("selectionInfo").shape=e,this.mode=m.Resize,this.resizeDirection=c,t.invalidate(!0),a=!0;break}if(e.contains(o)){const o=e;-1===t.selection.indexOf(o)&&(t.selection=[o],n.getRef("selectionInfo").shape=o),this.mode=m.Drag;const s=f.g2l(o.refPoint);this.dragRay=new l.Ray(s,i.subtract(s)),t.invalidate(!0),a=!0;break}}if(!a){this.mode=m.GroupSelect;for(const e of t.selection)n.getRef("selectionInfo").shape=e;this.selectionStartPoint=o,this.selectionHelper.refPoint=this.selectionStartPoint,this.selectionHelper.w=0,this.selectionHelper.h=0,t.selection=[this.selectionHelper],t.invalidate(!0)}this.active=!0}onMouseMove(e){const t=c.layerManager.getLayer();if(void 0===t)return void console.log("No active layer!");const i=p.getMouse(e),o=f.l2g(i);if(this.deltaChanged=!1,this.mode===m.GroupSelect){const e=o;this.selectionHelper.w=Math.abs(e.x-this.selectionStartPoint.x),this.selectionHelper.h=Math.abs(e.y-this.selectionStartPoint.y),this.selectionHelper.refPoint=new l.GlobalPoint(Math.min(this.selectionStartPoint.x,e.x),Math.min(this.selectionStartPoint.y,e.y)),t.invalidate(!0)}else if(t.selection.length){const s=f.g2l(t.selection[t.selection.length-1].refPoint),a=s.add(this.dragRay.direction);let n=i.subtract(a).multiply(1/d.gameStore.zoomFactor);const l=n;if(this.mode===m.Drag){if("tokens"===t.name&&(!e.shiftKey||!d.gameStore.IS_DM))for(const e of t.selection)e.uuid!==this.selectionHelper.uuid&&(n=h.calculateDelta(n,e),n!==l&&(this.deltaChanged=!0));for(const e of t.selection)e.refPoint=e.refPoint.add(n),e!==this.selectionHelper&&(e.visionObstruction&&d.gameStore.recalculateBV(),r.socket.emit("Shape.Update",{shape:e.asDict(),redraw:!0,temporary:!0}));t.invalidate(!1)}else if(this.mode===m.Resize)for(const e of t.selection)e.resize(this.resizeDirection,i),e!==this.selectionHelper&&(e.visionObstruction&&d.gameStore.recalculateBV(),r.socket.emit("Shape.Update",{shape:e.asDict(),redraw:!0,temporary:!0})),t.invalidate(!1);else for(const e of t.selection){const t=e.getBoundingBox(),i=o;t.inCorner(i,"nw")?document.body.style.cursor="nw-resize":t.inCorner(i,"ne")?document.body.style.cursor="ne-resize":t.inCorner(i,"se")?document.body.style.cursor="se-resize":t.inCorner(i,"sw")?document.body.style.cursor="sw-resize":document.body.style.cursor="default"}}else document.body.style.cursor="default"}onMouseUp(e){if(!this.active)return;if(void 0===c.layerManager.getLayer())return void console.log("No active layer!");const t=c.layerManager.getLayer();this.mode===m.GroupSelect?(t.clearSelection(),t.shapes.forEach(e=>{if(e===this.selectionHelper)return;const i=e.getBoundingBox();e.ownedBy()&&this.selectionHelper.refPoint.x<=i.topRight.x&&this.selectionHelper.refPoint.x+this.selectionHelper.w>=i.topLeft.x&&this.selectionHelper.refPoint.y<=i.botLeft.y&&this.selectionHelper.refPoint.y+this.selectionHelper.h>=i.topLeft.y&&t.selection.push(e)}),t.selection.length>0&&t.selection.push(this.selectionHelper),t.invalidate(!0)):t.selection.length&&t.selection.forEach(i=>{if(this.mode===m.Drag){if(this.dragRay.origin.x===f.g2lx(i.refPoint.x)&&this.dragRay.origin.y===f.g2ly(i.refPoint.y))return;!d.gameStore.useGrid||e.altKey||this.deltaChanged||i.snapToGrid(),i!==this.selectionHelper&&(i.visionObstruction&&d.gameStore.recalculateBV(),r.socket.emit("Shape.Update",{shape:i.asDict(),redraw:!0,temporary:!1})),t.invalidate(!1)}this.mode===m.Resize&&(d.gameStore.useGrid&&!e.altKey&&i.resizeToGrid(),i!==this.selectionHelper&&(i.visionObstruction&&d.gameStore.recalculateBV(),r.socket.emit("Shape.Update",{shape:i.asDict(),redraw:!0,temporary:!1})),t.invalidate(!1))}),this.mode=m.Noop,this.active=!1}onContextMenu(e){if(void 0===c.layerManager.getLayer())return void console.log("No active layer!");const t=c.layerManager.getLayer(),i=p.getMouse(e),o=f.l2g(i);for(const s of t.selection)if(s.contains(o))return t.selection=[s],n.getRef("selectionInfo").shape=s,t.invalidate(!0),void this.$parent.$refs.shapecontext.open(e,s);this.$refs.selectcontext.open(e)}};y=o.__decorate([g.default({components:{SelectContext:s.default}})],y),t.default=y},2838:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("8f0a"),s=i("6f92"),a=i("f10f");function n(e,t,i){void 0===i&&(i=[]);const r=t.getBoundingBox(),l=r.offset(e);let c=!1;for(const n of a.gameStore.movementblockers){if(i.includes(n))continue;const t=s.layerManager.UUIDMap.get(n),a=t.getBoundingBox();let u=a.intersectsWithInner(l);if(!u){const t=o.Ray.fromPoints(r.topLeft.add(e.normalize()),l.topLeft),i=t.direction.inverse(),s=[i.x<0,i.y<0];u=a.intersectP(t,i,s).hit}if(u){const t=a.center(),s=r.center(),l=s.subtract(t),u=new o.Vector(1,0),d=new o.Vector(0,1);let h=l.dot(u),f=l.dot(d);h>a.w/2&&(h=a.w/2),h<-a.w/2&&(h=-a.w/2),f>a.h/2&&(f=a.h/2),f<-a.h/2&&(f=-a.h/2);const p=t.add(u.multiply(h)).add(d.multiply(f));p.x===r.topLeft.x||p.x===r.topRight.x?e=new o.Vector(0,e.y):p.y===r.topLeft.y||p.y===r.botLeft.y?e=new o.Vector(e.x,0):p.x<r.topLeft.x?e=new o.Vector(p.x-r.topLeft.x,e.y):p.x>r.topRight.x?e=new o.Vector(p.x-r.topRight.x,e.y):p.y<r.topLeft.y?e=new o.Vector(e.x,p.y-r.topLeft.y):p.y>r.botLeft.y&&(e=new o.Vector(e.x,p.y-r.botLeft.y)),c=!0,i.push(n);break}}return c&&(e=n(e,t,i)),e}t.calculateDelta=n},2923:function(e,t,i){},"2b48":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("0bc6"),s=i("f10f");function a(){o.socket.emit("Client.Options.Set",{locationOptions:{panX:s.gameStore.panX,panY:s.gameStore.panY,zoomFactor:s.gameStore.zoomFactor}})}t.sendClientOptions=a},"2baf":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9")),n=i("60a3"),r=i("4a5b");let l=class extends s.default{constructor(){super(...arguments),this.showImage=null}get folders(){return Object.keys(this.asset).filter(e=>!["__files"].includes(e)).sort(r.alphSort)}get files(){return this.asset.__files?this.asset.__files.concat().sort((e,t)=>e.name.toLowerCase()>t.name.toLowerCase()?1:-1):[]}toggle(e){for(let t=0;t<e.target.children.length;t++){const i=e.target.children[t];i.style.display=""===i.style.display?"block":""}}dragStart(e,t){if(null===e||null===e.dataTransfer)return;const i=e.target.querySelector(".preview");e.dataTransfer.setDragImage(i,0,0),e.dataTransfer.setData("text/plain",t)}};o.__decorate([n.Prop()],l.prototype,"asset",void 0),l=o.__decorate([a.default],l),t.default=l},"2d5b":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=i("6fc5"),a=i("3a0b");let n=class extends s.VuexModule{constructor(){super(...arguments),this.root=-1,this.files=[],this.folders=[],this.idMap=new Map,this.selected=[]}clear(){this.folders=[],this.files=[]}clearSelected(){this.selected=[]}setRoot(e){this.root=e}isFile(e){return this.files.includes(e)}};o.__decorate([s.Mutation],n.prototype,"clear",null),o.__decorate([s.Mutation],n.prototype,"clearSelected",null),o.__decorate([s.Mutation],n.prototype,"setRoot",null),o.__decorate([s.Mutation],n.prototype,"isFile",null),n=o.__decorate([s.Module({dynamic:!0,store:a.rootStore,name:"assets",namespaced:!0})],n),t.assetStore=s.getModule(n)},"300e":function(e,t,i){"use strict";i.r(t);var o=i("cde6"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},"308b":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9")),n=o.__importDefault(i("1c76")),r=i("4a5b"),l=i("6f92"),c=i("f10f");let u=class extends s.default{constructor(){super(...arguments),this.visible=!1,this.x=0,this.y=0,this.shape=null}get activeLayer(){const e=l.layerManager.getLayer();return void 0===e?"":e.name}open(e,t){this.visible=!0,this.x=e.pageX,this.y=e.pageY,this.shape=t,this.$nextTick(()=>this.$children[0].$el.focus())}close(){this.visible=!1,this.shape=null}getLayers(){return l.layerManager.layers.filter(e=>e.selectable&&(c.gameStore.IS_DM||e.playerEditable))}getActiveLayer(){return l.layerManager.getLayer()}getInitiativeWord(){return null===this.shape?"":r.getRef("initiative").contains(this.shape.uuid)?"Show":"Add"}setLayer(e){null!==this.shape&&(this.shape.moveLayer(e,!0),this.close())}moveToBack(){if(null===this.shape)return;const e=this.getActiveLayer();e.moveShapeOrder(this.shape,0,!0),this.close()}moveToFront(){if(null===this.shape)return;const e=this.getActiveLayer();e.moveShapeOrder(this.shape,e.shapes.length-1,!0),this.close()}addInitiative(){if(null===this.shape)return;const e=r.getRef("initiative");e.contains(this.shape.uuid)||e.addInitiative(this.shape.getInitiativeRepr()),e.visible=!0,this.close()}};u=o.__decorate([a.default({components:{ContextMenu:n.default}})],u),t.default=u},3116:function(e,t,i){"use strict";var o=i("d35a"),s=i.n(o);s.a},"33f4":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("form",{on:{focusin:e.focusin,focusout:e.focusout,submit:function(t){return t.preventDefault(),e.login(t)}}},[i("fieldset",[i("legend",{staticClass:"legend"},[e._v("PlanarAlly")]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{type:"text",name:"username",placeholder:"Username",required:""},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}}),e._m(0)]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password",name:"password",placeholder:"Password",required:""},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),e._m(1)]),i("div",{staticStyle:{display:"flex"}},[i("button",{staticStyle:{visibility:"hidden",display:"none"},attrs:{type:"submit",name:"login"}}),i("button",{staticClass:"submit",attrs:{type:"button",name:"register",title:"Register"},on:{click:e.register}},[i("i",{staticClass:"fas fa-plus"})]),e._m(2)])]),e.error?i("div",{staticClass:"feedback"},[i("p",{staticClass:"error"},[i("strong",[e._v("Error:")]),e._v("\n      "+e._s(e.error)+"\n    ")])]):e._e()])},s=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fas fa-user-circle"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fas fa-lock"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("button",{staticClass:"submit",attrs:{type:"submit",name:"login",title:"Login"}},[i("i",{staticClass:"fas fa-arrow-right"})])}];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},3434:function(e,t,i){"use strict";var o=i("1517"),s=i.n(o);s.a},3481:function(e,t,i){"use strict";i.r(t);var o=i("47e6"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},"369e":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.IS_DM,expression:"IS_DM"}]},[e._v("Mode")]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.IS_DM,expression:"IS_DM"}],staticClass:"selectgroup"},e._l(e.modes,function(t){return i("div",{key:t,staticClass:"option",class:{"option-selected":e.modeSelect===t},on:{click:function(i){e.modeSelect=t}}},[e._v(e._s(t))])})),i("div",[e._v("Shape")]),i("div",{staticClass:"selectgroup"},e._l(e.shapes,function(t){return i("div",{key:t,staticClass:"option",class:{"option-selected":e.shapeSelect===t},on:{click:function(i){e.shapeSelect=t}}},[i("i",{staticClass:"fas",class:"fa-"+t})])})),i("div",[e._v("Colours")]),i("div",{staticClass:"selectgroup"},[i("color-picker",{staticClass:"option",attrs:{color:e.fillColour},on:{"update:color":function(t){e.fillColour=t}}}),i("color-picker",{staticClass:"option",attrs:{color:e.borderColour},on:{"update:color":function(t){e.borderColour=t}}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"paint-brush"===e.shapeSelect,expression:"shapeSelect === 'paint-brush'"}]},[e._v("Brush size")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.brushSize,expression:"brushSize"},{name:"show",rawName:"v-show",value:"paint-brush"===e.shapeSelect,expression:"shapeSelect === 'paint-brush'"}],staticStyle:{"max-width":"100px"},attrs:{type:"text"},domProps:{value:e.brushSize},on:{input:function(t){t.target.composing||(e.brushSize=t.target.value)}}})]):e._e()},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"38c9":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("bab4"),s=i("f10f");class a extends o.Layer{invalidate(){this.valid=!1}draw(e){this.valid||this.drawGrid()}drawGrid(){const e=this.ctx;this.clear(),e.beginPath();const t=s.gameStore.gridSize;for(let i=0;i<this.width;i+=t*s.gameStore.zoomFactor)e.moveTo(i+s.gameStore.panX%t*s.gameStore.zoomFactor,0),e.lineTo(i+s.gameStore.panX%t*s.gameStore.zoomFactor,this.height),e.moveTo(0,i+s.gameStore.panY%t*s.gameStore.zoomFactor),e.lineTo(this.width,i+s.gameStore.panY%t*s.gameStore.zoomFactor);e.strokeStyle=s.gameStore.gridColour,e.lineWidth=1,e.stroke(),this.valid=!0}}t.GridLayer=a},"396d":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ul",[e._l(e.folders,function(t){return i("li",{key:t,staticClass:"folder",on:{click:function(t){return t.stopPropagation(),e.toggle(t)}}},[e._v("\n    "+e._s(t)+"\n    "),i("asset-node",{attrs:{asset:e.asset[t]}})],1)}),e._l(e.files,function(t){return i("li",{key:t.name,staticClass:"file draggable token",attrs:{draggable:"true"},on:{mouseover:function(i){e.showImage=t.hash},mouseout:function(t){e.showImage=null},dragstart:function(i){e.dragStart(i,"/static/assets/"+t.hash)}}},[e._v("\n    "+e._s(t.name)+"\n    "),e.showImage==t.hash?i("div",{staticClass:"preview"},[i("img",{staticClass:"asset-preview-image",attrs:{src:"/static/assets/"+t.hash}})]):e._e()])})],2)},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"3a0b":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("2f62"));s.default.use(a.default),t.rootStore=new a.default.Store({})},"3b36":function(e,t,i){"use strict";i.r(t);var o=i("c867"),s=i("979e");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("11c8");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"a45a1816",null);r.options.__file="colorpicker.vue",t["default"]=r.exports},"3cf9":function(e,t,i){},"3dfd":function(e,t,i){"use strict";i.r(t);var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("router-view",{ref:"activeComponent"})],1)},s=[],a=(i("034f"),i("2877")),n={},r=Object(a["a"])(n,o,s,!1,null,null,null);r.options.__file="App.vue";t["default"]=r.exports},"40f3":function(e,t,i){"use strict";var o=i("6ac0"),s=i.n(o);s.a},"410d":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",[e._v("#X")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.xCount,expression:"xCount"}],attrs:{type:"text"},domProps:{value:e.xCount},on:{input:function(t){t.target.composing||(e.xCount=t.target.value)}}}),i("div",[e._v("#Y")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.yCount,expression:"yCount"}],attrs:{type:"text"},domProps:{value:e.yCount},on:{input:function(t){t.target.composing||(e.yCount=t.target.value)}}})]):e._e()},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},4124:function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return void 0!==e.getActiveLayer()?i("ContextMenu",{attrs:{visible:e.visible,left:e.x+"px",top:e.y+"px"},on:{close:e.close}},[e.getLayers().length>1?i("li",[e._v("Layer\n    "),i("ul",e._l(e.getLayers(),function(t){return i("li",{key:t.name,style:[e.getActiveLayer().name===t.name?{"background-color":"#82c8a0"}:{}],on:{click:function(i){e.setLayer(t.name)}}},[e._v(e._s(t.name))])}))]):e._e(),i("li",{on:{click:e.moveToBack}},[e._v("Move to back")]),i("li",{on:{click:e.moveToFront}},[e._v("Move to front")]),i("li",{on:{click:e.addInitiative}},[e._v(e._s(e.getInitiativeWord())+" initiative")])]):e._e()},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},4133:function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("SelectContext",{ref:"selectcontext"})},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},4185:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("8f0a"),s=i("bab4"),a=i("6f92"),n=i("d1ec"),r=i("4709"),l=i("f10f"),c=i("92b1"),u=i("5a5c");class d extends s.Layer{constructor(){super(...arguments),this.isVisionLayer=!0,this.preFogShapes=[]}addShape(e,t,i){super.addShape(e,t,i),e.options.has("preFogShape")&&e.options.get("preFogShape")&&this.preFogShapes.push(e)}removeShape(e,t,i){if(e.options.has("preFogShape")&&e.options.get("preFogShape")){const t=this.preFogShapes.findIndex(t=>t.uuid===e.uuid);this.preFogShapes.splice(t,1)}super.removeShape(e,t,i)}draw(){if(!this.valid){const e=this.ctx;if(n.Settings.skipLightFOW)return e.clearRect(0,0,this.canvas.width,this.canvas.height),void(this.valid=!0);const t=e.globalCompositeOperation;e.clearRect(0,0,this.canvas.width,this.canvas.height),e.fillStyle="rgba(0, 0, 0, 1)";const i=a.layerManager.getLayer("draw").ctx;(n.Settings.drawAngleLines||n.Settings.drawFirstLightHit)&&i.clearRect(0,0,i.canvas.width,i.canvas.height),l.gameStore.fullFOW&&a.layerManager.hasLayer("tokens")&&a.layerManager.getLayer("tokens").shapes.forEach(t=>{if(!t.ownedBy()||!t.isToken)return;const i=t.getBoundingBox(),o=c.g2l(t.center()),s=.8*c.g2lz(i.w);e.beginPath(),e.arc(o.x,o.y,s,0,2*Math.PI);const a=e.createRadialGradient(o.x,o.y,s/2,o.x,o.y,s);a.addColorStop(0,"rgba(0, 0, 0, 1)"),a.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=a,e.fill()});for(const s of l.gameStore.visionSources){const t=a.layerManager.UUIDMap.get(s.shape);if(void 0===t)continue;const u=t.auras.find(e=>e.uuid===s.aura);if(void 0===u)continue;const d=c.getUnitDistance(u.value+u.dim),h=t.center(),f=c.g2l(h),p=new r.Circle(h,d);if(!p.visibleInCanvas(e.canvas))continue;let g=-1;const m=new Path2D;let v;m.moveTo(f.x,f.y);for(let s=0;s<2*Math.PI;s+=n.Settings.angleSteps/180*Math.PI){const t=new o.GlobalPoint(h.x+d*Math.cos(s),h.y+d*Math.sin(s));n.Settings.drawAngleLines&&(i.beginPath(),i.moveTo(c.g2lx(h.x),c.g2ly(h.y)),i.lineTo(c.g2lx(t.x),c.g2ly(t.y)),i.stroke());const a=o.Ray.fromPoints(h,t),r=l.gameStore.BV.intersect(a);if(0===s&&(v=r.hit?r.intersect:t),r.hit)-1!==g&&(m.arc(f.x,f.y,c.g2lr(u.value+u.dim),g,s),g=-1),m.lineTo(c.g2lx(r.intersect.x),c.g2ly(r.intersect.y));else if(-1===g){g=s;const i=c.g2l(t);e.lineTo(i.x,i.y)}}if(-1===g?m.lineTo(c.g2lx(v.x),c.g2ly(v.y)):m.arc(f.x,f.y,c.g2lr(u.value+u.dim),g,2*Math.PI),l.gameStore.fullFOW){if(u.dim>0){const t=e.createRadialGradient(f.x,f.y,c.g2lr(u.value),f.x,f.y,c.g2lr(u.value+u.dim));t.addColorStop(0,"rgba(0, 0, 0, 1)"),t.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=t}else e.fillStyle="rgba(0, 0, 0, 1)";e.fill(m)}u.lastPath=m}l.gameStore.fowLOS&&(e.globalCompositeOperation="source-in",e.drawImage(a.layerManager.getLayer("fow-players").canvas,0,0));for(const o of this.preFogShapes){if(!o.visibleInCanvas(this.canvas))continue;const t=o.globalCompositeOperation;l.gameStore.fullFOW||("source-over"===o.globalCompositeOperation?o.globalCompositeOperation="destination-out":"destination-out"===o.globalCompositeOperation&&(o.globalCompositeOperation="source-over")),o.draw(e),o.globalCompositeOperation=t}l.gameStore.fullFOW&&(e.globalCompositeOperation="source-out",e.fillStyle=u.getFogColour(),e.fillRect(0,0,e.canvas.width,e.canvas.height)),super.draw(!1),e.globalCompositeOperation=t}}}t.FOWLayer=d},4444:function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"formcontainer"}},[e.owned||e.joined?i("form",[i("fieldset",[i("legend",{staticClass:"legend"},[e._v("Your sessions")]),i("div",{staticClass:"input"},[e._l(e.owned,function(t,o){return i("router-link",{key:"o-"+o,attrs:{to:"/game/"+t[1]+"/"+t[0]}},[e._v(e._s(t[0]))])}),e._l(e.joined,function(t,o){return i("router-link",{key:"j-"+o,attrs:{to:"/game/"+t[1]+"/"+t[0]}},[e._v(e._s(t[1])+"/"+e._s(t[0]))])})],2)])]):e._e(),e._m(0),i("form",{on:{submit:function(t){return t.preventDefault(),e.createRoom(t)}}},[i("fieldset",[e.owned||e.joined?i("div",{staticClass:"input"},[e._v("Create a new session")]):i("legend",{staticClass:"legend"},[e._v("Create a session")]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.newSessionName,expression:"newSessionName"}],attrs:{type:"text",name:"room_name",placeholder:"Session Name"},domProps:{value:e.newSessionName},on:{input:function(t){t.target.composing||(e.newSessionName=t.target.value)}}}),e._m(1)]),e._m(2)])]),i("div",{attrs:{id:"account-options"}},[i("form",{on:{submit:function(e){e.preventDefault()}}},[i("router-link",{staticClass:"submit",attrs:{tag:"button",title:"Account Settings",to:"/account"}},[i("i",{staticClass:"fas fa-cog"})])],1),i("form",{on:{submit:function(e){e.preventDefault()}}},[i("router-link",{staticClass:"submit",attrs:{tag:"button",title:"Logout",to:"/auth/logout"}},[i("i",{staticClass:"fas fa-sign-out-alt"})])],1)])])},s=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("h4",[i("span",[e._v("OR")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fab fa-d-and-d"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("button",{staticClass:"submit",attrs:{type:"submit",title:"Create"}},[i("i",{staticClass:"fas fa-arrow-right"})])}];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},4486:function(e,t,i){"use strict";i.r(t);var o=i("a097"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},4709:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("8f0a"),s=i("8db6"),a=i("2469"),n=i("f10f"),r=i("2838"),l=i("92b1"),c=i("5a5c");class u extends a.Shape{constructor(e,t,i,o,s){super(e,i,o,s),this.type="circle",this.r=t||1}asDict(){return Object.assign(this.getBaseDict(),{radius:this.r})}fromDict(e){super.fromDict(e),this.r=e.radius}getBoundingBox(){return new s.BoundingRect(new o.GlobalPoint(this.refPoint.x-this.r,this.refPoint.y-this.r),2*this.r,2*this.r)}draw(e){super.draw(e),e.beginPath(),"fog"===this.fillColour?e.fillStyle=c.getFogColour():e.fillStyle=this.fillColour;const t=l.g2l(this.refPoint);e.arc(t.x,t.y,l.g2lz(this.r),0,2*Math.PI),e.fill(),"rgba(0, 0, 0, 0)"!==this.strokeColour&&(e.beginPath(),e.lineWidth=l.g2lz(5),e.strokeStyle=this.strokeColour,e.arc(t.x,t.y,l.g2lz(this.r),0,2*Math.PI),e.stroke())}contains(e){return Math.pow(e.x-this.refPoint.x,2)+Math.pow(e.y-this.refPoint.y,2)<Math.pow(this.r,2)}inCorner(e,t){return!1}getCorner(e){return this.inCorner(e,"ne")?"ne":this.inCorner(e,"nw")?"nw":this.inCorner(e,"se")?"se":this.inCorner(e,"sw")?"sw":void 0}center(e){if(void 0===e)return this.refPoint;this.refPoint=e}visibleInCanvas(e){return!0}snapToGrid(){const e=n.gameStore.gridSize;let t,i;t=2*this.r/e%2===0?Math.round(this.refPoint.x/e)*e:Math.round((this.refPoint.x-e/2)/e)*e+this.r,i=2*this.r/e%2===0?Math.round(this.refPoint.y/e)*e:Math.round((this.refPoint.y-e/2)/e)*e+this.r;const s=r.calculateDelta(new o.Vector(t-this.refPoint.x,i-this.refPoint.y),this);this.refPoint=this.refPoint.add(s),this.invalidate(!1)}resizeToGrid(){const e=n.gameStore.gridSize;this.r=Math.max(Math.round(this.r/e)*e,e/2),this.invalidate(!1)}resize(e,t){n.gameStore.zoomFactor;const i=l.l2g(t).subtract(this.refPoint);this.r=Math.sqrt(Math.pow(i.length(),2)/2)}}t.Circle=u},"47e6":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("ea6a")),a=i("6f92"),n=i("c266"),r=i("b2ed"),l=i("f10f"),c=i("92b1"),u=i("5a5c"),d=o.__importDefault(i("65d9"));let h=class extends s.default{constructor(){super(...arguments),this.name="Map",this.active=!1,this.xCount=3,this.yCount=3,this.startPoint=null,this.rect=null}onMouseDown(e){const t=a.layerManager.getLayer();void 0!==t?(this.active=!0,this.startPoint=c.l2g(u.getMouse(e)),this.rect=new r.Rect(this.startPoint.clone(),0,0,"rgba(0,0,0,0)","black"),t.addShape(this.rect,!1,!1)):console.log("No active layer!")}onMouseMove(e){if(!this.active||null===this.rect||null===this.startPoint)return;const t=a.layerManager.getLayer();if(void 0===t)return void console.log("No active layer!");const i=c.l2g(u.getMouse(e));this.rect.w=Math.abs(i.x-this.startPoint.x),this.rect.h=Math.abs(i.y-this.startPoint.y),this.rect.refPoint.x=Math.min(this.startPoint.x,i.x),this.rect.refPoint.y=Math.min(this.startPoint.y,i.y),t.invalidate(!1)}onMouseUp(e){if(!this.active||null===this.rect)return;const t=a.layerManager.getLayer();if(void 0===t)return void console.log("No active layer!");if(this.active=!1,1!==t.selection.length)return void t.removeShape(this.rect,!1,!1);const i=this.rect.w,o=this.rect.h,s=t.selection[0];s instanceof n.BaseRect&&(s.w*=this.xCount*l.gameStore.gridSize/i,s.h*=this.yCount*l.gameStore.gridSize/o),t.removeShape(this.rect,!1,!1)}};h=o.__decorate([d.default],h),t.default=h},"47f7":function(e,t,i){"use strict";i.r(t);var o=i("4e1f"),s=i("4486");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,null,null);r.options.__file="load.vue",t["default"]=r.exports},4899:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("ea6a")),a=i("2b48"),n=i("8f0a"),r=i("6f92"),l=i("f10f"),c=i("5a5c"),u=o.__importDefault(i("65d9"));let d=class extends s.default{constructor(){super(...arguments),this.name="Pan",this.panStart=new n.LocalPoint(0,0),this.active=!1}onMouseDown(e){this.panStart=c.getMouse(e),this.active=!0}onMouseMove(e){if(!this.active)return;const t=c.getMouse(e),i=t.subtract(this.panStart).multiply(1/l.gameStore.zoomFactor);l.gameStore.increasePanX(Math.round(i.x)),l.gameStore.increasePanY(Math.round(i.y)),this.panStart=t,r.layerManager.invalidate()}onMouseUp(e){this.active=!1,a.sendClientOptions()}};d=o.__decorate([u.default],d),t.default=d},"496c":function(e,t,i){"use strict";i.r(t);var o=i("1b1f"),s=i("b809");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("70bb");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"6d5bd46a",null);r.options.__file="selectcontext.vue",t["default"]=r.exports},"4a5b":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("cd49");function s(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16)})}function a(e){return e.charAt(0).toUpperCase()+e.slice(1)}function n(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1}function r(e){let t=e.style.font;while(null===t&&null!==e.parentElement)e=e.parentElement,t=e.style.font;return null===t&&(t=window.getComputedStyle(document.body).getPropertyValue("font")),t}function l(e,t){let i=document.getElementById("emptycanvas");null===i&&(i=document.createElement("canvas"),i.id="emptycanvas",i.style.display="",document.body.appendChild(i));const o=i.getContext("2d");return o.font=t,Math.ceil(o.measureText(e).width)}function c(e,t){const i=[[],[]];return e.forEach(e=>t(e)?i[1].push(e):i[0].push(e)),i}function u(e,t,i,o){const s=.2*Number(e.font.split("px")[0]),a=e.measureText(t).width;return Math.min(i/a,o/s)}function d(e){return encodeURIComponent(e).replace(/[!'()*]/g,e=>{return"%"+e.charCodeAt(0).toString(16)})}t.uuidv4=s,t.capitalize=a,t.alphSort=n,t.getHTMLFont=r,t.getHTMLTextWidth=l,t.partition=c,t.calcFontScale=u,t.fixedEncodeURIComponent=d;class h{constructor(){this.keys=[],this.values=[]}get(e){return this.values[this.keys.indexOf(e)]}getIndexValue(e){return this.values[e]}getIndexKey(e){return this.keys[e]}set(e,t){this.keys.push(e),this.values.push(t)}indexOf(e){return this.keys.indexOf(e)}remove(e){const t=this.indexOf(e);this.keys.splice(t,1),this.values.splice(t,1)}}function f(){return o.app.$children[0].$refs.activeComponent}function p(e){const t=o.app.$children[0].$refs.activeComponent;return t.$refs[e]}t.OrderedMap=h,t.getComponent=f,t.getRef=p},"4aec":function(e,t,i){"use strict";i.r(t);var o=i("5b11"),s=i("f51a");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,null,null);r.options.__file="contextMenu.vue",t["default"]=r.exports},"4bc3":function(e,t,i){"use strict";i.r(t);var o=i("2baf"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},"4e1f":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e._v(e._s(e.message))])},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"52a8":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9")),n=i("60a3");let r=class extends s.default{constructor(){super(...arguments),this.positioned=!1,this.offsetX=0,this.offsetY=0,this.screenX=0,this.screenY=0,this.dragging=!1}mounted(){this.updatePosition()}updated(){this.updatePosition()}close(e){this.$emit("close")}updatePosition(){if(!this.positioned){const e=this.$refs.container;if(0===e.offsetWidth&&0===e.offsetHeight)return;this.$refs.container.style.left=(window.innerWidth-e.offsetWidth)/2+"px",this.$refs.container.style.top=(window.innerHeight-e.offsetHeight)/2+"px",this.positioned=!0}}dragStart(e){null!==e&&null!==e.dataTransfer&&(e.dataTransfer.setData("Hack",""),e.dataTransfer.setDragImage(this.$refs.container,e.offsetX,e.offsetY),this.offsetX=e.offsetX,this.offsetY=e.offsetY,this.screenX=e.screenX,this.screenY=e.screenY,this.dragging=!0)}dragEnd(e){this.dragging=!1;let t=e.clientX-this.offsetX,i=e.clientY-this.offsetY;0===e.clientX&&0===e.clientY&&0===e.pageX&&0===e.pageY&&(t=parseInt(this.$refs.container.style.left,10)-(this.screenX-e.screenX),i=parseInt(this.$refs.container.style.top,10)-(this.screenY-e.screenY)),t<0&&(t=0),t>window.innerWidth-100&&(t=window.innerWidth-100),i<0&&(i=0),i>window.innerHeight-100&&(i=window.innerHeight-100),this.$refs.container.style.left=t+"px",this.$refs.container.style.top=i+"px",this.$refs.container.style.display="block"}dragOver(e){this.dragging&&(this.$refs.container.style.display="none")}};o.__decorate([n.Prop(Boolean)],r.prototype,"visible",void 0),o.__decorate([n.Prop({type:Boolean,default:!0})],r.prototype,"mask",void 0),r=o.__decorate([a.default],r),t.default=r},5320:function(e,t,i){"use strict";var o=i("561d"),s=i.n(o);s.a},5338:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("8055")),a=i("2d5b");t.socket=s.default(location.protocol+"//"+location.host+"/pa_assetmgmt",{autoConnect:!1}),t.socket.on("connect",()=>{console.log("Connected")}),t.socket.on("disconnect",()=>{console.log("Disconnected")}),t.socket.on("redirect",e=>{console.log("redirecting"),window.location.href=e}),t.socket.on("Folder.Root.Set",e=>{a.assetStore.setRoot(e)}),t.socket.on("Folder.Set",e=>{if(a.assetStore.clear(),e.children)for(const t of e.children)a.assetStore.idMap.set(t.id,t),t.file_hash?a.assetStore.files.push(t.id):a.assetStore.folders.push(t.id)}),t.socket.on("Folder.Create",e=>{a.assetStore.folders.push(e.id),a.assetStore.idMap.set(e.id,e)}),t.socket.on("Asset.Upload.Finish",e=>{a.assetStore.idMap.set(e.id,e),a.assetStore.files.push(e.id)})},"561b":function(e,t,i){"use strict";var o=i("a450"),s=i.n(o);s.a},"561d":function(e,t,i){},"574e":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("8f0a"),s=i("8db6"),a=i("2469"),n=i("92b1"),r=i("5a5c");class l extends a.Shape{constructor(e,t,i,o,s){super(e,"rgba(0, 0, 0, 0)",o||"#000",s),this.type="multiline",this.points=[],this.points=t||[],this.lineWidth=i||3}asDict(){return Object.assign(this.getBaseDict(),{line_width:this.lineWidth,points:this.points.map(e=>({x:e.x,y:e.y}))})}getBoundingBox(){let e=this.refPoint.x,t=this.refPoint.y,i=this.refPoint.x,a=this.refPoint.y;for(const o of this.points)o.x<e&&(e=o.x),o.x>t&&(t=o.x),o.y<i&&(i=o.y),o.y>a&&(a=o.y);return new s.BoundingRect(new o.GlobalPoint(e,i),t-e,a-i)}draw(e){super.draw(e),e.beginPath(),e.lineCap="round",e.lineJoin="round",e.moveTo(n.g2lx(this.refPoint.x),n.g2ly(this.refPoint.y));for(const t of this.points)e.lineTo(n.g2lx(t.x),n.g2ly(t.y));"fog"===this.strokeColour?e.strokeStyle=r.getFogColour():e.strokeStyle=this.strokeColour,e.lineWidth=n.g2lz(this.lineWidth),e.stroke()}contains(e){return this.points.includes(e)}center(e){}getCorner(e){return""}visibleInCanvas(e){return!0}snapToGrid(){}resizeToGrid(){}resize(e,t){}}t.MultiLine=l},"59d8":function(e,t,i){"use strict";i.r(t);var o=i("369e"),s=i("6f8d");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("3434");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"67a6ef9a",null);r.options.__file="draw.vue",t["default"]=r.exports},"5a5c":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("66cb")),a=i("8f0a"),n=i("f10f");function r(e){return new a.LocalPoint(e.pageX,e.pageY)}function l(e=!1){const t=s.default(n.gameStore.fowColour);return n.gameStore.IS_DM?t.setAlpha(e?1:n.gameStore.fowOpacity):t.setAlpha(1),t.toRgbString()}t.getMouse=r,t.getFogColour=l},"5a81":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importStar(i("66cb")),a=o.__importDefault(i("a026")),n=o.__importDefault(i("65d9")),r=i("2f62"),l=o.__importDefault(i("3b36")),c=o.__importDefault(i("d65f")),u=i("4a5b"),d=i("8f0a"),h=i("6f92"),f=i("1327"),p=i("f10f"),g=i("92b1"),m=i("60a3");let v=class extends a.default{constructor(){super(...arguments),this.x=0,this.y=0,this.visible=!1,this.text="X",this.fillColour="rgba(255, 255, 255, 1)",this.borderColour="rgba(0, 0, 0, 1)"}mounted(){this.updatePreview()}onTextChange(e,t){this.updatePreview()}onFillChange(e,t){this.updatePreview()}onBorderChange(e,t){this.updatePreview()}open(e,t){this.visible=!0,this.x=e,this.y=t}submit(){const e=h.layerManager.getLayer();if(void 0===e)return;const t=new f.CircularToken(g.l2g(new d.LocalPoint(this.x,this.y)),g.getUnitDistance(p.gameStore.unitSize/2),this.text,"10px serif",this.fillColour,this.borderColour);t.owners.push(p.gameStore.username),e.addShape(t,!0),e.invalidate(!1),this.visible=!1}updatePreview(){const e=this.$refs.canvas.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath();const t={x:e.canvas.width/2,y:e.canvas.height/2},i=.9*Math.min(t.x,t.y);e.fillStyle=this.fillColour,e.arc(t.x,t.y,i,0,2*Math.PI),e.fill(),"rgba(0, 0, 0, 0)"!==this.borderColour&&(e.beginPath(),e.lineWidth=5,e.strokeStyle=this.borderColour,e.arc(t.x,t.y,i,0,2*Math.PI),e.stroke()),e.save(),e.textAlign="center",e.textBaseline="middle";const o=u.calcFontScale(e,this.text,i,i),a=0;e.transform(o,a,-a,o,t.x,t.y),e.fillStyle=s.mostReadable(this.fillColour,["#000","#fff"]).toHexString(),e.fillText(this.text,0,0),e.restore()}};o.__decorate([m.Watch("text")],v.prototype,"onTextChange",null),o.__decorate([m.Watch("fillColour")],v.prototype,"onFillChange",null),o.__decorate([m.Watch("borderColour")],v.prototype,"onBorderChange",null),v=o.__decorate([n.default({components:{Modal:c.default,"color-picker":l.default},computed:Object.assign({},r.mapState("game",["unitSize"]))})],v),t.default=v},"5ad0":function(e,t,i){},"5ae5":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9")),n=o.__importDefault(i("d65f")),r=i("4a5b"),l=i("f10f");let c=class extends s.default{constructor(){super(...arguments),this.visible=!1,this.note=null}open(e){this.visible=!0,this.note=e}calcHeight(){if(this.$refs.textarea){const e=this.$refs.textarea;return e.style.height="auto",e.style.height=e.scrollHeight+"px",e.scrollHeight+"px"}return"100px"}updateNote(){this.note&&l.gameStore.updateNote({note:this.note,sync:!0})}removeNote(){r.getRef("confirm").open("Are you sure you wish to remove this?").then(e=>{e&&this.note&&(l.gameStore.removeNote({note:this.note,sync:!0}),this.visible=!1)},()=>{})}};c=o.__decorate([a.default({components:{Modal:n.default}})],c),t.default=c},"5b11":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContextMenu",{attrs:{visible:e.visible,left:e.left+"px",top:e.top+"px"},on:{close:e.close}},[i("li",{on:{click:e.rename}},[e._v("Rename")]),i("li",{on:{click:e.remove}},[e._v("Remove")])])},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"5b68":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Initiative")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("draggable",{attrs:{id:"initiative-list",options:{setData:e.fakeSetData,disabled:!e.$store.state.game.IS_DM}},on:{change:e.updateOrder},model:{value:e.data,callback:function(t){e.data=t},expression:"data"}},[e._l(e.data,function(t){return[i("div",{key:t.uuid,staticStyle:{display:"flex","flex-direction":"column","align-items":"flex-end"}},[i("div",{staticClass:"initiative-actor",class:{"initiative-selected":e.currentActor===t.uuid},style:{cursor:e.$store.state.game.IS_DM&&"move"},on:{mouseenter:function(i){e.toggleHighlight(t,!0)},mouseleave:function(i){e.toggleHighlight(t,!1)}}},[t.has_img?[i("img",{attrs:{src:t.source,width:"30px",height:"30px"}})]:[i("span",{staticStyle:{width:"auto"}},[e._v(e._s(t.source))])],i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:t.initiative,expression:"actor.initiative",modifiers:{lazy:!0,number:!0}}],class:{notAllowed:!e.owns(t)},attrs:{type:"text",placeholder:"value",disabled:!e.owns(t)},domProps:{value:t.initiative},on:{change:[function(i){e.$set(t,"initiative",e._n(i.target.value))},function(i){e.syncInitiative(t)}],blur:function(t){e.$forceUpdate()}}}),i("div",{staticClass:"initiative-effects-icon",class:{notAllowed:!e.owns(t)},staticStyle:{opacity:"0.6"},on:{click:function(i){e.createEffect(t,e.getDefaultEffect(),!0)}}},[i("i",{staticClass:"fas fa-stopwatch"}),t.effects?[e._v(e._s(t.effects.length))]:[e._v("0")]],2),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:t.visible?"1.0":"0.3"},on:{click:function(i){e.toggleOption(t,"visible")}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:t.group?"1.0":"0.3"},on:{click:function(i){e.toggleOption(t,"group")}}},[i("i",{staticClass:"fas fa-users"})]),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:e.owns(t)?"1.0":"0.3"},on:{click:function(i){e.removeInitiative(t.uuid,!0,!0)}}},[i("i",{staticClass:"fas fa-trash-alt"})])],2),t.effects?i("div",{staticClass:"initiative-effect"},e._l(t.effects,function(o){return i("div",{key:o.uuid},[i("input",{directives:[{name:"model",rawName:"v-model",value:o.name,expression:"effect.name"}],attrs:{type:"text",size:o.name.length||1},domProps:{value:o.name},on:{change:function(i){e.updateEffect(t.uuid,o,!0)},input:function(t){t.target.composing||e.$set(o,"name",t.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model",value:o.turns,expression:"effect.turns"}],attrs:{type:"text",size:o.turns.toString().length||1},domProps:{value:o.turns},on:{change:function(i){e.updateEffect(t.uuid,o,!0)},input:function(t){t.target.composing||e.$set(o,"turns",t.target.value)}}})])})):e._e()])]})],2),i("div",{attrs:{id:"initiative-bar"}},[i("div",{attrs:{id:"initiative-round"}},[e._v("Round "+e._s(e.roundCounter))]),i("div",{staticStyle:{display:"flex"}}),i("div",{staticClass:"initiative-bar-button",class:{notAllowed:!e.$store.state.game.IS_DM},on:{click:function(t){e.setRound(0,!0),e.setTurn(e.data[0].uuid,!0)}}},[i("i",{staticClass:"fas fa-sync-alt"})]),i("div",{staticClass:"initiative-bar-button",class:{notAllowed:!e.$store.state.game.IS_DM},on:{click:e.nextTurn}},[i("i",{staticClass:"fas fa-chevron-right"})])])],1)])},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"5b69":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("65d9")),a=i("60a3"),n=o.__importDefault(i("3b36")),r=o.__importDefault(i("ea6a")),l=i("0bc6"),c=i("8f0a"),u=i("6f92"),d=i("4709"),h=i("574e"),f=i("b2ed"),p=i("f10f"),g=i("92b1"),m=i("5a5c");let v=class extends r.default{constructor(){super(...arguments),this.name="Draw",this.active=!1,this.startPoint=null,this.shape=null,this.brushHelper=null,this.fillColour="rgba(0, 0, 0, 1)",this.borderColour="rgba(255, 255, 255, 0)",this.shapeSelect="square",this.shapes=["square","circle","paint-brush"],this.modeSelect="normal",this.modes=["normal","reveal","hide"],this.brushSize=g.getUnitDistance(p.gameStore.unitSize)}get helperSize(){return"paint-brush"===this.shapeSelect?this.brushSize/2:g.getUnitDistance(this.unitSize)/8}get IS_DM(){return p.gameStore.IS_DM}get unitSize(){return p.gameStore.unitSize}get useGrid(){return p.gameStore.useGrid}onFillChange(){this.brushHelper&&(this.brushHelper.fillColour=this.fillColour)}onModeUpdate(e,t){this.onModeChange(e,t)}setupBrush(){null!==this.brushHelper&&("reveal"===this.modeSelect||"hide"===this.modeSelect?(this.brushHelper.options.set("preFogShape",!0),this.brushHelper.options.set("skipDraw",!0),this.brushHelper.fillColour="rgba(0, 0, 0, 1)","reveal"===this.modeSelect?this.brushHelper.globalCompositeOperation="source-over":"hide"===this.modeSelect&&(this.brushHelper.globalCompositeOperation="destination-out")):(this.brushHelper.options.delete("preFogShape"),this.brushHelper.options.delete("skipDraw"),this.brushHelper.globalCompositeOperation="source-over",this.brushHelper.fillColour=this.fillColour))}onModeChange(e,t){if(null===this.brushHelper)return;const i=u.layerManager.getLayer("fow"),o=u.layerManager.getLayer();void 0!==i&&void 0!==o&&(this.setupBrush(),"normal"!==e&&"normal"===t?(o.removeShape(this.brushHelper,!1),i.addShape(this.brushHelper,!1)):"normal"===e&&"normal"!==t&&(o.addShape(this.brushHelper,!1),i.removeShape(this.brushHelper,!1)))}getLayer(){return"normal"===this.modeSelect?u.layerManager.getLayer():u.layerManager.getLayer("fow")}onMouseDown(e){const t=this.getLayer();if(void 0!==t){if(this.active=!0,this.startPoint=g.l2g(m.getMouse(e)),"square"===this.shapeSelect)this.shape=new f.Rect(this.startPoint.clone(),0,0,this.fillColour,this.borderColour);else if("circle"===this.shapeSelect)this.shape=new d.Circle(this.startPoint.clone(),this.helperSize,this.fillColour,this.borderColour);else{if("paint-brush"!==this.shapeSelect)return;this.shape=new h.MultiLine(this.startPoint.clone(),[],this.brushSize),this.shape.fillColour=this.fillColour}"normal"!==this.modeSelect&&(this.shape.options.set("preFogShape",!0),this.shape.options.set("skipDraw",!0),this.shape.fillColour="rgba(0, 0, 0, 1)"),"reveal"===this.modeSelect?this.shape.globalCompositeOperation="source-over":"hide"===this.modeSelect&&(this.shape.globalCompositeOperation="destination-out"),this.shape.owners.push(p.gameStore.username),"fow"===t.name&&"normal"===this.modeSelect&&(this.shape.visionObstruction=!0,this.shape.movementObstruction=!0),p.gameStore.visionBlockers.push(this.shape.uuid),t.addShape(this.shape,!0,!1),this.onDeselect(),this.onSelect()}else console.log("No active layer!")}onMouseMove(e){const t=g.l2g(m.getMouse(e)),i=this.getLayer();void 0!==i?(null!==this.brushHelper&&(this.brushHelper.r=this.helperSize,this.brushHelper.refPoint=t,this.active||i.invalidate(!1)),this.active&&null!==this.startPoint&&null!==this.shape&&("square"===this.shapeSelect?(this.shape.w=Math.abs(t.x-this.startPoint.x),this.shape.h=Math.abs(t.y-this.startPoint.y),this.shape.refPoint.x=Math.min(this.startPoint.x,t.x),this.shape.refPoint.y=Math.min(this.startPoint.y,t.y)):"circle"===this.shapeSelect?this.shape.r=t.subtract(this.startPoint).length():"paint-brush"===this.shapeSelect&&this.shape.points.push(t),l.socket.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!1}),this.shape.visionObstruction&&p.gameStore.recalculateBV(),i.invalidate(!1))):console.log("No active layer!")}onMouseUp(e){this.active&&null!==this.shape&&!e.altKey&&this.useGrid&&(this.shape.resizeToGrid(),l.socket.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!1})),this.active=!1}onSelect(){const e=this.getLayer();void 0!==e&&(this.brushHelper=new d.Circle(new c.GlobalPoint(-1e3,-1e3),this.brushSize/2,this.fillColour),this.setupBrush(),e.addShape(this.brushHelper,!1))}onDeselect(){const e=this.getLayer();null!==this.brushHelper&&void 0!==e&&e.removeShape(this.brushHelper,!1)}};o.__decorate([a.Watch("fillColour")],v.prototype,"onFillChange",null),o.__decorate([a.Watch("modeSelect")],v.prototype,"onModeUpdate",null),v=o.__decorate([s.default({components:{"color-picker":n.default}})],v),t.default=v},"5c63":function(e,t,i){"use strict";var o=i("6b00"),s=i.n(o);s.a},"5d0b":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o{constructor(e,t){this.children=[],this.nPrimitives=e,this.bbox=t}}t.BoundingNode=o;class s extends o{constructor(e,t,i){super(t,i),this.firstPrimOffset=e}}t.LeafNode=s;class a extends o{constructor(e,t,i){super(0,t.bbox.union(i.bbox)),this.dimension=e,this.children.push(t),this.children.push(i)}}t.InteriorNode=a},"5e7c":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("8f0a"),s=i("8db6"),a=i("2469"),n=i("92b1");class r extends a.Shape{constructor(e,t,i,o,s){super(e,"rgba(0, 0, 0, 0)",o||"#000",s),this.type="line",this.endPoint=t,this.lineWidth=void 0===i?1:i}asDict(){return Object.assign(this.getBaseDict(),{x2:this.endPoint.x,y2:this.endPoint.y,line_width:this.lineWidth})}getBoundingBox(){return new s.BoundingRect(new o.GlobalPoint(Math.min(this.refPoint.x,this.endPoint.x),Math.min(this.refPoint.x,this.endPoint.y)),Math.abs(this.refPoint.x-this.endPoint.x),Math.abs(this.refPoint.y-this.endPoint.y))}draw(e){super.draw(e),e.strokeStyle=this.strokeColour,e.beginPath(),e.moveTo(n.g2lx(this.refPoint.x),n.g2ly(this.refPoint.y)),e.lineTo(n.g2lx(this.endPoint.x),n.g2ly(this.endPoint.y)),e.lineWidth=this.lineWidth,e.stroke()}contains(e){return!1}center(e){}getCorner(e){return""}visibleInCanvas(e){return!0}snapToGrid(){}resizeToGrid(){}resize(e,t){}}t.Line=r},"5f86":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("bc3a")),a=o.__importDefault(i("a026")),n=o.__importDefault(i("8c4f"));a.default.use(n.default);const r=o.__importDefault(i("e914")),l=o.__importDefault(i("1077")),c=o.__importDefault(i("cad7")),u=o.__importDefault(i("47f7")),d=o.__importDefault(i("c6b4")),h=o.__importDefault(i("07f5")),f=o.__importDefault(i("ce87")),p=i("cc67");t.router=new n.default({mode:"history",base:"/",routes:[{path:"/",redirect:"/dashboard"},{path:"/_load",name:"load",component:u.default},{path:"/assets",component:r.default,meta:{auth:!0}},{path:"/auth",component:{template:"<router-view></router-view>"},children:[{path:"login",component:l.default},{path:"logout",component:c.default}]},{path:"/invite/:code",component:f.default,meta:{auth:!0}},{path:"/dashboard",component:d.default,meta:{auth:!0}},{path:"/game/:creator/:room",component:h.default,meta:{auth:!0}}]}),t.router.beforeEach((e,i,o)=>{p.coreStore.initialized||"/_load"===e.path?e.matched.some(e=>e.meta.auth)&&!p.coreStore.authenticated?o({path:"/auth/login",query:{redirect:e.path}}):o():(o({path:"/_load"}),s.default.get("/api/auth").then(i=>{i.data.auth&&(p.coreStore.setAuthenticated(!0),p.coreStore.setUsername(i.data.username)),p.coreStore.setInitialized(!0),t.router.push(e.path)}).catch(()=>{console.error("Authentication check could not be fulfilled.")}))})},"5fa9":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9"));let n=class extends s.default{constructor(){super(...arguments),this.name="",this.selected=!1,this.active=!1}get detailRight(){const e=this.$parent.$refs[this.name+"-selector"][0].getBoundingClientRect(),t=e.left+e.width/2;return`${window.innerWidth-Math.min(window.innerWidth-25,t+75)}px`}get detailArrow(){const e=this.$parent.$refs[this.name+"-selector"][0].getBoundingClientRect(),t=e.left+e.width/2,i=Math.min(window.innerWidth-25,t+75);return`${i-t-14}px`}created(){this.$parent.$on("mousedown",(e,t)=>{t===this.name&&this.onMouseDown(e)}),this.$parent.$on("mouseup",(e,t)=>{t===this.name&&this.onMouseUp(e)}),this.$parent.$on("mousemove",(e,t)=>{t===this.name&&this.onMouseMove(e)}),this.$parent.$on("contextmenu",(e,t)=>{t===this.name&&this.onContextMenu(e)}),this.$parent.$on("tools-select-change",(e,t)=>{t===this.name?(this.selected=!1,this.onDeselect()):e===this.name&&(this.selected=!0,this.onSelect())})}onSelect(){}onDeselect(){}onMouseDown(e){}onMouseUp(e){}onMouseMove(e){}onContextMenu(e){}};n=o.__decorate([a.default],n),t.default=n},6100:function(e,t,i){"use strict";i.r(t);var o=i("0bdb"),s=i("e94f");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("1094");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"18f17c2d",null);r.options.__file="tools.vue",t["default"]=r.exports},6465:function(e,t,i){"use strict";i.r(t);var o=i("5fa9"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},"64a9":function(e,t,i){},"6ac0":function(e,t,i){},"6b00":function(e,t,i){},"6c30":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("c266"),s=i("f10f"),a=i("92b1");class n extends o.BaseRect{constructor(e,t,i,o,s){super(t,i,o),this.type="assetrect",this.src="",void 0!==s&&(this.uuid=s),this.img=e}asDict(){return Object.assign(this.getBaseDict(),{src:this.src})}fromDict(e){super.fromDict(e),this.src=e.src}draw(e){super.draw(e);try{e.drawImage(this.img,a.g2lx(this.refPoint.x),a.g2ly(this.refPoint.y),a.g2lz(this.w),a.g2lz(this.h))}catch(t){console.warn(`Shape ${this.uuid} could not load the image ${this.src}`)}}getInitiativeRepr(){return{uuid:this.uuid,visible:!s.gameStore.IS_DM,group:!1,source:this.src,has_img:!0,effects:[],index:1/0}}}t.Asset=n},"6d53":function(e,t,i){"use strict";var o=i("e995"),s=i.n(o);s.a},"6f20":function(e,t,i){},"6f21":function(e,t,i){"use strict";var o=i("b294"),s=i.n(o);s.a},"6f8d":function(e,t,i){"use strict";i.r(t);var o=i("5b69"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},"6f92":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("8f0a"),s=i("6c30"),a=i("f10f"),n=i("92b1");class r{constructor(){this.layers=[],this.width=window.innerWidth,this.height=window.innerHeight,this.UUIDMap=new Map,this.interval=30,this.drawLoop=(()=>{for(let e=this.layers.length-1;e>=0;e--)this.layers[e].draw();requestAnimationFrame(this.drawLoop)}),requestAnimationFrame(this.drawLoop)}reset(){this.layers=[],this.UUIDMap=new Map}setWidth(e){this.width=e;for(const t of this.layers)t.canvas.width=e,t.width=e}setHeight(e){this.height=e;for(const t of this.layers)t.canvas.height=e,t.height=e}addLayer(e){this.layers.push(e),(a.gameStore.IS_DM||e.playerEditable)&&e.selectable&&a.gameStore.addLayer(e.name)}hasLayer(e){return this.layers.some(t=>t.name===e)}getLayer(e){e=void 0===e?a.gameStore.selectedLayer:e;for(const t of this.layers)if(t.name===e)return t}selectLayer(e,t=!0){let i=!1;for(const o of this.layers)o.selectable&&(i&&"fow"!==o.name?o.ctx.globalAlpha=.3:o.ctx.globalAlpha=1,e===o.name&&(a.gameStore.selectLayer({name:e,sync:t}),i=!0),o.clearSelection(),o.invalidate(!0))}getGridLayer(){return this.getLayer("grid")}hasSelection(){const e=this.getSelection();return void 0!==e&&e.length>0}getSelection(){const e=this.getLayer();if(void 0!==e)return e.selection}invalidate(){for(let e=this.layers.length-1;e>=0;e--)this.layers[e].invalidate(!0)}invalidateLight(){for(let e=this.layers.length-1;e>=0;e--)this.layers[e].isVisionLayer&&this.layers[e].invalidate(!0)}dropAsset(e){const t=this.getLayer();if(void 0===t||null===e||null===e.dataTransfer)return;const i=document.createElement("img");i.src=e.dataTransfer.getData("text/plain");const r=new s.Asset(i,new o.GlobalPoint(n.l2gx(e.clientX),n.l2gy(e.clientY)),n.l2gz(i.width),n.l2gz(i.height));if(r.src=new URL(i.src).pathname,a.gameStore.useGrid){const e=a.gameStore.gridSize;r.refPoint.x=Math.round(r.refPoint.x/e)*e,r.refPoint.y=Math.round(r.refPoint.y/e)*e,r.w=Math.max(Math.round(r.w/e)*e,e),r.h=Math.max(Math.round(r.h/e)*e,e)}t.addShape(r,!0)}}t.layerManager=new r,window.lm=t.layerManager},7018:function(e,t,i){"use strict";i.r(t);var o=i("ebb9"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},"70bb":function(e,t,i){"use strict";var o=i("6f20"),s=i.n(o);s.a},7420:function(e,t,i){"use strict";i.r(t);var o=i("0167"),s=i("778b");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("5320");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"254e8bcf",null);r.options.__file="createtoken_modal.vue",t["default"]=r.exports},"778b":function(e,t,i){"use strict";i.r(t);var o=i("5a81"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},"77a6":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("4a5b"),s=i("0bc6"),a=i("2b48"),n=i("af17"),r=i("8f0a"),l=i("6f92"),c=i("f10f"),u=i("2838");function d(e){if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement);else if("Delete"===e.key||"Del"===e.key||"Backspace"===e.key){if(void 0===l.layerManager.getLayer)return void console.log("No active layer selected for delete operation");const e=l.layerManager.getLayer();for(let t=e.selection.length-1;t>=0;t--){const i=e.selection[t];o.getRef("tools").$refs.selectTool.selectionHelper.uuid!==i.uuid?(e.removeShape(i,!0,!1),n.EventBus.$emit("SelectionInfo.Shape.Set",null),n.EventBus.$emit("Initiative.Remove",i.uuid)):e.selection.splice(t,1)}}}function h(e){if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)65===e.keyCode&&e.ctrlKey&&e.target.select();else if(e.keyCode>=37&&e.keyCode<=40){const t=Math.round(c.gameStore.gridSize);let i=t*(e.keyCode%2),o=t*(e.keyCode%2?0:1);if(l.layerManager.hasSelection()){const a=l.layerManager.getSelection();i*=e.keyCode<=38?-1:1,o*=e.keyCode<=38?-1:1;let n=new r.Vector(i,o);if(!e.shiftKey||!c.gameStore.IS_DM)for(const e of a)n=u.calculateDelta(n,e);for(const e of a)e.refPoint.x+=n.x,e.refPoint.y+=n.y,e.refPoint.x%t===0&&e.refPoint.y%t===0||e.snapToGrid(),s.socket.emit("Shape.Position.Update",{shape:e.asDict(),redraw:!0,temporary:!1});l.layerManager.getLayer().invalidate(!1)}else c.gameStore.increasePanX(i*(e.keyCode<=38?1:-1)),c.gameStore.increasePanY(o*(e.keyCode<=38?1:-1)),l.layerManager.invalidate(),a.sendClientOptions()}else if(68===e.keyCode){const e=l.layerManager.getLayer();e&&(e.clearSelection(),e.invalidate(!0))}}t.onKeyUp=d,t.onKeyDown=h},"78c7":function(e,t,i){"use strict";var o=i("9227"),s=i.n(o);s.a},"7aaa":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("033f")),n=o.__importDefault(i("7420")),r=o.__importDefault(i("59d8")),l=o.__importDefault(i("dec1")),c=o.__importDefault(i("4899")),u=o.__importDefault(i("c277")),d=i("6f92"),h=i("9cb7"),f=i("f10f"),p=i("d5df"),g=i("92b1"),m=i("5a5c"),v=o.__importDefault(i("65d9"));let y=class extends s.default{constructor(){super(...arguments),this.currentTool="Select",this.tools=["Select","Pan","Draw","Ruler","Map"],this.dmTools=["Map"]}get IS_DM(){return f.gameStore.IS_DM}get currentToolComponent(){return`${this.currentTool.toLowerCase()}-tool`}mousedown(e){if("CANVAS"!==e.target.tagName)return;let t=this.currentTool;if(1===e.button)t="Pan";else if(0!==e.button)return;this.$emit("mousedown",e,t)}mouseup(e){if("CANVAS"!==e.target.tagName)return;let t=this.currentTool;if(1===e.button)t="Pan";else if(0!==e.button)return;this.$emit("mouseup",e,t)}mousemove(e){if("CANVAS"!==e.target.tagName)return;let t=this.currentTool;if(0!==(4&e.buttons))t="Pan";else if((1&e.button)>1)return;this.$emit("mousemove",e,t);let i=!1;for(const o of f.gameStore.annotations)if(d.layerManager.UUIDMap.has(o)&&d.layerManager.hasLayer("draw")){const t=d.layerManager.UUIDMap.get(o);t.contains(g.l2g(m.getMouse(e)))&&(i=!0,h.gameManager.annotationManager.setActiveText(t.annotation))}!i&&h.gameManager.annotationManager.shown&&h.gameManager.annotationManager.setActiveText("")}mouseleave(e){0!==(1&e.buttons)&&this.$emit("mouseup",e,this.currentTool)}contextmenu(e){"CANVAS"===e.target.tagName&&2===e.button&&"CANVAS"===e.target.tagName&&this.$emit("contextmenu",e,this.currentTool)}};y=o.__decorate([v.default({components:{"select-tool":u.default,"pan-tool":c.default,"draw-tool":r.default,"ruler-tool":p.RulerTool,"map-tool":l.default,"shape-menu":a.default,"createtoken-dialog":n.default},watch:{currentTool(e,t){this.$emit("tools-select-change",e,t)}}})],y),t.default=y},"7ba5":function(e,t,i){"use strict";i.r(t);var o=i("fbdd"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},"7e15":function(e,t,i){"use strict";i.r(t);var o=i("52a8"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},"7f1e":function(e,t,i){"use strict";var o=i("fe11"),s=i.n(o);s.a},"851c":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9")),n=o.__importDefault(i("d65f"));let r=class extends s.default{constructor(){super(...arguments),this.visible=!1,this.question="",this.answer="",this.title="",this.resolve=(e=>{}),this.reject=(()=>{})}submit(){this.resolve(this.answer),this.close()}close(){this.reject(),this.visible=!1,this.question="",this.answer="",this.title=""}prompt(e,t){return this.question=e,this.title=t,this.visible=!0,this.$nextTick(()=>{this.$refs.answer.focus()}),new Promise((e,t)=>{this.resolve=e,this.reject=t})}};r=o.__decorate([a.default({components:{Modal:n.default}})],r),t.default=r},8954:function(e,t,i){"use strict";var o=i("3cf9"),s=i.n(o);s.a},"8a0e":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return null!==e.note?i("modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("span",{on:{click:function(t){e.$refs.title.select()}}},[i("i",{staticClass:"fas fa-pencil-alt",staticStyle:{"font-size":"15px"}})]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.note.title,expression:"note.title"}],ref:"title",domProps:{value:e.note.title},on:{change:e.updateNote,input:function(t){t.target.composing||e.$set(e.note,"title",t.target.value)}}}),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.note.text,expression:"note.text"}],ref:"textarea",style:{height:e.calcHeight()},domProps:{value:e.note.text},on:{change:e.updateNote,input:function(t){t.target.composing||e.$set(e.note,"text",t.target.value)}}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.removeNote}},[i("i",{staticClass:"far fa-trash-alt"}),e._v(" Remove\n    ")])])]):e._e()},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"8cd4":function(e,t,i){"use strict";i.r(t);var o=i("9587"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},"8db6":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("8f0a");class s{constructor(e,t,i){this.w=t,this.h=i,this.topLeft=e,this.topRight=new o.GlobalPoint(e.x+t,e.y),this.botRight=new o.GlobalPoint(e.x+t,e.y+i),this.botLeft=new o.GlobalPoint(e.x,e.y+i)}contains(e){return this.topLeft.x<=e.x&&this.topRight.x>=e.x&&this.topLeft.y<=e.y&&this.botLeft.y>=e.y}offset(e){return new s(this.topLeft.add(e),this.w,this.h)}union(e){const t=Math.min(this.topLeft.x,e.topLeft.x),i=Math.max(this.topRight.x,e.topRight.x),a=Math.min(this.topLeft.y,e.topLeft.y),n=Math.max(this.botLeft.y,e.botLeft.y);return new s(new o.GlobalPoint(t,a),i-t,n-a)}getDiagCorner(e){return e?this.botRight:this.topLeft}intersectsWith(e){return!(e.topLeft.x>this.topRight.x||e.topRight.x<this.topLeft.x||e.topLeft.y>this.botLeft.y||e.botLeft.y<this.topLeft.y)}intersectsWithInner(e){return!(e.topLeft.x>=this.topRight.x||e.topRight.x<=this.topLeft.x||e.topLeft.y>=this.botLeft.y||e.botLeft.y<=this.topLeft.y)}intersectP(e,t,i){let o=t.x*(this.getDiagCorner(i[0]).x-e.origin.x),s=t.x*(this.getDiagCorner(!i[0]).x-e.origin.x);const a=t.y*(this.getDiagCorner(i[1]).y-e.origin.y),n=t.y*(this.getDiagCorner(!i[1]).y-e.origin.y);return o>n||a>s?{hit:!1,min:o,max:s}:(a>o&&(o=a),n<s&&(s=n),{hit:o<e.tMax&&s>0,min:o,max:s})}center(e){if(void 0===e)return this.topLeft.add(new o.Vector(this.w/2,this.h/2));this.topLeft.x=e.x-this.w/2,this.topLeft.y=e.y-this.h/2}inCorner(e,t){const i=Math.min(6,this.w/2)/2;switch(t){case"ne":return this.topRight.x-i<=e.x&&e.x<=this.topRight.x+i&&this.topLeft.y-i<=e.y&&e.y<=this.topLeft.y+i;case"nw":return this.topLeft.x-i<=e.x&&e.x<=this.topLeft.x+i&&this.topLeft.y-i<=e.y&&e.y<=this.topLeft.y+i;case"sw":return this.topLeft.x-i<=e.x&&e.x<=this.topLeft.x+i&&this.botLeft.y-i<=e.y&&e.y<=this.botLeft.y+i;case"se":return this.topRight.x-i<=e.x&&e.x<=this.topRight.x+i&&this.botLeft.y-i<=e.y&&e.y<=this.botLeft.y+i;default:return!1}}getCorner(e){return this.inCorner(e,"ne")?"ne":this.inCorner(e,"nw")?"nw":this.inCorner(e,"se")?"se":this.inCorner(e,"sw")?"sw":void 0}getMaxExtent(){return this.w>this.h?0:1}}t.BoundingRect=s},"8e25":function(e,t,i){},"8f0a":function(e,t,i){"use strict";function o(e,t){const i=e.x-t.x,o=e.y-t.y;return Math.sqrt(i*i+o*o)}Object.defineProperty(t,"__esModule",{value:!0}),t.getPointDistance=o;class s{constructor(e,t){this.x=e,this.y=t}add(e){return new s(this.x+e.x,this.y+e.y)}subtract(e){return new r(this.x-e.x,this.y-e.y)}clone(){return new s(this.x,this.y)}get(e){return 0===e?this.x:this.y}}t.Point=s;class a extends s{add(e){return super.add(e)}subtract(e){return super.subtract(e)}clone(){return super.clone()}}t.GlobalPoint=a;class n extends s{add(e){return super.add(e)}subtract(e){return super.subtract(e)}clone(){return super.clone()}}t.LocalPoint=n;class r{constructor(e,t){this.x=e,this.y=t}dot(e){return this.x*e.x+this.y*e.y}inverse(){return new r(1/this.x,1/this.y)}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}normalize(){const e=this.length();return new r(this.x/e,this.y/e)}reverse(){return new r(-this.x,-this.y)}multiply(e){return new r(this.x*e,this.y*e)}}t.Vector=r;class l{constructor(e,t,i){this.direction=t,this.origin=e,void 0===i&&(i=1/0),this.tMax=i}static fromPoints(e,t){const i=new r(t.x-e.x,t.y-e.y);let o;return o=Math.abs(i.x)>.01?(t.x-e.x)/i.x:(t.y-e.y)/i.y,new l(e,i,o)}get(e){return new s(this.origin.x+e*this.direction.x,this.origin.y+e*this.direction.y)}getDistance(e,t){return Math.sqrt(Math.pow(t-e,2)*(Math.pow(this.direction.x,2)+Math.pow(this.direction.y,2)))}getT(e,t){return e+Math.sqrt(Math.pow(t,2)/(Math.pow(this.direction.x,2)+Math.pow(this.direction.y,2)))}}t.Ray=l},"91df":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9")),n=o.__importDefault(i("6f79"));i("fe80");const r=i("2ef0"),l=o.__importDefault(i("a535")),c=o.__importDefault(i("cec2")),u=o.__importDefault(i("f5fe")),d=o.__importDefault(i("19f9")),h=o.__importDefault(i("f551")),f=o.__importDefault(i("f086")),p=o.__importDefault(i("6100")),g=i("0bc6"),m=i("77a6"),v=i("bb17"),y=i("6f92"),b=i("f10f"),_=i("92b1"),S=i("8f0a");let x=class extends s.default{constructor(){super(...arguments),this.ready={manager:!1,tools:!1}}get IS_DM(){return b.gameStore.IS_DM}get layers(){return b.gameStore.layers}get selectedLayer(){return b.gameStore.selectedLayer}get zoomFactor(){return b.gameStore.zoomFactor}set zoomFactor(e){b.gameStore.updateZoom({newZoomValue:e,zoomLocation:_.l2g(new S.LocalPoint(window.innerWidth/2,window.innerHeight/2))})}mounted(){window.addEventListener("resize",()=>{y.layerManager.setWidth(window.innerWidth),y.layerManager.setHeight(window.innerHeight),y.layerManager.invalidate()}),window.addEventListener("wheel",r.throttle(v.scrollZoom)),window.addEventListener("keyup",m.onKeyUp),window.addEventListener("keydown",m.onKeyDown),window.addEventListener("selectstart",e=>{return e.preventDefault(),!1}),this.ready.manager=!0}mousedown(e){this.$refs.tools.mousedown(e)}mouseup(e){this.$refs.tools.mouseup(e)}mousemove(e){this.$refs.tools.mousemove(e)}mouseleave(e){this.$refs.tools.mouseleave(e)}contextmenu(e){this.$refs.tools.contextmenu(e)}selectLayer(e){y.layerManager.selectLayer(e)}drop(e){if(null!==e&&null!==e.dataTransfer)if(e.dataTransfer.files.length>0)this.$refs.confirm.open("Uploading files should be done through the asset manager.","Ok","").then(()=>{},()=>{});else{if(""===e.dataTransfer.getData("text/plain"))return;y.layerManager.dropAsset(e)}}};x=o.__decorate([a.default({components:{"tool-bar":p.default,"selection-info":f.default,"prompt-dialog":c.default,"confirm-dialog":l.default,"menu-bar":d.default,"initiative-dialog":u.default,"zoom-slider":n.default,"note-dialog":h.default},beforeRouteEnter(e,t,i){g.createConnection(e),i()},beforeRouteLeave(e,t,i){g.socket.disconnect(),i()}})],x),t.default=x},9227:function(e,t,i){},"92b1":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("8f0a"),s=i("f10f");function a(e){const t=s.gameStore.zoomFactor,i=s.gameStore.panX,a=s.gameStore.panY;return new o.LocalPoint((e.x+i)*t,(e.y+a)*t)}function n(e){return a(new o.GlobalPoint(e,0)).x}function r(e){return a(new o.GlobalPoint(0,e)).y}function l(e){return e*s.gameStore.zoomFactor}function c(e){return e/s.gameStore.unitSize*s.gameStore.gridSize}function u(e){return l(c(e))}function d(e){const t=s.gameStore.zoomFactor,i=s.gameStore.panX,a=s.gameStore.panY;return e instanceof o.LocalPoint?new o.GlobalPoint(e.x/t-i,e.y/t-a):new o.Ray(d(e.origin),e.direction.multiply(1/t),e.tMax)}function h(e){return d(new o.LocalPoint(e,0)).x}function f(e){return d(new o.LocalPoint(0,e)).y}function p(e){return e/s.gameStore.zoomFactor}function g(e){return p(c(e))}t.g2l=a,t.g2lx=n,t.g2ly=r,t.g2lz=l,t.getUnitDistance=c,t.g2lr=u,t.l2g=d,t.l2gx=h,t.l2gy=f,t.l2gz=p,t.l2gr=g},"93d8":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"modal"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"mask",class:{"modal-mask":e.mask,"dialog-mask":!e.mask},on:{click:e.close,dragover:function(t){return t.preventDefault(),e.dragOver(t)}}},[i("div",{ref:"container",staticClass:"modal-container",on:{click:function(e){e.stopPropagation()}}},[e._t("header",null,{dragStart:e.dragStart,dragEnd:e.dragEnd}),e._t("default")],2)])])},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"950d":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"AssetManager"}},[i("div",{attrs:{id:"titlebar"}},[e._v("Asset Manager")]),i("div",{attrs:{id:"main"}},[i("div",{attrs:{id:"assets"},on:{dragover:function(t){return t.preventDefault(),e.moveDrag(t)},drop:function(t){t.preventDefault(),t.stopPropagation(),e.stopDrag(t,e.currentFolder)}}},[i("div",{attrs:{id:"breadcrumbs"}},[i("div",[e._v("/")]),e._l(e.path,function(t){return i("div",{key:t},[e._v(e._s(e.idMap.get(t).name))])})],2),i("div",{attrs:{id:"actionbar"}},[i("input",{attrs:{id:"files",type:"file",multiple:"",hidden:""},on:{change:function(t){e.upload()}}}),i("div",{attrs:{title:"Create folder"},on:{click:e.createDirectory}},[i("i",{staticClass:"fas fa-plus-square"})]),i("div",{attrs:{title:"Upload files"},on:{click:e.prepareUpload}},[i("i",{staticClass:"fas fa-upload"})])]),i("div",{attrs:{id:"explorer"}},[e.path.length?i("div",{staticClass:"inode folder",on:{dblclick:function(t){e.changeDirectory(-1)},dragover:function(t){return t.preventDefault(),e.moveDrag(t)},dragleave:function(t){return t.preventDefault(),e.leaveDrag(t)},drop:function(t){t.preventDefault(),t.stopPropagation(),e.stopDrag(t,e.parentFolder)}}},[i("i",{staticClass:"fas fa-folder",staticStyle:{"font-size":"50px"}}),i("div",{staticClass:"title"},[e._v("..")])]):e._e(),e._l(e.folders,function(t){return i("div",{key:t,staticClass:"inode folder",class:{"inode-selected":e.selected.includes(t)},attrs:{draggable:"true"},on:{click:function(i){e.select(i,t)},dblclick:function(i){e.changeDirectory(t)},contextmenu:function(i){i.preventDefault(),e.$refs.cm.open(i,t)},dragstart:function(i){e.startDrag(i,t)},dragover:function(t){return t.preventDefault(),e.moveDrag(t)},dragleave:function(t){return t.preventDefault(),e.leaveDrag(t)},drop:function(i){i.preventDefault(),i.stopPropagation(),e.stopDrag(i,t)}}},[i("i",{staticClass:"fas fa-folder",staticStyle:{"font-size":"50px"}}),i("div",{staticClass:"title"},[e._v(e._s(e.idMap.get(t).name))])])}),e._l(e.files,function(t){return i("div",{key:t,staticClass:"inode file",class:{"inode-selected":e.selected.includes(t)},attrs:{draggable:"true"},on:{click:function(i){e.select(i,t)},contextmenu:function(i){i.preventDefault(),e.$refs.cm.open(i,t)},dragstart:function(i){e.startDrag(i,t)}}},[i("img",{attrs:{src:"/static/assets/"+e.idMap.get(t).file_hash,width:"50"}}),i("div",{staticClass:"title"},[e._v(e._s(e.idMap.get(t).name))])])})],2)]),e.firstSelectedFile?i("div",{attrs:{id:"asset-details"}},[i("div",{attrs:{id:"asset-detail-title"}},[e._v(e._s(e.firstSelectedFile.name))]),i("img",{attrs:{src:"/static/assets/"+e.firstSelectedFile.file_hash}})]):e._e()]),i("AssetContextMenu",{ref:"cm"}),i("Prompt",{ref:"prompt"}),i("ConfirmDialog",{ref:"confirm"})],1)},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},9587:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9")),n=i("2f62"),r=o.__importDefault(i("3b36")),l=o.__importDefault(i("0ddd")),c=i("4a5b"),u=i("0bc6"),d=i("f10f");let h=class extends s.default{constructor(){super(...arguments),this.visible={settings:!1,locations:!1}}get useGrid(){return d.gameStore.useGrid}set useGrid(e){d.gameStore.setUseGrid({useGrid:e,sync:!0})}get fullFOW(){return d.gameStore.fullFOW}set fullFOW(e){d.gameStore.setFullFOW({fullFOW:e,sync:!0})}get fowOpacity(){return d.gameStore.fowOpacity}set fowOpacity(e){"number"===typeof e&&d.gameStore.setFOWOpacity({fowOpacity:e,sync:!0})}get fowLOS(){return d.gameStore.fowLOS}set fowLOS(e){d.gameStore.setLineOfSight({fowLOS:e,sync:!0})}get unitSize(){return d.gameStore.unitSize}set unitSize(e){"number"===typeof e&&d.gameStore.setUnitSize({unitSize:e,sync:!0})}get gridSize(){return d.gameStore.gridSize}set gridSize(e){"number"===typeof e&&d.gameStore.setGridSize({gridSize:e,sync:!0})}get gridColour(){return d.gameStore.gridColour}set gridColour(e){d.gameStore.setGridColour({colour:e,sync:!0})}get fowColour(){return d.gameStore.fowColour}set fowColour(e){d.gameStore.setFOWColour({colour:e,sync:!0})}get rulerColour(){return d.gameStore.rulerColour}set rulerColour(e){d.gameStore.setRulerColour({colour:e,sync:!0})}settingsClick(e){if(e.target.classList.contains("accordion")){e.target.classList.toggle("accordion-active");const t=e.target.nextElementSibling;null!==t&&(t.style.display=""===t.style.display?"block":"")}}changeLocation(e){u.socket.emit("Location.Change",e)}createLocation(){c.getRef("prompt").prompt("New location name:","Create new location").then(e=>{u.socket.emit("Location.New",e)},()=>{})}createNote(){const e={title:"New note",text:"",uuid:c.uuidv4()};d.gameStore.newNote({note:e,sync:!0}),this.openNote(e)}openNote(e){c.getRef("note").open(e)}};h=o.__decorate([a.default({components:{"color-picker":r.default,"asset-node":l.default},computed:Object.assign({},n.mapState("game",["invitationCode","IS_DM","locations","assets","notes"]))})],h),t.default=h},"979e":function(e,t,i){"use strict";i.r(t);var o=i("0634"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},9896:function(e,t,i){"use strict";var o=i("b6f3"),s=i.n(o);s.a},"9a7c":function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div")},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},"9cb7":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("4a5b"),s=i("2b48"),a=i("6f92"),n=i("206a"),r=i("f10f"),l=i("1625"),c=i("92b1");class u{constructor(){this.selectedTool=0,this.annotationManager=new l.AnnotationManager}addShape(e){if(!a.layerManager.hasLayer(e.layer))return void console.log(`Shape with unknown layer ${e.layer} could not be added`);const t=a.layerManager.getLayer(e.layer),i=n.createShapeFromDict(e);void 0!==i?(t.addShape(i,!1),t.invalidate(!1)):console.log(`Shape with unknown type ${e.type_} could not be added`)}updateShape(e){if(!a.layerManager.hasLayer(e.shape.layer))return void console.log(`Shape with unknown layer ${e.shape.layer} could not be added`);const t=n.createShapeFromDict(e.shape,!0);if(void 0===t)return void console.log(`Shape with unknown type ${e.shape.type_} could not be added`);const i=a.layerManager.UUIDMap.get(e.shape.uuid);if(void 0===i)return void console.log("Shape with unknown id could not be updated");const s=t.owners!==i.owners,l=Object.assign(i,t);l.checkVisionSources(),l.setMovementBlock(l.movementObstruction),l.setIsToken(l.isToken),e.move&&l.visionObstruction&&r.gameStore.recalculateBV(),e.redraw&&a.layerManager.getLayer(e.shape.layer).invalidate(!1),s&&o.getRef("initiative").$forceUpdate()}setCenterPosition(e){const t=c.g2l(e);r.gameStore.increasePanX((window.innerWidth/2-t.x)/r.gameStore.zoomFactor),r.gameStore.increasePanY((window.innerHeight/2-t.y)/r.gameStore.zoomFactor),a.layerManager.invalidate(),s.sendClientOptions()}}t.GameManager=u,t.gameManager=new u,window.gameManager=t.gameManager},a097:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9"));let n=class extends s.default{constructor(){super(...arguments),this.message="Loading..."}};n=o.__decorate([a.default],n),t.default=n},a260:function(e,t,i){},a450:function(e,t,i){},a474:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("bc3a")),a=o.__importDefault(i("a026")),n=o.__importDefault(i("65d9")),r=i("cc67");n.default.registerHooks(["beforeRouteEnter"]);let l=class extends a.default{constructor(){super(...arguments),this.owned=[],this.joined=[],this.error="",this.newSessionName=""}beforeRouteEnter(e,t,i){s.default.get("/api/rooms").then(e=>{i(t=>{t.owned=e.data.owned,t.joined=e.data.joined})}).catch(e=>{i(t=>{t.error=e.message})})}createRoom(e){s.default.post("/api/rooms",{name:this.newSessionName}).then(e=>{this.$router.push(`/game/${r.coreStore.username}/${this.newSessionName}`)}).catch(e=>{this.error=e.message})}};l=o.__decorate([n.default],l),t.default=l},a535:function(e,t,i){"use strict";i.r(t);var o=i("1b45"),s=i("f30c");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("d16e");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"94ad04e6",null);r.options.__file="confirm.vue",t["default"]=r.exports},a57a:function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible},on:{close:e.close},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v(e._s(e.title))])}}])},[i("div",{staticClass:"modal-body"},[e._v("\n    "+e._s(e.question)+"\n    "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.answer,expression:"answer"}],ref:"answer",attrs:{type:"text"},domProps:{value:e.answer},on:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.submit(t):null},input:function(t){t.target.composing||(e.answer=t.target.value)}}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.submit}},[e._v("Submit")])])])},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},a68b:function(e,t,i){"use strict";i.r(t);var o=i("308b"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},aa69:function(e,t,i){"use strict";i.r(t);var o=i("0cf7"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},af17:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026"));t.EventBus=new s.default},b0ac:function(e,t,i){"use strict";i.r(t);var o=i("a474"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},b294:function(e,t,i){},b2ed:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("c266"),s=i("f10f"),a=i("92b1"),n=i("5a5c");class r extends o.BaseRect{constructor(e,t,i,o,s,a){super(e,t,i,o,s,a),this.type="rect"}asDict(){return super.getBaseDict()}draw(e){super.draw(e),"fog"===this.fillColour?e.fillStyle=n.getFogColour():e.fillStyle=this.fillColour;const t=s.gameStore.zoomFactor,i=a.g2l(this.refPoint);e.fillRect(i.x,i.y,this.w*t,this.h*t),"rgba(0, 0, 0, 0)"!==this.strokeColour&&(e.strokeStyle=this.strokeColour,e.lineWidth=5,e.strokeRect(i.x,i.y,this.w*t,this.h*t))}}t.Rect=r},b6f3:function(e,t,i){},b809:function(e,t,i){"use strict";i.r(t);var o=i("ca56"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},b906:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("8f0a"),s=i("bab4"),a=i("6f92"),n=i("d1ec"),r=i("f10f"),l=i("92b1");class c extends s.Layer{constructor(){super(...arguments),this.isVisionLayer=!0}draw(){if(!this.valid){const e=this.ctx;if(!r.gameStore.fowLOS||n.Settings.skipPlayerFOW)return e.clearRect(0,0,this.canvas.width,this.canvas.height),void(this.valid=!0);e.clearRect(0,0,this.canvas.width,this.canvas.height);const t=e.globalCompositeOperation;e.fillStyle="rgba(0, 0, 0, 1)",r.gameStore.IS_DM||super.draw(!r.gameStore.fullFOW);const i=e.canvas.width+e.canvas.height;for(const s of r.gameStore.ownedtokens){e.beginPath();let t=-1;const c=a.layerManager.UUIDMap.get(s);if(void 0===c)continue;const u=c.center(),d=l.g2l(u);for(let s=0;s<2*Math.PI;s+=n.Settings.angleSteps/2/180*Math.PI){const a=Math.cos(s),n=Math.sin(s),c=new o.Ray(u,new o.Vector(a,n)),h=r.gameStore.BV.intersect(c);h.hit?(-1!==t&&(e.arc(d.x,d.y,i,t,s),t=-1),e.lineTo(l.g2lx(h.intersect.x),l.g2ly(h.intersect.y))):-1===t&&(e.lineTo(d.x+i*a,d.y+i*n),t=s)}-1!==t?e.arc(d.x,d.y,i,t,2*Math.PI):e.closePath(),e.fill()}r.gameStore.IS_DM&&super.draw(!r.gameStore.fullFOW),e.globalCompositeOperation=t}}}t.FOWPlayersLayer=c},ba53:function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Edit asset")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("label",{attrs:{for:"shapeselectiondialog-name"}},[e._v("Name")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.shape.name,expression:"shape.name"}],staticStyle:{"grid-column":"numerator / end"},attrs:{type:"text",id:"shapeselectiondialog-name"},domProps:{value:e.shape.name},on:{change:function(t){e.updateShape(!1)},input:function(t){t.target.composing||e.$set(e.shape,"name",t.target.value)}}}),i("label",{attrs:{for:"shapeselectiondialog-istoken"}},[e._v("Is a token")]),i("input",{staticStyle:{"grid-column-start":"remove",width:"15px",height:"15px"},attrs:{type:"checkbox",id:"shapeselectiondialog-istoken"},domProps:{checked:e.shape.isToken},on:{click:e.setToken}}),i("label",{attrs:{for:"shapeselectiondialog-visionblocker"}},[e._v("Blocks vision/light")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.shape.visionObstruction,expression:"shape.visionObstruction"}],staticStyle:{"grid-column-start":"remove",width:"15px",height:"15px"},attrs:{type:"checkbox",id:"shapeselectiondialog-visionblocker"},domProps:{checked:Array.isArray(e.shape.visionObstruction)?e._i(e.shape.visionObstruction,null)>-1:e.shape.visionObstruction},on:{change:[function(t){var i=e.shape.visionObstruction,o=t.target,s=!!o.checked;if(Array.isArray(i)){var a=null,n=e._i(i,a);o.checked?n<0&&e.$set(e.shape,"visionObstruction",i.concat([a])):n>-1&&e.$set(e.shape,"visionObstruction",i.slice(0,n).concat(i.slice(n+1)))}else e.$set(e.shape,"visionObstruction",s)},e.setVisionBlocker]}}),i("label",{attrs:{for:"shapeselectiondialog-moveblocker"}},[e._v("Blocks movement")]),i("input",{staticStyle:{"grid-column-start":"remove",width:"15px",height:"15px"},attrs:{type:"checkbox",id:"shapeselectiondialog-moveblocker"},domProps:{checked:e.shape.movementObstruction},on:{click:e.setMovementBlocker}}),i("div",{staticClass:"spanrow header"},[e._v("Access")]),e._l(e.shape.owners,function(t){return[i("input",{key:t,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name"},domProps:{value:t},on:{change:function(i){e.updateOwner(i,t)}}}),""!==t?i("div",{key:"remove-"+t,staticStyle:{"grid-column-start":"remove"},on:{click:function(i){e.removeOwner(t)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]}),i("div",{staticClass:"spanrow header"},[e._v("Trackers")]),e._l(e.shape.trackers,function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"tracker.name"}],key:"name-"+t.uuid,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name"},domProps:{value:t.name},on:{change:function(t){e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"name",i.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.value,expression:"tracker.value",modifiers:{number:!0}}],key:"value-"+t.uuid,attrs:{type:"text",title:"Current value"},domProps:{value:t.value},on:{change:function(t){e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"value",e._n(i.target.value))},blur:function(t){e.$forceUpdate()}}}),i("span",{key:"fspan-"+t.uuid},[e._v("/")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.maxvalue,expression:"tracker.maxvalue",modifiers:{number:!0}}],key:"maxvalue-"+t.uuid,attrs:{type:"text",title:"Current value"},domProps:{value:t.maxvalue},on:{change:function(t){e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"maxvalue",e._n(i.target.value))},blur:function(t){e.$forceUpdate()}}}),i("span",{key:"sspan-"+t.uuid}),i("div",{key:"visibility-"+t.uuid,style:{opacity:t.visible?1:.3},on:{click:function(i){t.visible=!t.visible,e.updateShape(!1)}}},[i("i",{staticClass:"fas fa-eye"})]),i("span",{key:"tspan-"+t.uuid}),""!==t.name||0!==t.value?i("div",{key:"remove-"+t.uuid,on:{click:function(i){e.removeTracker(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]}),i("div",{staticClass:"spanrow header"},[e._v("Auras")]),e._l(e.shape.auras,function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"aura.name"}],key:"name-"+t.uuid,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name"},domProps:{value:t.name},on:{change:function(t){e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"name",i.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.value,expression:"aura.value",modifiers:{number:!0}}],key:"value-"+t.uuid,attrs:{type:"text",title:"Current value"},domProps:{value:t.value},on:{change:function(t){e.updateShape(!0)},input:function(i){i.target.composing||e.$set(t,"value",e._n(i.target.value))},blur:function(t){e.$forceUpdate()}}}),i("span",{key:"fspan-"+t.uuid},[e._v("/")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.dim,expression:"aura.dim",modifiers:{number:!0}}],key:"dimvalue-"+t.uuid,attrs:{type:"text",title:"Dim value"},domProps:{value:t.dim},on:{change:function(t){e.updateShape(!0)},input:function(i){i.target.composing||e.$set(t,"dim",e._n(i.target.value))},blur:function(t){e.$forceUpdate()}}}),i("color-picker",{key:"colour-"+t.uuid,attrs:{color:t.colour},on:{"update:color":function(i){e.$set(t,"colour",i)},input:function(i){e.updateAuraColour(t,i)},change:function(t){e.updateShape(!0)}}}),i("div",{key:"visibility-"+t.uuid,style:{opacity:t.visible?1:.3},on:{click:function(i){t.visible=!t.visible,e.updateShape(!0)}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{key:"visionsource-"+t.uuid,style:{opacity:t.visionSource?1:.3},on:{click:function(i){e.updateAuraVisionSource(t)}}},[i("i",{staticClass:"fas fa-lightbulb"})]),""!==t.name||0!==t.value?i("div",{key:"remove-"+t.uuid,on:{click:function(i){e.removeAura(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]}),i("div",{staticClass:"spanrow header"},[e._v("Annotation")]),i("textarea",{staticClass:"spanrow",domProps:{value:e.shape.annotation},on:{change:e.updateAnnotation}})],2)])},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},bab4:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("0bc6"),s=i("af17"),a=i("6f92"),n=i("206a"),r=i("f10f"),l=i("92b1");class c{constructor(e,t){this.selectable=!1,this.playerEditable=!1,this.isVisionLayer=!1,this.valid=!1,this.shapes=[],this.selection=[],this.selectionColor="#CC0000",this.selectionWidth=2,this.canvas=e,this.name=t,this.width=e.width,this.height=e.height,this.ctx=e.getContext("2d")}invalidate(e){this.valid=!1,e||a.layerManager.invalidateLight()}addShape(e,t,i){void 0===i&&(i=!1),e.layer=this.name,this.shapes.push(e),a.layerManager.UUIDMap.set(e.uuid,e),e.checkVisionSources(),e.setMovementBlock(e.movementObstruction),e.ownedBy(r.gameStore.username)&&e.isToken&&r.gameStore.ownedtokens.push(e.uuid),e.annotation.length&&r.gameStore.annotations.push(e.uuid),t&&o.socket.emit("Shape.Add",{shape:e.asDict(),temporary:i}),this.invalidate(!t)}setShapes(e){for(const t of e){const e=n.createShapeFromDict(t);if(void 0===e)return void console.log(`Shape with unknown type ${t.type_} could not be added`);this.addShape(e,!1,!1)}this.clearSelection(),this.invalidate(!1)}removeShape(e,t,i){void 0===i&&(i=!1),this.shapes.splice(this.shapes.indexOf(e),1),t&&o.socket.emit("Shape.Remove",{shape:e,temporary:i});const s=r.gameStore.visionSources.findIndex(t=>t.shape===e.uuid),n=r.gameStore.visionBlockers.findIndex(t=>t===e.uuid),l=r.gameStore.movementblockers.findIndex(t=>t===e.uuid),c=r.gameStore.annotations.findIndex(t=>t===e.uuid);s>=0&&r.gameStore.visionSources.splice(s,1),n>=0&&r.gameStore.visionBlockers.splice(n,1),l>=0&&r.gameStore.movementblockers.splice(l,1),c>=0&&r.gameStore.annotations.splice(c,1);const u=r.gameStore.annotations.indexOf(e.uuid);u>=0&&r.gameStore.annotations.splice(u,1);const d=r.gameStore.ownedtokens.indexOf(e.uuid);d>=0&&r.gameStore.ownedtokens.splice(d,1),a.layerManager.UUIDMap.delete(e.uuid);const h=this.selection.indexOf(e);h>=0&&this.selection.splice(h,1),n>=0&&r.gameStore.recalculateBV(),this.invalidate(!t)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}clearSelection(){this.selection=[],s.EventBus.$emit("SelectionInfo.Shape.Set",null)}draw(e){if(!this.valid){const t=this.ctx,i=t.globalCompositeOperation;e=void 0===e||e,e&&this.clear();const o=this;if(this.shapes.forEach(e=>{e.options.has("skipDraw")&&e.options.get("skipDraw")||void 0!==a.layerManager.getLayer()&&e.visibleInCanvas(o.canvas)&&("fow"===o.name&&e.visionObstruction&&a.layerManager.getLayer().name!==o.name||e.drawAuras(t))}),this.shapes.forEach(e=>{e.options.has("skipDraw")&&e.options.get("skipDraw")||void 0!==a.layerManager.getLayer()&&e.visibleInCanvas(o.canvas)&&("fow"===o.name&&e.visionObstruction&&a.layerManager.getLayer().name!==o.name||e.draw(t))}),null!=this.selection){t.fillStyle=this.selectionColor,t.strokeStyle=this.selectionColor,t.lineWidth=this.selectionWidth;const e=r.gameStore.zoomFactor;this.selection.forEach(i=>{t.globalCompositeOperation=i.globalCompositeOperation;const o=i.getBoundingBox();t.strokeRect(l.g2lx(o.topLeft.x),l.g2ly(o.topLeft.y),o.w*e,o.h*e);const s=Math.min(6,o.w/2);t.fillRect(l.g2lx(o.topRight.x-s/2),l.g2ly(o.topLeft.y-s/2),s*e,s*e),t.fillRect(l.g2lx(o.topLeft.x-s/2),l.g2ly(o.topLeft.y-s/2),s*e,s*e),t.fillRect(l.g2lx(o.topRight.x-s/2),l.g2ly(o.botLeft.y-s/2),s*e,s*e),t.fillRect(l.g2lx(o.topLeft.x-s/2),l.g2ly(o.botLeft.y-s/2),s*e,s*e)})}t.globalCompositeOperation=i,this.valid=!0}}moveShapeOrder(e,t,i){const s=this.shapes.indexOf(e);s!==t&&(this.shapes.splice(s,1),this.shapes.splice(t,0,e),i&&o.socket.emit("Shape.Order.Set",{shape:e.asDict(),index:t}),this.invalidate(!0))}onShapeMove(e){e.checkVisionSources(),e.visionObstruction&&r.gameStore.recalculateBV(),this.invalidate(!1)}}t.Layer=c},bb17:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("f10f"),s=i("92b1"),a=i("5a5c");function n(e){if(!e.target||!e.target.tagName||"CANVAS"!==e.target.tagName)return;let t;t=-1*Math.sign(e.deltaY),o.gameStore.updateZoom({newZoomValue:o.gameStore.zoomFactor+.1*t,zoomLocation:s.l2g(a.getMouse(e))})}t.scrollZoom=n},bc19:function(e,t,i){},be21:function(e,t,i){},c266:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("8f0a"),s=i("8db6"),a=i("2469"),n=i("f10f"),r=i("2838"),l=i("92b1");class c extends a.Shape{constructor(e,t,i,o,s,a){super(e,o,s,a),this.w=t,this.h=i}getBaseDict(){return Object.assign(super.getBaseDict(),{width:this.w,height:this.h})}getBoundingBox(){return new s.BoundingRect(this.refPoint,this.w,this.h)}contains(e){return this.refPoint.x<=e.x&&this.refPoint.x+this.w>=e.x&&this.refPoint.y<=e.y&&this.refPoint.y+this.h>=e.y}inCorner(e,t){switch(t){case"ne":return this.refPoint.x+this.w-3<=e.x&&e.x<=this.refPoint.x+this.w+3&&this.refPoint.y-3<=e.y&&e.y<=this.refPoint.y+3;case"nw":return this.refPoint.x-3<=e.x&&e.x<=this.refPoint.x+3&&this.refPoint.y-3<=e.y&&e.y<=this.refPoint.y+3;case"sw":return this.refPoint.x-3<=e.x&&e.x<=this.refPoint.x+3&&this.refPoint.y+this.h-3<=e.y&&e.y<=this.refPoint.y+this.h+3;case"se":return this.refPoint.x+this.w-3<=e.x&&e.x<=this.refPoint.x+this.w+3&&this.refPoint.y+this.h-3<=e.y&&e.y<=this.refPoint.y+this.h+3;default:return!1}}getCorner(e){return this.inCorner(e,"ne")?"ne":this.inCorner(e,"nw")?"nw":this.inCorner(e,"se")?"se":this.inCorner(e,"sw")?"sw":void 0}center(e){if(void 0===e)return this.refPoint.add(new o.Vector(this.w/2,this.h/2));this.refPoint.x=e.x-this.w/2,this.refPoint.y=e.y-this.h/2}visibleInCanvas(e){if(super.visibleInCanvas(e))return!0;const t=!(l.g2lx(this.refPoint.x)>e.width||l.g2ly(this.refPoint.y)>e.height||l.g2lx(this.refPoint.x+this.w)<0||l.g2ly(this.refPoint.y+this.h)<0);return!!t}snapToGrid(){const e=n.gameStore.gridSize,t=this.center(),i=t.x,s=t.y;let a,l;a=this.w/e%2===0?Math.round(i/e)*e-this.w/2:(Math.round((i+e/2)/e)-.5)*e-this.w/2,l=this.h/e%2===0?Math.round(s/e)*e-this.h/2:(Math.round((s+e/2)/e)-.5)*e-this.h/2;const c=r.calculateDelta(new o.Vector(a-this.refPoint.x,l-this.refPoint.y),this);this.refPoint=this.refPoint.add(c),this.invalidate(!1)}resizeToGrid(){const e=n.gameStore.gridSize;this.refPoint.x=Math.round(this.refPoint.x/e)*e,this.refPoint.y=Math.round(this.refPoint.y/e)*e,this.w=Math.max(Math.round(this.w/e)*e,e),this.h=Math.max(Math.round(this.h/e)*e,e),this.invalidate(!1)}resize(e,t){const i=n.gameStore.zoomFactor;"nw"===e?(this.w=l.g2lx(this.refPoint.x)+this.w*i-t.x,this.h=l.g2ly(this.refPoint.y)+this.h*i-t.y,this.refPoint=l.l2g(t)):"ne"===e?(this.w=t.x-l.g2lx(this.refPoint.x),this.h=l.g2ly(this.refPoint.y)+this.h*i-t.y,this.refPoint.y=l.l2gy(t.y)):"se"===e?(this.w=t.x-l.g2lx(this.refPoint.x),this.h=t.y-l.g2ly(this.refPoint.y)):"sw"===e&&(this.w=l.g2lx(this.refPoint.x)+this.w*i-t.x,this.h=t.y-l.g2ly(this.refPoint.y),this.refPoint.x=l.l2gx(t.x)),this.w/=i,this.h/=i,this.w<0&&(this.refPoint.x+=this.w,this.w=Math.abs(this.w)),this.h<0&&(this.refPoint.y+=this.h,this.h=Math.abs(this.h))}}t.BaseRect=c},c277:function(e,t,i){"use strict";i.r(t);var o=i("4133"),s=i("e27a");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,null,null);r.options.__file="select.vue",t["default"]=r.exports},c43c:function(e,t,i){"use strict";var o=i("bc19"),s=i.n(o);s.a},c6b4:function(e,t,i){"use strict";i.r(t);var o=i("4444"),s=i("b0ac");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("3116");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"3430ab3a",null);r.options.__file="main.vue",t["default"]=r.exports},c71e:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("4a5b"),s=i("5d0b"),a=i("6f92"),n=i("8db6"),r=i("92b1"),l=i("f10f");class c{constructor(e){if(this.totalNodes=0,this.buildData=[],this.orderedPrims=[],this.nodes=[],this.offset=0,this.shapes=e,0===this.shapes.length)return this.root=null,void(this.nodes=[]);for(let i=0;i<e.length;i++){const o=a.layerManager.UUIDMap.get(e[i]);try{this.buildData.push({index:i,bbox:o.getBoundingBox(),center:new n.BoundingRect(o.center(),0,0)})}catch(t){throw console.warn(`Shape ${o.type} - ${o.uuid} cannot be used for vision blocking !!!`),o.visionObstruction=!1,l.gameStore.visionBlockers.splice(i,1),new Error}}this.root=this.recursiveBuild(0,e.length),this.compact()}draw(){const e=a.layerManager.getLayer("draw").ctx;for(const t of this.nodes){const i=t.bbox;e.strokeRect(r.g2lx(i.topLeft.x),r.g2ly(i.topLeft.y),r.g2lz(i.w),r.g2lz(i.h))}}recursiveBuild(e,t){this.totalNodes++;let i=this.buildData[e].bbox;for(let o=e+1;o<t;o++)i=i.union(this.buildData[o].bbox);const a=t-e;if(1===a)return this.createLeaf(e,t,a,i);{let n=this.buildData[e].center;for(let i=e;i<t;i++)n=n.union(this.buildData[i].center);const r=n.getMaxExtent();if(n.botRight.get(r)===n.topLeft.get(r))return this.createLeaf(e,t,a,i);const l=.5*(n.topLeft.get(r)+n.botRight.get(r)),c=o.partition(this.buildData.slice(e,t),e=>e.center.center().get(r)<l),u=[].concat.apply([],c);0!==c[0].length&&0!==c[1].length||console.log("EMPTY"),this.buildData.splice(e,u.length,...u);const d=c[0].length+e;return new s.InteriorNode(r,this.recursiveBuild(e,d),this.recursiveBuild(d,t))}}intersect(e,t){if(0===this.nodes.length)return{hit:!1,intersect:e.get(0),tMin:0,tMax:e.tMax};void 0===t&&(t=!1);let i=!1,o=0,s=e.tMax,a=0,n=0;const r=[],l=e.direction.inverse(),c=[l.x<0,l.y<0];while(1){const u=this.nodes[n],d=u.bbox.intersectP(e,l,c);if(d.hit)if(u.nPrimitives>0){if(i=!0,o=e.tMax=d.min,s=d.max,0===a||t)break;n=r[--a]}else c[u.dimension]?(r[a++]=n+1,n=u.secondChildOffset):(r[a++]=u.secondChildOffset,n++);else{if(0===a)break;n=r[--a]}}return{hit:i,intersect:e.get(o),tMin:o,tMax:s}}compact(){this.offset=0,null!==this.root&&this.flatten(this.root)}flatten(e){const t=this.offset,i=this.offset++;if(0===e.nPrimitives){this.flatten(e.children[0]);const i=this.flatten(e.children[1]);this.nodes[t]={bbox:e.bbox,dimension:e.dimension,nPrimitives:0,secondChildOffset:i}}else this.nodes[t]={bbox:e.bbox,primitivesOffset:e.firstPrimOffset,nPrimitives:e.nPrimitives};return i}createLeaf(e,t,i,o){const a=this.orderedPrims.length;for(let s=e;s<t;s++)this.orderedPrims.push(this.shapes[this.buildData[s].index]);return new s.LeafNode(a,i,o)}}t.BoundingVolume=c},c85f:function(e,t,i){"use strict";var o=i("be21"),s=i.n(o);s.a},c867:function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"outer",on:{click:function(t){return t.target!==t.currentTarget?null:e.open(t)}}},[i("div",{staticClass:"current-color",style:e.transparent?"background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)":"background-color:"+e.color,on:{click:function(t){return t.target!==t.currentTarget?null:e.open(t)}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.display,expression:"display"}],staticClass:"mask",on:{click:function(t){return t.target!==t.currentTarget?null:e.closePicker(t)}}}),i("chrome-picker",{directives:[{name:"show",rawName:"v-show",value:e.display,expression:"display"}],ref:"chromePicker",style:{position:"fixed",left:e.left+"px",top:e.top+"px","z-index":9999},attrs:{value:e.color,tabindex:"-1"},on:{input:e.updateColor}})],1)},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},ca56:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9")),n=o.__importDefault(i("1c76")),r=i("0bc6"),l=i("f10f"),c=i("92b1");let u=class extends s.default{constructor(){super(...arguments),this.visible=!1,this.x=0,this.y=0}get IS_DM(){return l.gameStore.IS_DM}open(e){this.visible=!0,this.x=e.pageX,this.y=e.pageY,this.$nextTick(()=>this.$children[0].$el.focus())}close(){this.visible=!1}bringPlayers(){l.gameStore.IS_DM&&(r.socket.emit("Players.Bring",{x:c.l2gx(this.x),y:c.l2gy(this.y)}),this.close())}createToken(){this.$parent.$parent.$refs.createtokendialog.open(this.x,this.y),this.close()}showInitiative(){this.$root.$refs.initiative.visible=!0,this.close()}};u=o.__decorate([a.default({components:{ContextMenu:n.default}})],u),t.default=u},cad7:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("bc3a")),a=o.__importDefault(i("a026")),n=o.__importDefault(i("65d9")),r=i("cc67");let l=class extends a.default{beforeRouteEnter(e,t,i){s.default.post("/api/logout").then(()=>{r.coreStore.setAuthenticated(!1),r.coreStore.setUsername(""),i({path:"/auth/login"})})}};l=o.__decorate([n.default({template:""})],l),t.default=l},cb94:function(e,t,i){},cc67:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=i("6fc5"),a=i("3a0b");let n=class extends s.VuexModule{constructor(){super(...arguments),this.authenticated=!1,this.initialized=!1,this.username=""}setAuthenticated(e){this.authenticated=e}setInitialized(e){this.initialized=e}setUsername(e){this.username=e}};o.__decorate([s.Mutation],n.prototype,"setAuthenticated",null),o.__decorate([s.Mutation],n.prototype,"setInitialized",null),o.__decorate([s.Mutation],n.prototype,"setUsername",null),n=o.__decorate([s.Module({dynamic:!0,store:a.rootStore,name:"core"})],n),t.coreStore=s.getModule(n)},cd49:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("3dfd")),n=i("5f86"),r=i("3a0b");s.default.config.productionTip=!1,s.default.config.devtools=!0,s.default.config.performance=!0,t.app=new s.default({router:n.router,store:r.rootStore,render:e=>e(a.default)}).$mount("#app"),window.app=t.app},cde6:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9"));let n=class extends s.default{};n=o.__decorate([a.default({props:["visible","left","top"]})],n),t.default=n},ce87:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("bc3a")),a=o.__importDefault(i("a026")),n=o.__importDefault(i("65d9"));let r=class extends a.default{beforeRouteEnter(e,t,i){s.default.post("/api/invite",{code:e.params.code}).then(e=>{i({path:e.data.sessionUrl})}).catch(e=>{console.error("Invitation code could not be redeemed"),i({path:"/dashboard"})})}};r=o.__decorate([n.default({template:""})],r),t.default=r},cec2:function(e,t,i){"use strict";i.r(t);var o=i("a57a"),s=i("255e");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("6d53");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"3c674586",null);r.options.__file="prompt.vue",t["default"]=r.exports},d065:function(e,t,i){"use strict";i.r(t);var o=i("ba53"),s=i("f8b3");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("de0f");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"6f3cf09f",null);r.options.__file="edit_dialog.vue",t["default"]=r.exports},d16e:function(e,t,i){"use strict";var o=i("ded3"),s=i.n(o);s.a},d1ec:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class o{}o.angleSteps=4,o.drawAngleLines=!1,o.drawFirstLightHit=!1,o.skipPlayerFOW=!1,o.skipLightFOW=!1,o.tempFill="fog",t.Settings=o},d30b:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("bc3a")),a=o.__importDefault(i("a026")),n=o.__importDefault(i("65d9")),r=i("cc67");let l=class extends a.default{constructor(){super(...arguments),this.username="",this.password="",this.error=""}login(){s.default.post("/api/login",{username:this.username,password:this.password}).then(e=>{r.coreStore.setUsername(this.username),r.coreStore.setAuthenticated(!0),this.$router.push(this.$route.query.redirect||"/")}).catch(e=>{e.response?this.error=e.response.statusText:this.error="Unknown error occured"})}register(){s.default.post("/api/register",{username:this.username,password:this.password}).then(e=>{r.coreStore.setUsername(this.username),r.coreStore.setAuthenticated(!0)}).catch(e=>{e.response?this.error=e.response.statusText:this.error="Unknown error occured"})}focusin(e){if(e.target&&e.target.nextElementSibling){const t=e.target.nextElementSibling;t.style.opacity="0"}}focusout(e){if(e.target&&e.target.nextElementSibling){const t=e.target.nextElementSibling;t.style.opacity="1"}}};l=o.__decorate([n.default],l),t.default=l},d35a:function(e,t,i){},d4cd:function(e,t,i){"use strict";var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return null!==e.shape?i("div",[i("div",{attrs:{id:"selection-menu"}},[i("div",{attrs:{id:"selection-edit-button"},on:{click:e.openEditDialog}},[i("i",{staticClass:"fas fa-edit"})]),i("div",{attrs:{id:"selection-name"}},[e._v(e._s(e.shape.name))]),i("div",{attrs:{id:"selection-trackers"}},[e._l(e.shape.trackers,function(t){return""!==t.name||0!==t.value?[i("div",{key:"name-"+t.uuid},[e._v(e._s(t.name))]),i("div",{key:"value-"+t.uuid,staticClass:"selection-tracker-value",on:{click:function(i){e.changeValue(t,!1)}}},[0===t.maxvalue?[e._v(e._s(t.value))]:[e._v(e._s(t.value)+" / "+e._s(t.maxvalue))]],2)]:e._e()})],2),i("div",{attrs:{id:"selection-auras"}},[e._l(e.shape.auras,function(t){return""!==t.name||0!==t.value?[i("div",{key:"name-"+t.uuid},[e._v(e._s(t.name))]),i("div",{key:"value-"+t.uuid,staticClass:"selection-tracker-value",on:{click:function(i){e.changeValue(t,!0)}}},[0===t.dim?[e._v(e._s(t.value))]:[e._v(e._s(t.value)+" / "+e._s(t.dim))]],2)]:e._e()})],2)]),i("edit-dialog",{ref:"editDialog",attrs:{shape:e.shape}})],1):e._e()},s=[];i.d(t,"a",function(){return o}),i.d(t,"b",function(){return s})},d588:function(e,t,i){"use strict";i.r(t);var o=i("91df"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},d5df:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("65d9")),a=o.__importDefault(i("ea6a")),n=i("0bc6"),r=i("6f92"),l=i("5e7c"),c=i("0180"),u=i("f10f"),d=i("92b1"),h=i("5a5c");let f=class extends a.default{constructor(){super(...arguments),this.name="Ruler",this.active=!1,this.startPoint=null,this.ruler=null,this.text=null}onMouseDown(e){const t=r.layerManager.getLayer("draw");void 0!==t?(this.active=!0,this.startPoint=d.l2g(h.getMouse(e)),this.ruler=new l.Line(this.startPoint,this.startPoint,3,u.gameStore.rulerColour),this.text=new c.Text(this.startPoint.clone(),"","bold 20px serif"),this.ruler.owners.push(u.gameStore.username),this.text.owners.push(u.gameStore.username),t.addShape(this.ruler,!0,!0),t.addShape(this.text,!0,!0)):console.log("No draw layer!")}onMouseMove(e){if(!this.active||null===this.ruler||null===this.startPoint||null===this.text)return;const t=r.layerManager.getLayer("draw");if(void 0===t)return void console.log("No draw layer!");const i=d.l2g(h.getMouse(e));this.ruler.endPoint=i,n.socket.emit("Shape.Update",{shape:this.ruler.asDict(),redraw:!0,temporary:!0});const o=Math.sign(i.x-this.startPoint.x)*Math.sign(i.y-this.startPoint.y),s=Math.abs(i.x-this.startPoint.x),a=Math.abs(i.y-this.startPoint.y),l=Math.round(Math.sqrt(Math.pow(s,2)+Math.pow(a,2))*u.gameStore.unitSize/u.gameStore.gridSize)+" ft",c=Math.atan2(o*a,s),f=Math.min(this.startPoint.x,i.x)+s/2,p=Math.min(this.startPoint.y,i.y)+a/2;this.text.refPoint.x=f,this.text.refPoint.y=p,this.text.text=l,this.text.angle=c,n.socket.emit("Shape.Update",{shape:this.text.asDict(),redraw:!0,temporary:!0}),t.invalidate(!0)}onMouseUp(e){if(!this.active||null===this.ruler||null===this.startPoint||null===this.text)return;const t=r.layerManager.getLayer("draw");void 0!==t?(this.active=!1,t.removeShape(this.ruler,!0,!0),t.removeShape(this.text,!0,!0),t.invalidate(!0),this.ruler=this.startPoint=this.text=null):console.log("No active layer!")}};f=o.__decorate([s.default],f),t.RulerTool=f},d65f:function(e,t,i){"use strict";i.r(t);var o=i("93d8"),s=i("7e15");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("e997");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"8b7717ce",null);r.options.__file="modal.vue",t["default"]=r.exports},d811:function(e,t,i){"use strict";var o=i("5ad0"),s=i.n(o);s.a},d8ee:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9")),n=o.__importDefault(i("3b36")),r=o.__importDefault(i("d65f")),l=i("4a5b"),c=i("0bc6"),u=i("6f92"),d=i("f10f"),h=i("60a3");let f=class extends s.default{constructor(){super(...arguments),this.visible=!1}updated(){this.addEmpty()}addEmpty(){""!==this.shape.owners[this.shape.owners.length-1]&&this.shape.owners.push(""),this.shape.trackers.length&&""===this.shape.trackers[this.shape.trackers.length-1].name&&0===this.shape.trackers[this.shape.trackers.length-1].value||this.shape.trackers.push({uuid:l.uuidv4(),name:"",value:0,maxvalue:0,visible:!1}),this.shape.auras.length&&""===this.shape.auras[this.shape.auras.length-1].name&&0===this.shape.auras[this.shape.auras.length-1].value||this.shape.auras.push({uuid:l.uuidv4(),name:"",value:0,dim:0,visionSource:!1,colour:"rgba(0,0,0,0)",visible:!1})}updateShape(e){c.socket.emit("Shape.Update",{shape:this.shape.asDict(),redraw:e,temporary:!1}),e&&u.layerManager.invalidate(),this.addEmpty()}setToken(e){this.shape.setIsToken(e.target.checked),this.updateShape(!0)}setVisionBlocker(e){this.shape.checkVisionSources(),this.updateShape(!0)}setMovementBlocker(e){this.shape.setMovementBlock(e.target.checked),this.updateShape(!1)}updateAnnotation(e){const t=""!==this.shape.annotation;this.shape.annotation=e.target.value,""===this.shape.annotation||t?""===this.shape.annotation&&t&&(d.gameStore.annotations.splice(d.gameStore.annotations.findIndex(e=>e===this.shape.uuid)),u.layerManager.hasLayer("draw")&&u.layerManager.getLayer("draw").invalidate(!0)):(d.gameStore.annotations.push(this.shape.uuid),u.layerManager.hasLayer("draw")&&u.layerManager.getLayer("draw").invalidate(!0)),this.updateShape(!1)}updateOwner(e,t){const i=this.shape.owners.findIndex(e=>e===t);i>=0?this.shape.owners.splice(i,1,e.target.value):this.shape.owners.push(e.target.value),this.updateShape(d.gameStore.fowLOS)}removeOwner(e){const t=this.shape.owners.findIndex(t=>t===e);this.shape.owners.splice(t,1),this.updateShape(d.gameStore.fowLOS)}removeTracker(e){this.shape.trackers=this.shape.trackers.filter(t=>t.uuid!==e),this.updateShape(!1)}removeAura(e){this.shape.auras=this.shape.auras.filter(t=>t.uuid!==e),this.shape.checkVisionSources(),this.updateShape(!0)}updateAuraVisionSource(e){e.visionSource=!e.visionSource;const t=d.gameStore.visionSources.findIndex(t=>t.aura===e.uuid);e.visionSource&&-1===t?d.gameStore.visionSources.push({shape:this.shape.uuid,aura:e.uuid}):!e.visionSource&&t>=0&&d.gameStore.visionSources.splice(t,1),u.layerManager.invalidateLight(),this.updateShape(!0)}updateAuraColour(e,t){const i=u.layerManager.getLayer(this.shape.layer);void 0!==i&&i.invalidate(!e.visionSource)}};o.__decorate([h.Prop()],f.prototype,"shape",void 0),f=o.__decorate([a.default({components:{Modal:r.default,"color-picker":n.default}})],f),t.default=f},dc37:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9")),n=o.__importDefault(i("d65f"));let r=class extends s.default{constructor(){super(...arguments),this.visible=!1,this.yes="Yes",this.no="No",this.title="",this.resolve=(e=>{}),this.reject=(()=>{})}confirm(){this.resolve(!0),this.close()}deny(){this.resolve(!1),this.close()}close(){this.reject(),this.visible=!1,this.title=""}open(e,t="yes",i="no"){return this.yes=t,this.no=i,this.title=e,this.visible=!0,this.$nextTick(()=>{this.$refs.confirm.focus()}),new Promise((e,t)=>{this.resolve=e,this.reject=t})}};r=o.__decorate([a.default({components:{Modal:n.default}})],r),t.default=r},de0f:function(e,t,i){"use strict";var o=i("cb94"),s=i.n(o);s.a},dec1:function(e,t,i){"use strict";i.r(t);var o=i("410d"),s=i("3481");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,null,null);r.options.__file="map.vue",t["default"]=r.exports},ded3:function(e,t,i){},e0e9:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9")),n=o.__importDefault(i("1c76")),r=i("5338"),l=i("2d5b"),c=i("4a5b");let u=class extends s.default{constructor(){super(...arguments),this.visible=!1,this.left=0,this.top=0}open(e,t){l.assetStore.selected.includes(t)||c.getComponent().select(e,t),this.visible=!0,this.left=e.pageX,this.top=e.pageY,this.$nextTick(()=>{this.$children[0].$el.focus()})}close(){this.visible=!1}rename(){if(1!==l.assetStore.selected.length)return;const e=l.assetStore.idMap.get(l.assetStore.selected[0]);c.getRef("prompt").prompt("New name:",`Renaming ${e.name}`).then(t=>{r.socket.emit("Asset.Rename",{asset:e.id,name:t}),e.name=t,c.getComponent().$forceUpdate()},()=>{}),this.close()}remove(){0!==l.assetStore.selected.length&&(c.getRef("confirm").open("Are you sure you wish to remove this?").then(e=>{if(e){for(const e of l.assetStore.selected)r.socket.emit("Asset.Remove",e),l.assetStore.isFile(e)?l.assetStore.files.splice(l.assetStore.files.indexOf(e),1):l.assetStore.folders.splice(l.assetStore.folders.indexOf(e),1);l.assetStore.selected=[]}},()=>{}),this.close())}};u=o.__decorate([a.default({components:{ContextMenu:n.default}})],u),t.default=u},e27a:function(e,t,i){"use strict";i.r(t);var o=i("2756"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},e914:function(e,t,i){"use strict";i.r(t);var o=i("950d"),s=i("aa69");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("78c7");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,null,null);r.options.__file="manager.vue",t["default"]=r.exports},e94f:function(e,t,i){"use strict";i.r(t);var o=i("7aaa"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},e995:function(e,t,i){},e997:function(e,t,i){"use strict";var o=i("241d"),s=i.n(o);s.a},ea6a:function(e,t,i){"use strict";i.r(t);var o=i("9a7c"),s=i("6465");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("12d3");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,null,null);r.options.__file="tool.vue",t["default"]=r.exports},ebb9:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9")),n=o.__importDefault(i("1516"));s.default.component("draggable",n.default);const r=o.__importDefault(i("d65f")),l=i("4a5b"),c=i("0bc6"),u=i("af17"),d=i("6f92"),h=i("f10f");let f=class extends s.default{constructor(){super(...arguments),this.visible=!1,this.data=[],this.currentActor=null,this.roundCounter=0}mounted(){u.EventBus.$on("Initiative.Clear",this.clear),u.EventBus.$on("Initiative.Remove",e=>this.removeInitiative(e)),c.socket.on("Initiative.Set",e=>{this.data=e}),c.socket.on("Initiative.Turn.Update",e=>this.setTurn(e,!1)),c.socket.on("Initiative.Round.Update",e=>this.setRound(e,!1)),c.socket.on("Initiative.Effect.New",e=>{const t=this.getActor(e.actor);void 0!==t&&this.createEffect(t,e.effect,!1)}),c.socket.on("Initiative.Effect.Update",e=>this.updateEffect(e.actor,e.effect,!1))}beforeDestroy(){u.EventBus.$off()}clear(){this.data=[],this.currentActor=null}getActor(e){return this.data.find(t=>t.uuid===e)}contains(e){return this.data.some(t=>t.uuid===e)}owns(e){if(h.gameStore.IS_DM)return!0;const t=d.layerManager.UUIDMap.get(e.uuid);return void 0!==t&&t.owners.includes(h.gameStore.username)}getDefaultEffect(){return{uuid:l.uuidv4(),name:"New Effect",turns:10}}fakeSetData(e){e.setData("Hack","")}syncInitiative(e){c.socket.emit("Initiative.Update",e)}addInitiative(e){const t=this.data.findIndex(t=>t.uuid===e.uuid);t>=0||(void 0===e.initiative&&(e.initiative=0),this.syncInitiative(e))}removeInitiative(e){const t=this.data.findIndex(t=>t.uuid===e);if(t<0||this.data[t].group)return;this.syncInitiative({uuid:e});const i=d.layerManager.UUIDMap.get(e);void 0!==i&&i.showHighlight&&(i.showHighlight=!1,d.layerManager.getLayer(i.layer).invalidate(!0))}updateOrder(){h.gameStore.IS_DM&&c.socket.emit("Initiative.Set",this.data.map(e=>e.uuid))}setTurn(e,t){if(!h.gameStore.IS_DM&&t)return;this.currentActor=e;const i=this.data.find(t=>t.uuid===e);if(void 0!==i){if(i.effects)for(let e=i.effects.length-1;e>=0;e--)i.effects[e].turns<=0?i.effects.splice(e,1):i.effects[e].turns--;t&&c.socket.emit("Initiative.Turn.Update",e)}}setRound(e,t){!h.gameStore.IS_DM&&t||(this.roundCounter=e,t&&c.socket.emit("Initiative.Round.Update",e))}nextTurn(){if(!h.gameStore.IS_DM)return;const e=this.data,t=e[(e.findIndex(e=>e.uuid===this.currentActor)+1)%e.length];this.data[0].uuid===t.uuid&&this.setRound(this.roundCounter+1,!0),this.setTurn(t.uuid,!0)}toggleHighlight(e,t){const i=d.layerManager.UUIDMap.get(e.uuid);void 0!==i&&(i.showHighlight=t,d.layerManager.getLayer(i.layer).invalidate(!0))}toggleOption(e,t){this.owns(e)&&(e[t]=!e[t],this.syncInitiative(e))}createEffect(e,t,i){this.owns(e)&&(e.effects.push(t),i&&c.socket.emit("Initiative.Effect.New",{actor:e.uuid,effect:t}))}syncEffect(e,t){this.owns(e)&&c.socket.emit("Initiative.Effect.Update",{actor:e.uuid,effect:t})}updateEffect(e,t,i){const o=this.data.find(t=>t.uuid===e);if(void 0===o)return;const s=o.effects.findIndex(e=>e.uuid===t.uuid);void 0!==s&&(o.effects[s]=t,i?this.syncEffect(o,t):this.$forceUpdate())}};f=o.__decorate([a.default({components:{Modal:r.default,draggable:n.default}})],f),t.default=f},f086:function(e,t,i){"use strict";i.r(t);var o=i("d4cd"),s=i("7ba5");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("9896");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"4d8cbeae",null);r.options.__file="selection_info.vue",t["default"]=r.exports},f10f:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=i("6fc5"),a=i("0bc6"),n=i("2b48"),r=i("c71e"),l=i("6f92"),c=i("92b1"),u=i("3a0b");let d=class extends s.VuexModule{constructor(){super(...arguments),this.layers=[],this.selectedLayerIndex=-1,this.boardInitialized=!1,this.locations=[],this.assets={},this.notes=[],this.IS_DM=!1,this.gridSize=50,this.username="",this.roomName="",this.roomCreator="",this.invitationCode="",this.gridColour="rgba(0, 0, 0, 1)",this.fowColour="rgba(0, 0, 0, 1)",this.rulerColour="rgba(255, 0, 0, 1)",this.panX=0,this.panY=0,this.zoomFactor=1,this.unitSize=5,this.useGrid=!0,this.fullFOW=!1,this.fowOpacity=.3,this.fowLOS=!1,this.locationName="",this.visionSources=[],this.visionBlockers=[],this.annotations=[],this.movementblockers=[],this.ownedtokens=[],this.BV=Object.freeze(new r.BoundingVolume([]))}get selectedLayer(){return this.layers[this.selectedLayerIndex]}setBoardInitialized(e){this.boardInitialized=e}setDM(e){this.IS_DM=e}setUsername(e){this.username=e}setRoomName(e){this.roomName=e}setRoomCreator(e){this.roomCreator=e}setInvitationCode(e){this.invitationCode=e}addLayer(e){this.layers.push(e),-1===this.selectedLayerIndex&&(this.selectedLayerIndex=this.layers.indexOf(e))}selectLayer(e){const t=this.layers.indexOf(e.name);t>=0&&(this.selectedLayerIndex=t),e.sync&&a.socket.emit("Client.ActiveLayer.Set",e.name)}newNote(e){this.notes.push(e.note),e.sync&&a.socket.emit("Note.New",e.note)}setAssets(e){this.assets=e}setLocations(e){this.locations=e}resetLayerInfo(){this.layers=[],this.selectedLayerIndex=-1}recalculateBV(){if(this.boardInitialized){let t=!1;while(!t){t=!0;try{this.BV=Object.freeze(new r.BoundingVolume(this.visionBlockers))}catch(e){t=!1}}}}updateZoom(e){if(e.newZoomValue===this.zoomFactor)return;e.newZoomValue<.1&&(e.newZoomValue=.1),e.newZoomValue>5&&(e.newZoomValue=5);const t=c.g2l(e.zoomLocation);this.zoomFactor=e.newZoomValue;const i=c.l2g(t),o=i.subtract(e.zoomLocation);this.panX+=o.x,this.panY+=o.y,l.layerManager.invalidate(),n.sendClientOptions()}setGridColour(e){this.gridColour=e.colour,l.layerManager.getGridLayer().drawGrid(),e.sync&&a.socket.emit("Client.Options.Set",{gridColour:e.colour})}setFOWColour(e){this.fowColour=e.colour,l.layerManager.invalidate(),e.sync&&a.socket.emit("Client.Options.Set",{fowColour:e.colour})}setRulerColour(e){this.rulerColour=e.colour,e.sync&&a.socket.emit("Client.Options.Set",{rulerColour:e.colour})}setPanX(e){this.panX=e}setPanY(e){this.panY=e}setZoomFactor(e){this.zoomFactor=e}increasePanX(e){this.panX+=e}increasePanY(e){this.panY+=e}setUnitSize(e){this.unitSize!==e.unitSize&&(this.unitSize=e.unitSize,void 0!==l.layerManager.getGridLayer()&&l.layerManager.getGridLayer().drawGrid(),e.sync&&a.socket.emit("Location.Options.Set",{unit_size:e.unitSize}))}setUseGrid(e){if(this.useGrid!==e.useGrid){this.useGrid=e.useGrid;const t=l.layerManager.getGridLayer();e.useGrid?t.canvas.style.display="block":t.canvas.style.display="none",e.sync&&a.socket.emit("Location.Options.Set",{use_grid:e.useGrid})}}setGridSize(e){if(this.gridSize!==e.gridSize&&e.gridSize>0){this.gridSize=e.gridSize;const t=l.layerManager.getGridLayer();void 0!==t&&t.drawGrid(),e.sync&&a.socket.emit("Gridsize.Set",e.gridSize)}}setFullFOW(e){this.fullFOW!==e.fullFOW&&(this.fullFOW=e.fullFOW,l.layerManager.invalidateLight(),e.sync&&a.socket.emit("Location.Options.Set",{full_fow:e.fullFOW}))}setFOWOpacity(e){this.fowOpacity=e.fowOpacity,l.layerManager.invalidateLight(),e.sync&&a.socket.emit("Location.Options.Set",{fow_opacity:e.fowOpacity})}setLineOfSight(e){this.fowLOS!==e.fowLOS&&(this.fowLOS=e.fowLOS,l.layerManager.invalidate(),e.sync&&a.socket.emit("Location.Options.Set",{fow_los:e.fowLOS}))}setLocationName(e){this.locationName=e}updateNote(e){const t=this.notes.find(t=>t.uuid===e.note.uuid);void 0!==t&&(t.title=e.note.title,t.text=e.note.text,e.sync&&a.socket.emit("Note.Update",t))}removeNote(e){this.notes=this.notes.filter(t=>t.uuid!==e.note.uuid),e.sync&&a.socket.emit("Note.Remove",e.note.uuid)}clear(){this.context.getters.visionSources=[],this.context.getters.visionBlockers=[],this.context.getters.ownedtokens=[],this.context.getters.annotations=[],this.context.getters.movementblockers=[],this.context.commit("recalculateBV")}};o.__decorate([s.Mutation],d.prototype,"setBoardInitialized",null),o.__decorate([s.Mutation],d.prototype,"setDM",null),o.__decorate([s.Mutation],d.prototype,"setUsername",null),o.__decorate([s.Mutation],d.prototype,"setRoomName",null),o.__decorate([s.Mutation],d.prototype,"setRoomCreator",null),o.__decorate([s.Mutation],d.prototype,"setInvitationCode",null),o.__decorate([s.Mutation],d.prototype,"addLayer",null),o.__decorate([s.Mutation],d.prototype,"selectLayer",null),o.__decorate([s.Mutation],d.prototype,"newNote",null),o.__decorate([s.Mutation],d.prototype,"setAssets",null),o.__decorate([s.Mutation],d.prototype,"setLocations",null),o.__decorate([s.Mutation],d.prototype,"resetLayerInfo",null),o.__decorate([s.Mutation],d.prototype,"recalculateBV",null),o.__decorate([s.Mutation],d.prototype,"updateZoom",null),o.__decorate([s.Mutation],d.prototype,"setGridColour",null),o.__decorate([s.Mutation],d.prototype,"setFOWColour",null),o.__decorate([s.Mutation],d.prototype,"setRulerColour",null),o.__decorate([s.Mutation],d.prototype,"setPanX",null),o.__decorate([s.Mutation],d.prototype,"setPanY",null),o.__decorate([s.Mutation],d.prototype,"setZoomFactor",null),o.__decorate([s.Mutation],d.prototype,"increasePanX",null),o.__decorate([s.Mutation],d.prototype,"increasePanY",null),o.__decorate([s.Mutation],d.prototype,"setUnitSize",null),o.__decorate([s.Mutation],d.prototype,"setUseGrid",null),o.__decorate([s.Mutation],d.prototype,"setGridSize",null),o.__decorate([s.Mutation],d.prototype,"setFullFOW",null),o.__decorate([s.Mutation],d.prototype,"setFOWOpacity",null),o.__decorate([s.Mutation],d.prototype,"setLineOfSight",null),o.__decorate([s.Mutation],d.prototype,"setLocationName",null),o.__decorate([s.Mutation],d.prototype,"updateNote",null),o.__decorate([s.Mutation],d.prototype,"removeNote",null),o.__decorate([s.Action],d.prototype,"clear",null),d=o.__decorate([s.Module({dynamic:!0,store:u.rootStore,name:"game",namespaced:!0})],d),t.gameStore=s.getModule(d)},f30c:function(e,t,i){"use strict";i.r(t);var o=i("dc37"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},f312:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aurasFromServer=(e=>{const t=[];for(const i of e)t.push({uuid:i.uuid,visionSource:i.vision_source,visible:i.visible,name:i.name,value:i.value,dim:i.dim,colour:i.colour});return t}),t.aurasToServer=(e=>{const t=[];for(const i of e)t.push({uuid:i.uuid,vision_source:i.visionSource,visible:i.visible,name:i.name,value:i.value,dim:i.dim,colour:i.colour});return t})},f51a:function(e,t,i){"use strict";i.r(t);var o=i("e0e9"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},f551:function(e,t,i){"use strict";i.r(t);var o=i("8a0e"),s=i("1dd6");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("6f21");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"6c3d2628",null);r.options.__file="note.vue",t["default"]=r.exports},f5fe:function(e,t,i){"use strict";i.r(t);var o=i("5b68"),s=i("7018");for(var a in s)"default"!==a&&function(e){i.d(t,e,function(){return s[e]})}(a);i("40f3");var n=i("2877"),r=Object(n["a"])(s["default"],o["a"],o["b"],!1,null,"38ee733a",null);r.options.__file="initiative.vue",t["default"]=r.exports},f692:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("4185"),s=i("b906"),a=i("38c9"),n=i("bab4"),r=i("6f92"),l=i("f10f");function c(e){const t=document.createElement("canvas");let i;t.style.zIndex=r.layerManager.layers.length.toString(),t.width=window.innerWidth,t.height=window.innerHeight,i="grid"===e.type_?new a.GridLayer(t,e.name):"fow"===e.type_?new o.FOWLayer(t,e.name):"fow-players"===e.type_?new s.FOWPlayersLayer(t,e.name):new n.Layer(t,e.name),i.selectable=e.selectable,i.playerEditable=e.player_editable,r.layerManager.addLayer(i);const c=document.getElementById("layers");null!==c?("fow-players"!==e.name&&c.appendChild(t),"grid"===e.type_&&e.size&&l.gameStore.setGridSize({gridSize:e.size,sync:!1}),i.setShapes(e.shapes)):console.warn("Layers div is missing, this will prevent the main game board from loading!")}t.createLayer=c},f8b3:function(e,t,i){"use strict";i.r(t);var o=i("d8ee"),s=i.n(o);for(var a in o)"default"!==a&&function(e){i.d(t,e,function(){return o[e]})}(a);t["default"]=s.a},fbdd:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("9ab4"),s=o.__importDefault(i("a026")),a=o.__importDefault(i("65d9")),n=o.__importDefault(i("d065")),r=i("4a5b"),l=i("0bc6"),c=i("af17"),u=i("6f92");let d=class extends s.default{constructor(){super(...arguments),this.shape=null}mounted(){c.EventBus.$on("SelectionInfo.Shape.Set",e=>{this.shape=e})}beforeDestroy(){c.EventBus.$off()}openEditDialog(){this.$refs.editDialog.visible=!0}changeValue(e,t){null!==this.shape&&r.getRef("prompt").prompt(`New  ${e.name} value:`,`Updating ${e.name}`).then(i=>{if(null===this.shape)return;const o=e.value;"+"===i[0]||"-"===i[0]?e.value+=parseInt(i,10):e.value=parseInt(i,10),isNaN(e.value)&&(e.value=o),l.socket.emit("Shape.Update",{shape:this.shape.asDict(),redraw:t,temporary:!1}),t&&u.layerManager.invalidate()},()=>{})}};d=o.__decorate([a.default({components:{"edit-dialog":n.default}})],d),t.default=d},fe11:function(e,t,i){},fe80:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=i("0bc6"),s=i("af17"),a=i("8f0a"),n=i("6f92"),r=i("f692"),l=i("9cb7"),c=i("f10f"),u=i("5f86");o.socket.on("connect",()=>{console.log("Connected")}),o.socket.on("disconnect",()=>{console.log("Disconnected")}),o.socket.on("connect_error",e=>{console.error("Could not connect to game session."),u.router.push("/dashboard")}),o.socket.on("error",e=>{console.error("Game session does not exist."),u.router.push("/dashboard")}),o.socket.on("redirect",e=>{console.log("redirecting"),u.router.push(e)}),o.socket.on("Room.Info.Set",e=>{c.gameStore.setRoomName(e.name),c.gameStore.setRoomCreator(e.creator),c.gameStore.setInvitationCode(e.invitationCode)}),o.socket.on("Username.Set",e=>{c.gameStore.setUsername(e),c.gameStore.setDM(e===window.location.pathname.split("/")[2])}),o.socket.on("Client.Options.Set",e=>{c.gameStore.setGridColour({colour:e.grid_colour,sync:!1}),c.gameStore.setFOWColour({colour:e.fow_colour,sync:!1}),c.gameStore.setRulerColour({colour:e.ruler_colour,sync:!1}),c.gameStore.setPanX(e.pan_x),c.gameStore.setPanY(e.pan_y),c.gameStore.setZoomFactor(e.zoom_factor),e.active_layer&&n.layerManager.selectLayer(e.active_layer,!1),void 0!==n.layerManager.getGridLayer()&&n.layerManager.getGridLayer().invalidate()}),o.socket.on("Location.Set",e=>{void 0!==e.name&&c.gameStore.setLocationName(e.name),void 0!==e.unit_size&&c.gameStore.setUnitSize({unitSize:e.unit_size,sync:!1}),void 0!==e.use_grid&&c.gameStore.setUseGrid({useGrid:e.use_grid,sync:!1}),void 0!==e.full_fow&&c.gameStore.setFullFOW({fullFOW:e.full_fow,sync:!1}),void 0!==e.fow_opacity&&c.gameStore.setFOWOpacity({fowOpacity:e.fow_opacity,sync:!1}),void 0!==e.fow_los&&c.gameStore.setLineOfSight({fowLOS:e.fow_los,sync:!1})}),o.socket.on("Position.Set",e=>{l.gameManager.setCenterPosition(new a.GlobalPoint(e.x,e.y))}),o.socket.on("Notes.Set",e=>{for(const t of e)c.gameStore.newNote({note:t,sync:!1})}),o.socket.on("Asset.List.Set",e=>{c.gameStore.setAssets(e)}),o.socket.on("Board.Set",e=>{c.gameStore.clear(),c.gameStore.setLocations(e.locations),document.getElementById("layers").innerHTML="",c.gameStore.resetLayerInfo(),n.layerManager.reset();for(const t of e.layers)r.createLayer(t);n.layerManager.selectLayer(n.layerManager.getLayer().name,!1),s.EventBus.$emit("Initiative.Clear"),c.gameStore.setBoardInitialized(!0),c.gameStore.recalculateBV()}),o.socket.on("Gridsize.Set",e=>{c.gameStore.setGridSize({gridSize:e,sync:!1})}),o.socket.on("Shape.Add",e=>{l.gameManager.addShape(e)}),o.socket.on("Shape.Remove",e=>{if(!n.layerManager.UUIDMap.has(e.uuid))return void console.log("Attempted to remove an unknown shape");if(!n.layerManager.hasLayer(e.layer))return void console.log(`Attempted to remove shape from an unknown layer ${e.layer}`);const t=n.layerManager.getLayer(e.layer);t.removeShape(n.layerManager.UUIDMap.get(e.uuid),!1),t.invalidate(!1)}),o.socket.on("Shape.Order.Set",e=>{if(!n.layerManager.UUIDMap.has(e.shape.uuid))return void console.log("Attempted to move the shape order of an unknown shape");if(!n.layerManager.hasLayer(e.shape.layer))return void console.log(`Attempted to remove shape from an unknown layer ${e.shape.layer}`);const t=n.layerManager.UUIDMap.get(e.shape.uuid),i=n.layerManager.getLayer(t.layer);i.moveShapeOrder(t,e.index,!1)}),o.socket.on("Shape.Layer.Change",e=>{const t=n.layerManager.UUIDMap.get(e.uuid);void 0!==t&&t.moveLayer(e.layer,!1)}),o.socket.on("Shape.Update",e=>{l.gameManager.updateShape(e)}),o.socket.on("Temp.Clear",e=>{e.forEach(e=>{if(!n.layerManager.UUIDMap.has(e.uuid))return void console.log("Attempted to remove an unknown temporary shape");if(!n.layerManager.hasLayer(e.layer))return void console.log(`Attempted to remove shape from an unknown layer ${e.layer}`);const t=n.layerManager.UUIDMap.get(e.uuid);n.layerManager.getLayer(e.layer).removeShape(t,!1)})})}});
//# sourceMappingURL=app.ab9c7830.js.map