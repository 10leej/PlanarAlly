(function(e){function t(t){for(var s,r,a=t[0],l=t[1],c=t[2],d=0,h=[];d<a.length;d++)r=a[d],n[r]&&h.push(n[r][0]),n[r]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);u&&u(t);while(h.length)h.shift()();return o.push.apply(o,c||[]),i()}function i(){for(var e,t=0;t<o.length;t++){for(var i=o[t],s=!0,a=1;a<i.length;a++){var l=i[a];0!==n[l]&&(s=!1)}s&&(o.splice(t--,1),e=r(r.s=i[0]))}return e}var s={},n={app:0},o=[];function r(t){if(s[t])return s[t].exports;var i=s[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=s,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(i,s,function(t){return e[t]}.bind(null,s));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],l=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var u=l;o.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("cd49")},"0180":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8db6"),n=i("2469"),o=i("92b1");class r extends n.Shape{constructor(e,t,i,s,n,o,r){super(e,n,o,r),this.type="text",this.text=t,this.font=i,this.angle=s||0}asDict(){return Object.assign(this.getBaseDict(),{text:this.text,font:this.font,angle:this.angle})}get points(){return[[this.refPoint.x,this.refPoint.y]]}getBoundingBox(){return new s.BoundingRect(this.refPoint,5,5)}draw(e){super.draw(e),e.font=this.font,e.fillStyle=this.fillColour,e.save();const t=o.g2l(this.refPoint);e.translate(t.x,t.y),e.rotate(this.angle),e.textAlign="center",this.getLines(e).map(t=>e.fillText(t.text,t.x,t.y)),e.restore()}contains(e){return!1}center(e){}visibleInCanvas(e){return this.getBoundingBox().visibleInCanvas(e)}snapToGrid(){}resizeToGrid(){}resize(e,t){}getMaxHeight(e){const t=this.getLines(e),i=30;return i*t.length}getMaxWidth(e){const t=this.getLines(e),i=t.map(t=>e.measureText(t.text).width);return Math.max(...i)}getLines(e){const t=this.text.split("\n"),i=[],s=e.canvas.width,n=30,o=0;let r=0;for(const a of t){let t="";const l=a.split(" ");for(const a of l){const l=t+a+" ",c=e.measureText(l),u=c.width;u>s?(e.fillText(t,o,r),i.push({text:t,x:o,y:r}),t=a+" ",r+=n):t=l}i.push({text:t,x:o,y:r}),r+=n}return i}}t.Text=r},"01be":function(e,t,i){"use strict";var s=i("919a"),n=i.n(s);n.a},"033f":function(e,t,i){"use strict";i.r(t);var s=i("da7f"),n=i("a68b");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("a83f");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"6c66d243",null);t["default"]=a.exports},"034f":function(e,t,i){"use strict";var s=i("64a9"),n=i.n(s);n.a},"0525":function(e,t,i){},"0584":function(e,t,i){"use strict";var s=i("de21"),n=i.n(s);n.a},"0634":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("66cb")),o=s.__importDefault(i("a026")),r=s.__importDefault(i("65d9")),a=i("c345a"),l=i("60a3");let c=class extends o.default{constructor(){super(...arguments),this.display=!1,this.left=0,this.top=0,this.transparent=!1}mounted(){this.transparent=0===this.$refs.chromePicker.val.rgba.a,this.setPosition()}open(){this.display||this.disabled||(this.setPosition(),this.display=!0,this.$nextTick(()=>this.$children[0].$el.focus()))}updateColor(e){this.transparent=0===e.rgba.a;const t=n.default(e.rgba).toRgbString();this.$emit("update:color",t),this.$emit("input",t)}closePicker(){this.display=!1,this.$emit("change",this.color)}setPosition(){const e=this.$el.getBoundingClientRect();e.right+224>window.innerWidth?this.left=e.left-224:this.left=e.right,e.bottom+242>window.innerHeight?this.top=e.top-242:this.top=e.bottom}};s.__decorate([l.Prop(String)],c.prototype,"color",void 0),s.__decorate([l.Prop(Boolean)],c.prototype,"disabled",void 0),c=s.__decorate([r.default({components:{"chrome-picker":a.Chrome}})],c),t.default=c},"07f5":function(e,t,i){"use strict";i.r(t);var s=i("69fb"),n=i("d588");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("561b"),i("e6c4");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"3d0578ba",null);t["default"]=a.exports},"0a75":function(e,t,i){},"0bc6":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("8055"));function o(e){t.socket.io.opts.query=`user=${e.params.creator}&room=${e.params.room}`,t.socket.connect()}t.socket=n.default(location.protocol+"//"+location.host+"/planarally",{autoConnect:!1}),t.createConnection=o},"0cf7":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=s.__importDefault(i("4aec")),a=s.__importDefault(i("a535")),l=s.__importDefault(i("cec2")),c=i("5338"),u=i("2d5b"),d=i("4a5b");let h=class extends n.default{constructor(){super(...arguments),this.path=[],this.draggingSelection=!1}get folders(){return u.assetStore.folders}get files(){return u.assetStore.files}get selected(){return u.assetStore.selected}get idMap(){return u.assetStore.idMap}get currentFolder(){return this.path.length?this.path[this.path.length-1]:u.assetStore.root}get parentFolder(){let e=this.path[this.path.length-2];return void 0===e&&(e=u.assetStore.root),e}get firstSelectedFile(){for(const e of u.assetStore.selected)if(u.assetStore.idMap.get(e).file_hash)return u.assetStore.idMap.get(e);return null}changeDirectory(e){e<0?this.path.pop():this.path.push(e),u.assetStore.clearSelected(),c.socket.emit("Folder.Get",this.currentFolder)}createDirectory(){const e=window.prompt("New folder name");null!==e&&c.socket.emit("Folder.Create",{name:e,parent:this.currentFolder})}moveInode(e,t){u.assetStore.files.includes(e)?u.assetStore.files.splice(u.assetStore.files.indexOf(e),1):u.assetStore.folders.splice(u.assetStore.folders.indexOf(e),1),u.assetStore.idMap.delete(e),c.socket.emit("Inode.Move",{inode:e,target:t})}select(e,t){if(e.shiftKey&&u.assetStore.selected.length>0){const e=[...u.assetStore.files,...u.assetStore.folders],i=e.indexOf(u.assetStore.selected[u.assetStore.selected.length-1]),s=e.indexOf(t);for(let t=i;t!==s;i<s?t++:t--)t!==i&&u.assetStore.selected.push(e[t]);u.assetStore.selected.push(e[s])}else e.ctrlKey||u.assetStore.clearSelected(),u.assetStore.selected.push(t)}startDrag(e,t){null!==e.dataTransfer&&(e.dataTransfer.setData("Hack","ittyHack"),e.dataTransfer.dropEffect="move",u.assetStore.selected.includes(t)||u.assetStore.selected.push(t),this.draggingSelection=!0)}moveDrag(e){e.target.classList.contains("folder")&&e.target.classList.add("inode-selected")}leaveDrag(e){e.target.classList.contains("folder")&&e.target.classList.remove("inode-selected")}stopDrag(e,t){if(e.target.classList.remove("inode-selected"),this.draggingSelection){if((t===u.assetStore.root||u.assetStore.folders.includes(t))&&!u.assetStore.selected.includes(t))for(const e of u.assetStore.selected)this.moveInode(e,t);u.assetStore.clearSelected()}else e.dataTransfer&&e.dataTransfer.files.length>0&&this.upload(e.dataTransfer.files,t);this.draggingSelection=!1}prepareUpload(){document.getElementById("files").click()}upload(e,t){const i=document.getElementById("files").files;if(void 0===e){if(!i)return;e=i}void 0===t&&(t=this.currentFolder);const s=1e5;for(const n of e){const e=d.uuidv4(),i=Math.ceil(n.size/s);for(let o=0;o<i;o++){const r=new FileReader;r.readAsArrayBuffer(n.slice(o*s,o*s+Math.min(s,n.size-o*s))),r.onload=s=>{c.socket.emit("Asset.Upload",{name:n.name,directory:t,data:r.result,slice:o,totalSlices:i,uuid:e})}}}}};h=s.__decorate([o.default({components:{Prompt:l.default,ConfirmDialog:a.default,AssetContextMenu:r.default},beforeRouteEnter(e,t,i){c.socket.connect(),i()},beforeRouteLeave(e,t,i){c.socket.disconnect(),i()}})],h),t.default=h},"0ddd":function(e,t,i){"use strict";i.r(t);var s=i("8f54"),n=i("4bc3");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("9dd4");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"6d718094",null);t["default"]=a.exports},1:function(e,t){},1077:function(e,t,i){"use strict";i.r(t);var s=i("f994"),n=i("1eee");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("3cd3");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"bc30fc14",null);t["default"]=a.exports},1216:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("6f92"),n=i("92b1"),o=i("98ef"),r=i("4aee");function a(e,t){const i=s.layerManager.getLayer("draw");if(void 0===i)return;const o=i.ctx;o.lineJoin="round",o.lineJoin="round",o.beginPath(),o.strokeStyle=void 0===t?`rgb(${255*Math.random()}, ${255*Math.random()}, ${255*Math.random()})`:t,o.moveTo(n.g2lx(e[0][0]),n.g2ly(e[0][1]));for(const s of e)o.lineTo(n.g2lx(s[0]),n.g2ly(s[1]));o.closePath(),o.stroke()}function l(e,t){const i=s.layerManager.getLayer("draw");if(void 0===i)return;const n=i.ctx;n.lineJoin="round",n.lineJoin="round",n.beginPath(),n.strokeStyle=void 0===t?`rgb(${255*Math.random()}, ${255*Math.random()}, ${255*Math.random()})`:t,n.moveTo(e[0][0],e[0][1]);for(const s of e)n.lineTo(s[0],s[1]);n.closePath(),n.stroke()}function c(e,t){return t?e:n.g2lx(e)}function u(e,t){return t?e:n.g2ly(e)}t.drawPolygon=a,t.drawPolygonL=l;let d=0,h=0;function f(e,t,i,s,n){e.beginPath(),e.strokeStyle=s?"rgba(255, 0, 0, 0.30)":"rgba(0, 0, 0, 0.30)",e.moveTo(c(t[0],n),u(t[1],n)),e.lineTo(c(i[0],n),u(i[1],n)),e.closePath(),e.stroke()}function p(e,t=!0,i=!0,n=0){d=0,h=0;let a=0;const l=s.layerManager.getLayer("draw");if(void 0===l)return;const p=l.ctx;i&&p.clearRect(0,0,2e3,1e3),p.lineJoin="round",p.lineJoin="round";const g=new o.EdgeIterator(e);while(g.valid)g.next(),g.collect();g.collect();do{const e=g.edge.first.vertices[r.ccw(g.edge.second)].point,t=g.edge.first.vertices[r.cw(g.edge.second)].point;if(n>0){if(e[0]===-1/0||t[0]===-1/0){g.next();continue}h++,g.edge.first.constraints[g.edge.second]?(d++,2===n&&console.log(`Edge: (*) ${e} > ${t}`)):2===n&&console.log(`Edge: ${e} > ${t}`)}do{g.next(),g.collect()}while(g.valid)}while(null!==g.pos);for(const s of e.triangles){if(s.isInfinite())continue;a++;const e=[];p.fillStyle="red",void 0!==s.vertices[0]&&(e.push(s.vertices[0].point),p.beginPath(),p.arc(c(s.vertices[0].point[0],t),u(s.vertices[0].point[1],t),5,0,2*Math.PI),p.closePath(),p.fill()),void 0!==s.vertices[1]&&(e.push(s.vertices[1].point),p.arc(c(s.vertices[1].point[0],t),u(s.vertices[1].point[1],t),5,0,2*Math.PI),p.closePath(),p.fill()),void 0!==s.vertices[2]&&(e.push(s.vertices[2].point),p.arc(c(s.vertices[2].point[0],t),u(s.vertices[2].point[1],t),5,0,2*Math.PI),p.closePath(),p.fill()),2===n&&console.log("[T] ",...e,s.constraints),p.moveTo(c(s.vertices[0].point[0],t),u(s.vertices[0].point[1],t)),void 0!==s.vertices[0]&&void 0!==s.vertices[1]&&f(p,s.vertices[0].point,s.vertices[1].point,s.constraints[2],t),void 0!==s.vertices[1]&&void 0!==s.vertices[2]&&f(p,s.vertices[1].point,s.vertices[2].point,s.constraints[0],t),void 0!==s.vertices[2]&&void 0!==s.vertices[0]&&f(p,s.vertices[2].point,s.vertices[0].point,s.constraints[1],t)}n>0&&(console.log(`Edges: ${d}/${h}`),console.log(`Faces: ${a}`))}window.DP=a,window.DPL=l,window.DPT=p},1289:function(e,t,i){"use strict";i.r(t);var s=i("df64"),n=i("d677");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("8790");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"0bf2b7ba",null);t["default"]=a.exports},"12d3":function(e,t,i){"use strict";var s=i("a260"),n=i.n(s);n.a},1327:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importStar(i("66cb")),o=i("4a5b"),r=i("4709"),a=i("f10f"),l=i("92b1");class c extends r.Circle{constructor(e,t,i,s,n,o,r){super(e,t,n,o,r),this.type="circulartoken",this.text=i,this.font=s}asDict(){return Object.assign(this.getBaseDict(),{radius:this.r,text:this.text,font:this.font})}fromDict(e){super.fromDict(e),this.r=e.radius,this.text=e.text,this.font=e.font}draw(e){super.draw(e),e.font=this.font,e.save();const t=l.g2l(this.center());e.textAlign="center",e.textBaseline="middle";const i=o.calcFontScale(e,this.text,l.g2lz(this.r),l.g2lz(this.r)),s=0;e.transform(i,s,-s,i,t.x,t.y),e.fillStyle=n.mostReadable(this.fillColour,["#000","#fff"]).toHexString(),e.fillText(this.text,0,0),e.restore()}getInitiativeRepr(){return{uuid:this.uuid,visible:!a.gameStore.IS_DM,group:!1,source:""===this.name||"Unknown shape"===this.name?this.text:this.name,has_img:!1,effects:[],index:1/0}}}t.CircularToken=c},1625:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8f0a"),n=i("6f92"),o=i("b2ed"),r=i("0180"),a=i("f10f"),l=i("92b1");class c{constructor(){this.shown=!1;const e=new s.GlobalPoint(0,0);this.annotationText=new r.Text(e,"","bold 20px serif",0,"rgba(230, 230, 230, 1)"),this.annotationRect=new o.Rect(e,0,0,"rgba(0, 0, 0, 0.6)")}setActiveText(e){if(void 0===this.layer){if(!n.layerManager.hasLayer("draw"))return void console.warn("There is no draw layer to draw annotations on!");this.layer=n.layerManager.getLayer("draw"),this.layer.addShape(this.annotationRect,!1),this.layer.addShape(this.annotationText,!1)}this.shown=""!==e,this.annotationText.refPoint=l.l2g(new s.LocalPoint(this.layer.canvas.width/2,50)),this.annotationText.text=e;const t=this.shown?this.annotationText.getMaxWidth(this.layer.ctx)+10:0,i=this.shown?this.annotationText.getMaxHeight(this.layer.ctx)+10:0;this.annotationRect.refPoint=l.l2g(new s.LocalPoint(this.layer.canvas.width/2-t/2,30)),this.annotationRect.w=t/a.gameStore.zoomFactor,this.annotationRect.h=i/a.gameStore.zoomFactor,this.layer.invalidate(!0)}}t.AnnotationManager=c},"19f9":function(e,t,i){"use strict";i.r(t);var s=i("264b"),n=i("8cd4");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("314d");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"c7fe324c",null);t["default"]=a.exports},"1c76":function(e,t,i){"use strict";i.r(t);var s=i("2c88"),n=i("300e");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("7f1e");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,null,null);t["default"]=a.exports},"1dd6":function(e,t,i){"use strict";i.r(t);var s=i("5ae5"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"1eee":function(e,t,i){"use strict";i.r(t);var s=i("d30b"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"1fd5":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Label manager")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("div",{staticClass:"grid"},[i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Category"}},[e._v("Cat.")])]),i("div",{staticClass:"header name"},[e._v("Name")]),i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Visible"}},[e._v("Vis.")])]),i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Delete"}},[e._v("Del.")])]),i("div",{staticClass:"separator spanrow",staticStyle:{margin:"0 0 7px"}}),i("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],ref:"search",staticClass:"spanrow",attrs:{type:"text",placeholder:"search"},domProps:{value:e.search},on:{input:function(t){t.target.composing||(e.search=t.target.value)}}})]),i("div",{staticClass:"grid scroll"},[e._l(e.categories,function(t){return[e._l(e.labels[t],function(t){return[i("div",{key:"row-"+t.uuid,staticClass:"row",on:{click:function(i){return e.selectLabel(t.uuid)}}},[t.category?[i("div",{key:"cat-"+t.uuid},[e._v(e._s(t.category))]),i("div",{key:"name-"+t.uuid,staticClass:"name"},[e._v(e._s(t.name))])]:e._e(),t.category?e._e():[i("div",{key:"cat-"+t.uuid}),i("div",{key:"name-"+t.uuid,staticClass:"name"},[e._v(e._s(t.name))])],i("div",{key:"visible-"+t.uuid,class:{"lower-opacity":!t.visible},style:{textAlign:"center"},on:{click:function(i){return i.stopPropagation(),e.toggleVisibility(t)}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{key:"delete-"+t.uuid,on:{click:function(i){return i.stopPropagation(),e.deleteLabel(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})])],2)]})]}),0===e.labels.length?[i("div",{attrs:{id:"no-labels"}},[e._v("No labels exist yet")])]:e._e()],2),i("div",{staticClass:"grid"},[i("div",{staticClass:"separator spanrow"}),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.newCategory,expression:"newCategory",modifiers:{trim:!0}}],attrs:{type:"text"},domProps:{value:e.newCategory},on:{input:function(t){t.target.composing||(e.newCategory=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.newName,expression:"newName",modifiers:{trim:!0}}],attrs:{type:"text"},domProps:{value:e.newName},on:{input:function(t){t.target.composing||(e.newName=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),i("button",{attrs:{id:"addLabelButton"},on:{click:function(t){return t.stopPropagation(),e.addLabel(t)}}},[e._v("Add")])])])])},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},"206a":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8f0a"),n=i("6f92"),o=i("6c30"),r=i("4709"),a=i("1327"),l=i("5e7c"),c=i("574e"),u=i("b2ed"),d=i("0180"),h=i("e4ea");function f(e){let t;const i=new s.GlobalPoint(e.x,e.y);if("rect"===e.type_){const s=e;t=new u.Rect(i,s.width,s.height,s.fill_colour,s.stroke_colour,s.uuid)}else if("circle"===e.type_){const s=e;t=new r.Circle(i,s.radius,s.fill_colour,s.stroke_colour,s.uuid)}else if("circulartoken"===e.type_){const s=e;t=new a.CircularToken(i,s.radius,s.text,s.font,s.fill_colour,s.stroke_colour,s.uuid)}else if("line"===e.type_){const n=e;t=new l.Line(i,new s.GlobalPoint(n.x2,n.y2),n.line_width,n.stroke_colour,n.uuid)}else if("multiline"===e.type_){const n=e;t=new c.MultiLine(i,n.points.map(e=>new s.GlobalPoint(e.x,e.y)),n.line_width,n.stroke_colour,n.uuid)}else if("polygon"===e.type_){const n=e;t=new h.Polygon(i,n.vertices.map(e=>new s.GlobalPoint(e.x,e.y)),n.fill_colour,n.stroke_colour,n.uuid)}else if("text"===e.type_){const s=e;t=new d.Text(i,s.text,s.font,s.angle,s.fill_colour,s.stroke_colour,s.uuid)}else{if("assetrect"!==e.type_)return;{const s=e,r=new Image(s.width,s.height);s.src.startsWith("http")?r.src=new URL(s.src).pathname:r.src=s.src,t=new o.Asset(r,i,s.width,s.height,s.uuid),r.onload=()=>{n.layerManager.getLayer(e.layer).invalidate(!1)}}}return t.fromDict(e),t}t.createShapeFromDict=f},"208e":function(e,t,i){"use strict";i.r(t);var s=i("27ae"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"223d":function(e,t,i){"use strict";var s=i("e756"),n=i.n(s);n.a},"22bd":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("SelectContext",{ref:"selectcontext"})},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},2380:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,colour:"rgba(255, 255, 255, 0.8)",mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("DM Settings")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body",on:{click:e.handleClick}},[i("div",{attrs:{id:"categories"}},e._l(e.categories,function(t,s){return i("div",{key:t,staticClass:"category",class:{selected:e.selection===s},on:{click:function(t){e.selection=s}}},[e._v(e._s(t))])}),0),i("div",{directives:[{name:"show",rawName:"v-show",value:0===e.selection,expression:"selection === 0"}],staticClass:"panel"},[i("div",{staticClass:"spanrow header"},[e._v("Players")]),e._l(e.$store.state.game.players,function(t){return i("div",{key:t.id,staticClass:"row smallrow"},[i("div",[e._v(e._s(t.name))]),i("div",[i("div",{on:{click:function(i){return e.kickPlayer(t.id)}}},[e._v("Kick")])])])}),0===Object.values(e.$store.state.game.players).length?i("div",{staticClass:"row smallrow"},[i("div",{staticClass:"spanrow"},[e._v("There are no players yet, invite some using the link below!")])]):e._e(),i("div",{staticClass:"spanrow header"},[e._v("Invite code")]),i("div",{staticClass:"row"},[i("div",[e._v("Invitation URL:")]),e.showRefreshState?[i("InputCopyElement",{attrs:{value:e.refreshState}})]:[i("InputCopyElement",{attrs:{value:e.invitationUrl}})]],2),i("div",{staticClass:"row",on:{click:e.refreshInviteCode}},[i("div"),i("div",[i("button",[e._v("Refresh invitation code")])])]),i("div",{staticClass:"spanrow header"},[e._v("Danger Zone")]),i("div",{staticClass:"row"},[i("div",[e.locked?[e._v("Unlock")]:[e._v("Lock")],e._v(" Session "),i("i",[e._v("(DM access only)")])],2),i("div",[i("button",{staticClass:"danger",on:{click:e.toggleSessionLock}},[e.locked?[e._v("Unlock")]:[e._v("Lock")],e._v(" this Session")],2)])]),i("div",{staticClass:"row"},[i("div",[e._v("Remove Session")]),i("div",[i("button",{staticClass:"danger",on:{click:e.deleteSession}},[e._v("Delete this Session")])])])],2),i("div",{directives:[{name:"show",rawName:"v-show",value:1===e.selection,expression:"selection === 1"}],staticClass:"panel"},[i("div",{staticClass:"row"},[i("label",{attrs:{for:"useGridInput"}},[e._v("Use grid")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.useGrid,expression:"useGrid"}],attrs:{id:"useGridInput",type:"checkbox"},domProps:{checked:Array.isArray(e.useGrid)?e._i(e.useGrid,null)>-1:e.useGrid},on:{change:function(t){var i=e.useGrid,s=t.target,n=!!s.checked;if(Array.isArray(i)){var o=null,r=e._i(i,o);s.checked?r<0&&(e.useGrid=i.concat([o])):r>-1&&(e.useGrid=i.slice(0,r).concat(i.slice(r+1)))}else e.useGrid=n}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"gridSizeInput"}},[e._v("Grid Size (in pixels):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.gridSize,expression:"gridSize",modifiers:{number:!0}}],attrs:{id:"gridSizeInput",type:"number",min:"0"},domProps:{value:e.gridSize},on:{input:function(t){t.target.composing||(e.gridSize=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"unitSizeInput"}},[e._v("Unit Size (in ft.):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.unitSize,expression:"unitSize",modifiers:{number:!0}}],attrs:{id:"unitSizeInput",type:"number"},domProps:{value:e.unitSize},on:{input:function(t){t.target.composing||(e.unitSize=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:2===e.selection,expression:"selection === 2"}],staticClass:"panel"},[i("div",{staticClass:"spanrow header"},[e._v("Core")]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fakePlayerInput"}},[e._v("Fake player:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fakePlayer,expression:"fakePlayer"}],attrs:{id:"fakePlayerInput",type:"checkbox"},domProps:{checked:Array.isArray(e.fakePlayer)?e._i(e.fakePlayer,null)>-1:e.fakePlayer},on:{change:function(t){var i=e.fakePlayer,s=t.target,n=!!s.checked;if(Array.isArray(i)){var o=null,r=e._i(i,o);s.checked?r<0&&(e.fakePlayer=i.concat([o])):r>-1&&(e.fakePlayer=i.slice(0,r).concat(i.slice(r+1)))}else e.fakePlayer=n}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"useFOWInput"}},[e._v("Fill entire canvas with FOW:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fullFOW,expression:"fullFOW"}],attrs:{id:"useFOWInput",type:"checkbox"},domProps:{checked:Array.isArray(e.fullFOW)?e._i(e.fullFOW,null)>-1:e.fullFOW},on:{change:function(t){var i=e.fullFOW,s=t.target,n=!!s.checked;if(Array.isArray(i)){var o=null,r=e._i(i,o);s.checked?r<0&&(e.fullFOW=i.concat([o])):r>-1&&(e.fullFOW=i.slice(0,r).concat(i.slice(r+1)))}else e.fullFOW=n}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fowLOS"}},[e._v("Only show lights in LoS:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fowLOS,expression:"fowLOS"}],attrs:{id:"fowLOS",type:"checkbox"},domProps:{checked:Array.isArray(e.fowLOS)?e._i(e.fowLOS,null)>-1:e.fowLOS},on:{change:function(t){var i=e.fowLOS,s=t.target,n=!!s.checked;if(Array.isArray(i)){var o=null,r=e._i(i,o);s.checked?r<0&&(e.fowLOS=i.concat([o])):r>-1&&(e.fowLOS=i.slice(0,r).concat(i.slice(r+1)))}else e.fowLOS=n}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fowOpacity"}},[e._v("FOW opacity:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.fowOpacity,expression:"fowOpacity",modifiers:{number:!0}}],attrs:{id:"fowOpacity",type:"number",min:"0",max:"1",step:"0.1"},domProps:{value:e.fowOpacity},on:{input:function(t){t.target.composing||(e.fowOpacity=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"spanrow header"},[e._v("Advanced")]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"visionMode"}},[e._v("Vision Mode:")]),i("div",[i("select",{attrs:{id:"visionMode"},on:{change:e.changeVisionMode}},[i("option",{domProps:{selected:"bvh"===e.$store.state.game.visionMode}},[e._v("BVH")]),i("option",{domProps:{selected:"triangle"===e.$store.state.game.visionMode}},[e._v("Triangle")])])])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"vmininp"}},[e._v("Minimal full vision (ft):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:e.visionRangeMin,expression:"visionRangeMin",modifiers:{lazy:!0,number:!0}}],attrs:{id:"vmininp",type:"number",min:"0"},domProps:{value:e.visionRangeMin},on:{change:function(t){e.visionRangeMin=e._n(t.target.value)},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"vmaxinp"}},[e._v("Maximal vision (ft):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:e.visionRangeMax,expression:"visionRangeMax",modifiers:{lazy:!0,number:!0}}],attrs:{id:"vmaxinp",type:"number",min:"0"},domProps:{value:e.visionRangeMax},on:{change:function(t){e.visionRangeMax=e._n(t.target.value)},blur:function(t){return e.$forceUpdate()}}})])])])])])},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},2469:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("66cb")),o=i("4a5b"),r=i("0bc6"),a=i("f312"),l=i("8f0a"),c=i("6f92"),u=i("f10f"),d=i("92b1");class h{constructor(e,t,i,s){this.fillColour="#000",this.strokeColour="rgba(0,0,0,0)",this.name="Unknown shape",this.nameVisible=!0,this.trackers=[],this.auras=[],this.labels=[],this._owners=[],this.visionObstruction=!1,this.movementObstruction=!1,this.isToken=!1,this.showHighlight=!1,this.annotation="",this.globalCompositeOperation="source-over",this.options=new Map,this._refPoint=e,this.uuid=s||o.uuidv4(),void 0!==t&&(this.fillColour=t),void 0!==i&&(this.strokeColour=i)}get refPoint(){return this._refPoint}set refPoint(e){this._refPoint=e}visibleInCanvas(e){return!1}getPointIndex(e,t=0){for(const[i,s]of this.points.entries())if(Math.abs(e.x-s[0])<=t&&Math.abs(e.y-s[1])<=t)return i;return-1}getPointOrientation(e){const t=l.GlobalPoint.fromArray(this.points[(this.points.length+e-1)%this.points.length]),i=l.GlobalPoint.fromArray(this.points[e]),s=l.GlobalPoint.fromArray(this.points[(e+1)%this.points.length]),n=s.subtract(t),o=t.add(n.multiply(.5));return i.subtract(o).normalize()}invalidate(e){const t=c.layerManager.getLayer(this.layer);t&&t.invalidate(e)}checkVisionSources(e=!0){const t=this,i=u.gameStore.visionBlockers.indexOf(this.uuid);let s=!1;this.visionObstruction&&-1===i?(u.gameStore.visionBlockers.push(this.uuid),s=!0):!this.visionObstruction&&i>=0&&(u.gameStore.visionBlockers.splice(i,1),s=!0),s&&e&&u.gameStore.recalculateVision(),this.auras.forEach(e=>{const i=u.gameStore.visionSources,s=i.findIndex(t=>t.aura===e.uuid);e.visionSource&&-1===s?i.push({shape:t.uuid,aura:e.uuid}):!e.visionSource&&s>=0&&i.splice(s,1)});for(let n=u.gameStore.visionSources.length-1;n>=0;n--){const e=u.gameStore.visionSources[n];e.shape===t.uuid&&(t.auras.some(t=>t.uuid===e.aura&&t.visionSource)||u.gameStore.visionSources.splice(n,1))}}setMovementBlock(e,t=!0){this.movementObstruction=e||!1;const i=u.gameStore.movementblockers.indexOf(this.uuid);let s=!1;this.movementObstruction&&-1===i?(u.gameStore.movementblockers.push(this.uuid),s=!0):!this.movementObstruction&&i>=0&&(u.gameStore.movementblockers.splice(i,1),s=!0),s&&t&&u.gameStore.recalculateMovement()}setIsToken(e){if(this.isToken=e,this.ownedBy()){const e=u.gameStore.ownedtokens.indexOf(this.uuid);this.isToken&&-1===e?u.gameStore.ownedtokens.push(this.uuid):!this.isToken&&e>=0&&u.gameStore.ownedtokens.splice(e,1)}}getBaseDict(){return{type_:this.type,uuid:this.uuid,x:this.refPoint.x,y:this.refPoint.y,layer:this.layer,draw_operator:this.globalCompositeOperation,movement_obstruction:this.movementObstruction,vision_obstruction:this.visionObstruction,auras:a.aurasToServer(this.auras),trackers:this.trackers,labels:this.labels,owners:this._owners,fill_colour:this.fillColour,stroke_colour:this.strokeColour,name:this.name,name_visible:this.nameVisible,annotation:this.annotation,is_token:this.isToken,options:JSON.stringify([...this.options])}}fromDict(e){this.layer=e.layer,this.globalCompositeOperation=e.draw_operator,this.movementObstruction=e.movement_obstruction,this.visionObstruction=e.vision_obstruction,this.auras=a.aurasFromServer(e.auras),this.trackers=e.trackers,this.labels=e.labels,this._owners=e.owners,this.isToken=e.is_token,this.nameVisible=e.name_visible,e.annotation&&(this.annotation=e.annotation),e.name&&(this.name=e.name),e.options&&(this.options=new Map(JSON.parse(e.options)))}draw(e){if(void 0!==this.globalCompositeOperation?e.globalCompositeOperation=this.globalCompositeOperation:e.globalCompositeOperation="source-over",this.showHighlight){const t=this.getBoundingBox();e.strokeStyle="red",e.strokeRect(d.g2lx(t.topLeft.x)-5,d.g2ly(t.topLeft.y)-5,d.g2lz(t.w)+10,d.g2lz(t.h)+10)}}drawAuras(e){for(const i of this.auras){if(0===i.value&&0===i.dim)return;e.beginPath();const s=d.g2l(this.center()),o=d.g2lr(i.value+i.dim);if(0===i.dim)e.fillStyle=i.colour;else{const t=e.createRadialGradient(s.x,s.y,d.g2lr(i.value),s.x,s.y,d.g2lr(i.value+i.dim)),o=n.default(i.colour);e.fillStyle=t,t.addColorStop(0,i.colour),t.addColorStop(1,o.setAlpha(0).toRgbString())}if(i.visionSource&&void 0!==i.lastPath)try{e.fill(i.lastPath)}catch(t){e.arc(s.x,s.y,o,0,2*Math.PI),e.fill(),console.warn(t)}else e.arc(s.x,s.y,o,0,2*Math.PI),e.fill()}}getInitiativeRepr(){return{uuid:this.uuid,visible:!u.gameStore.IS_DM,group:!1,source:this.name,has_img:!1,effects:[],index:1/0}}moveLayer(e,t){const i=c.layerManager.getLayer(this.layer),s=c.layerManager.getLayer(e);void 0!==i&&void 0!==s&&(this.layer=e,i.shapes.splice(i.shapes.indexOf(this),1),s.shapes.push(this),i.invalidate(!0),s.invalidate(!1),t&&r.socket.emit("Shape.Layer.Change",{uuid:this.uuid,layer:e}))}get owners(){return Object.freeze(this._owners.slice())}ownedBy(e){return void 0===e&&(e=u.gameStore.username),u.gameStore.IS_DM||this._owners.includes(e)||u.gameStore.FAKE_PLAYER&&u.gameStore.activeTokens.includes(this.uuid)}addOwner(e){this._owners.includes(e)||this._owners.push(e)}updateOwner(e,t){const i=this._owners.findIndex(t=>t===e);i>=0?this._owners.splice(i,1,t):this.addOwner(t)}removeOwner(e){const t=this._owners.findIndex(t=>t===e);this._owners.splice(t,1)}}t.Shape=h},"255e":function(e,t,i){"use strict";i.r(t);var s=i("851c"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"264b":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"menuContainer"}},[i("div",{ref:"rm",style:{left:e.visible.settings?"200px":"0",top:e.visible.locations?"100px":"0"},attrs:{id:"radialmenu"}},[i("div",{staticClass:"rm-wrapper"},[i("div",{staticClass:"rm-toggler"},[i("ul",{staticClass:"rm-list",class:{"rm-list-dm":e.IS_DM}},[e.IS_DM?i("li",{staticClass:"rm-item",attrs:{id:"rm-locations"},on:{click:function(t){e.visible.locations=!e.visible.locations}}},[e._m(0)]):e._e(),i("li",{staticClass:"rm-item",attrs:{id:"rm-settings"},on:{click:function(t){e.visible.settings=!e.visible.settings}}},[e._m(1)])])]),e._m(2)])]),i("transition",{attrs:{name:"settings"},on:{enter:function(t){e.$refs.rm.style.transition="left 500ms"}}},[e.visible.settings?i("div",{ref:"settings",attrs:{id:"menu"},on:{click:e.settingsClick}},[i("div",{staticStyle:{width:"200px",height:"90%","overflow-y":"auto","overflow-x":"hidden"}},[e.IS_DM?[i("button",{staticClass:"menu-accordion"},[e._v("Assets")]),i("div",{staticClass:"menu-accordion-panel"},[i("a",{staticClass:"actionButton",attrs:{href:"/assets",target:"blank",title:"Open asset manager"}},[i("i",{staticClass:"fas fa-external-link-alt"})]),i("div",{staticClass:"directory",attrs:{id:"menu-tokens"}},[i("asset-node",{attrs:{asset:e.assets}}),e.assets?e._e():i("div",[e._v("No assets")])],1)]),i("button",{staticClass:"menu-accordion"},[e._v("Notes")]),i("div",{staticClass:"menu-accordion-panel"},[i("div",{staticClass:"menu-accordion-subpanel",attrs:{id:"menu-notes"}},[i("a",{staticClass:"actionButton",on:{click:e.createNote}},[i("i",{staticClass:"far fa-plus-square"})]),e._l(e.notes,function(t){return i("div",{key:t.uuid,staticStyle:{cursor:"pointer"},on:{click:function(i){return e.openNote(t)}}},[e._v(e._s(t.title||"[?]"))])}),e.notes.length?e._e():i("div",[e._v("No notes")])],2)]),i("button",{staticClass:"menu-accordion",on:{click:e.openDmSettings}},[e._v("DM Options")])]:e._e(),i("button",{staticClass:"menu-accordion"},[e._v("Client Options")]),i("div",{staticClass:"menu-accordion-panel"},[i("div",{staticClass:"menu-accordion-subpanel"},[i("label",{attrs:{for:"gridColour"}},[e._v("Grid Colour:")]),i("color-picker",{attrs:{id:"gridColour",color:e.gridColour},on:{"update:color":function(t){e.gridColour=t}}}),i("label",{attrs:{for:"fowColour"}},[e._v("FOW Colour:")]),i("color-picker",{attrs:{id:"fowColour",color:e.fowColour},on:{"update:color":function(t){e.fowColour=t}}}),i("label",{attrs:{for:"rulerColour"}},[e._v("Ruler Colour:")]),i("color-picker",{attrs:{id:"rulerColour",color:e.rulerColour},on:{"update:color":function(t){e.rulerColour=t}}})],1)])],2),i("router-link",{staticClass:"menu-accordion",staticStyle:{"text-decoration":"none",display:"inline-block",position:"absolute",bottom:"0"},attrs:{to:"/dashboard"}},[e._v("Exit")])],1):e._e()]),i("transition",{attrs:{name:"locations"},on:{enter:function(t){e.$refs.rm.style.transition="top 500ms"}}},[e.IS_DM&&e.visible.locations?i("div",{attrs:{id:"locations-menu"}},[i("div",[e._l(e.locations,function(t){return i("div",{key:t,on:{click:function(i){return e.changeLocation(t)}}},[e._v(e._s(t))])}),i("div",{on:{click:e.createLocation}},[i("i",{staticClass:"fas fa-plus"})])],2)]):e._e()]),i("img",{attrs:{id:"dragImage"}})],1)},n=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{attrs:{href:"#"}},[i("i",{staticClass:"far fa-compass"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{attrs:{href:"#"}},[i("i",{staticClass:"fas fa-cog"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"rm-topper"},[i("i",{staticClass:"icon-share-alt"})])}];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},2686:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return null!==e.note?i("modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("span",{on:{click:function(t){return e.$refs.title.select()}}},[i("i",{staticClass:"fas fa-pencil-alt",staticStyle:{"font-size":"15px"}})]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.note.title,expression:"note.title"}],ref:"title",domProps:{value:e.note.title},on:{change:e.updateNote,input:function(t){t.target.composing||e.$set(e.note,"title",t.target.value)}}}),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}],null,!1,1320213373)},[i("div",{staticClass:"modal-body"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.note.text,expression:"note.text"}],ref:"textarea",style:{height:e.calcHeight()},domProps:{value:e.note.text},on:{change:e.updateNote,input:function(t){t.target.composing||e.$set(e.note,"text",t.target.value)}}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.removeNote}},[i("i",{staticClass:"far fa-trash-alt"}),e._v(" Remove\n    ")])])]):e._e()},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},2756:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("65d9")),o=s.__importDefault(i("496c")),r=s.__importDefault(i("ea6a")),a=i("4a5b"),l=i("0bc6"),c=i("8f0a"),u=i("6f92"),d=i("b2ed"),h=i("f10f"),f=i("2838"),p=i("92b1"),g=i("5a5c");var v;(function(e){e[e["Noop"]=0]="Noop",e[e["Resize"]=1]="Resize",e[e["Drag"]=2]="Drag",e[e["GroupSelect"]=3]="GroupSelect"})(v=t.SelectOperations||(t.SelectOperations={}));const m=new c.GlobalPoint(-1e3,-1e3);let y=class extends r.default{constructor(){super(...arguments),this.name="Select",this.showContextMenu=!1,this.active=!1,this.mode=v.Noop,this.resizePoint=0,this.deltaChanged=!1,this.dragRay=new c.Ray(new c.LocalPoint(0,0),new c.Vector(0,0)),this.selectionStartPoint=m,this.selectionHelper=new d.Rect(m,0,0)}created(){this.selectionHelper.globalCompositeOperation="source-over"}onMouseDown(e){const t=u.layerManager.getLayer();if(void 0===t)return void console.log("No active layer!");this.selectionHelper.owners.includes(h.gameStore.username)||this.selectionHelper.addOwner(h.gameStore.username);const i=g.getMouse(e),s=p.l2g(i);let n,o=!1;n=t.selection.length?t.shapes.concat(t.selection):t.shapes;for(let r=n.length-1;r>=0;r--){const e=n[r];if(this.resizePoint=e.getPointIndex(s,p.l2gz(3)),this.resizePoint>=0){t.selection=[e],a.getRef("selectionInfo").shape=e,this.mode=v.Resize,t.invalidate(!0),o=!0;break}if(e.contains(s)){const s=e;-1===t.selection.indexOf(s)&&(t.selection=[s],a.getRef("selectionInfo").shape=s),this.mode=v.Drag;const n=p.g2l(s.refPoint);this.dragRay=new c.Ray(n,i.subtract(n)),t.invalidate(!0),o=!0;break}}if(!o){this.mode=v.GroupSelect;for(const e of t.selection)a.getRef("selectionInfo").shape=e;this.selectionStartPoint=s,this.selectionHelper.refPoint=this.selectionStartPoint,this.selectionHelper.w=0,this.selectionHelper.h=0,t.selection=[this.selectionHelper],t.invalidate(!0)}this.active=!0}onMouseMove(e){const t=u.layerManager.getLayer();if(void 0===t)return void console.log("No active layer!");const i=g.getMouse(e),s=p.l2g(i);if(this.deltaChanged=!1,this.mode===v.GroupSelect){const e=s;this.selectionHelper.w=Math.abs(e.x-this.selectionStartPoint.x),this.selectionHelper.h=Math.abs(e.y-this.selectionStartPoint.y),this.selectionHelper.refPoint=new c.GlobalPoint(Math.min(this.selectionStartPoint.x,e.x),Math.min(this.selectionStartPoint.y,e.y)),t.invalidate(!0)}else if(t.selection.length){const n=p.g2l(t.selection[t.selection.length-1].refPoint),o=n.add(this.dragRay.direction);let r=i.subtract(o).multiply(1/h.gameStore.zoomFactor);const a=r;if(this.mode===v.Drag){if("tokens"===t.name&&(!e.shiftKey||!h.gameStore.IS_DM))for(const e of t.selection)e.ownedBy()&&e.uuid!==this.selectionHelper.uuid&&(r=f.calculateDelta(r,e),r!==a&&(this.deltaChanged=!0));for(const e of t.selection)e.ownedBy()&&(e.refPoint=e.refPoint.add(r),e!==this.selectionHelper&&(e.visionObstruction&&h.gameStore.recalculateVision(!0),l.socket.emit("Shape.Update",{shape:e.asDict(),redraw:!0,temporary:!0})));t.invalidate(!1)}else if(this.mode===v.Resize)for(const e of t.selection)e.ownedBy()&&(e.resize(this.resizePoint,i),e!==this.selectionHelper&&(e.visionObstruction&&h.gameStore.recalculateVision(!0),l.socket.emit("Shape.Update",{shape:e.asDict(),redraw:!0,temporary:!0})),t.invalidate(!1),this.updateCursor(t,s));else this.updateCursor(t,s)}else document.body.style.cursor="default"}onMouseUp(e){if(!this.active)return;if(void 0===u.layerManager.getLayer())return void console.log("No active layer!");const t=u.layerManager.getLayer();this.mode===v.GroupSelect?(t.clearSelection(),t.shapes.forEach(e=>{if(!e.ownedBy())return;if(e===this.selectionHelper)return;const i=e.getBoundingBox();e.ownedBy()&&this.selectionHelper.refPoint.x<=i.topRight.x&&this.selectionHelper.refPoint.x+this.selectionHelper.w>=i.topLeft.x&&this.selectionHelper.refPoint.y<=i.botLeft.y&&this.selectionHelper.refPoint.y+this.selectionHelper.h>=i.topLeft.y&&t.selection.push(e)}),t.selection.length>0&&t.selection.push(this.selectionHelper),t.invalidate(!0)):t.selection.length&&t.selection.forEach(i=>{if(i.ownedBy()){if(this.mode===v.Drag){if(this.dragRay.origin.x===p.g2lx(i.refPoint.x)&&this.dragRay.origin.y===p.g2ly(i.refPoint.y))return;!h.gameStore.useGrid||e.altKey||this.deltaChanged||i.snapToGrid(),i!==this.selectionHelper&&(i.visionObstruction&&h.gameStore.recalculateVision(),i.movementObstruction&&h.gameStore.recalculateMovement(),l.socket.emit("Shape.Update",{shape:i.asDict(),redraw:!0,temporary:!1})),t.invalidate(!1)}this.mode===v.Resize&&(h.gameStore.useGrid&&!e.altKey&&i.resizeToGrid(),i!==this.selectionHelper&&(i.visionObstruction&&h.gameStore.recalculateVision(),i.movementObstruction&&h.gameStore.recalculateMovement(),l.socket.emit("Shape.Update",{shape:i.asDict(),redraw:!0,temporary:!1})),t.invalidate(!1))}}),this.mode=v.Noop,this.active=!1}onContextMenu(e){if(void 0===u.layerManager.getLayer())return void console.log("No active layer!");const t=u.layerManager.getLayer(),i=g.getMouse(e),s=p.l2g(i);for(const n of t.selection)if(n.contains(s)&&n!==this.selectionHelper)return t.selection=[n],a.getRef("selectionInfo").shape=n,t.invalidate(!0),void this.$parent.$refs.shapecontext.open(e,n);this.$refs.selectcontext.open(e)}updateCursor(e,t){for(const i of e.selection){const e=i.getPointIndex(t,p.l2gz(3));if(e<0)document.body.style.cursor="default";else{let t=i.getPointOrientation(e).angle();t<0&&(t+=360);const s=22.5;(t>=315+s||t<s||t>=135+s&&t<225-s)&&(document.body.style.cursor="ew-resize"),(t>=45+s&&t<135-s||t>=225+s&&t<315-s)&&(document.body.style.cursor="ns-resize"),(t>=s&&t<90-s||t>=180+s&&t<270-s)&&(document.body.style.cursor="nwse-resize"),(t>=90+s&&t<180-s||t>=270+s&&t<360-s)&&(document.body.style.cursor="nesw-resize")}}}};y=s.__decorate([n.default({components:{SelectContext:o.default}})],y),t.default=y},"27ae":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=i("2f62"),a=s.__importDefault(i("6c7c")),l=s.__importDefault(i("d65f")),c=i("4a5b"),u=i("0bc6"),d=i("af17"),h=i("f10f"),f=i("6f92");let p=class extends n.default{constructor(){super(...arguments),this.visible=!1,this.categories=["Admin","Grid","Vision"],this.selection=0,this.showRefreshState=!1,this.refreshState="pending"}mounted(){d.EventBus.$on("DmSettings.Open",()=>{this.visible=!0}),d.EventBus.$on("DmSettings.RefreshedInviteCode",()=>{this.showRefreshState=!1})}beforeDestroy(){d.EventBus.$off("DmSettings.Open"),d.EventBus.$off("DmSettings.RefreshedInviteCode")}get invitationUrl(){return window.location.protocol+"//"+window.location.host+"/invite/"+h.gameStore.invitationCode}get locked(){return h.gameStore.isLocked}get useGrid(){return h.gameStore.useGrid}set useGrid(e){h.gameStore.setUseGrid({useGrid:e,sync:!0})}get unitSize(){return h.gameStore.unitSize}set unitSize(e){"number"===typeof e&&h.gameStore.setUnitSize({unitSize:e,sync:!0})}get gridSize(){return h.gameStore.gridSize}set gridSize(e){"number"===typeof e&&h.gameStore.setGridSize({gridSize:e,sync:!0})}get fakePlayer(){return h.gameStore.FAKE_PLAYER}set fakePlayer(e){h.gameStore.setFakePlayer(e)}get fullFOW(){return h.gameStore.fullFOW}set fullFOW(e){h.gameStore.setFullFOW({fullFOW:e,sync:!0})}get fowOpacity(){return h.gameStore.fowOpacity}set fowOpacity(e){"number"===typeof e&&h.gameStore.setFOWOpacity({fowOpacity:e,sync:!0})}get fowLOS(){return h.gameStore.fowLOS}set fowLOS(e){h.gameStore.setLineOfSight({fowLOS:e,sync:!0})}get visionRangeMin(){return h.gameStore.visionRangeMin}set visionRangeMin(e){"number"===typeof e&&h.gameStore.setVisionRangeMin({value:e,sync:!0})}get visionRangeMax(){return h.gameStore.visionRangeMax}set visionRangeMax(e){"number"===typeof e&&h.gameStore.setVisionRangeMax({value:e,sync:!0})}changeVisionMode(e){const t=e.target.value.toLowerCase();"bvh"!==t&&"triangle"!==t||(h.gameStore.setVisionMode({mode:t,sync:!0}),h.gameStore.recalculateVision(),h.gameStore.recalculateMovement(),f.layerManager.invalidate())}handleClick(e){const t=e.target.firstElementChild;t instanceof HTMLInputElement&&t.click()}refreshInviteCode(){u.socket.emit("Room.Info.InviteCode.Refresh"),this.refreshState="pending",this.showRefreshState=!0}kickPlayer(e){u.socket.emit("Room.Info.Players.Kick",e),h.gameStore.kickPlayer(e)}toggleSessionLock(){h.gameStore.setIsLocked({isLocked:!h.gameStore.isLocked,sync:!0})}deleteSession(){c.getRef("prompt").prompt(`ENTER ${h.gameStore.roomCreator}/${h.gameStore.roomName} TO CONFIRM SESSION REMOVAL.`,"DELETING SESSION").then(e=>{e===`${h.gameStore.roomCreator}/${h.gameStore.roomName}`&&(u.socket.emit("Room.Delete"),this.$router.push("/"))},()=>{})}};p=s.__decorate([o.default({components:{InputCopyElement:a.default,Modal:l.default},computed:Object.assign({},r.mapState("game",["invitationCode"]))})],p),t.default=p},2838:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8f0a"),n=i("6f92"),o=i("f10f"),r=i("d6be"),a=i("98ef"),l=i("4aee");function c(e,t,i){if(0===e.x&&0===e.y)return e;if("bvh"===o.gameStore.visionMode){void 0===i&&(i=[]);const r=t.getBoundingBox(),a=r.offset(e);let l=!1;for(const t of o.gameStore.movementblockers){if(i.includes(t))continue;const o=n.layerManager.UUIDMap.get(t),c=o.getBoundingBox();let u=c.intersectsWithInner(a);if(!u){const t=s.Ray.fromPoints(r.topLeft.add(e.normalize()),a.topLeft),i=t.direction.inverse(),n=[i.x<0,i.y<0];u=c.intersectP(t,i,n).hit}if(u){const n=c.center(),o=r.center(),a=o.subtract(n),u=new s.Vector(1,0),d=new s.Vector(0,1);let h=a.dot(u),f=a.dot(d);h>c.w/2&&(h=c.w/2),h<-c.w/2&&(h=-c.w/2),f>c.h/2&&(f=c.h/2),f<-c.h/2&&(f=-c.h/2);const p=n.add(u.multiply(h)).add(d.multiply(f));p.x===r.topLeft.x||p.x===r.topRight.x?e=new s.Vector(0,e.y):p.y===r.topLeft.y||p.y===r.botLeft.y?e=new s.Vector(e.x,0):p.x<r.topLeft.x?e=new s.Vector(p.x-r.topLeft.x,e.y):p.x>r.topRight.x?e=new s.Vector(p.x-r.topRight.x,e.y):p.y<r.topLeft.y?e=new s.Vector(e.x,p.y-r.topLeft.y):p.y>r.botLeft.y&&(e=new s.Vector(e.x,p.y-r.botLeft.y)),l=!0,i.push(t);break}}return l&&(e=c(e,t,i)),e}{const i=r.PA_CDT.movement.locate(t.center().asArray(),null).loc;for(const s of t.points){const t=r.PA_CDT.movement.locate(s,i),n=t.loc;null!==n&&(e=u(s,n,e))}return e}}function u(e,t,i,n=[]){const o=new s.GlobalPoint(e[0],e[1]),r=o.add(i).asArray();if(t.contains(r))return i;n.push(t);for(let c=0;c<3;c++){if(n.includes(t.neighbours[c]))continue;const d=t.vertices[l.cw(c)].point,h=t.vertices[l.ccw(c)].point,f=l.intersection(e,r,d,h);if(null===f)continue;if(!t.isConstrained(c))return u(e,t.neighbours[c],i,n);if(f[0]===o.x&&f[1]===o.y){l.orientation;const t=l.orientation(e,r,h);if(t===a.Sign.LEFT_TURN)continue;if(t===a.Sign.ZERO)continue}let p=new s.GlobalPoint(f[0],f[1]).subtract(o).multiply(.8);p.length()<1&&(p=new s.Vector(0,0)),p.length()<i.length()&&(i=p)}return i}t.calculateDelta=c},"28b6":function(e,t,i){"use strict";var s=i("ee96"),n=i.n(s);n.a},2900:function(e,t,i){"use strict";var s=i("676f"),n=i.n(s);n.a},"29a2":function(e,t,i){"use strict";i.r(t);var s=i("e4b0"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"2afa":function(e,t,i){"use strict";i.r(t);var s=i("3cc2"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"2b48":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("0bc6"),n=i("f10f");function o(){s.socket.emit("Client.Options.Set",{locationOptions:{panX:n.gameStore.panX,panY:n.gameStore.panY,zoomFactor:n.gameStore.zoomFactor}})}t.sendClientOptions=o},"2baf":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=i("60a3"),a=i("4a5b");let l=class extends n.default{constructor(){super(...arguments),this.showImage=null}get folders(){return Object.keys(this.asset).filter(e=>!["__files"].includes(e)).sort(a.alphSort)}get files(){return this.asset.__files?this.asset.__files.concat().sort((e,t)=>e.name.toLowerCase()>t.name.toLowerCase()?1:-1):[]}toggle(e){for(let t=0;t<e.target.children.length;t++){const i=e.target.children[t];i.style.display=""===i.style.display?"block":""}}dragStart(e,t){if(this.showImage=null,null===e||null===e.dataTransfer)return;const i=e.target.querySelector(".preview");e.dataTransfer.setDragImage(i,0,0),e.dataTransfer.setData("text/plain",t)}};s.__decorate([r.Prop()],l.prototype,"asset",void 0),l=s.__decorate([o.default({name:"asset-node"})],l),t.default=l},"2bfd":function(e,t,i){"use strict";var s=i("c159"),n=i.n(s);n.a},"2c88":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.visible?i("div",{staticClass:"ContextMenu",style:{left:e.left,top:e.top},attrs:{tabindex:"-1"},on:{blur:function(t){return e.$emit("close")}}},[i("ul",[e._t("default")],2)]):e._e()},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},"2d5b":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=i("6fc5"),o=i("3a0b");let r=class extends n.VuexModule{constructor(){super(...arguments),this.root=-1,this.files=[],this.folders=[],this.idMap=new Map,this.selected=[]}clear(){this.folders=[],this.files=[]}clearSelected(){console.log("Cleared"),this.selected=[]}setRoot(e){this.root=e}};s.__decorate([n.Mutation],r.prototype,"clear",null),s.__decorate([n.Mutation],r.prototype,"clearSelected",null),s.__decorate([n.Mutation],r.prototype,"setRoot",null),r=s.__decorate([n.Module({dynamic:!0,store:o.rootStore,name:"assets",namespaced:!0})],r),t.assetStore=n.getModule(r)},"2dad":function(e,t,i){},"300e":function(e,t,i){"use strict";i.r(t);var s=i("cde6"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"308b":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=s.__importDefault(i("1c76")),a=i("4a5b"),l=i("af17"),c=i("6f92"),u=i("f10f");let d=class extends n.default{constructor(){super(...arguments),this.visible=!1,this.x=0,this.y=0,this.shape=null}get activeLayer(){const e=c.layerManager.getLayer();return void 0===e?"":e.name}open(e,t){this.visible=!0,this.x=e.pageX,this.y=e.pageY,this.shape=t,this.$nextTick(()=>this.$children[0].$el.focus())}close(){this.visible=!1,this.shape=null}getLayers(){return c.layerManager.layers.filter(e=>e.selectable&&(u.gameStore.IS_DM||e.playerEditable))}getActiveLayer(){return c.layerManager.getLayer()}getInitiativeWord(){return null===this.shape?"":a.getRef("initiative").contains(this.shape.uuid)?"Show":"Add"}setLayer(e){null!==this.shape&&(this.shape.moveLayer(e,!0),this.close())}moveToBack(){if(null===this.shape)return;const e=this.getActiveLayer();e.moveShapeOrder(this.shape,0,!0),this.close()}moveToFront(){if(null===this.shape)return;const e=this.getActiveLayer();e.moveShapeOrder(this.shape,e.shapes.length-1,!0),this.close()}addInitiative(){if(null===this.shape)return;const e=a.getRef("initiative");e.contains(this.shape.uuid)||e.addInitiative(this.shape.getInitiativeRepr()),e.visible=!0,this.close()}openEditDialog(){l.EventBus.$emit("EditDialog.Open",this.shape),this.close()}};d=s.__decorate([o.default({components:{ContextMenu:r.default}})],d),t.default=d},"314d":function(e,t,i){"use strict";var s=i("4fce"),n=i.n(s);n.a},3411:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=i("60a3");let a=class extends n.default{constructor(){super(...arguments),this.borderColour="lightgray",this.popupString="",this.showPopup=!1}copy(){navigator.clipboard.writeText(this.value).then(()=>{this.popupString="Copied!",this.showPopup=!0},()=>{console.log("Could not copy to clipboard :("),this.popupString="Error!",this.showPopup=!0})}};s.__decorate([r.Prop()],a.prototype,"value",void 0),a=s.__decorate([o.default],a),t.default=a},3481:function(e,t,i){"use strict";i.r(t);var s=i("47e6"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},3752:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContextMenu",{attrs:{visible:e.visible,left:e.left+"px",top:e.top+"px"},on:{close:e.close}},[i("li",{on:{click:e.rename}},[e._v("Rename")]),i("li",{on:{click:e.remove}},[e._v("Remove")])])},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},"38c9":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("bab4"),n=i("f10f");class o extends s.Layer{invalidate(){this.valid=!1}draw(e){this.valid||this.drawGrid()}drawGrid(){const e=this.ctx;this.clear(),e.beginPath();const t=n.gameStore.gridSize;for(let i=0;i<this.width;i+=t*n.gameStore.zoomFactor)e.moveTo(i+n.gameStore.panX%t*n.gameStore.zoomFactor,0),e.lineTo(i+n.gameStore.panX%t*n.gameStore.zoomFactor,this.height),e.moveTo(0,i+n.gameStore.panY%t*n.gameStore.zoomFactor),e.lineTo(this.width,i+n.gameStore.panY%t*n.gameStore.zoomFactor);e.strokeStyle=n.gameStore.gridColour,e.lineWidth=1,e.stroke(),this.valid=!0}}t.GridLayer=o},"393f":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"outer",on:{click:function(t){return t.target!==t.currentTarget?null:e.open(t)}}},[i("div",{staticClass:"current-color",style:e.transparent?"background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)":"background-color:"+e.color,on:{click:function(t){return t.target!==t.currentTarget?null:e.open(t)}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.display,expression:"display"}],staticClass:"mask",on:{click:function(t){return t.target!==t.currentTarget?null:e.closePicker(t)}}}),i("chrome-picker",{directives:[{name:"show",rawName:"v-show",value:e.display,expression:"display"}],ref:"chromePicker",style:{position:"fixed",left:e.left+"px",top:e.top+"px","z-index":9999},attrs:{value:e.color,tabindex:"-1"},on:{input:e.updateColor}})],1)},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},"3a0b":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("2f62"));n.default.use(o.default),t.rootStore=new o.default.Store({})},"3a20":function(e,t,i){},"3b36":function(e,t,i){"use strict";i.r(t);var s=i("393f"),n=i("979e");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("2bfd");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"f8744d60",null);t["default"]=a.exports},"3cc2":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("65d9")),o=s.__importDefault(i("ea6a")),r=i("6f92"),a=i("f10f");let l=class extends o.default{constructor(){super(...arguments),this.name="Vision",this.active=!1}get selection(){return a.gameStore.activeTokens}get tokens(){return a.gameStore.ownedtokens.map(e=>r.layerManager.UUIDMap.get(e))}toggle(e){this.selection.includes(e)?a.gameStore.removeActiveToken(e):a.gameStore.addActiveToken(e)}};l=s.__decorate([n.default],l),t.default=l},"3cd3":function(e,t,i){"use strict";var s=i("b0c0"),n=i.n(s);n.a},"3dfd":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("router-view",{ref:"activeComponent"})],1)},n=[],o=(i("034f"),i("2877")),r={},a=Object(o["a"])(r,s,n,!1,null,null,null);t["default"]=a.exports},4185:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8f0a"),n=i("bab4"),o=i("6f92"),r=i("d1ec"),a=i("4709"),l=i("f10f"),c=i("92b1"),u=i("5a5c"),d=i("cee3");class h extends n.Layer{constructor(e,t){super(e,t),this.isVisionLayer=!0,this.preFogShapes=[],this.virtualCanvas=document.createElement("canvas"),this.virtualCanvas.width=window.innerWidth,this.virtualCanvas.height=window.innerHeight,this.vCtx=this.virtualCanvas.getContext("2d")}addShape(e,t,i,s=!0){super.addShape(e,t,i,s),e.options.has("preFogShape")&&e.options.get("preFogShape")&&this.preFogShapes.push(e)}removeShape(e,t,i){if(e.options.has("preFogShape")&&e.options.get("preFogShape")){const t=this.preFogShapes.findIndex(t=>t.uuid===e.uuid);this.preFogShapes.splice(t,1)}super.removeShape(e,t,i)}draw(){if(!this.valid){const e=this.ctx;if(r.Settings.skipLightFOW)return e.clearRect(0,0,this.canvas.width,this.canvas.height),void(this.valid=!0);const t=e.globalCompositeOperation;e.clearRect(0,0,this.canvas.width,this.canvas.height),e.fillStyle="rgba(0, 0, 0, 1)";const i=o.layerManager.getLayer("draw").ctx;(r.Settings.drawAngleLines||r.Settings.drawFirstLightHit)&&i.clearRect(0,0,i.canvas.width,i.canvas.height),l.gameStore.fullFOW&&o.layerManager.hasLayer("tokens")&&o.layerManager.getLayer("tokens").shapes.forEach(t=>{if(!t.ownedBy()||!t.isToken)return;const i=t.getBoundingBox(),s=c.g2l(t.center()),n=.8*c.g2lz(i.w);e.beginPath(),e.arc(s.x,s.y,n,0,2*Math.PI);const o=e.createRadialGradient(s.x,s.y,n/2,s.x,s.y,n);o.addColorStop(0,"rgba(0, 0, 0, 1)"),o.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=o,e.fill()}),this.vCtx.clearRect(0,0,window.innerWidth,window.innerHeight);for(const n of l.gameStore.visionSources){const t=o.layerManager.UUIDMap.get(n.shape);if(void 0===t)continue;const u=t.auras.find(e=>e.uuid===n.aura);if(void 0===u)continue;const h=c.getUnitDistance(u.value+u.dim),f=t.center(),p=c.g2l(f),g=new a.Circle(f,h);if(g.visibleInCanvas(e.canvas))if("bvh"===l.gameStore.visionMode){let t=-1;const n=new Path2D;let o;n.moveTo(p.x,p.y);for(let a=0;a<2*Math.PI;a+=r.Settings.angleSteps/180*Math.PI){const d=new s.GlobalPoint(f.x+h*Math.cos(a),f.y+h*Math.sin(a));r.Settings.drawAngleLines&&(i.beginPath(),i.moveTo(c.g2lx(f.x),c.g2ly(f.y)),i.lineTo(c.g2lx(d.x),c.g2ly(d.y)),i.stroke());const g=s.Ray.fromPoints(f,d),v=l.gameStore.BV.intersect(g);if(0===a&&(o=v.hit?v.intersect:d),v.hit)-1!==t&&(n.arc(p.x,p.y,c.g2lr(u.value+u.dim),t,a),t=-1),n.lineTo(c.g2lx(v.intersect.x),c.g2ly(v.intersect.y));else if(-1===t){t=a;const i=c.g2l(d);e.lineTo(i.x,i.y)}}if(-1===t?n.lineTo(c.g2lx(o.x),c.g2ly(o.y)):n.arc(p.x,p.y,c.g2lr(u.value+u.dim),t,2*Math.PI),l.gameStore.fullFOW){if(u.dim>0){const t=e.createRadialGradient(p.x,p.y,c.g2lr(u.value),p.x,p.y,c.g2lr(u.value+u.dim));t.addColorStop(0,"rgba(0, 0, 0, 1)"),t.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=t}else e.fillStyle="rgba(0, 0, 0, 1)";e.fill(n)}u.lastPath=n}else{this.vCtx.globalCompositeOperation="source-over",this.vCtx.fillStyle="rgba(0, 0, 0, 1)";const t=d.computeVisibility(f,"vision");this.vCtx.beginPath(),this.vCtx.moveTo(c.g2lx(t[0][0]),c.g2ly(t[0][1]));for(const e of t)this.vCtx.lineTo(c.g2lx(e[0]),c.g2ly(e[1]));if(this.vCtx.closePath(),this.vCtx.fill(),u.dim>0){const e=this.vCtx.createRadialGradient(p.x,p.y,c.g2lr(u.value),p.x,p.y,c.g2lr(u.value+u.dim));e.addColorStop(0,"rgba(0, 0, 0, 1)"),e.addColorStop(1,"rgba(0, 0, 0, 0)"),this.vCtx.fillStyle=e}else this.vCtx.fillStyle="rgba(0, 0, 0, 1)";this.vCtx.globalCompositeOperation="source-in",this.vCtx.beginPath(),this.vCtx.arc(p.x,p.y,c.g2lr(u.value+u.dim),0,2*Math.PI),this.vCtx.fill(),e.drawImage(this.virtualCanvas,0,0)}}l.gameStore.fowLOS&&(e.globalCompositeOperation="source-in",e.drawImage(o.layerManager.getLayer("fow-players").canvas,0,0));for(const s of this.preFogShapes){if(!s.visibleInCanvas(this.canvas))continue;const t=s.globalCompositeOperation;l.gameStore.fullFOW||("source-over"===s.globalCompositeOperation?s.globalCompositeOperation="destination-out":"destination-out"===s.globalCompositeOperation&&(s.globalCompositeOperation="source-over")),s.draw(e),s.globalCompositeOperation=t}l.gameStore.fullFOW&&(e.globalCompositeOperation="source-out",e.fillStyle=u.getFogColour(),e.fillRect(0,0,e.canvas.width,e.canvas.height)),super.draw(!1),e.globalCompositeOperation=t}}}t.FOWLayer=h},4486:function(e,t,i){"use strict";i.r(t);var s=i("a097"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"45fb":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Edit asset")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("div",{staticClass:"grid"},[i("label",{attrs:{for:"shapeselectiondialog-name"}},[e._v("Name")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.shape.name,expression:"shape.name"}],staticStyle:{"grid-column":"numerator / remove"},attrs:{type:"text",id:"shapeselectiondialog-name",disabled:!e.owned},domProps:{value:e.shape.name},on:{change:function(t){return e.updateShape(!1)},input:function(t){t.target.composing||e.$set(e.shape,"name",t.target.value)}}}),i("div",{style:{opacity:e.shape.nameVisible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(t){e.shape.nameVisible=!e.shape.nameVisible,e.updateShape(!1)}}},[i("i",{staticClass:"fas fa-eye"})]),i("label",{attrs:{for:"shapeselectiondialog-istoken"}},[e._v("Is a token")]),i("input",{staticClass:"styled-checkbox",staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-istoken",disabled:!e.owned},domProps:{checked:e.shape.isToken},on:{click:e.setToken}}),i("label",{attrs:{for:"shapeselectiondialog-visionblocker"}},[e._v("Blocks vision/light")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.shape.visionObstruction,expression:"shape.visionObstruction"}],staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-visionblocker",disabled:!e.owned},domProps:{checked:Array.isArray(e.shape.visionObstruction)?e._i(e.shape.visionObstruction,null)>-1:e.shape.visionObstruction},on:{change:[function(t){var i=e.shape.visionObstruction,s=t.target,n=!!s.checked;if(Array.isArray(i)){var o=null,r=e._i(i,o);s.checked?r<0&&e.$set(e.shape,"visionObstruction",i.concat([o])):r>-1&&e.$set(e.shape,"visionObstruction",i.slice(0,r).concat(i.slice(r+1)))}else e.$set(e.shape,"visionObstruction",n)},e.setVisionBlocker]}}),i("label",{attrs:{for:"shapeselectiondialog-moveblocker"}},[e._v("Blocks movement")]),i("input",{staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-moveblocker",disabled:!e.owned},domProps:{checked:e.shape.movementObstruction},on:{click:e.setMovementBlocker}}),i("label",{attrs:{for:"shapeselectiondialog-strokecolour"}},[e._v("Border colour")]),i("color-picker",{staticStyle:{"grid-column-start":"remove"},attrs:{color:e.shape.strokeColour,disabled:!e.owned},on:{"update:color":function(t){return e.$set(e.shape,"strokeColour",t)},input:function(t){return e.updateShape(!0,!0)},change:function(t){return e.updateShape(!0)}}}),i("label",{attrs:{for:"shapeselectiondialog-fillcolour"}},[e._v("Fill colour")]),i("color-picker",{staticStyle:{"grid-column-start":"remove"},attrs:{color:e.shape.fillColour,disabled:!e.owned},on:{"update:color":function(t){return e.$set(e.shape,"fillColour",t)},input:function(t){return e.updateShape(!0,!0)},change:function(t){return e.updateShape(!0)}}}),i("div",{staticClass:"spanrow header"},[e._v("Access")]),e._l(e.shape.owners,function(t){return[i("input",{key:t,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t},on:{change:function(i){return e.updateOwner(i,t)}}}),""!==t?i("div",{key:"remove-"+t,style:{opacity:e.owned?1:.3,textAlign:"center",gridColumnStart:"remove"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeOwner(t)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]}),i("div",{staticClass:"spanrow header"},[e._v("Trackers")]),e._l(e.shape.trackers,function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"tracker.name"}],key:"name-"+t.uuid,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t.name},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"name",i.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.value,expression:"tracker.value",modifiers:{number:!0}}],key:"value-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.value},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"value",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"fspan-"+t.uuid},[e._v("/")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.maxvalue,expression:"tracker.maxvalue",modifiers:{number:!0}}],key:"maxvalue-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.maxvalue},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"maxvalue",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"sspan-"+t.uuid}),i("div",{key:"visibility-"+t.uuid,style:{opacity:t.visible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){t.visible=!t.visible,e.updateShape(!1)}}},[i("i",{staticClass:"fas fa-eye"})]),i("span",{key:"tspan-"+t.uuid}),""!==t.name||0!==t.value?i("div",{key:"remove-"+t.uuid,style:{opacity:e.owned?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeTracker(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]}),i("div",{staticClass:"spanrow header"},[e._v("Auras")]),e._l(e.shape.auras,function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"aura.name"}],key:"name-"+t.uuid,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t.name},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"name",i.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.value,expression:"aura.value",modifiers:{number:!0}}],key:"value-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.value},on:{change:function(t){return e.updateShape(!0)},input:function(i){i.target.composing||e.$set(t,"value",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"fspan-"+t.uuid},[e._v("/")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.dim,expression:"aura.dim",modifiers:{number:!0}}],key:"dimvalue-"+t.uuid,attrs:{type:"text",title:"Dim value",disabled:!e.owned},domProps:{value:t.dim},on:{change:function(t){return e.updateShape(!0)},input:function(i){i.target.composing||e.$set(t,"dim",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("color-picker",{key:"colour-"+t.uuid,attrs:{color:t.colour,disabled:!e.owned},on:{"update:color":function(i){return e.$set(t,"colour",i)},input:function(i){return e.updateAuraColour(t,i)},change:function(t){return e.updateShape(!0)}}}),i("div",{key:"visibility-"+t.uuid,style:{opacity:t.visible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){t.visible=!t.visible,e.updateShape(!0)}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{key:"visionsource-"+t.uuid,style:{opacity:t.visionSource?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.updateAuraVisionSource(t)}}},[i("i",{staticClass:"fas fa-lightbulb"})]),""!==t.name||0!==t.value?i("div",{key:"remove-"+t.uuid,style:{opacity:e.owned?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeAura(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]}),i("div",{staticClass:"spanrow header"},[e._v("Labels")]),i("div",{staticClass:"spanrow",attrs:{id:"labels"}},[e._l(e.shape.labels,function(t){return i("div",{key:t.uuid,staticClass:"label"},[t.category?[i("div",{staticClass:"label-user"},[e._v(e._s(t.category))]),i("div",{staticClass:"label-main",on:{click:function(i){return e.removeLabel(t.uuid)}}},[e._v(e._s(t.name))])]:e._e(),t.category?e._e():[i("div",{staticClass:"label-main",on:{click:function(i){return e.removeLabel(t.uuid)}}},[e._v(e._s(t.name))])]],2)}),e.owned?i("div",{staticClass:"label",attrs:{id:"label-add"}},[i("div",{staticClass:"label-main",on:{click:e.openLabelManager}},[e._v("+")])]):e._e()],2),i("div",{staticClass:"spanrow header"},[e._v("Annotation")]),i("textarea",{staticClass:"spanrow",attrs:{disabled:!e.owned},domProps:{value:e.shape.annotation},on:{change:e.updateAnnotation}})],2)])])},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},4709:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8f0a"),n=i("8db6"),o=i("2469"),r=i("f10f"),a=i("2838"),l=i("92b1"),c=i("5a5c");class u extends o.Shape{constructor(e,t,i,s,n){super(e,i,s,n),this.type="circle",this.r=t||1}asDict(){return Object.assign(this.getBaseDict(),{radius:this.r})}fromDict(e){super.fromDict(e),this.r=e.radius}getBoundingBox(){return new n.BoundingRect(new s.GlobalPoint(this.refPoint.x-this.r,this.refPoint.y-this.r),2*this.r,2*this.r)}get points(){return this.getBoundingBox().points}draw(e){super.draw(e),e.beginPath(),"fog"===this.fillColour?e.fillStyle=c.getFogColour():e.fillStyle=this.fillColour;const t=l.g2l(this.refPoint);e.arc(t.x,t.y,l.g2lz(this.r),0,2*Math.PI),e.fill(),"rgba(0, 0, 0, 0)"!==this.strokeColour&&(e.beginPath(),e.lineWidth=l.g2lz(5),e.strokeStyle=this.strokeColour,e.arc(t.x,t.y,l.g2lz(this.r),0,2*Math.PI),e.stroke())}contains(e){return Math.pow(e.x-this.refPoint.x,2)+Math.pow(e.y-this.refPoint.y,2)<Math.pow(this.r,2)}center(e){if(void 0===e)return this.refPoint;this.refPoint=e}visibleInCanvas(e){return this.getBoundingBox().visibleInCanvas(e)}snapToGrid(){const e=r.gameStore.gridSize;let t,i;t=2*this.r/e%2===0?Math.round(this.refPoint.x/e)*e:Math.round((this.refPoint.x-e/2)/e)*e+this.r,i=2*this.r/e%2===0?Math.round(this.refPoint.y/e)*e:Math.round((this.refPoint.y-e/2)/e)*e+this.r;const n=a.calculateDelta(new s.Vector(t-this.refPoint.x,i-this.refPoint.y),this);this.refPoint=this.refPoint.add(n),this.invalidate(!1)}resizeToGrid(){const e=r.gameStore.gridSize;this.r=Math.max(Math.round(this.r/e)*e,e/2),this.invalidate(!1)}resize(e,t){r.gameStore.zoomFactor;const i=l.l2g(t).subtract(this.refPoint);this.r=Math.sqrt(Math.pow(i.length(),2)/2)}}t.Circle=u},"47e6":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("ea6a")),o=i("8f0a"),r=i("6f92"),a=i("c266"),l=i("b2ed"),c=i("f10f"),u=i("92b1"),d=i("5a5c"),h=s.__importDefault(i("65d9"));let f=class extends n.default{constructor(){super(...arguments),this.name="Map",this.active=!1,this.xCount=3,this.yCount=3,this.startPoint=null,this.rect=null}onMouseDown(e){const t=r.layerManager.getLayer();void 0!==t?(this.active=!0,this.startPoint=u.l2g(d.getMouse(e)),this.rect=new l.Rect(this.startPoint.clone(),0,0,"rgba(0,0,0,0)","black"),t.addShape(this.rect,!1,!1)):console.log("No active layer!")}onMouseMove(e){if(!this.active||null===this.rect||null===this.startPoint)return;const t=r.layerManager.getLayer();if(void 0===t)return void console.log("No active layer!");const i=u.l2g(d.getMouse(e));this.rect.w=Math.abs(i.x-this.startPoint.x),this.rect.h=Math.abs(i.y-this.startPoint.y),this.rect.refPoint=new o.GlobalPoint(Math.min(this.startPoint.x,i.x),Math.min(this.startPoint.y,i.y)),t.invalidate(!1)}onMouseUp(e){if(!this.active||null===this.rect)return;const t=r.layerManager.getLayer();if(void 0===t)return void console.log("No active layer!");if(this.active=!1,1!==t.selection.length)return void t.removeShape(this.rect,!1,!1);const i=this.rect.w,s=this.rect.h,n=t.selection[0];n instanceof a.BaseRect&&(n.w*=this.xCount*c.gameStore.gridSize/i,n.h*=this.yCount*c.gameStore.gridSize/s),t.removeShape(this.rect,!1,!1)}};f=s.__decorate([h.default],f),t.default=f},"47f7":function(e,t,i){"use strict";i.r(t);var s=i("88af"),n=i("4486");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,null,null);t["default"]=a.exports},4899:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("ea6a")),o=i("2b48"),r=i("8f0a"),a=i("6f92"),l=i("f10f"),c=i("5a5c"),u=s.__importDefault(i("65d9"));let d=class extends n.default{constructor(){super(...arguments),this.name="Pan",this.panStart=new r.LocalPoint(0,0),this.active=!1}onMouseDown(e){this.panStart=c.getMouse(e),this.active=!0}onMouseMove(e){if(!this.active)return;const t=c.getMouse(e),i=t.subtract(this.panStart).multiply(1/l.gameStore.zoomFactor);l.gameStore.increasePanX(Math.round(i.x)),l.gameStore.increasePanY(Math.round(i.y)),this.panStart=t,a.layerManager.invalidate()}onMouseUp(e){this.active=!1,o.sendClientOptions()}};d=s.__decorate([u.default],d),t.default=d},"496c":function(e,t,i){"use strict";i.r(t);var s=i("4d60"),n=i("b809");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("54fb");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"2e7d4582",null);t["default"]=a.exports},"4a5b":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("cd49");function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16)})}function o(e){return e.charAt(0).toUpperCase()+e.slice(1)}function r(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1}function a(e){let t=e.style.font;while(null===t&&null!==e.parentElement)e=e.parentElement,t=e.style.font;return null===t&&(t=window.getComputedStyle(document.body).getPropertyValue("font")),t}function l(e,t){let i=document.getElementById("emptycanvas");null===i&&(i=document.createElement("canvas"),i.id="emptycanvas",i.style.display="",document.body.appendChild(i));const s=i.getContext("2d");return s.font=t,Math.ceil(s.measureText(e).width)}function c(e,t){const i=[[],[]];return e.forEach(e=>t(e)?i[1].push(e):i[0].push(e)),i}function u(e,t,i,s){const n=.2*Number(e.font.split("px")[0]),o=e.measureText(t).width;return Math.min(i/o,s/n)}function d(e){return encodeURIComponent(e).replace(/[!'()*]/g,e=>{return"%"+e.charCodeAt(0).toString(16)})}t.uuidv4=n,t.capitalize=o,t.alphSort=r,t.getHTMLFont=a,t.getHTMLTextWidth=l,t.partition=c,t.calcFontScale=u,t.fixedEncodeURIComponent=d;class h{constructor(){this.keys=[],this.values=[]}get length(){return this.keys.length}get(e){return this.values[this.keys.indexOf(e)]}getIndexValue(e){return this.values[e]}getIndexKey(e){return this.keys[e]}set(e,t){this.keys.push(e),this.values.push(t)}has(e){return this.indexOf(e)>=0}indexOf(e){return this.keys.indexOf(e)}remove(e){const t=this.indexOf(e);this.keys.splice(t,1),this.values.splice(t,1)}}function f(){return s.app.$children[0].$refs.activeComponent}function p(e){const t=s.app.$children[0].$refs.activeComponent;return t.$refs[e]}t.OrderedMap=h,t.getComponent=f,t.getRef=p},"4aec":function(e,t,i){"use strict";i.r(t);var s=i("3752"),n=i("f51a");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,null,null);t["default"]=a.exports},"4aee":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("98ef");function n(e){return(e+2)%3}function o(e){return(e+1)%3}function r(e,t){const i=new s.EdgeCirculator(e,null);if(i.valid)do{const n=3-i.t.indexV(e)-i.ri,o=i.t.vertices[n];if(!o.infinite){if(o===t)return{includes:!0,vi:t,fr:i.t,i:i.ri};{const n=c(e.point,t.point,o.point);if(n===s.Sign.COLLINEAR&&a(e.point,o.point,t.point))return{includes:!0,vi:o,fr:i.t,i:i.ri}}}}while(i.next());return{includes:!1}}function a(e,t,i){let n,o;return l(0,e,i)===s.Sign.EQUAL?(n=l(1,e,t),o=l(1,t,i)):(n=l(0,e,t),o=l(0,t,i)),n===s.Sign.SMALLER&&o===s.Sign.SMALLER||n===s.Sign.LARGER&&o===s.Sign.LARGER}function l(e,t,i){return t[e]<i[e]?s.Sign.SMALLER:t[e]>i[e]?s.Sign.LARGER:s.Sign.EQUAL}function c(e,t,i){const n=e[0],o=e[1],r=t[0],a=t[1],l=i[0],c=i[1],d=r-n,h=a-o,f=l-n,p=c-o,g=u(d,h,f,p);let v=Math.abs(d),m=Math.abs(h);const y=Math.abs(f),b=Math.abs(p);if(v<y&&(v=y),m<b&&(m=b),v>m&&([v,m]=[m,v]),v<2e-162&&0===v)return s.Sign.ZERO;if(m<1e153){const e=Number.EPSILON*v*m;if(g>e)return s.Sign.POSITIVE;if(g<-e)return s.Sign.NEGATIVE}return s.Sign.ZERO}function u(e,t,i,s){return e*s-t*i}function d(e,t,i){return u(t[0]-e[0],t[1]-e[1],i[0]-e[0],i[1]-e[1])<0}function h(e,t,i){if(!e.isInfinite())return f(e.vertices[0].point,e.vertices[1].point,e.vertices[2].point,t,i);throw new Error("SSS")}function f(e,t,i,n,o){const r=m(e,t,i,n);if(r!==s.Sign.ON_ORIENTED_BOUNDARY||!o)return r;const a=[e,t,i,n];a.sort((e,t)=>e[0]-t[0]||e[1]-t[1]);for(const l of a.reverse()){if(l===n)return s.Sign.ON_NEGATIVE_SIDE;let o=c(e,t,n);if(l===i&&o!==s.Sign.COLLINEAR)return o;if(o=c(e,n,i),l===t&&o!==s.Sign.COLLINEAR)return o;if(o=c(n,t,i),l===e&&o!==s.Sign.COLLINEAR)return o}return s.Sign.ON_NEGATIVE_SIDE}function p(e,t){return e[0]===t[0]&&e[1]===t[1]}function g(e,t){return e[0]<t[0]||e[0]===t[0]&&e[1]<t[1]}function v(e,t){return g(e,t)?s.Sign.SMALLER:p(e,t)?s.Sign.EQUAL:s.Sign.LARGER}function m(e,t,i,n){const o=t[0]-e[0],r=t[1]-e[1],a=i[0]-e[0],l=i[1]-e[1],c=n[0]-e[0],d=n[1]-e[1],h=n[0]-t[0],f=n[1]-t[1],p=i[0]-t[0],g=i[1]-t[1],v=u(o*d-r*c,c*h+d*f,o*l-r*a,a*p+l*g);let m=Math.abs(o),y=Math.abs(r);const b=Math.abs(a),_=Math.abs(l),w=Math.abs(h),S=Math.abs(f),x=Math.abs(c),C=Math.abs(d),M=Math.abs(p),k=Math.abs(g);if(m<b&&(m=b),m<x&&(m=x),m<w&&(m=w),m<M&&(m=M),y<_&&(y=_),y<C&&(y=C),y<S&&(y=S),y<k&&(y=k),m>y&&([m,y]=[y,m]),m<1e-73&&0===m)return s.Sign.ON_ORIENTED_BOUNDARY;if(y<1e76){const e=Number.EPSILON*m*y*(y*y);if(v>e)return s.Sign.ON_POSITIVE_SIDE;if(v<-e)return s.Sign.ON_NEGATIVE_SIDE}return s.Sign.ZERO}function y(e,t,i,n){switch(c(e,t,i)){case s.Sign.LEFT_TURN:return c(i,n,t)!==s.Sign.RIGHT_TURN;case s.Sign.RIGHT_TURN:return c(i,n,t)!==s.Sign.LEFT_TURN;case s.Sign.COLLINEAR:return!0}}function b(e,t,i,n){switch(c(e,t,i)){case s.Sign.LEFT_TURN:return c(e,t,n)!==s.Sign.LEFT_TURN;case s.Sign.RIGHT_TURN:return c(e,t,n)!==s.Sign.RIGHT_TURN;case s.Sign.COLLINEAR:return!0}}function _(e,t,i,s){const n=x(e,t,i,s);switch(n.intersectionType){case w.POINT:return n.point;case w.NO_INTERSECTION:return null}throw new Error("sdfgighowen")}var w;function S(e,t){if(e[0]===t[0])return[1,0,-e[0]];if(e[1]===t[1])return[0,1,-e[1]];const i=t[0]-e[0],s=t[1]-e[1];return[-s,i,-i*e[1]+s*e[0]]}function x(e,t,i,s){if(!M(e,t,i,s))return{intersectionType:w.NO_INTERSECTION,point:null};const n=S(e,t),o=S(i,s),r=C(n,o);switch(r.intersectionType){case w.POINT:return r}throw new Error("gzseuihgpib")}function C(e,t){const i=e[0]*t[1]-t[0]*e[1],s=e[1]*t[2]-t[1]*e[2],n=t[0]*e[2]-e[0]*t[2];return{intersectionType:w.POINT,point:[s/i,n/i]}}function M(e,t,i,n){if(g(e,t)){if(g(i,n)){if(g(t,i)||g(n,e))return!1}else if(g(t,n)||g(i,e))return!1}else if(g(i,n)){if(g(e,i)||g(n,t))return!1}else if(g(e,n)||g(i,t))return!1;if(g(e,t))if(g(i,n))switch(v(e,i)){case s.Sign.SMALLER:switch(v(t,i)){case s.Sign.SMALLER:return!1;case s.Sign.EQUAL:return!0;default:switch(v(t,n)){case s.Sign.SMALLER:return y(e,t,i,n);case s.Sign.EQUAL:return!0;default:return b(e,t,i,n)}}case s.Sign.EQUAL:return!0;default:switch(v(n,e)){case s.Sign.SMALLER:return!1;case s.Sign.EQUAL:return!0;default:switch(v(n,t)){case s.Sign.SMALLER:return y(i,n,e,t);case s.Sign.EQUAL:return!0;default:return b(i,n,e,t)}}}else switch(v(e,n)){case s.Sign.SMALLER:switch(v(t,n)){case s.Sign.SMALLER:return!1;case s.Sign.EQUAL:return!0;default:switch(v(t,i)){case s.Sign.SMALLER:return y(e,t,n,i);case s.Sign.EQUAL:return!0;default:return b(e,t,n,i)}}case s.Sign.EQUAL:return!0;default:switch(v(i,e)){case s.Sign.SMALLER:return!1;case s.Sign.EQUAL:return!0;default:switch(v(i,t)){case s.Sign.SMALLER:return y(n,i,e,t);case s.Sign.EQUAL:return!0;default:return b(n,i,e,t)}}}else if(g(i,n))switch(v(t,i)){case s.Sign.SMALLER:switch(v(e,i)){case s.Sign.SMALLER:return!1;case s.Sign.EQUAL:return!0;default:switch(v(e,n)){case s.Sign.SMALLER:return y(t,e,i,n);case s.Sign.EQUAL:return!0;default:return b(t,e,i,n)}}case s.Sign.EQUAL:return!0;default:switch(v(n,t)){case s.Sign.SMALLER:return!1;case s.Sign.EQUAL:return!0;default:switch(v(n,e)){case s.Sign.SMALLER:return y(i,n,t,e);case s.Sign.EQUAL:return!0;default:return b(i,n,t,e)}}}else switch(v(t,n)){case s.Sign.SMALLER:switch(v(e,n)){case s.Sign.SMALLER:return!1;case s.Sign.EQUAL:return!0;default:switch(v(e,i)){case s.Sign.SMALLER:return y(t,e,n,i);case s.Sign.EQUAL:return!0;default:return b(t,e,n,i)}}case s.Sign.EQUAL:return!0;default:switch(v(i,t)){case s.Sign.SMALLER:return!1;case s.Sign.EQUAL:return!0;default:switch(v(i,e)){case s.Sign.SMALLER:return y(n,i,t,e);case s.Sign.EQUAL:return!0;default:return b(n,i,t,e)}}}}function k(e){if(e!==e)return e;if(e===-1/0)return-Number.MAX_VALUE;if(e===1/0)return 1/0;if(e===+Number.MAX_VALUE)return 1/0;let t=e*(e<0?1-Number.EPSILON/2:1+Number.EPSILON);t===e&&(t=Number.MIN_VALUE*Number.EPSILON>0?e+Number.MIN_VALUE*Number.EPSILON:e+Number.MIN_VALUE),t===1/0&&(t=+Number.MAX_VALUE);const i=e+(t-e)/2;e<i&&i<t&&(t=i);const s=(t+e)/2;return e<s&&s<t&&(t=s),0===t?-0:t}function L(e){return e<0?k(e)-e:e+k(-e)}t.cw=n,t.ccw=o,t.edgeInfo=r,t.collinearBetween=a,t.orientation=c,t.determinant=u,t.hasInexactNegativeOrientation=d,t.sideOfOrientedCircle=h,t.xyEqual=p,t.xySmaller=g,t.xyCompare=v,t.intersection=_,function(e){e[e["NO_INTERSECTION"]=0]="NO_INTERSECTION",e[e["POINT"]=1]="POINT",e[e["SEGMENT"]=2]="SEGMENT"}(w||(w={})),t.ulp=L},"4bc3":function(e,t,i){"use strict";i.r(t);var s=i("2baf"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"4d60":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContextMenu",{attrs:{visible:e.visible,left:e.x+"px",top:e.y+"px"},on:{close:e.close}},[e.IS_DM?i("li",{on:{click:e.bringPlayers}},[e._v("Bring players")]):e._e(),i("li",{on:{click:e.createToken}},[e._v("Create basic token")]),i("li",{on:{click:e.showInitiative}},[e._v("Show initiative")])])},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},"4f27":function(e,t,i){"use strict";var s=i("c5ff"),n=i.n(s);n.a},"4fce":function(e,t,i){},"514b":function(e,t,i){"use strict";var s=i("c31c"),n=i.n(s);n.a},"52a8":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=i("60a3");let a=class extends n.default{constructor(){super(...arguments),this.positioned=!1,this.offsetX=0,this.offsetY=0,this.screenX=0,this.screenY=0,this.dragging=!1}mounted(){this.updatePosition()}updated(){this.updatePosition()}close(e){this.$emit("close")}updatePosition(){if(!this.positioned){const e=this.$refs.container;if(0===e.offsetWidth&&0===e.offsetHeight)return;this.$refs.container.style.left=(window.innerWidth-e.offsetWidth)/2+"px",this.$refs.container.style.top=(window.innerHeight-e.offsetHeight)/2+"px",this.positioned=!0}}dragStart(e){null!==e&&null!==e.dataTransfer&&(e.dataTransfer.setData("Hack",""),e.dataTransfer.setDragImage(this.$refs.container,e.offsetX,e.offsetY),this.offsetX=e.offsetX,this.offsetY=e.offsetY,this.screenX=e.screenX,this.screenY=e.screenY,this.dragging=!0)}dragEnd(e){this.dragging=!1;let t=e.clientX-this.offsetX,i=e.clientY-this.offsetY;0===e.clientX&&0===e.clientY&&0===e.pageX&&0===e.pageY&&(t=parseInt(this.$refs.container.style.left,10)-(this.screenX-e.screenX),i=parseInt(this.$refs.container.style.top,10)-(this.screenY-e.screenY)),t<0&&(t=0),t>window.innerWidth-100&&(t=window.innerWidth-100),i<0&&(i=0),i>window.innerHeight-100&&(i=window.innerHeight-100),this.$refs.container.style.left=t+"px",this.$refs.container.style.top=i+"px",this.$refs.container.style.display="block"}dragOver(e){this.dragging&&(this.$refs.container.style.display="none")}};s.__decorate([r.Prop(Boolean)],a.prototype,"visible",void 0),s.__decorate([r.Prop({type:Boolean,default:!0})],a.prototype,"mask",void 0),s.__decorate([r.Prop({type:String,default:"white"})],a.prototype,"colour",void 0),a=s.__decorate([o.default],a),t.default=a},5338:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("8055")),o=i("2d5b");t.socket=n.default(location.protocol+"//"+location.host+"/pa_assetmgmt",{autoConnect:!1}),t.socket.on("connect",()=>{console.log("Connected")}),t.socket.on("disconnect",()=>{console.log("Disconnected")}),t.socket.on("redirect",e=>{console.log("redirecting"),window.location.href=e}),t.socket.on("Folder.Root.Set",e=>{o.assetStore.setRoot(e)}),t.socket.on("Folder.Set",e=>{if(o.assetStore.clear(),e.children)for(const t of e.children)o.assetStore.idMap.set(t.id,t),t.file_hash?o.assetStore.files.push(t.id):o.assetStore.folders.push(t.id)}),t.socket.on("Folder.Create",e=>{o.assetStore.folders.push(e.id),o.assetStore.idMap.set(e.id,e)}),t.socket.on("Asset.Upload.Finish",e=>{o.assetStore.idMap.set(e.id,e),o.assetStore.files.push(e.id)})},5394:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("65d9")),o=s.__importDefault(i("1289")),r=s.__importDefault(i("ea6a")),a=i("0bc6"),l=i("6f92"),c=i("f10f");let u=class extends r.default{constructor(){super(...arguments),this.name="Filter",this.active=!1}get labels(){const e={"":[]};for(const t of Object.keys(c.gameStore.labels)){const i=c.gameStore.labels[t];i.category?(i.category in e||(e[i.category]=[]),e[i.category].push([i.uuid,i.name]),e[i.category].sort((e,t)=>e[1].localeCompare(t[1]))):e[""].push([i.uuid,i.name])}return e}get initalValues(){const e={};for(const t of Object.keys(this.labels))e[t]=c.gameStore.labelFilters.filter(e=>this.labels[t].map(e=>e[0]).includes(e));return e}get categories(){return Object.keys(this.labels).sort()}isFilter(e){return c.gameStore.labelFilters.includes(e)}toggleFilter(e){const t=c.gameStore.labelFilters.indexOf(e);t>=0?c.gameStore.labelFilters.splice(t,1):c.gameStore.labelFilters.push(e),l.layerManager.invalidate()}toggleUnlabeled(){c.gameStore.toggleUnlabeledFilter(),l.layerManager.invalidate()}updateSelection(e){if(e.title in this.labels){for(const[t,i]of this.labels[e.title]){const i=c.gameStore.labelFilters.indexOf(t),s=e.selection.includes(t);i>=0&&!s?(c.gameStore.labelFilters.splice(i,1),a.socket.emit("Labels.Filter.Remove",t)):i<0&&s&&(c.gameStore.labelFilters.push(t),a.socket.emit("Labels.Filter.Add",t))}l.layerManager.invalidate()}}};u=s.__decorate([n.default({components:{accordion:o.default}})],u),t.default=u},"53ec":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=i("60a3");let a=class extends n.default{constructor(){super(...arguments),this.selected=[],this.active=!1}mounted(){this.selected=this.initialValues,this.updateCategory()}toggleDisplay(e){this.active=!this.active}toggleCategory(){const e=this.$refs.overall;e.checked?this.selected=this.items.map(e=>e[0]):this.selected=[],this.$emit("selectionupdate",{title:this.title,selection:this.selected})}updateCategory(){const e=this.$refs.overall;0===this.selected.length?(e.checked=!1,e.indeterminate=!1):this.selected.length===this.items.length?(e.checked=!0,e.indeterminate=!1):(e.checked=!1,e.indeterminate=!0)}toggleSelection(e){const t=this.selected.indexOf(e);-1===t?this.selected.push(e):this.selected.splice(t,1),this.updateCategory(),this.$emit("selectionupdate",{title:this.title,selection:this.selected})}};s.__decorate([r.Prop(String)],a.prototype,"title",void 0),s.__decorate([r.Prop({default:!0,type:Boolean})],a.prototype,"showArrow",void 0),s.__decorate([r.Prop({default:()=>[]})],a.prototype,"items",void 0),s.__decorate([r.Prop({default:()=>[]})],a.prototype,"initialValues",void 0),a=s.__decorate([o.default],a),t.default=a},5459:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},e._l(e.tokens,function(t){return i("div",{key:t.uuid,staticClass:"token",class:{selected:e.selection.includes(t.uuid)},on:{click:function(i){return e.toggle(t.uuid)}}},[t.src?i("img",{attrs:{src:t.src,width:"30px",height:"30px"}}):e._e(),i("div",[e._v(e._s(t.name))])])}),0):e._e()},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},"54fb":function(e,t,i){"use strict";var s=i("c106"),n=i.n(s);n.a},"561b":function(e,t,i){"use strict";var s=i("a450"),n=i.n(s);n.a},"574e":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8f0a"),n=i("8db6"),o=i("2469"),r=i("92b1"),a=i("5a5c");class l extends o.Shape{constructor(e,t,i,s,n){super(e,"rgba(0, 0, 0, 0)",s||"#000",n),this.type="multiline",this._points=[],this._points=t||[],this.lineWidth=i||3}get refPoint(){return this._refPoint}set refPoint(e){const t=e.subtract(this._refPoint);this._refPoint=e;for(let i=0;i<this._points.length;i++)this._points[i]=this._points[i].add(t)}asDict(){return Object.assign(this.getBaseDict(),{line_width:this.lineWidth,points:this._points.map(e=>({x:e.x,y:e.y}))})}fromDict(e){super.fromDict(e),this._points=e.points.map(e=>new s.GlobalPoint(e.x,e.y))}get points(){return this._points.map(e=>[e.x,e.y])}getBoundingBox(){let e=this.refPoint.x,t=this.refPoint.x,i=this.refPoint.y,o=this.refPoint.y;for(const s of this._points)s.x<e&&(e=s.x),s.x>t&&(t=s.x),s.y<i&&(i=s.y),s.y>o&&(o=s.y);return new n.BoundingRect(new s.GlobalPoint(e,i),t-e,o-i)}draw(e){super.draw(e),e.beginPath(),e.lineCap="round",e.lineJoin="round",e.moveTo(r.g2lx(this.refPoint.x),r.g2ly(this.refPoint.y));for(const t of this._points)e.lineTo(r.g2lx(t.x),r.g2ly(t.y));"fog"===this.strokeColour?e.strokeStyle=a.getFogColour():e.strokeStyle=this.strokeColour,e.lineWidth=r.g2lz(this.lineWidth),e.stroke()}contains(e){return this.getBoundingBox().contains(e)}center(e){return this.getBoundingBox().center()}visibleInCanvas(e){return this.getBoundingBox().visibleInCanvas(e)}snapToGrid(){}resizeToGrid(){}resize(e,t){0===e?this._refPoint=r.l2g(t):this._points[e-1]=r.l2g(t)}}t.MultiLine=l},"59d8":function(e,t,i){"use strict";i.r(t);var s=i("e5ca"),n=i("6f8d");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("a7b3");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"639cd890",null);t["default"]=a.exports},"5a5c":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("66cb")),o=i("8f0a"),r=i("f10f");function a(e){return new o.LocalPoint(e.pageX,e.pageY)}function l(e=!1){const t=n.default(r.gameStore.fowColour);return r.gameStore.IS_DM?t.setAlpha(e?1:r.gameStore.fowOpacity):t.setAlpha(1),t.toRgbString()}function c(e){return 1/(-5/3+28/15*Math.exp(1.83*e))}function u(e){return Math.log(15/28*(1/e+5/3))/1.83}t.getMouse=a,t.getFogColour=l,t.zoomValue=c,t.zoomDisplay=u},"5a81":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importStar(i("66cb")),o=s.__importDefault(i("a026")),r=s.__importDefault(i("65d9")),a=i("2f62"),l=s.__importDefault(i("3b36")),c=s.__importDefault(i("d65f")),u=i("4a5b"),d=i("8f0a"),h=i("6f92"),f=i("1327"),p=i("f10f"),g=i("92b1"),v=i("60a3");let m=class extends o.default{constructor(){super(...arguments),this.x=0,this.y=0,this.visible=!1,this.text="X",this.fillColour="rgba(255, 255, 255, 1)",this.borderColour="rgba(0, 0, 0, 1)"}mounted(){this.updatePreview()}onTextChange(e,t){this.updatePreview()}onFillChange(e,t){this.updatePreview()}onBorderChange(e,t){this.updatePreview()}open(e,t){this.visible=!0,this.x=e,this.y=t}submit(){const e=h.layerManager.getLayer();if(void 0===e)return;const t=new f.CircularToken(g.l2g(new d.LocalPoint(this.x,this.y)),g.getUnitDistance(p.gameStore.unitSize/2),this.text,"10px serif",this.fillColour,this.borderColour);t.addOwner(p.gameStore.username),e.addShape(t,!0),e.invalidate(!1),this.visible=!1}updatePreview(){const e=this.$refs.canvas.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath();const t={x:e.canvas.width/2,y:e.canvas.height/2},i=.9*Math.min(t.x,t.y);e.fillStyle=this.fillColour,e.arc(t.x,t.y,i,0,2*Math.PI),e.fill(),"rgba(0, 0, 0, 0)"!==this.borderColour&&(e.beginPath(),e.lineWidth=5,e.strokeStyle=this.borderColour,e.arc(t.x,t.y,i,0,2*Math.PI),e.stroke()),e.save(),e.textAlign="center",e.textBaseline="middle";const s=u.calcFontScale(e,this.text,i,i),o=0;e.transform(s,o,-o,s,t.x,t.y),e.fillStyle=n.mostReadable(this.fillColour,["#000","#fff"]).toHexString(),e.fillText(this.text,0,0),e.restore()}};s.__decorate([v.Watch("text")],m.prototype,"onTextChange",null),s.__decorate([v.Watch("fillColour")],m.prototype,"onFillChange",null),s.__decorate([v.Watch("borderColour")],m.prototype,"onBorderChange",null),m=s.__decorate([r.default({components:{Modal:c.default,"color-picker":l.default},computed:Object.assign({},a.mapState("game",["unitSize"]))})],m),t.default=m},"5ae5":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=s.__importDefault(i("d65f")),a=i("4a5b"),l=i("f10f");let c=class extends n.default{constructor(){super(...arguments),this.visible=!1,this.note=null}open(e){this.visible=!0,this.note=e}calcHeight(){if(this.$refs.textarea){const e=this.$refs.textarea;return e.style.height="auto",e.style.height=e.scrollHeight+"px",e.scrollHeight+"px"}return"100px"}updateNote(){this.note&&l.gameStore.updateNote({note:this.note,sync:!0})}removeNote(){a.getRef("confirm").open("Are you sure you wish to remove this?").then(e=>{e&&this.note&&(l.gameStore.removeNote({note:this.note,sync:!0}),this.visible=!1)},()=>{})}};c=s.__decorate([o.default({components:{Modal:r.default}})],c),t.default=c},"5b69":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("65d9")),o=i("60a3"),r=s.__importDefault(i("3b36")),a=s.__importDefault(i("ea6a")),l=i("0bc6"),c=i("8f0a"),u=i("6f92"),d=i("4709"),h=i("5e7c"),f=i("574e"),p=i("e4ea"),g=i("b2ed"),v=i("f10f"),m=i("92b1"),y=i("5a5c");let b=class extends a.default{constructor(){super(...arguments),this.name="Draw",this.active=!1,this.startPoint=null,this.shape=null,this.brushHelper=null,this.ruler=null,this.fillColour="rgba(0, 0, 0, 1)",this.borderColour="rgba(255, 255, 255, 0)",this.shapeSelect="square",this.shapes=["square","circle","draw-polygon","paint-brush"],this.modeSelect="normal",this.modes=["normal","reveal","hide"],this.brushSize=m.getUnitDistance(v.gameStore.unitSize)}get helperSize(){return"paint-brush"===this.shapeSelect?this.brushSize/2:m.getUnitDistance(this.unitSize)/8}get IS_DM(){return v.gameStore.IS_DM}get unitSize(){return v.gameStore.unitSize}get useGrid(){return v.gameStore.useGrid}onFillChange(){this.brushHelper&&(this.brushHelper.fillColour=this.fillColour)}onModeUpdate(e,t){this.onModeChange(e,t)}setupBrush(){null!==this.brushHelper&&("reveal"===this.modeSelect||"hide"===this.modeSelect?(this.brushHelper.options.set("preFogShape",!0),this.brushHelper.options.set("skipDraw",!0),this.brushHelper.fillColour="rgba(0, 0, 0, 1)","reveal"===this.modeSelect?this.brushHelper.globalCompositeOperation="source-over":"hide"===this.modeSelect&&(this.brushHelper.globalCompositeOperation="destination-out")):(this.brushHelper.options.delete("preFogShape"),this.brushHelper.options.delete("skipDraw"),this.brushHelper.globalCompositeOperation="source-over",this.brushHelper.fillColour=this.fillColour))}onModeChange(e,t){if(null===this.brushHelper)return;const i=u.layerManager.getLayer("fow"),s=u.layerManager.getLayer();void 0!==i&&void 0!==s&&(this.setupBrush(),"normal"!==e&&"normal"===t?(s.removeShape(this.brushHelper,!1),i.addShape(this.brushHelper,!1)):"normal"===e&&"normal"!==t&&(s.addShape(this.brushHelper,!1),i.removeShape(this.brushHelper,!1)))}getLayer(){return"normal"===this.modeSelect?u.layerManager.getLayer():u.layerManager.getLayer("fow")}onMouseDown(e){const t=this.getLayer();if(void 0!==t){if(this.active)null!==this.shape&&this.shape instanceof p.Polygon&&this.shape._vertices.push(m.l2g(y.getMouse(e)));else{switch(this.startPoint=m.l2g(y.getMouse(e)),this.active=!0,this.shapeSelect){case"square":this.shape=new g.Rect(this.startPoint.clone(),0,0,this.fillColour,this.borderColour);break;case"circle":this.shape=new d.Circle(this.startPoint.clone(),this.helperSize,this.fillColour,this.borderColour);break;case"paint-brush":this.shape=new f.MultiLine(this.startPoint.clone(),[],this.brushSize),this.shape.fillColour=this.fillColour;break;case"draw-polygon":this.shape=new p.Polygon(this.startPoint.clone(),[],this.fillColour,this.borderColour);break;default:return}"normal"!==this.modeSelect&&(this.shape.options.set("preFogShape",!0),this.shape.options.set("skipDraw",!0),this.shape.fillColour="rgba(0, 0, 0, 1)"),"reveal"===this.modeSelect?this.shape.globalCompositeOperation="source-over":"hide"===this.modeSelect&&(this.shape.globalCompositeOperation="destination-out"),this.shape.addOwner(v.gameStore.username),"fow"===t.name&&"normal"===this.modeSelect&&(this.shape.visionObstruction=!0,this.shape.movementObstruction=!0),t.addShape(this.shape,!0,!1,!1),this.pushBrushBack()}if(null!==this.shape&&this.shape instanceof p.Polygon){const i=m.l2g(y.getMouse(e));null===this.ruler?(this.ruler=new h.Line(i,i,3,"black"),t.addShape(this.ruler,!1)):(this.ruler.refPoint=i,this.ruler.endPoint=i),this.shape.visionObstruction&&v.gameStore.recalculateVision(!0),t.invalidate(!1),l.socket.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!0})}}else console.log("No active layer!")}onMouseMove(e){const t=m.l2g(y.getMouse(e)),i=this.getLayer();if(void 0!==i){if(null!==this.brushHelper&&(this.brushHelper.r=this.helperSize,this.brushHelper.refPoint=t,this.active||i.invalidate(!1)),this.active&&null!==this.startPoint&&null!==this.shape){switch(this.shapeSelect){case"square":this.shape.w=Math.abs(t.x-this.startPoint.x),this.shape.h=Math.abs(t.y-this.startPoint.y),this.shape.refPoint=new c.GlobalPoint(Math.min(this.startPoint.x,t.x),Math.min(this.startPoint.y,t.y));break;case"circle":this.shape.r=t.subtract(this.startPoint).length();break;case"paint-brush":this.shape._points.push(t);break;case"draw-polygon":this.ruler.endPoint=t;break}this.shape instanceof p.Polygon||(l.socket.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!0}),this.shape.visionObstruction&&v.gameStore.recalculateVision(!0)),i.invalidate(!1)}}else console.log("No active layer!")}onMouseUp(e){!this.active||null===this.shape||this.shape instanceof p.Polygon||(!e.altKey&&this.useGrid&&this.shape.resizeToGrid(),this.finaliseShape())}onContextMenu(e){if(!this.active||null===this.shape||!(this.shape instanceof p.Polygon))return;const t=this.getLayer();void 0!==t?(t.removeShape(this.ruler,!1),this.ruler=null,this.finaliseShape()):console.log("No active layer!")}finaliseShape(){null!==this.shape&&(this.shape.visionObstruction&&v.gameStore.recalculateVision(),this.shape.movementObstruction&&v.gameStore.recalculateMovement(),l.socket.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!1}),this.active=!1)}onSelect(){const e=this.getLayer();void 0!==e&&(this.brushHelper=new d.Circle(new c.GlobalPoint(-1e3,-1e3),this.brushSize/2,this.fillColour),this.setupBrush(),e.addShape(this.brushHelper,!1))}onDeselect(){const e=this.getLayer();null!==this.brushHelper&&void 0!==e&&e.removeShape(this.brushHelper,!1),this.active&&void 0!==e&&null!==this.shape&&(e.removeShape(this.shape,!0,!1),this.shape=null,this.active=!1,e.invalidate(!1))}pushBrushBack(){const e=this.getLayer();void 0!==e?(null!==this.brushHelper&&e.removeShape(this.brushHelper,!1),this.brushHelper=new d.Circle(new c.GlobalPoint(-1e3,-1e3),this.brushSize/2,this.fillColour),this.setupBrush(),e.addShape(this.brushHelper,!1)):console.log("No active layer!")}};s.__decorate([o.Watch("fillColour")],b.prototype,"onFillChange",null),s.__decorate([o.Watch("modeSelect")],b.prototype,"onModeUpdate",null),b=s.__decorate([n.default({components:{"color-picker":r.default}})],b),t.default=b},"5e7c":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8f0a"),n=i("8db6"),o=i("2469"),r=i("92b1");class a extends o.Shape{constructor(e,t,i,s,n){super(e,"rgba(0, 0, 0, 0)",s||"#000",n),this.type="line",this.endPoint=t,this.lineWidth=void 0===i?1:i}asDict(){return Object.assign(this.getBaseDict(),{x2:this.endPoint.x,y2:this.endPoint.y,line_width:this.lineWidth})}get points(){return[[this.refPoint.x,this.refPoint.y],[this.endPoint.x,this.endPoint.y]]}getBoundingBox(){return new n.BoundingRect(new s.GlobalPoint(Math.min(this.refPoint.x,this.endPoint.x),Math.min(this.refPoint.y,this.endPoint.y)),Math.abs(this.refPoint.x-this.endPoint.x),Math.abs(this.refPoint.y-this.endPoint.y))}draw(e){super.draw(e),e.strokeStyle=this.strokeColour,e.beginPath(),e.moveTo(r.g2lx(this.refPoint.x),r.g2ly(this.refPoint.y)),e.lineTo(r.g2lx(this.endPoint.x),r.g2ly(this.endPoint.y)),e.lineWidth=this.lineWidth,e.stroke()}contains(e){return!1}center(e){}visibleInCanvas(e){return this.getBoundingBox().visibleInCanvas(e)}snapToGrid(){}resizeToGrid(){}resize(e,t){0===e?this.refPoint=r.l2g(t):this.endPoint=r.l2g(t)}}t.Line=a},"5ed5":function(e,t,i){},"5f86":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("bc3a")),o=s.__importDefault(i("a026")),r=s.__importDefault(i("8c4f"));o.default.use(r.default);const a=s.__importDefault(i("e914")),l=s.__importDefault(i("1077")),c=s.__importDefault(i("cad7")),u=s.__importDefault(i("47f7")),d=s.__importDefault(i("c6b4")),h=s.__importDefault(i("07f5")),f=s.__importDefault(i("ce87")),p=i("cc67");t.router=new r.default({mode:"history",base:"/",routes:[{path:"/",redirect:"/dashboard"},{path:"/_load",name:"load",component:u.default},{path:"/assets",component:a.default,meta:{auth:!0}},{path:"/auth",component:{template:"<router-view></router-view>"},children:[{path:"login",component:l.default},{path:"logout",component:c.default}]},{path:"/invite/:code",component:f.default,meta:{auth:!0}},{path:"/dashboard",component:d.default,meta:{auth:!0}},{path:"/game/:creator/:room",component:h.default,meta:{auth:!0}}]}),t.router.beforeEach((e,i,s)=>{p.coreStore.initialized||"/_load"===e.path?e.matched.some(e=>e.meta.auth)&&!p.coreStore.authenticated?s({path:"/auth/login",query:{redirect:e.path}}):s():(s({path:"/_load"}),n.default.get("/api/auth").then(i=>{i.data.auth&&(p.coreStore.setAuthenticated(!0),p.coreStore.setUsername(i.data.username)),p.coreStore.setInitialized(!0),t.router.push(e.path)}).catch(()=>{console.error("Authentication check could not be fulfilled.")}))})},"5fa9":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9"));let r=class extends n.default{constructor(){super(...arguments),this.name="",this.selected=!1,this.active=!1}get detailRight(){const e=this.$parent.$refs[this.name+"-selector"][0].getBoundingClientRect(),t=e.left+e.width/2;return`${window.innerWidth-Math.min(window.innerWidth-25,t+75)}px`}get detailArrow(){const e=this.$parent.$refs[this.name+"-selector"][0].getBoundingClientRect(),t=e.left+e.width/2,i=Math.min(window.innerWidth-25,t+75);return`${i-t-14}px`}created(){this.$parent.$on("mousedown",(e,t)=>{t===this.name&&this.onMouseDown(e)}),this.$parent.$on("mouseup",(e,t)=>{t===this.name&&this.onMouseUp(e)}),this.$parent.$on("mousemove",(e,t)=>{t===this.name&&this.onMouseMove(e)}),this.$parent.$on("contextmenu",(e,t)=>{t===this.name&&this.onContextMenu(e)}),this.$parent.$on("tools-select-change",(e,t)=>{t===this.name?(this.selected=!1,this.onDeselect()):e===this.name&&(this.selected=!0,this.onSelect())})}onSelect(){}onDeselect(){}onMouseDown(e){}onMouseUp(e){}onMouseMove(e){}onContextMenu(e){}};r=s.__decorate([o.default],r),t.default=r},6100:function(e,t,i){"use strict";i.r(t);var s=i("f974"),n=i("e94f");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("d75e");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"b6e1f51c",null);t["default"]=a.exports},6465:function(e,t,i){"use strict";i.r(t);var s=i("5fa9"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"64a9":function(e,t,i){},6542:function(e,t,i){},"676f":function(e,t,i){},"69fb":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"main"},on:{mouseleave:e.mouseleave,wheel:e.zoom}},[e.showUI?i("menu-bar"):e._e(),i("div",{attrs:{id:"board"}},[e.ready.manager?[i("tool-bar",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],ref:"tools"})]:e._e(),i("div",{attrs:{id:"layers"},on:{mousedown:e.mousedown,mouseup:e.mouseup,mousemove:e.mousemove,contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.contextmenu(t)},dragover:function(e){e.preventDefault()},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.drop(t)}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showUI&&e.layers.length>1,expression:"showUI && layers.length>1"}],attrs:{id:"layerselect"}},[i("ul",e._l(e.layers,function(t){return i("li",{key:t.name,class:{"layer-selected":t===e.selectedLayer},on:{mousedown:function(i){return e.selectLayer(t)}}},[i("a",{attrs:{href:"#"}},[e._v(e._s(t))])])}),0)])],2),i("selection-info",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],ref:"selectionInfo"}),i("initiative-dialog",{ref:"initiative",attrs:{id:"initiativedialog"}}),i("note-dialog",{ref:"note"}),i("label-dialog",{ref:"labels"}),e.IS_DM||e.FAKE_PLAYER?i("dm-settings",{ref:"dmsettings"}):e._e(),i("zoom-slider",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],attrs:{id:"zoomer",height:6,width:200,min:0,max:1,interval:.1,"dot-width":8,"dot-height":20,"tooltip-dir":"bottom",tooltip:"hover",formatter:e.zoomDisplay.toFixed(1),"slider-style":{"border-radius":"15%"},"bg-style":{"background-color":"#fff","box-shadow":"0.5px 0.5px 3px 1px rgba(0, 0, 0, .36)"},"process-style":{"background-color":"#fff"}},model:{value:e.zoomDisplay,callback:function(t){e.zoomDisplay=t},expression:"zoomDisplay"}}),i("prompt-dialog",{ref:"prompt"}),i("confirm-dialog",{ref:"confirm"})],1)},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},"6a95":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"input-copy"},on:{mouseleave:function(t){e.showPopup=!1}}},[i("input",{attrs:{type:"text",disabled:"disabled",id:"input-element"},domProps:{value:e.value}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showPopup,expression:"showPopup"}],attrs:{id:"show-popup"}},[e._v(e._s(e.popupString))]),i("div",{attrs:{id:"copy-button"},on:{click:e.copy}},[i("i",{staticClass:"far fa-copy"})])])},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},"6c30":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("c266"),n=i("f10f"),o=i("92b1");class r extends s.BaseRect{constructor(e,t,i,s,n){super(t,i,s,void 0,void 0,n),this.type="assetrect",this.src="",this.img=e}asDict(){return Object.assign(this.getBaseDict(),{src:this.src})}fromDict(e){super.fromDict(e),this.src=e.src}draw(e){super.draw(e);try{e.drawImage(this.img,o.g2lx(this.refPoint.x),o.g2ly(this.refPoint.y),o.g2lz(this.w),o.g2lz(this.h))}catch(t){console.warn(`Shape ${this.uuid} could not load the image ${this.src}`)}}getInitiativeRepr(){return{uuid:this.uuid,visible:!n.gameStore.IS_DM,group:!1,source:this.src,has_img:!0,effects:[],index:1/0}}}t.Asset=r},"6c7c":function(e,t,i){"use strict";i.r(t);var s=i("6a95"),n=i("9088");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("2900");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"20bfdb3e",null);t["default"]=a.exports},"6e4a":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("98ef"),n=i("4aee");class o{constructor(){this.tds=new s.TDS}insertConstraint(e,t){const i=this.insert(e),s=this.insert(t);i!==s&&this.insertConstraintV(i,s)}insertConstraintV(e,t){const i=[[e,t]];while(i.length>0){const e=i.pop(),t=n.edgeInfo(e[0],e[1]);if(t.includes){this.markConstraint(t.fr,t.i),t.vi!==e[1]&&i.push([t.vi,e[1]]);continue}const s=this.findIntersectedFaces(e[0],e[1]);s.found?s.vi!==e[0]&&s.vi!==e[1]?(i.push([e[0],s.vi]),i.push([s.vi,e[1]])):i.push(e):(this.triangulateHole(s.intersectedFaces,s.listAB,s.listBA),s.vi!==e[1]&&i.push([s.vi,e[1]]))}}triangulateHole(e,t,i){const s=[];this.triangulateHole2(e,t,i,s),this.propagatingFlipE(s)}triangulateHole2(e,t,i,s){if(t.length>0){this.triangulateHalfHole(t,s),this.triangulateHalfHole(i,s);const n=t[0][0],o=i[0][0];n.neighbours[2]=o,o.neighbours[2]=n,n.constraints[2]=!0,o.constraints[2]=!0;while(e.length>0)this.tds.deleteTriangle(e.shift())}}triangulateHalfHole(e,t){let i,o,r=0;const a=()=>e[r],l=()=>e[i],c=a()[0].vertices[n.ccw(a()[1])];let u,d,h,f,p,g;i=r,++i;do{d=a()[0],p=a()[1],null!==d.neighbours[p]&&(u=d.neighbours[p],f=n.cw(u.indexV(d.vertices[n.cw(p)])),d=u.neighbours[f],p=this.tds.mirrorIndex(u,f)),h=l()[0],g=l()[1],null!==h.neighbours[g]&&(u=h.neighbours[g],f=n.cw(u.indexV(h.vertices[n.cw(g)])),h=u.neighbours[f],g=this.tds.mirrorIndex(u,f));const v=d.vertices[n.ccw(p)],m=d.vertices[n.cw(p)],y=h.vertices[n.cw(g)],b=n.orientation(v.point,m.point,y.point);switch(b){case s.Sign.RIGHT_TURN:{const s=this.tds.createTriangle(v,y,m,null,null,null);t.push([s,2]),s.neighbours[1]=d,s.neighbours[0]=h,d.neighbours[p]=s,h.neighbours[g]=s,d.isConstrained(p)&&(s.constraints[1]=!0),h.isConstrained(g)&&(s.constraints[0]=!0),v.triangle=s,m.triangle=s,y.triangle=s,o=r+1,e.splice(r,0,[s,2]),e.splice(Math.max(o,i),1),e.splice(Math.min(o,i),1),i=r,v!==c?--r:++i;break}case s.Sign.LEFT_TURN:case s.Sign.COLLINEAR:++r,++i;break}}while(i<e.length)}findIntersectedFaces(e,t){const i=e.point,o=t.point,r=[],a=[],l=[],c=new s.LineFaceCirculator(e,this,o);let u,d=c.pos.indexV(e);if(c.pos.isConstrained(d))return u=this.intersect(c.pos,d,e,t),{found:!0,vi:u,listAB:r,listBA:a,intersectedFaces:l};let h=c.pos.neighbours[n.ccw(d)],f=c.pos.neighbours[n.cw(d)];r.push([h,h.indexT(c.pos)]),a.unshift([f,f.indexT(c.pos)]),l.unshift(c.pos);let p=c.pos;c.next(),d=c.pos.indexT(p);let g=c.pos.vertices[d],v=!1;while(g!==t&&!v){let f,m;const y=n.orientation(i,o,g.point);switch(y){case s.Sign.COLLINEAR:v=!0;break;case s.Sign.LEFT_TURN:case s.Sign.RIGHT_TURN:if(y===s.Sign.LEFT_TURN?(f=n.ccw(d),m=n.cw(d)):(f=n.cw(d),m=n.ccw(d)),c.pos.isConstrained(f))return u=this.intersect(c.pos,f,e,t),{found:!0,vi:u,listAB:r,listBA:a,intersectedFaces:l};h=c.pos.neighbours[m],l.unshift(c.pos),y===s.Sign.LEFT_TURN?r.push([h,h.indexT(c.pos)]):a.unshift([h,h.indexT(c.pos)]),p=c.pos,c.next(),d=c.pos.indexT(p),g=c.pos.vertices[d];break}}return u=g,l.unshift(c.pos),h=c.pos.neighbours[n.cw(d)],r.push([h,h.indexT(c.pos)]),f=c.pos.neighbours[n.ccw(d)],a.unshift([f,f.indexT(c.pos)]),{found:!1,vi:u,listAB:r,listBA:a,intersectedFaces:l}}intersect(e,t,i,o){const r=e.vertices[n.cw(t)],a=e.vertices[n.ccw(t)],l=i.point,c=o.point,u=r.point,d=a.point;let h,f=n.intersection(l,c,u,d);if(f!==l&&f!==c&&f!==u&&f!==d){const e=new s.BoundingBox(f);e.dilate(4),e.overlaps(new s.BoundingBox(l))&&(f=l),e.overlaps(new s.BoundingBox(c))&&(f=c),e.overlaps(new s.BoundingBox(u))&&(f=u),e.overlaps(new s.BoundingBox(d))&&(f=d)}if(null===f)throw new Error("what");return this.removeConstrainedEdge(e,t),h=this.insert(f,e),h!==r&&h!==a?(this.insertConstraintV(r,h),this.insertConstraintV(h,a)):this.insertConstraintV(r,a),h}removeConstrainedEdge(e,t){e.constraints[t]=!1,2===this.tds.dimension&&(e.neighbours[t].constraints[this.tds.mirrorIndex(e,t)]=!1)}updateConstraintsOpposite(e){let t=e.triangle;const i=t;let s;do{s=t.indexV(e),t.neighbours[s].constraints[this.tds.mirrorIndex(t,s)]?t.constraints[s]=!0:t.constraints[s]=!1,t=t.neighbours[n.ccw(s)]}while(t!==i)}markConstraint(e,t){1===this.tds.dimension?e.constraints[2]=!0:(e.constraints[t]=!0,e.neighbours[t].constraints[this.tds.mirrorIndex(e,t)]=!0)}insert(e,t=null){const i=this.locate(e,this.iLocate(e,t)),s=this.insertb(e,i.loc,i.lt,i.li);return this.flipAround(s),s}flipAround(e){if(this.tds.dimension<=1)return;let t,i,s=e.triangle;const o=s;do{t=s.indexV(e),i=s.neighbours[n.ccw(t)],this.propagatingFlip(s,t),s=i}while(i!==o)}propagatingFlip(e,t,i=0){if(!this.isFlipable(e,t))return;const s=100;if(i===s)throw new Error("maxde");const n=e.neighbours[t];this.flip(e,t),this.propagatingFlip(e,t,i+1),t=n.indexV(e.vertices[t]),this.propagatingFlip(n,t,i+1)}lessEdge(e,t){const i=e[1],s=t[1];return e[0].uid<t[0].uid||e[0].uid===t[0].uid&&i<s}propagatingFlipE(e){let t,i,s,o=0;const r=[];while(o<e.length)t=e[o][0],i=e[o][1],this.isFlipable(t,i)&&(s=[t.neighbours[i],this.tds.mirrorIndex(t,i)],this.lessEdge(e[o],s)?r.push(e[o]):r.push(s)),++o;let a,l,c,u;const d=[null,null,null,null];while(r.length>0){t=r[0][0],a=r[0][1],l=t.neighbours[a],c=this.tds.mirrorIndex(t,a),u=[t,a],r.splice(r.findIndex(e=>e[0]===u[0]&&e[1]===u[1]),1),d[0]=[t,n.cw(a)],d[1]=[t,n.ccw(a)],d[2]=[l,n.cw(c)],d[3]=[l,n.ccw(c)];for(const e of d){const t=e[0],i=e[1];s=[t.neighbours[i],this.tds.mirrorIndex(t,i)],this.lessEdge(e,s)?r.splice(r.findIndex(t=>t[0]===e[0]&&t[1]===e[1]),1):r.splice(r.findIndex(e=>e[0]===s[0]&&e[1]===s[1]),1)}this.flip(t,a);for(const e of d){const t=e[0],i=e[1];this.isFlipable(t,i)&&(s=[t.neighbours[i],this.tds.mirrorIndex(t,i)],this.lessEdge(e,s)?r.push(e):r.push(s))}}}flip(e,t){const i=e.neighbours[t],s=this.tds.mirrorIndex(e,t),o=e.neighbours[n.cw(t)],r=this.tds.mirrorIndex(e,n.cw(t)),a=e.neighbours[n.ccw(t)],l=this.tds.mirrorIndex(e,n.ccw(t)),c=i.neighbours[n.cw(s)],u=this.tds.mirrorIndex(i,n.cw(s)),d=i.neighbours[n.ccw(s)],h=this.tds.mirrorIndex(i,n.ccw(s));this.tds.flip(e,t),e.constraints[e.indexT(i)]=!1,i.constraints[i.indexT(e)]=!1,o.neighbours[r].constraints[this.tds.mirrorIndex(o,r)]=o.constraints[r],a.neighbours[l].constraints[this.tds.mirrorIndex(a,l)]=a.constraints[l],c.neighbours[u].constraints[this.tds.mirrorIndex(c,u)]=c.constraints[u],d.neighbours[h].constraints[this.tds.mirrorIndex(d,h)]=d.constraints[h]}isFlipable(e,t,i=!0){const o=e.neighbours[t];return!e.isInfinite()&&!o.isInfinite()&&(!e.constraints[t]&&n.sideOfOrientedCircle(o,e.vertices[t].point,i)===s.Sign.ON_POSITIVE_SIDE)}insertb(e,t,i,o){let r,a,l=!1;i===s.LocateType.EDGE&&t.isConstrained(o)&&(l=!0,r=t.vertices[n.ccw(o)],a=t.vertices[n.cw(o)]);const c=this.insertc(e,t,i,o);return l?this.updateConstraintsIncident(c,r,a):i!==s.LocateType.VERTEX&&this.clearConstraintsIncident(c),2===this.tds.dimension&&this.updateConstraintsOpposite(c),c}updateConstraintsIncident(e,t,i){if(0!==this.tds.dimension)if(1===this.tds.dimension){const t=new s.EdgeCirculator(e,null);do{t.t.constraints[2]=!0}while(t.next())}else{const o=new s.FaceCirculator(e,null);do{const s=o.t.indexV(e),r=n.cw(s),a=n.ccw(s);o.t.vertices[r]===t||o.t.vertices[r]===i?(o.t.constraints[a]=!0,o.t.constraints[r]=!1):(o.t.constraints[a]=!1,o.t.constraints[r]=!0)}while(o.next())}}clearConstraintsIncident(e){const t=new s.EdgeCirculator(e,null);if(t.valid)do{const e=t.t,i=t.ri;e.constraints[i]=!1,2===this.tds.dimension&&(e.neighbours[i].constraints[this.tds.mirrorIndex(e,i)]=!1)}while(t.next())}insertc(e,t,i,n){if(1===this.tds.vertices.length)return this.insertFirst(e);if(2===this.tds.vertices.length)return i===s.LocateType.VERTEX?this.tds.finiteVertex:this.insertSecond(e);switch(i){case s.LocateType.VERTEX:return t.vertices[n];case s.LocateType.OUTSIDE_AFFINE_HULL:return this.insertOutsideAffineHull(e);case s.LocateType.OUTSIDE_CONVEX_HULL:return this.insertOutsideConvexHull(e,t);case s.LocateType.EDGE:return this.insertInEdge(e,t,n);case s.LocateType.FACE:return this.insertInFace(e,t)}throw new Error("qwe")}insertInEdge(e,t,i){const s=this.tds.insertInEdge(t,i);return s.point=e,s}insertInFace(e,t){const i=this.tds.insertInFace(t);return i.point=e,i}insertFirst(e){const t=this.tds.insertDimUp();return t.point=e,t}insertSecond(e){const t=this.tds.insertDimUp(this.tds._infinite,!0);return t.point=e,t}insertOutsideAffineHull(e){let t=!1;if(1===this.tds.dimension){const i=this.tds.finiteEdge.first,o=n.orientation(i.vertices[0].point,i.vertices[1].point,e);t=o===s.Sign.COUNTERCLOCKWISE}const i=this.tds.insertDimUp(this.tds._infinite,t);return i.point=e,i}insertOutsideConvexHull(e,t){let i;if(1===this.tds.dimension)throw new Error("sdfasdasd");return i=this.insertOutsideConvexHull2(e,t),i.point=e,i}insertOutsideConvexHull2(e,t){let i=t.indexV(this.tds._infinite);const o=[],r=[];let a=new s.FaceCirculator(this.tds._infinite,t),l=!1;while(!l){a.prev(),i=a.t.indexV(this.tds._infinite);const t=a.t.vertices[n.ccw(i)].point,r=a.t.vertices[n.cw(i)].point;n.orientation(e,t,r)===s.Sign.LEFT_TURN?o.push(a.t):l=!0}a=new s.FaceCirculator(this.tds._infinite,t),l=!1;while(!l){a.next(),i=a.t.indexV(this.tds._infinite);const t=a.t.vertices[n.ccw(i)].point,o=a.t.vertices[n.cw(i)].point;n.orientation(e,t,o)===s.Sign.LEFT_TURN?r.push(a.t):l=!0}const c=this.tds.insertInFace(t);let u;c.point=e;while(o.length>0)u=o[0],i=n.ccw(u.indexV(this.tds._infinite)),this.tds.flip(u,i),o.shift();while(r.length>0)u=r[0],i=n.cw(u.indexV(this.tds._infinite)),this.tds.flip(u,i),r.shift();a=new s.FaceCirculator(c,null);while(!a.t.isInfinite())a.next();return this.tds._infinite.triangle=a.t,c}locate(e,t){let i=0,o=0;if(this.tds.dimension<0)return i=s.LocateType.OUTSIDE_AFFINE_HULL,o=4,{loc:null,lt:i,li:o};if(0===this.tds.dimension)return i=n.xyEqual(e,this.tds.finiteVertex.triangle.vertices[0].point)?s.LocateType.VERTEX:s.LocateType.OUTSIDE_AFFINE_HULL,o=4,{loc:null,lt:i,li:o};if(1===this.tds.dimension)return this.marchLocate1D(e);if(null===t){const e=this.tds._infinite.triangle;t=e.neighbours[e.indexV(this.tds._infinite)]}else t.isInfinite()&&(t=t.neighbours[t.indexV(this.tds._infinite)]);return this.marchLocate2D(t,e)}marchLocate1D(e){const t=this.tds._infinite.triangle,i=t.indexV(this.tds._infinite),o=t.neighbours[i],r=n.orientation(o.vertices[0].point,o.vertices[1].point,e);if(r===s.Sign.RIGHT_TURN||r===s.Sign.LEFT_TURN)return{loc:new s.Triangle,lt:s.LocateType.OUTSIDE_AFFINE_HULL,li:4};const a=o.indexT(t);if(n.collinearBetween(e,o.vertices[1-a].point,o.vertices[a].point))return{loc:t,lt:s.LocateType.OUTSIDE_CONVEX_HULL,li:i};if(n.xyEqual(e,o.vertices[1-a].point))return{loc:o,lt:s.LocateType.VERTEX,li:1-a};throw new Error("sdfsdf")}marchLocate2D(e,t){let i,o,r=null,a=!0;while(1){if(e.isInfinite())return{loc:e,lt:s.LocateType.OUTSIDE_CONVEX_HULL,li:e.indexV(this.tds._infinite)};const l=0,c=e.vertices[0].point,u=e.vertices[1].point,d=e.vertices[2].point;let h,f,p;if(a){if(r=e,a=!1,h=n.orientation(c,u,t),h===s.Sign.NEGATIVE){e=e.neighbours[2];continue}if(f=n.orientation(u,d,t),f===s.Sign.NEGATIVE){e=e.neighbours[0];continue}if(p=n.orientation(d,c,t),p===s.Sign.NEGATIVE){e=e.neighbours[1];continue}}else if(l)if(e.neighbours[0]===r){if(r=e,h=n.orientation(c,u,t),h===s.Sign.NEGATIVE){e=e.neighbours[2];continue}if(p=n.orientation(d,c,t),p===s.Sign.NEGATIVE){e=e.neighbours[1];continue}f=s.Sign.POSITIVE}else if(e.neighbours[1]===r){if(r=e,f=n.orientation(u,d,t),f===s.Sign.NEGATIVE){e=e.neighbours[0];continue}if(h=n.orientation(c,u,t),h===s.Sign.NEGATIVE){e=e.neighbours[2];continue}p=s.Sign.POSITIVE}else{if(r=e,p=n.orientation(d,c,t),p===s.Sign.NEGATIVE){e=e.neighbours[1];continue}if(f=n.orientation(u,d,t),f===s.Sign.NEGATIVE){e=e.neighbours[0];continue}h=s.Sign.POSITIVE}else if(e.neighbours[0]===r){if(r=e,p=n.orientation(d,c,t),p===s.Sign.NEGATIVE){e=e.neighbours[1];continue}if(h=n.orientation(c,u,t),h===s.Sign.NEGATIVE){e=e.neighbours[2];continue}f=s.Sign.POSITIVE}else if(e.neighbours[1]===r){if(r=e,h=n.orientation(c,u,t),h===s.Sign.NEGATIVE){e=e.neighbours[2];continue}if(f=n.orientation(u,d,t),f===s.Sign.NEGATIVE){e=e.neighbours[0];continue}p=s.Sign.POSITIVE}else{if(r=e,f=n.orientation(u,d,t),f===s.Sign.NEGATIVE){e=e.neighbours[0];continue}if(p=n.orientation(d,c,t),p===s.Sign.NEGATIVE){e=e.neighbours[1];continue}h=s.Sign.POSITIVE}const g=(h===s.Sign.COLLINEAR?1:0)+(f===s.Sign.COLLINEAR?1:0)+(p===s.Sign.COLLINEAR?1:0);switch(g){case 0:i=s.LocateType.FACE,o=4;break;case 1:i=s.LocateType.EDGE,o=h===s.Sign.COLLINEAR?2:f===s.Sign.COLLINEAR?0:1;break;case 2:i=s.LocateType.VERTEX,o=h!==s.Sign.COLLINEAR?2:f!==s.Sign.COLLINEAR?0:1;break}if(void 0===i||void 0===o)throw new Error("ert");return{loc:e,lt:i,li:o}}}iLocate(e,t){if(this.tds.dimension<2)return t;if(null===t){const e=this.tds._infinite.triangle;t=e.neighbours[e.indexV(this.tds._infinite)]}else t.isInfinite()&&(t=t.neighbours[t.indexV(this.tds._infinite)]);let i=null,s=t,o=!0,r=2500;while(1){if(!r--)return s;if(s.isInfinite())return s;const t=s.vertices[0].point,a=s.vertices[1].point,l=s.vertices[2].point;if(o){if(i=s,o=!1,n.hasInexactNegativeOrientation(t,a,e)){s=s.neighbours[2];continue}if(n.hasInexactNegativeOrientation(a,l,e)){s=s.neighbours[0];continue}if(n.hasInexactNegativeOrientation(l,t,e)){s=s.neighbours[1];continue}}else if(s.neighbours[0]===i){if(i=s,n.hasInexactNegativeOrientation(t,a,e)){s=s.neighbours[2];continue}if(n.hasInexactNegativeOrientation(l,t,e)){s=s.neighbours[1];continue}}else if(s.neighbours[1]===i){if(i=s,n.hasInexactNegativeOrientation(t,a,e)){s=s.neighbours[2];continue}if(n.hasInexactNegativeOrientation(a,l,e)){s=s.neighbours[0];continue}}else{if(i=s,n.hasInexactNegativeOrientation(l,t,e)){s=s.neighbours[1];continue}if(n.hasInexactNegativeOrientation(a,l,e)){s=s.neighbours[0];continue}}break}return s}}t.CDT=o},"6f8d":function(e,t,i){"use strict";i.r(t);var s=i("5b69"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"6f92":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8f0a"),n=i("6c30"),o=i("f10f"),r=i("92b1");class a{constructor(){this.layers=[],this.width=window.innerWidth,this.height=window.innerHeight,this.UUIDMap=new Map,this.interval=30,this.drawLoop=()=>{for(let e=this.layers.length-1;e>=0;e--)this.layers[e].draw();requestAnimationFrame(this.drawLoop)},requestAnimationFrame(this.drawLoop)}reset(){this.layers=[],this.UUIDMap=new Map}setWidth(e){this.width=e;for(const t of this.layers)t.canvas.width=e,t.width=e}setHeight(e){this.height=e;for(const t of this.layers)t.canvas.height=e,t.height=e}addLayer(e){this.layers.push(e),(o.gameStore.IS_DM||e.playerEditable)&&e.selectable&&o.gameStore.addLayer(e.name)}hasLayer(e){return this.layers.some(t=>t.name===e)}getLayer(e){e=void 0===e?o.gameStore.selectedLayer:e;for(const t of this.layers)if(t.name===e)return t}selectLayer(e,t=!0){let i=!1;for(const s of this.layers)s.selectable&&(i&&"fow"!==s.name?s.ctx.globalAlpha=.3:s.ctx.globalAlpha=1,e===s.name&&(o.gameStore.selectLayer({name:e,sync:t}),i=!0),s.clearSelection(),s.invalidate(!0))}getGridLayer(){return this.getLayer("grid")}hasSelection(){const e=this.getSelection();return void 0!==e&&e.length>0}getSelection(){const e=this.getLayer();if(void 0!==e)return e.selection}invalidate(){for(let e=this.layers.length-1;e>=0;e--)this.layers[e].invalidate(!0)}invalidateLight(){for(let e=this.layers.length-1;e>=0;e--)this.layers[e].isVisionLayer&&this.layers[e].invalidate(!0)}dropAsset(e){const t=this.getLayer();if(void 0===t||null===e||null===e.dataTransfer)return;const i=document.createElement("img");i.src=e.dataTransfer.getData("text/plain");const a=new n.Asset(i,new s.GlobalPoint(r.l2gx(e.clientX),r.l2gy(e.clientY)),r.l2gz(i.width),r.l2gz(i.height));if(a.src=new URL(i.src).pathname,o.gameStore.useGrid){const e=o.gameStore.gridSize;a.refPoint=new s.GlobalPoint(Math.round(a.refPoint.x/e)*e,Math.round(a.refPoint.y/e)*e),a.w=Math.max(Math.round(a.w/e)*e,e),a.h=Math.max(Math.round(a.h/e)*e,e)}t.addShape(a,!0)}}t.layerManager=new a,window.lm=t.layerManager},7018:function(e,t,i){"use strict";i.r(t);var s=i("ebb9"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},7420:function(e,t,i){"use strict";i.r(t);var s=i("d320"),n=i("778b");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("c969");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"73816298",null);t["default"]=a.exports},"76b3":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(e,t){this.children=[],this.nPrimitives=e,this.bbox=t}}t.BoundingNode=s;class n extends s{constructor(e,t,i){super(t,i),this.firstPrimOffset=e}}t.LeafNode=n;class o extends s{constructor(e,t,i){super(0,t.bbox.union(i.bbox)),this.dimension=e,this.children.push(t),this.children.push(i)}}t.InteriorNode=o},"778b":function(e,t,i){"use strict";i.r(t);var s=i("5a81"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"77a6":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("4a5b"),n=i("0bc6"),o=i("2b48"),r=i("af17"),a=i("8f0a"),l=i("6f92"),c=i("206a"),u=i("f10f"),d=i("2838");function h(e){if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement);else if("Delete"===e.key||"Del"===e.key||"Backspace"===e.key){if(void 0===l.layerManager.getLayer)return void console.log("No active layer selected for delete operation");const e=l.layerManager.getLayer();for(let t=e.selection.length-1;t>=0;t--){const i=e.selection[t];s.getRef("tools").$refs.selectTool.selectionHelper.uuid!==i.uuid?(e.removeShape(i,!0,!1),r.EventBus.$emit("SelectionInfo.Shape.Set",null),r.EventBus.$emit("Initiative.Remove",i.uuid)):e.selection.splice(t,1)}}}function f(e){if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)65===e.keyCode&&e.ctrlKey&&e.target.select();else if(e.keyCode>=37&&e.keyCode<=40){const t=Math.round(u.gameStore.gridSize);let i=t*(e.keyCode%2),r=t*(e.keyCode%2?0:1);if(l.layerManager.hasSelection()){const t=l.layerManager.getSelection();i*=e.keyCode<=38?-1:1,r*=e.keyCode<=38?-1:1;let o=new a.Vector(i,r);if(!e.shiftKey||!u.gameStore.IS_DM)for(const e of t)s.getRef("tools").$refs.selectTool.selectionHelper.uuid!==e.uuid&&(o=d.calculateDelta(o,e));for(const e of t)s.getRef("tools").$refs.selectTool.selectionHelper.uuid!==e.uuid&&(e.refPoint=e.refPoint.add(o),n.socket.emit("Shape.Position.Update",{shape:e.asDict(),redraw:!0,temporary:!1}));u.gameStore.recalculateVision(),l.layerManager.getLayer().invalidate(!1)}else u.gameStore.increasePanX(i*(e.keyCode<=38?1:-1)),u.gameStore.increasePanY(r*(e.keyCode<=38?1:-1)),l.layerManager.invalidate(),o.sendClientOptions()}else if(68===e.keyCode){const e=l.layerManager.getLayer();e&&(e.clearSelection(),e.invalidate(!0))}else if("u"===e.key&&e.ctrlKey)e.preventDefault(),e.stopPropagation(),u.gameStore.toggleUI();else if("c"===e.key&&e.ctrlKey){const e=l.layerManager.getLayer();if(!e)return;if(!e.selection)return;const t=[];for(const i of e.selection)s.getRef("tools").$refs.selectTool.selectionHelper.uuid!==i.uuid&&t.push(i.asDict());u.gameStore.setClipboard(t)}else if("v"===e.key&&e.ctrlKey){const e=l.layerManager.getLayer();if(!e)return;if(!u.gameStore.clipboard)return;e.selection=[];for(const t of u.gameStore.clipboard){t.x+=10,t.y+=10,t.uuid=s.uuidv4();const i=t.trackers;t.trackers=[];for(const e of i){const i=Object.assign({},e,{uuid:s.uuidv4()});t.trackers.push(i)}const n=t.auras;t.auras=[];for(const e of n){const i=Object.assign({},e,{uuid:s.uuidv4()});t.auras.push(i)}const o=c.createShapeFromDict(t);void 0!==o&&(e.addShape(o,!0),e.selection.push(o))}1===e.selection.length?r.EventBus.$emit("SelectionInfo.Shape.Set",e.selection[0]):r.EventBus.$emit("SelectionInfo.Shape.Set",null),e.invalidate(!1)}}t.onKeyUp=h,t.onKeyDown=f},"78c7":function(e,t,i){"use strict";var s=i("9227"),n=i.n(s);n.a},"7aaa":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("033f")),r=s.__importDefault(i("7420")),a=s.__importDefault(i("59d8")),l=s.__importDefault(i("bea6")),c=s.__importDefault(i("dec1")),u=s.__importDefault(i("4899")),d=s.__importDefault(i("c277")),h=s.__importDefault(i("9f58")),f=i("6f92"),p=i("9cb7"),g=i("f10f"),v=i("d5df"),m=i("92b1"),y=i("5a5c"),b=s.__importDefault(i("65d9"));let _=class extends n.default{constructor(){super(...arguments),this.currentTool="Select",this.tools=["Select","Pan","Draw","Ruler","Map","Filter","Vision"],this.dmTools=["Map"]}get IS_DM(){return g.gameStore.IS_DM}get currentToolComponent(){return`${this.currentTool.toLowerCase()}-tool`}get visibleTools(){return this.tools.filter(e=>!this.dmTools.includes(e)||this.IS_DM)}toolVisible(e){return"Filter"===e?Object.keys(g.gameStore.labels).length>0:"Vision"!==e||g.gameStore.ownedtokens.length>1}mousedown(e){if("CANVAS"!==e.target.tagName)return;let t=this.currentTool;if(1===e.button)t="Pan";else if(0!==e.button)return;this.$emit("mousedown",e,t)}mouseup(e){if("CANVAS"!==e.target.tagName)return;let t=this.currentTool;if(1===e.button)t="Pan";else if(0!==e.button)return;this.$emit("mouseup",e,t)}mousemove(e){if("CANVAS"!==e.target.tagName)return;let t=this.currentTool;if(0!==(4&e.buttons))t="Pan";else if((1&e.button)>1)return;this.$emit("mousemove",e,t);let i=!1;for(const s of g.gameStore.annotations)if(f.layerManager.UUIDMap.has(s)&&f.layerManager.hasLayer("draw")){const t=f.layerManager.UUIDMap.get(s);t.contains(m.l2g(y.getMouse(e)))&&(i=!0,p.gameManager.annotationManager.setActiveText(t.annotation))}!i&&p.gameManager.annotationManager.shown&&p.gameManager.annotationManager.setActiveText("")}mouseleave(e){0!==(1&e.buttons)&&this.$emit("mouseup",e,this.currentTool)}contextmenu(e){"CANVAS"===e.target.tagName&&2===e.button&&"CANVAS"===e.target.tagName&&this.$emit("contextmenu",e,this.currentTool)}};_=s.__decorate([b.default({components:{"select-tool":d.default,"pan-tool":u.default,"draw-tool":a.default,"ruler-tool":v.RulerTool,"map-tool":c.default,"filter-tool":l.default,"vision-tool":h.default,"shape-menu":o.default,"createtoken-dialog":r.default},watch:{currentTool(e,t){this.$emit("tools-select-change",e,t)}}})],_),t.default=_},"7ba5":function(e,t,i){"use strict";i.r(t);var s=i("fbdd"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"7e15":function(e,t,i){"use strict";i.r(t);var s=i("52a8"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"7eb7":function(e,t,i){"use strict";var s=i("cd76"),n=i.n(s);n.a},"7f1e":function(e,t,i){"use strict";var s=i("fe11"),n=i.n(s);n.a},"839d":function(e,t,i){},"851c":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=s.__importDefault(i("d65f"));let a=class extends n.default{constructor(){super(...arguments),this.visible=!1,this.question="",this.answer="",this.title="",this.resolve=e=>{},this.reject=()=>{}}submit(){this.resolve(this.answer),this.close()}close(){this.reject(),this.visible=!1,this.question="",this.answer="",this.title=""}prompt(e,t){return this.question=e,this.title=t,this.visible=!0,this.$nextTick(()=>{this.$refs.answer.focus()}),new Promise((e,t)=>{this.resolve=e,this.reject=t})}};a=s.__decorate([o.default({components:{Modal:r.default}})],a),t.default=a},8790:function(e,t,i){"use strict";var s=i("a912"),n=i.n(s);n.a},"88af":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e._v(e._s(e.message))])},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},"8cd4":function(e,t,i){"use strict";i.r(t);var s=i("9587"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"8db6":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8f0a"),n=i("92b1");class o{constructor(e,t,i){this.w=t,this.h=i,this.topLeft=e,this.topRight=new s.GlobalPoint(e.x+t,e.y),this.botRight=new s.GlobalPoint(e.x+t,e.y+i),this.botLeft=new s.GlobalPoint(e.x,e.y+i)}contains(e){return this.topLeft.x<=e.x&&this.topRight.x>=e.x&&this.topLeft.y<=e.y&&this.botLeft.y>=e.y}get points(){return 0===this.w||0===this.h?[[this.topLeft.x,this.topLeft.y]]:[[this.topLeft.x,this.topLeft.y],[this.botLeft.x,this.botLeft.y],[this.botRight.x,this.botRight.y],[this.topRight.x,this.topRight.y]]}offset(e){return new o(this.topLeft.add(e),this.w,this.h)}union(e){const t=Math.min(this.topLeft.x,e.topLeft.x),i=Math.max(this.topRight.x,e.topRight.x),n=Math.min(this.topLeft.y,e.topLeft.y),r=Math.max(this.botLeft.y,e.botLeft.y);return new o(new s.GlobalPoint(t,n),i-t,r-n)}getDiagCorner(e){return e?this.botRight:this.topLeft}intersectsWith(e){return!(e.topLeft.x>this.topRight.x||e.topRight.x<this.topLeft.x||e.topLeft.y>this.botLeft.y||e.botLeft.y<this.topLeft.y)}intersectsWithInner(e){return!(e.topLeft.x>=this.topRight.x||e.topRight.x<=this.topLeft.x||e.topLeft.y>=this.botLeft.y||e.botLeft.y<=this.topLeft.y)}intersectP(e,t,i){let s=t.x*(this.getDiagCorner(i[0]).x-e.origin.x),n=t.x*(this.getDiagCorner(!i[0]).x-e.origin.x);const o=t.y*(this.getDiagCorner(i[1]).y-e.origin.y),r=t.y*(this.getDiagCorner(!i[1]).y-e.origin.y);return s>r||o>n?{hit:!1,min:s,max:n}:(o>s&&(s=o),r<n&&(n=r),{hit:s<e.tMax&&n>0,min:s,max:n})}center(){return this.topLeft.add(new s.Vector(this.w/2,this.h/2))}getMaxExtent(){return this.w>this.h?0:1}visibleInCanvas(e){const t=!(n.g2lx(this.topLeft.x)>e.width||n.g2ly(this.topLeft.y)>e.height||n.g2lx(this.topRight.x)<0||n.g2ly(this.botRight.y)<0);return!!t}}t.BoundingRect=o},"8e60":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"formcontainer"}},[e.owned||e.joined?i("form",[i("fieldset",[i("legend",{staticClass:"legend"},[e._v("Your sessions")]),i("div",{staticClass:"input"},[e._l(e.owned,function(t,s){return i("router-link",{key:"o-"+s,attrs:{to:"/game/"+t[1]+"/"+t[0]}},[e._v(e._s(t[0]))])}),e._l(e.joined,function(t,s){return i("router-link",{key:"j-"+s,attrs:{to:"/game/"+t[1]+"/"+t[0]}},[e._v(e._s(t[1])+"/"+e._s(t[0]))])})],2),0===e.owned.length?i("div",{staticClass:"input"},[e._v("No active sessions")]):e._e()])]):e._e(),e._m(0),i("form",{on:{submit:function(t){return t.preventDefault(),e.createRoom(t)}}},[i("fieldset",[e.owned||e.joined?i("div",{staticClass:"input"},[e._v("Create a new session")]):i("legend",{staticClass:"legend"},[e._v("Create a session")]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.newSessionName,expression:"newSessionName"}],attrs:{type:"text",name:"room_name",placeholder:"Session Name"},domProps:{value:e.newSessionName},on:{input:function(t){t.target.composing||(e.newSessionName=t.target.value)}}}),e._m(1)]),e._m(2)])]),i("div",{attrs:{id:"account-options"}},[i("form",{on:{submit:function(e){e.preventDefault()}}},[i("router-link",{staticClass:"submit",attrs:{tag:"button",title:"Account Settings",to:"/account"}},[i("i",{staticClass:"fas fa-cog"})])],1),i("form",{on:{submit:function(e){e.preventDefault()}}},[i("router-link",{staticClass:"submit",attrs:{tag:"button",title:"Logout",to:"/auth/logout"}},[i("i",{staticClass:"fas fa-sign-out-alt"})])],1)])])},n=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("h4",[i("span",[e._v("OR")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fab fa-d-and-d"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("button",{staticClass:"submit",attrs:{type:"submit",title:"Create"}},[i("i",{staticClass:"fas fa-arrow-right"})])}];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},"8f0a":function(e,t,i){"use strict";function s(e,t){const i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)}Object.defineProperty(t,"__esModule",{value:!0}),t.getPointDistance=s;class n{constructor(e,t){this.x=e,this.y=t}static fromArray(e){return new n(e[0],e[1])}add(e){return new n(this.x+e.x,this.y+e.y)}subtract(e){return new a(this.x-e.x,this.y-e.y)}clone(){return new n(this.x,this.y)}get(e){return 0===e?this.x:this.y}asArray(){return[this.x,this.y]}}t.Point=n;class o extends n{add(e){return super.add(e)}subtract(e){return super.subtract(e)}clone(){return super.clone()}static fromArray(e){return new o(e[0],e[1])}}t.GlobalPoint=o;class r extends n{add(e){return super.add(e)}subtract(e){return super.subtract(e)}clone(){return super.clone()}}t.LocalPoint=r;class a{constructor(e,t){this.x=e,this.y=t}dot(e){return this.x*e.x+this.y*e.y}inverse(){return new a(0===this.x?0:1/this.x,0===this.y?0:1/this.y)}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}normalize(){const e=this.length();return new a(this.x/e,this.y/e)}reverse(){return new a(-this.x,-this.y)}multiply(e){return new a(this.x*e,this.y*e)}angle(){return 180*Math.atan2(this.y,this.x)/Math.PI}}t.Vector=a;class l{constructor(e,t,i){this.direction=t,this.origin=e,void 0===i&&(i=1/0),this.tMax=i}static fromPoints(e,t){const i=new a(t.x-e.x,t.y-e.y);let s;return s=Math.abs(i.x)>.01?(t.x-e.x)/i.x:(t.y-e.y)/i.y,new l(e,i,s)}get(e){return new n(this.origin.x+e*this.direction.x,this.origin.y+e*this.direction.y)}getDistance(e,t){return Math.sqrt(Math.pow(t-e,2)*(Math.pow(this.direction.x,2)+Math.pow(this.direction.y,2)))}getT(e,t){return e+Math.sqrt(Math.pow(t,2)/(Math.pow(this.direction.x,2)+Math.pow(this.direction.y,2)))}}t.Ray=l},"8f54":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ul",[e._l(e.folders,function(t){return i("li",{key:t,staticClass:"folder",on:{click:function(t){return t.stopPropagation(),e.toggle(t)}}},[e._v("\n        "+e._s(t)+"\n        "),i("asset-node",{attrs:{asset:e.asset[t]}})],1)}),e._l(e.files,function(t){return i("li",{key:t.name,staticClass:"file draggable token",attrs:{draggable:"true"},on:{mouseover:function(i){e.showImage=t.hash},mouseout:function(t){e.showImage=null},dragstart:function(i){return e.dragStart(i,"/static/assets/"+t.hash)}}},[e._v("\n        "+e._s(t.name)+"\n        "),e.showImage==t.hash?i("div",{staticClass:"preview"},[i("img",{staticClass:"asset-preview-image",attrs:{src:"/static/assets/"+t.hash}})]):e._e()])})],2)},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},9088:function(e,t,i){"use strict";i.r(t);var s=i("3411"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"919a":function(e,t,i){},"91df":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=s.__importDefault(i("6f79"));i("fe80");const a=i("2ef0"),l=s.__importDefault(i("a535")),c=s.__importDefault(i("cec2")),u=s.__importDefault(i("f5fe")),d=s.__importDefault(i("f74c")),h=s.__importDefault(i("19f9")),f=s.__importDefault(i("f551")),p=s.__importDefault(i("f086")),g=s.__importDefault(i("6100")),v=i("0bc6"),m=i("77a6"),y=i("bb17"),b=i("6f92"),_=i("f10f"),w=i("92b1"),S=i("8f0a"),x=s.__importDefault(i("e0e8"));let C=class extends n.default{constructor(){super(...arguments),this.ready={manager:!1,tools:!1}}get showUI(){return _.gameStore.showUI}get IS_DM(){return _.gameStore.IS_DM}get FAKE_PLAYER(){return _.gameStore.FAKE_PLAYER}get layers(){return _.gameStore.layers}get selectedLayer(){return _.gameStore.selectedLayer}get zoomDisplay(){return _.gameStore.zoomDisplay}set zoomDisplay(e){_.gameStore.updateZoom({newZoomDisplay:e,zoomLocation:w.l2g(new S.LocalPoint(window.innerWidth/2,window.innerHeight/2))})}mounted(){window.addEventListener("resize",this.resizeWindow),window.addEventListener("keyup",m.onKeyUp),window.addEventListener("keydown",m.onKeyDown),this.ready.manager=!0}destroyed(){window.removeEventListener("resize",this.resizeWindow),window.removeEventListener("keyup",m.onKeyUp),window.removeEventListener("keydown",m.onKeyDown),this.ready.manager=!1}zoom(e){a.throttle(y.scrollZoom)(e)}resizeWindow(){b.layerManager.setWidth(window.innerWidth),b.layerManager.setHeight(window.innerHeight),b.layerManager.invalidate()}mousedown(e){this.$refs.tools.mousedown(e)}mouseup(e){this.$refs.tools.mouseup(e)}mousemove(e){this.$refs.tools.mousemove(e)}mouseleave(e){this.$refs.tools.mouseleave(e)}contextmenu(e){this.$refs.tools.contextmenu(e)}selectLayer(e){b.layerManager.selectLayer(e)}drop(e){if(null!==e&&null!==e.dataTransfer)if(e.dataTransfer.files.length>0)this.$refs.confirm.open("Uploading files should be done through the asset manager.","Ok","").then(()=>{},()=>{});else{if(""===e.dataTransfer.getData("text/plain"))return;b.layerManager.dropAsset(e)}}};C=s.__decorate([o.default({components:{"tool-bar":g.default,"selection-info":p.default,"prompt-dialog":c.default,"confirm-dialog":l.default,"menu-bar":h.default,"initiative-dialog":u.default,"zoom-slider":r.default,"note-dialog":f.default,"label-dialog":d.default,"dm-settings":x.default},beforeRouteEnter(e,t,i){v.createConnection(e),i()},beforeRouteLeave(e,t,i){v.socket.disconnect(),i()}})],C),t.default=C},9227:function(e,t,i){},"92b1":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8f0a"),n=i("f10f");function o(e){const t=n.gameStore.zoomFactor,i=n.gameStore.panX,o=n.gameStore.panY;return new s.LocalPoint((e.x+i)*t,(e.y+o)*t)}function r(e){return o(new s.GlobalPoint(e,0)).x}function a(e){return o(new s.GlobalPoint(0,e)).y}function l(e){return e*n.gameStore.zoomFactor}function c(e){return e/n.gameStore.unitSize*n.gameStore.gridSize}function u(e){return l(c(e))}function d(e){const t=n.gameStore.zoomFactor,i=n.gameStore.panX,o=n.gameStore.panY;return e instanceof s.LocalPoint?new s.GlobalPoint(e.x/t-i,e.y/t-o):new s.Ray(d(e.origin),e.direction.multiply(1/t),e.tMax)}function h(e){return d(new s.LocalPoint(e,0)).x}function f(e){return d(new s.LocalPoint(0,e)).y}function p(e){return e/n.gameStore.zoomFactor}function g(e){return p(c(e))}t.g2l=o,t.g2lx=r,t.g2ly=a,t.g2lz=l,t.getUnitDistance=c,t.g2lr=u,t.l2g=d,t.l2gx=h,t.l2gy=f,t.l2gz=p,t.l2gr=g,window.g2lx=r,window.g2ly=a},9587:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=i("2f62"),a=s.__importDefault(i("3b36")),l=s.__importDefault(i("0ddd")),c=i("4a5b"),u=i("0bc6"),d=i("f10f"),h=i("af17");let f=class extends n.default{constructor(){super(...arguments),this.visible={settings:!1,locations:!1}}get IS_DM(){return d.gameStore.IS_DM||d.gameStore.FAKE_PLAYER}get gridColour(){return d.gameStore.gridColour}set gridColour(e){d.gameStore.setGridColour({colour:e,sync:!0})}get fowColour(){return d.gameStore.fowColour}set fowColour(e){d.gameStore.setFOWColour({colour:e,sync:!0})}get rulerColour(){return d.gameStore.rulerColour}set rulerColour(e){d.gameStore.setRulerColour({colour:e,sync:!0})}settingsClick(e){if(e.target.classList.contains("menu-accordion")){e.target.classList.toggle("menu-accordion-active");const t=e.target.nextElementSibling;null!==t&&(t.style.display=""===t.style.display?"block":"")}}changeLocation(e){u.socket.emit("Location.Change",e)}createLocation(){c.getRef("prompt").prompt("New location name:","Create new location").then(e=>{u.socket.emit("Location.New",e)},()=>{})}createNote(){const e={title:"New note",text:"",uuid:c.uuidv4()};d.gameStore.newNote({note:e,sync:!0}),this.openNote(e)}openNote(e){c.getRef("note").open(e)}openDmSettings(){h.EventBus.$emit("DmSettings.Open")}};f=s.__decorate([o.default({components:{"color-picker":a.default,"asset-node":l.default},computed:Object.assign({},r.mapState("game",["locations","assets","notes"]))})],f),t.default=f},"979e":function(e,t,i){"use strict";i.r(t);var s=i("0634"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},"98ef":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("4aee");let n;var o,r;function a(){return[t.INFINITE,t.INFINITE]}t.INFINITE=-Infinity,function(e){e[e["NEGATIVE"]=-1]="NEGATIVE",e[e["ZERO"]=0]="ZERO",e[e["POSITIVE"]=1]="POSITIVE",e[e["RIGHT_TURN"]=-1]="RIGHT_TURN",e[e["LEFT_TURN"]=1]="LEFT_TURN",e[e["SMALLER"]=-1]="SMALLER",e[e["EQUAL"]=0]="EQUAL",e[e["LARGER"]=1]="LARGER",e[e["CLOCKWISE"]=-1]="CLOCKWISE",e[e["COUNTERCLOCKWISE"]=1]="COUNTERCLOCKWISE",e[e["COLLINEAR"]=0]="COLLINEAR",e[e["COPLANAR"]=0]="COPLANAR",e[e["DEGENERATE"]=0]="DEGENERATE",e[e["ON_NEGATIVE_SIDE"]=-1]="ON_NEGATIVE_SIDE",e[e["ON_ORIENTED_BOUNDARY"]=0]="ON_ORIENTED_BOUNDARY",e[e["ON_POSITIVE_SIDE"]=1]="ON_POSITIVE_SIDE"}(o=t.Sign||(t.Sign={})),function(e){e[e["UNDEFINED"]=-1]="UNDEFINED",e[e["VERTEX_VERTEX"]=0]="VERTEX_VERTEX",e[e["VERTEX_EDGE"]=1]="VERTEX_EDGE",e[e["EDGE_VERTEX"]=2]="EDGE_VERTEX",e[e["EDGE_EDGE"]=3]="EDGE_EDGE"}(r||(r={}));class l{constructor(...e){this.vertices=[],this.neighbours=[null,null,null],this.constraints=[!1,!1,!1],this.uid=l._counter++,this.vertices=e}from(e){return this.vertices=e.vertices.slice(0,e.vertices.length),this.neighbours=e.neighbours.slice(0,e.neighbours.length),this.constraints=e.constraints.slice(0,e.constraints.length),this}get dimension(){return this.vertices.length-1}addVertex(e){void 0===e&&console.log("UNDEFINED HIERE"),this.vertices.push(e),e.triangle=this}isConstrained(e){return this.constraints[e]}reorient(){this.vertices=[this.vertices[1],this.vertices[0],this.vertices[2]].slice(0,this.vertices.length),this.neighbours=[this.neighbours[1],this.neighbours[0],this.neighbours[2]],this.constraints=[this.constraints[1],this.constraints[0],this.constraints[2]]}indexV(e){return this.vertices.indexOf(e)}indexT(e){return this.neighbours.indexOf(e)}isInfinite(e){return void 0===e?this.vertices.includes(n):this.vertices[s.ccw(e)].infinite||this.vertices[s.cw(e)].infinite}contains(e){const t=-this.vertices[1].point[1]*this.vertices[2].point[0]+this.vertices[0].point[1]*(-this.vertices[1].point[0]+this.vertices[2].point[0])+this.vertices[0].point[0]*(this.vertices[1].point[1]-this.vertices[2].point[1])+this.vertices[1].point[0]*this.vertices[2].point[1],i=t<0?-1:1,s=(this.vertices[0].point[1]*this.vertices[2].point[0]-this.vertices[0].point[0]*this.vertices[2].point[1]+(this.vertices[2].point[1]-this.vertices[0].point[1])*e[0]+(this.vertices[0].point[0]-this.vertices[2].point[0])*e[1])*i;if(s<0)return!1;const n=(this.vertices[0].point[0]*this.vertices[1].point[1]-this.vertices[0].point[1]*this.vertices[1].point[0]+(this.vertices[0].point[1]-this.vertices[1].point[1])*e[0]+(this.vertices[1].point[0]-this.vertices[0].point[0])*e[1])*i;return n>0&&s+n<t*i}}l._counter=0,t.Triangle=l;class c{constructor(e){this.infinite=!1,this._point=e}get point(){return this._point}set point(e){this._point=e,this.infinite=!1}}t.Vertex=c;class u{constructor(e,t){if(this.v=e,this.t=t,null===e?this.t=null:null===t&&(this.t=e.triangle),null==this.t||this.t.dimension<1)this.ri=0,this.v=null,this.t=null;else{const t=this.t.indexV(e);2===this.t.dimension?this.ri=s.ccw(t):this.ri=2}this._ri=this.ri,this._v=this.v,this._t=this.t}get valid(){return null!==this.t&&null!==this.v}next(){let e=this.t.indexV(this.v);return 1===this.t.dimension?this.t=this.t.neighbours[0===e?1:0]:(this.t=this.t.neighbours[s.ccw(e)],e=this.t.indexV(this.v),this.ri=s.ccw(e)),this.ri!==this._ri||this.v!==this._v||this.t!==this._t}}t.EdgeCirculator=u;class d{constructor(e){if(this.i=0,this.edge=new p,this._es=0,this.tds=e,this.edge.second=0,e.dimension<=0)this.pos=null;else{this.pos=e.triangles[0],1===e.dimension&&(this.edge.second=2);while(null!==this.pos&&!this.associatedEdge())throw new Error("[poi");1===e.dimension&&(this._es=2)}}get valid(){return(null!==this.pos||this._es!==this.edge.second)&&this.pos.isInfinite(this.edge.second)}next(){do{this.increment()}while(null!==this.pos&&!this.associatedEdge())}collect(){return this.edge.first=this.pos,this.edge}associatedEdge(){return 1===this.tds.dimension||this.tds.triangles.indexOf(this.pos)<this.tds.triangles.indexOf(this.pos.neighbours[this.edge.second])}increment(){1===this.tds.dimension?(this.i++,this.tds.triangles.length<=this.i?this.pos=null:this.pos=this.tds.triangles[this.i]):2===this.edge.second?(this.edge.second=0,this.i++,this.tds.triangles.length<=this.i?this.pos=null:this.pos=this.tds.triangles[this.i]):this.edge.second++}}t.EdgeIterator=d;class h{constructor(e,t){this.v=e,this.t=t,null===e?this.t=null:null===t&&(this.t=e.triangle),(null==this.t||this.t.dimension<2)&&(this.v=null,this.t=null),this._v=this.v,this._t=this.t}get valid(){return null!==this.t&&null!==this.v}prev(){const e=this.t.indexV(this.v);this.t=this.t.neighbours[s.cw(e)]}next(){const e=this.t.indexV(this.v);return this.t=this.t.neighbours[s.ccw(e)],this.v!==this._v||this.t!==this._t}}t.FaceCirculator=h;class f{constructor(e,t,i){this.i=0,this.pos=null,this.s=r.UNDEFINED,this._tr=t,this.p=e.point,this.q=i;const a=new h(e,null);let l=a.t.indexV(e),c=a.t.vertices[s.cw(l)];while(e===n||s.orientation(this.p,this.q,c.point)!==o.LEFT_TURN)if(a.next(),l=a.t.indexV(e),c=a.t.vertices[s.cw(l)],!a.valid)return;let u=a.t.vertices[s.ccw(l)],d=o.RIGHT_TURN;while(u!==n&&(d=s.orientation(this.p,this.q,u.point))===o.LEFT_TURN)a.prev(),l=a.t.indexV(e),u=a.t.vertices[s.ccw(l)];if(l=a.t.indexV(e),c=a.t.vertices[s.cw(l)],u===n)switch(a.prev(),l=a.t.indexV(e),u=a.t.vertices[s.ccw(l)],d=s.orientation(this.p,this.q,u.point),d){case o.RIGHT_TURN:case o.COLLINEAR:a.next(),l=a.t.indexV(n),this.pos=a.t,this.s=r.VERTEX_VERTEX,this.i=l;break;case o.LEFT_TURN:break}else d===o.COLLINEAR?(this.pos=a.t,this.s=r.VERTEX_VERTEX,this.i=s.ccw(l)):(this.pos=a.t,this.s=r.VERTEX_EDGE,this.i=l)}next(){this.increment()}increment(){let e;if(this.s===r.VERTEX_VERTEX||this.s===r.EDGE_VERTEX){do{const t=this.pos.neighbours[s.cw(this.i)];if(this.i=t.indexT(this.pos),this.pos=t,this.pos.vertices[this.i]===n){e=o.COLLINEAR,this.i=s.cw(this.i);break}e=s.orientation(this.p,this.q,this.pos.vertices[this.i].point),this.i=s.cw(this.i)}while(e===o.LEFT_TURN);e===o.COLLINEAR?(this.s=r.VERTEX_VERTEX,this.i=s.ccw(this.i)):this.s=r.VERTEX_EDGE}else{const t=this.pos.neighbours[this.i],i=t.indexT(this.pos);switch(this.pos=t,e=this.pos.vertices[i]===n?o.COLLINEAR:s.orientation(this.p,this.q,this.pos.vertices[i].point),e){case o.LEFT_TURN:this.s=r.EDGE_EDGE,this.i=s.ccw(i);break;case o.RIGHT_TURN:this.s=r.EDGE_EDGE,this.i=s.cw(i);break;default:this.s=r.EDGE_VERTEX,this.i=i}}}}t.LineFaceCirculator=f;class p{constructor(){this.first=null,this.second=0}}(function(e){e[e["VERTEX"]=0]="VERTEX",e[e["EDGE"]=1]="EDGE",e[e["FACE"]=2]="FACE",e[e["OUTSIDE_CONVEX_HULL"]=3]="OUTSIDE_CONVEX_HULL",e[e["OUTSIDE_AFFINE_HULL"]=4]="OUTSIDE_AFFINE_HULL"})(t.LocateType||(t.LocateType={}));class g{constructor(){this.dimension=-1,this.vertices=[],this.triangles=[],this._infinite=this.createVertex(),n=this._infinite;const e=new l;e.addVertex(this._infinite),this.triangles.push(e)}createVertex(){const e=this.infiniteVertex;return void 0===e&&console.log("UNDEFINED HIERE"),this.vertices.push(e),e}createTriangle(e,t,i,s,n,o){const r=new l(e,t,i);return r.neighbours[0]=s,r.neighbours[1]=n,r.neighbours[2]=o,this.triangles.push(r),r}deleteTriangle(e){this.triangles=this.triangles.filter(t=>t!==e)}setAdjacency(e,t,i,s){e.neighbours[t]=i,i.neighbours[s]=e}get finiteVertex(){return this.vertices[1]}get infiniteVertex(){const e=new c(a());return e.infinite=!0,e}get finiteEdge(){if(this.dimension<1)throw new Error("aspo");const e=new d(this);while(e.valid)e.next();return e.collect()}insertDimUp(e=new c,t=!0){const i=this.createVertex();let s,n;switch(this.dimension++,this.dimension){case 0:s=this.triangles[0],n=new l(i),this.triangles.push(n),this.setAdjacency(s,0,n,0),i.triangle=n;break;case 1:case 2:{const o=[],r=this.triangles.slice(0,this.triangles.length);for(const t of r){const s=(new l).from(t);this.triangles.push(s),t.vertices[this.dimension]=i,s.vertices[this.dimension]=e,this.setAdjacency(t,this.dimension,s,this.dimension),t.vertices.includes(e)&&o.push(s)}for(const e of r){const t=e.neighbours[this.dimension];for(let i=0;i<this.dimension;++i)t.neighbours[i]=e.neighbours[i].neighbours[this.dimension]}let a=0;if(1===this.dimension)t?(r[a].reorient(),a++,r[a].neighbours[1].reorient()):(r[a].neighbours[1].reorient(),a++,r[a].reorient());else for(const e of r)t?e.neighbours[2].reorient():e.reorient();for(const t of o){let i=1;t.vertices[0]===e&&(i=0),s=t.neighbours[this.dimension];const o=this.mirrorIndex(t,this.dimension);n=t.neighbours[i];const r=this.mirrorIndex(t,i);this.setAdjacency(s,o,n,r),this.deleteTriangle(t)}i.triangle=r[0];break}default:throw new Error("Dimension unknown")}return i}mirrorIndex(e,t){if(1===e.dimension){const i=e.neighbours[t].indexV(e.vertices[0===t?1:0]);return 0===i?1:0}return s.ccw(e.neighbours[t].indexV(e.vertices[s.ccw(t)]))}insertInFace(e){const t=this.createVertex(),i=e.vertices[0],s=e.vertices[1],n=e.vertices[2],o=e.neighbours[1],r=e.neighbours[2],a=this.createTriangle(i,t,n,e,o,null),l=this.createTriangle(i,s,t,e,null,r);if(this.setAdjacency(a,2,l,1),null!==o){const t=this.mirrorIndex(e,1);o.neighbours[t]=a}if(null!==r){const t=this.mirrorIndex(e,2);r.neighbours[t]=l}return e.vertices[0]=t,e.neighbours[1]=a,e.neighbours[2]=l,i.triangle===e&&(i.triangle=l),t.triangle=e,t}flip(e,t){const i=e.neighbours[t],n=this.mirrorIndex(e,t),o=e.vertices[s.cw(t)],r=e.vertices[s.ccw(t)],a=e.neighbours[s.ccw(t)],l=this.mirrorIndex(e,s.ccw(t)),c=i.neighbours[s.ccw(n)],u=this.mirrorIndex(i,s.ccw(n));e.vertices[s.cw(t)]=i.vertices[n],i.vertices[s.cw(n)]=e.vertices[t],this.setAdjacency(e,t,c,u),this.setAdjacency(e,s.ccw(t),i,s.ccw(n)),this.setAdjacency(i,n,a,l),o.triangle===e&&(o.triangle=i),r.triangle===i&&(r.triangle=e)}insertInEdge(e,t){let i;if(1===this.dimension){i=this.createVertex();const t=e.neighbours[0],s=e.vertices[1],n=this.createTriangle(i,s,null,t,e,null);e.vertices[1]=i,e.neighbours[0]=n,t.neighbours[1]=n,i.triangle=n,s.triangle=t}else{const s=e.neighbours[t],n=this.mirrorIndex(e,t);i=this.insertInFace(e),this.flip(s,n)}return i}}t.TDS=g;class v{constructor(e){this.x1=e[0],this.y1=e[1],this.x2=e[0],this.y2=e[1]}dilate(e){this.x1-=e*s.ulp(this.x1),this.y1-=e*s.ulp(this.y1),this.x2+=e*s.ulp(this.x2),this.y2+=e*s.ulp(this.y2)}overlaps(e){return!(this.x2<e.x1||e.x2<this.x1)&&!(this.y2<e.y1||e.y2<this.y1)}}t.BoundingBox=v},"99e3":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("4a5b"),n=i("6f92"),o=i("8db6"),r=i("92b1"),a=i("76b3");class l{constructor(e){if(this.totalNodes=0,this.buildData=[],this.orderedPrims=[],this.nodes=[],this.offset=0,this.shapes=e,0===this.shapes.length)return this.root=null,void(this.nodes=[]);for(let t=0;t<e.length;t++){const i=n.layerManager.UUIDMap.get(e[t]);this.buildData.push({index:t,bbox:i.getBoundingBox(),center:new o.BoundingRect(i.center(),0,0)})}this.root=this.recursiveBuild(0,e.length),this.compact()}draw(){const e=n.layerManager.getLayer("draw").ctx;for(const t of this.nodes){const i=t.bbox;e.strokeRect(r.g2lx(i.topLeft.x),r.g2ly(i.topLeft.y),r.g2lz(i.w),r.g2lz(i.h))}}recursiveBuild(e,t){this.totalNodes++;let i=this.buildData[e].bbox;for(let s=e+1;s<t;s++)i=i.union(this.buildData[s].bbox);const n=t-e;if(1===n)return this.createLeaf(e,t,n,i);{let o=this.buildData[e].center;for(let i=e;i<t;i++)o=o.union(this.buildData[i].center);const r=o.getMaxExtent();if(o.botRight.get(r)===o.topLeft.get(r))return this.createLeaf(e,t,n,i);const l=.5*(o.topLeft.get(r)+o.botRight.get(r)),c=s.partition(this.buildData.slice(e,t),e=>e.center.center().get(r)<l),u=[].concat.apply([],c);0!==c[0].length&&0!==c[1].length||console.log("EMPTY"),this.buildData.splice(e,u.length,...u);const d=c[0].length+e;return new a.InteriorNode(r,this.recursiveBuild(e,d),this.recursiveBuild(d,t))}}intersect(e,t){if(0===this.nodes.length)return{hit:!1,intersect:e.get(0),tMin:0,tMax:e.tMax};void 0===t&&(t=!1);let i=!1,s=0,n=e.tMax,o=0,r=0;const a=[],l=e.direction.inverse(),c=[l.x<0,l.y<0];while(1){const u=this.nodes[r],d=u.bbox.intersectP(e,l,c);if(d.hit)if(u.nPrimitives>0){if(i=!0,s=e.tMax=d.min,n=d.max,0===o||t)break;r=a[--o]}else c[u.dimension]?(a[o++]=r+1,r=u.secondChildOffset):(a[o++]=u.secondChildOffset,r++);else{if(0===o)break;r=a[--o]}}return{hit:i,intersect:e.get(s),tMin:s,tMax:n}}compact(){this.offset=0,null!==this.root&&this.flatten(this.root)}flatten(e){const t=this.offset,i=this.offset++;if(0===e.nPrimitives){this.flatten(e.children[0]);const i=this.flatten(e.children[1]);this.nodes[t]={bbox:e.bbox,dimension:e.dimension,nPrimitives:0,secondChildOffset:i}}else this.nodes[t]={bbox:e.bbox,primitivesOffset:e.firstPrimOffset,nPrimitives:e.nPrimitives};return i}createLeaf(e,t,i,s){const n=this.orderedPrims.length;for(let o=e;o<t;o++)this.orderedPrims.push(this.shapes[this.buildData[o].index]);return new a.LeafNode(n,i,s)}}t.BoundingVolume=l},"99ea":function(e,t,i){"use strict";var s=i("a37b"),n=i.n(s);n.a},"9cb7":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("4a5b"),n=i("2b48"),o=i("6f92"),r=i("206a"),a=i("f10f"),l=i("1625"),c=i("92b1");class u{constructor(){this.selectedTool=0,this.annotationManager=new l.AnnotationManager}addShape(e){if(!o.layerManager.hasLayer(e.layer))return void console.log(`Shape with unknown layer ${e.layer} could not be added`);const t=o.layerManager.getLayer(e.layer),i=r.createShapeFromDict(e);void 0!==i?(t.addShape(i,!1),t.invalidate(!1)):console.log(`Shape with unknown type ${e.type_} could not be added`)}updateShape(e){if(!o.layerManager.hasLayer(e.shape.layer))return void console.log(`Shape with unknown layer ${e.shape.layer} could not be added`);const t=r.createShapeFromDict(e.shape);if(void 0===t)return void console.log(`Shape with unknown type ${e.shape.type_} could not be added`);const i=o.layerManager.UUIDMap.get(e.shape.uuid);if(void 0===i)return void console.log("Shape with unknown id could not be updated");const n=t.owners!==i.owners,l=Object.assign(i,t);l.checkVisionSources(),l.setMovementBlock(l.movementObstruction),l.setIsToken(l.isToken),e.redraw&&(l.visionObstruction&&a.gameStore.recalculateVision(e.temporary),o.layerManager.getLayer(e.shape.layer).invalidate(!1),l.movementObstruction&&a.gameStore.recalculateMovement(e.temporary)),n&&s.getRef("initiative").$forceUpdate()}setCenterPosition(e){const t=c.g2l(e);a.gameStore.increasePanX((window.innerWidth/2-t.x)/a.gameStore.zoomFactor),a.gameStore.increasePanY((window.innerHeight/2-t.y)/a.gameStore.zoomFactor),o.layerManager.invalidate(),n.sendClientOptions()}}t.GameManager=u,t.gameManager=new u,window.gameManager=t.gameManager},"9dd4":function(e,t,i){"use strict";var s=i("fcac"),n=i.n(s);n.a},"9e35":function(e,t,i){"use strict";var s=i("5ed5"),n=i.n(s);n.a},"9f58":function(e,t,i){"use strict";i.r(t);var s=i("5459"),n=i("2afa");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("4f27");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"46baf892",null);t["default"]=a.exports},a014:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Initiative")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("draggable",{attrs:{id:"initiative-list",options:{setData:e.fakeSetData,disabled:!e.$store.state.game.IS_DM}},on:{change:e.updateOrder},model:{value:e.data,callback:function(t){e.data=t},expression:"data"}},[e._l(e.data,function(t){return[i("div",{key:t.uuid,staticStyle:{display:"flex","flex-direction":"column","align-items":"flex-end"}},[i("div",{staticClass:"initiative-actor",class:{"initiative-selected":e.currentActor===t.uuid},style:{cursor:e.$store.state.game.IS_DM&&"move"},on:{mouseenter:function(i){return e.toggleHighlight(t,!0)},mouseleave:function(i){return e.toggleHighlight(t,!1)}}},[t.has_img?[i("img",{attrs:{src:t.source,width:"30px",height:"30px"}})]:[i("span",{staticStyle:{width:"auto"}},[e._v(e._s(t.source))])],i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:t.initiative,expression:"actor.initiative",modifiers:{lazy:!0,number:!0}}],class:{notAllowed:!e.owns(t)},attrs:{type:"text",placeholder:"value",disabled:!e.owns(t)},domProps:{value:t.initiative},on:{change:[function(i){e.$set(t,"initiative",e._n(i.target.value))},function(i){return e.syncInitiative(t)}],blur:function(t){return e.$forceUpdate()}}}),i("div",{staticClass:"initiative-effects-icon",class:{notAllowed:!e.owns(t)},staticStyle:{opacity:"0.6"},on:{click:function(i){e.createEffect(t,e.getDefaultEffect(),!0)}}},[i("i",{staticClass:"fas fa-stopwatch"}),t.effects?[e._v(e._s(t.effects.length))]:[e._v("0")]],2),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:t.visible?"1.0":"0.3"},on:{click:function(i){return e.toggleOption(t,"visible")}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:t.group?"1.0":"0.3"},on:{click:function(i){return e.toggleOption(t,"group")}}},[i("i",{staticClass:"fas fa-users"})]),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:e.owns(t)?"1.0":"0.3"},on:{click:function(i){return e.removeInitiative(t.uuid,!0,!0)}}},[i("i",{staticClass:"fas fa-trash-alt"})])],2),t.effects?i("div",{staticClass:"initiative-effect"},e._l(t.effects,function(s){return i("div",{key:s.uuid},[i("input",{directives:[{name:"model",rawName:"v-model",value:s.name,expression:"effect.name"}],attrs:{type:"text",size:s.name.length||1},domProps:{value:s.name},on:{change:function(i){return e.updateEffect(t.uuid,s,!0)},input:function(t){t.target.composing||e.$set(s,"name",t.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model",value:s.turns,expression:"effect.turns"}],attrs:{type:"text",size:s.turns.toString().length||1},domProps:{value:s.turns},on:{change:function(i){return e.updateEffect(t.uuid,s,!0)},input:function(t){t.target.composing||e.$set(s,"turns",t.target.value)}}})])}),0):e._e()])]})],2),i("div",{attrs:{id:"initiative-bar"}},[i("div",{attrs:{id:"initiative-round"}},[e._v("Round "+e._s(e.roundCounter))]),i("div",{staticStyle:{display:"flex"}}),i("div",{staticClass:"initiative-bar-button",style:e.visionLock?"background-color: #82c8a0":"",on:{click:e.toggleVisionLock}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{staticClass:"initiative-bar-button",style:e.cameraLock?"background-color: #82c8a0":"",on:{click:function(t){e.cameraLock=!e.cameraLock}}},[i("i",{staticClass:"fas fa-video"})]),i("div",{staticClass:"initiative-bar-button",class:{notAllowed:!e.$store.state.game.IS_DM},on:{click:function(t){e.setRound(0,!0),e.updateTurn(e.data[0].uuid,!0)}}},[i("i",{staticClass:"fas fa-sync-alt"})]),i("div",{staticClass:"initiative-bar-button",class:{notAllowed:!e.$store.state.game.IS_DM},on:{click:e.nextTurn}},[i("i",{staticClass:"fas fa-chevron-right"})])])],1)])},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},a097:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9"));let r=class extends n.default{constructor(){super(...arguments),this.message="Loading..."}};r=s.__decorate([o.default],r),t.default=r},a112:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return null!==e.shape?i("div",[i("div",{attrs:{id:"selection-menu"}},[i("div",{attrs:{id:"selection-edit-button"},on:{click:e.openEditDialog}},[i("i",{staticClass:"fas fa-edit"})]),i("div",{attrs:{id:"selection-name"}},[e._v(e._s(e.shape.name))]),i("div",{attrs:{id:"selection-trackers"}},[e._l(e.shape.trackers,function(t){return""!==t.name||0!==t.value?[i("div",{key:"name-"+t.uuid},[e._v(e._s(t.name))]),i("div",{key:"value-"+t.uuid,staticClass:"selection-tracker-value",on:{click:function(i){return e.changeValue(t,!1)}}},[0===t.maxvalue?[e._v(e._s(t.value))]:[e._v(e._s(t.value)+" / "+e._s(t.maxvalue))]],2)]:e._e()})],2),i("div",{attrs:{id:"selection-auras"}},[e._l(e.shape.auras,function(t){return""!==t.name||0!==t.value?[i("div",{key:"name-"+t.uuid},[e._v(e._s(t.name))]),i("div",{key:"value-"+t.uuid,staticClass:"selection-tracker-value",on:{click:function(i){return e.changeValue(t,!0)}}},[0===t.dim?[e._v(e._s(t.value))]:[e._v(e._s(t.value)+" / "+e._s(t.dim))]],2)]:e._e()})],2)]),i("edit-dialog",{ref:"editDialog",attrs:{shape:e.shape}})],1):e._e()},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},a126:function(e,t,i){},a260:function(e,t,i){},a37b:function(e,t,i){},a450:function(e,t,i){},a474:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("bc3a")),o=s.__importDefault(i("a026")),r=s.__importDefault(i("65d9")),a=i("cc67");r.default.registerHooks(["beforeRouteEnter"]);let l=class extends o.default{constructor(){super(...arguments),this.owned=[],this.joined=[],this.error="",this.newSessionName=""}beforeRouteEnter(e,t,i){n.default.get("/api/rooms").then(e=>{i(t=>{t.owned=e.data.owned,t.joined=e.data.joined})}).catch(e=>{i(t=>{t.error=e.message})})}createRoom(e){n.default.post("/api/rooms",{name:this.newSessionName}).then(e=>{this.$router.push(`/game/${a.coreStore.username}/${this.newSessionName}`)}).catch(e=>{this.error=e.message})}};l=s.__decorate([r.default],l),t.default=l},a535:function(e,t,i){"use strict";i.r(t);var s=i("e06e"),n=i("f30c");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("223d");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"1883e207",null);t["default"]=a.exports},a68b:function(e,t,i){"use strict";i.r(t);var s=i("308b"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},a7b3:function(e,t,i){"use strict";var s=i("6542"),n=i.n(s);n.a},a83f:function(e,t,i){"use strict";var s=i("0525"),n=i.n(s);n.a},a912:function(e,t,i){},aa69:function(e,t,i){"use strict";i.r(t);var s=i("0cf7"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},af17:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026"));t.EventBus=new n.default},b0ac:function(e,t,i){"use strict";i.r(t);var s=i("a474"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},b0c0:function(e,t,i){},b2ed:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("c266"),n=i("f10f"),o=i("92b1"),r=i("5a5c");class a extends s.BaseRect{constructor(e,t,i,s,n,o){super(e,t,i,s,n,o),this.type="rect"}asDict(){return super.getBaseDict()}draw(e){super.draw(e),"fog"===this.fillColour?e.fillStyle=r.getFogColour():e.fillStyle=this.fillColour;const t=n.gameStore.zoomFactor,i=o.g2l(this.refPoint);e.fillRect(i.x,i.y,this.w*t,this.h*t),"rgba(0, 0, 0, 0)"!==this.strokeColour&&(e.strokeStyle=this.strokeColour,e.lineWidth=5,e.strokeRect(i.x,i.y,this.w*t,this.h*t))}}t.Rect=a},b599:function(e,t,i){},b6bc:function(e,t,i){"use strict";i.r(t);var s=i("5394"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},b809:function(e,t,i){"use strict";i.r(t);var s=i("ca56"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},b906:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8f0a"),n=i("bab4"),o=i("6f92"),r=i("d1ec"),a=i("f10f"),l=i("92b1"),c=i("cee3");class u extends n.Layer{constructor(){super(...arguments),this.isVisionLayer=!0}draw(){if(!this.valid){const t=this.ctx;if(!a.gameStore.fowLOS||r.Settings.skipPlayerFOW)return t.clearRect(0,0,this.canvas.width,this.canvas.height),void(this.valid=!0);t.clearRect(0,0,this.canvas.width,this.canvas.height);const i=t.globalCompositeOperation;t.fillStyle="rgba(0, 0, 0, 1)",a.gameStore.IS_DM||super.draw(!a.gameStore.fullFOW);const n=t.canvas.width+t.canvas.height;for(const u of a.gameStore.activeTokens){const i=o.layerManager.UUIDMap.get(u);if(void 0===i)continue;const d=i.center(),h=l.g2l(d);if("bvh"===a.gameStore.visionMode){t.beginPath();let e=-1;for(let i=0;i<2*Math.PI;i+=r.Settings.angleSteps/2/180*Math.PI){const o=Math.cos(i),r=Math.sin(i),c=new s.Ray(d,new s.Vector(o,r)),u=a.gameStore.BV.intersect(c);u.hit?(-1!==e&&(t.arc(h.x,h.y,n,e,i),e=-1),t.lineTo(l.g2lx(u.intersect.x),l.g2ly(u.intersect.y))):-1===e&&(t.lineTo(h.x+n*o,h.y+n*r),e=i)}-1!==e?t.arc(h.x,h.y,n,e,2*Math.PI):t.closePath(),t.fill()}else{{const e=t.createRadialGradient(h.x,h.y,l.g2lr(a.gameStore.visionRangeMin),h.x,h.y,l.g2lr(a.gameStore.visionRangeMax));e.addColorStop(0,"rgba(0, 0, 0, 1)"),e.addColorStop(1,"rgba(0, 0, 0, 0)"),t.fillStyle=e}try{const s=c.computeVisibility(i.center(),"vision");t.beginPath(),t.moveTo(l.g2lx(s[0][0]),l.g2ly(s[0][1]));for(const e of s)t.lineTo(l.g2lx(e[0]),l.g2ly(e[1]));t.closePath(),t.fill()}catch(e){}}}a.gameStore.IS_DM&&super.draw(!a.gameStore.fullFOW),t.globalCompositeOperation=i}}}t.FOWPlayersLayer=u},bab4:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("0bc6"),n=i("af17"),o=i("6f92"),r=i("206a"),a=i("f10f"),l=i("92b1");class c{constructor(e,t){this.selectable=!1,this.playerEditable=!1,this.isVisionLayer=!1,this.valid=!1,this.shapes=[],this.selection=[],this.selectionColor="#CC0000",this.selectionWidth=2,this.canvas=e,this.name=t,this.width=e.width,this.height=e.height,this.ctx=e.getContext("2d")}invalidate(e){this.valid=!1,e||o.layerManager.invalidateLight()}addShape(e,t,i,n=!0){void 0===i&&(i=!1),e.layer=this.name,this.shapes.push(e),o.layerManager.UUIDMap.set(e.uuid,e),e.checkVisionSources(n),e.setMovementBlock(e.movementObstruction,n),e.ownedBy(a.gameStore.username)&&e.isToken&&a.gameStore.ownedtokens.push(e.uuid),e.annotation.length&&a.gameStore.annotations.push(e.uuid),t&&s.socket.emit("Shape.Add",{shape:e.asDict(),temporary:i}),n&&this.invalidate(!t)}setShapes(e){for(const t of e){const e=r.createShapeFromDict(t);if(void 0===e)return void console.log(`Shape with unknown type ${t.type_} could not be added`);this.addShape(e,!1,!1,!1)}this.clearSelection(),this.invalidate(!1)}removeShape(e,t,i){void 0===i&&(i=!1),this.shapes.splice(this.shapes.indexOf(e),1),t&&s.socket.emit("Shape.Remove",{shape:e.asDict(),temporary:i});const n=a.gameStore.visionSources.findIndex(t=>t.shape===e.uuid),r=a.gameStore.visionBlockers.findIndex(t=>t===e.uuid),l=a.gameStore.movementblockers.findIndex(t=>t===e.uuid),c=a.gameStore.annotations.findIndex(t=>t===e.uuid);n>=0&&a.gameStore.visionSources.splice(n,1),r>=0&&a.gameStore.visionBlockers.splice(r,1),l>=0&&a.gameStore.movementblockers.splice(l,1),c>=0&&a.gameStore.annotations.splice(c,1);const u=a.gameStore.annotations.indexOf(e.uuid);u>=0&&a.gameStore.annotations.splice(u,1);const d=a.gameStore.ownedtokens.indexOf(e.uuid);d>=0&&a.gameStore.ownedtokens.splice(d,1),o.layerManager.UUIDMap.delete(e.uuid);const h=this.selection.indexOf(e);h>=0&&this.selection.splice(h,1),r>=0&&a.gameStore.recalculateVision(),l>=0&&a.gameStore.recalculateMovement(),this.invalidate(!t)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}clearSelection(){this.selection=[],n.EventBus.$emit("SelectionInfo.Shape.Set",null)}draw(e){if(!this.valid){const t=this.ctx,i=t.globalCompositeOperation;e=void 0===e||e,e&&this.clear();const s=this;if(this.shapes.forEach(e=>{e.options.has("skipDraw")&&e.options.get("skipDraw")||void 0!==o.layerManager.getLayer()&&e.visibleInCanvas(s.canvas)&&("fow"===s.name&&e.visionObstruction&&o.layerManager.getLayer().name!==s.name||e.drawAuras(t))}),this.shapes.forEach(e=>{e.options.has("skipDraw")&&e.options.get("skipDraw")||0===e.labels.length&&a.gameStore.filterNoLabel||e.labels.length&&a.gameStore.labelFilters.length&&!e.labels.some(e=>a.gameStore.labelFilters.includes(e.uuid))||void 0!==o.layerManager.getLayer()&&e.visibleInCanvas(s.canvas)&&("fow"===s.name&&e.visionObstruction&&o.layerManager.getLayer().name!==s.name||e.draw(t))}),null!=this.selection){t.fillStyle=this.selectionColor,t.strokeStyle=this.selectionColor,t.lineWidth=this.selectionWidth;const e=a.gameStore.zoomFactor;this.selection.forEach(i=>{t.globalCompositeOperation=i.globalCompositeOperation;const s=i.getBoundingBox();t.strokeRect(l.g2lx(s.topLeft.x),l.g2ly(s.topLeft.y),s.w*e,s.h*e);for(const e of i.points)t.beginPath(),t.arc(l.g2lx(e[0]),l.g2ly(e[1]),3,0,2*Math.PI),t.fill();t.beginPath(),t.moveTo(l.g2lx(i.points[0][0]),l.g2ly(i.points[0][1]));for(let e=1;e<=i.points.length;e++){const s=i.points[e%i.points.length];t.lineTo(l.g2lx(s[0]),l.g2ly(s[1]))}t.stroke()})}t.globalCompositeOperation=i,this.valid=!0}}moveShapeOrder(e,t,i){const n=this.shapes.indexOf(e);n!==t&&(this.shapes.splice(n,1),this.shapes.splice(t,0,e),i&&s.socket.emit("Shape.Order.Set",{shape:e.asDict(),index:t}),this.invalidate(!0))}}t.Layer=c},bb17:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("f10f"),n=i("92b1"),o=i("5a5c");function r(e){if(!e.target||!e.target.tagName||"CANVAS"!==e.target.tagName)return;let t;t=-1*Math.sign(e.deltaY),s.gameStore.updateZoom({newZoomDisplay:s.gameStore.zoomDisplay-.1*t,zoomLocation:n.l2g(o.getMouse(e))})}t.scrollZoom=r},bea6:function(e,t,i){"use strict";i.r(t);var s=i("e8bb"),n=i("b6bc");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("e3f5"),i("99ea");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"dca395d6",null);t["default"]=a.exports},c106:function(e,t,i){},c159:function(e,t,i){},c266:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8f0a"),n=i("8db6"),o=i("2469"),r=i("f10f"),a=i("2838"),l=i("92b1");class c extends o.Shape{constructor(e,t,i,s,n,o){super(e,s,n,o),this.w=t,this.h=i}getBaseDict(){return Object.assign(super.getBaseDict(),{width:this.w,height:this.h})}getBoundingBox(){return new n.BoundingRect(this.refPoint,this.w,this.h)}get points(){if(0===this.w||0===this.h)return[[this.refPoint.x,this.refPoint.y]];const e=this.refPoint.add(new s.Vector(0,this.h)),t=this.refPoint.add(new s.Vector(this.w,this.h)),i=this.refPoint.add(new s.Vector(this.w,0));return[[this.refPoint.x,this.refPoint.y],[e.x,e.y],[t.x,t.y],[i.x,i.y]]}contains(e){return this.refPoint.x<=e.x&&this.refPoint.x+this.w>=e.x&&this.refPoint.y<=e.y&&this.refPoint.y+this.h>=e.y}center(e){if(void 0===e)return this.refPoint.add(new s.Vector(this.w/2,this.h/2));this.refPoint=new s.GlobalPoint(e.x-this.w/2,e.y-this.h/2)}visibleInCanvas(e){if(super.visibleInCanvas(e))return!0;const t=!(l.g2lx(this.refPoint.x)>e.width||l.g2ly(this.refPoint.y)>e.height||l.g2lx(this.refPoint.x+this.w)<0||l.g2ly(this.refPoint.y+this.h)<0);return!!t}snapToGrid(){const e=r.gameStore.gridSize,t=this.center(),i=t.x,n=t.y;let o,l;o=this.w/e%2===0?Math.round(i/e)*e-this.w/2:(Math.round((i+e/2)/e)-.5)*e-this.w/2,l=this.h/e%2===0?Math.round(n/e)*e-this.h/2:(Math.round((n+e/2)/e)-.5)*e-this.h/2;const c=a.calculateDelta(new s.Vector(o-this.refPoint.x,l-this.refPoint.y),this);this.refPoint=this.refPoint.add(c),this.invalidate(!1)}resizeToGrid(){const e=r.gameStore.gridSize;this.refPoint=new s.GlobalPoint(Math.round(this.refPoint.x/e)*e,Math.round(this.refPoint.y/e)*e),this.w=Math.max(Math.round(this.w/e)*e,e),this.h=Math.max(Math.round(this.h/e)*e,e),this.invalidate(!1)}resize(e,t){const i=r.gameStore.zoomFactor;switch(e){case 0:this.w=l.g2lx(this.refPoint.x)+this.w*i-t.x,this.h=l.g2ly(this.refPoint.y)+this.h*i-t.y,this.refPoint=l.l2g(t);break;case 1:this.w=l.g2lx(this.refPoint.x)+this.w*i-t.x,this.h=t.y-l.g2ly(this.refPoint.y),this.refPoint=new s.GlobalPoint(l.l2gx(t.x),this.refPoint.y);break;case 2:this.w=t.x-l.g2lx(this.refPoint.x),this.h=t.y-l.g2ly(this.refPoint.y);break;case 3:this.w=t.x-l.g2lx(this.refPoint.x),this.h=l.g2ly(this.refPoint.y)+this.h*i-t.y,this.refPoint=new s.GlobalPoint(this.refPoint.x,l.l2gy(t.y));break}this.w/=i,this.h/=i,this.w<0&&(this.refPoint=this.refPoint.add(new s.Vector(this.w,0)),this.w=Math.abs(this.w)),this.h<0&&(this.refPoint=this.refPoint.add(new s.Vector(0,this.h)),this.h=Math.abs(this.h))}}t.BaseRect=c},c277:function(e,t,i){"use strict";i.r(t);var s=i("22bd"),n=i("e27a");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,null,null);t["default"]=a.exports},c31c:function(e,t,i){},c5ff:function(e,t,i){},c6b4:function(e,t,i){"use strict";i.r(t);var s=i("8e60"),n=i("b0ac");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("d767");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"61eb1455",null);t["default"]=a.exports},c969:function(e,t,i){"use strict";var s=i("3a20"),n=i.n(s);n.a},c9a2:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"AssetManager"}},[i("div",{attrs:{id:"titlebar"}},[e._v("Asset Manager")]),i("div",{attrs:{id:"main"}},[i("div",{attrs:{id:"assets"},on:{dragover:function(t){return t.preventDefault(),e.moveDrag(t)},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.stopDrag(t,e.currentFolder)}}},[i("div",{attrs:{id:"breadcrumbs"}},[i("div",[e._v("/")]),e._l(e.path,function(t){return i("div",{key:t},[e._v(e._s(e.idMap.get(t).name))])})],2),i("div",{attrs:{id:"actionbar"}},[i("input",{attrs:{id:"files",type:"file",multiple:"",hidden:""},on:{change:function(t){return e.upload()}}}),i("div",{attrs:{title:"Create folder"},on:{click:e.createDirectory}},[i("i",{staticClass:"fas fa-plus-square"})]),i("div",{attrs:{title:"Upload files"},on:{click:e.prepareUpload}},[i("i",{staticClass:"fas fa-upload"})])]),i("div",{attrs:{id:"explorer"}},[e.path.length?i("div",{staticClass:"inode folder",on:{dblclick:function(t){return e.changeDirectory(-1)},dragover:function(t){return t.preventDefault(),e.moveDrag(t)},dragleave:function(t){return t.preventDefault(),e.leaveDrag(t)},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.stopDrag(t,e.parentFolder)}}},[i("i",{staticClass:"fas fa-folder",staticStyle:{"font-size":"50px"}}),i("div",{staticClass:"title"},[e._v("..")])]):e._e(),e._l(e.folders,function(t){return i("div",{key:t,staticClass:"inode folder",class:{"inode-selected":e.selected.includes(t)},attrs:{draggable:"true"},on:{click:function(i){return e.select(i,t)},dblclick:function(i){return e.changeDirectory(t)},contextmenu:function(i){return i.preventDefault(),e.$refs.cm.open(i,t)},dragstart:function(i){return e.startDrag(i,t)},dragover:function(t){return t.preventDefault(),e.moveDrag(t)},dragleave:function(t){return t.preventDefault(),e.leaveDrag(t)},drop:function(i){return i.preventDefault(),i.stopPropagation(),e.stopDrag(i,t)}}},[i("i",{staticClass:"fas fa-folder",staticStyle:{"font-size":"50px"}}),i("div",{staticClass:"title"},[e._v(e._s(e.idMap.get(t).name))])])}),e._l(e.files,function(t){return i("div",{key:t,staticClass:"inode file",class:{"inode-selected":e.selected.includes(t)},attrs:{draggable:"true"},on:{click:function(i){return e.select(i,t)},contextmenu:function(i){return i.preventDefault(),e.$refs.cm.open(i,t)},dragstart:function(i){return e.startDrag(i,t)}}},[i("img",{attrs:{src:"/static/assets/"+e.idMap.get(t).file_hash,width:"50"}}),i("div",{staticClass:"title"},[e._v(e._s(e.idMap.get(t).name))])])})],2)]),e.firstSelectedFile?i("div",{attrs:{id:"asset-details"}},[i("div",{attrs:{id:"asset-detail-title"}},[e._v(e._s(e.firstSelectedFile.name))]),i("img",{attrs:{src:"/static/assets/"+e.firstSelectedFile.file_hash}})]):e._e()]),i("AssetContextMenu",{ref:"cm"}),i("Prompt",{ref:"prompt"}),i("ConfirmDialog",{ref:"confirm"})],1)},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},ca56:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=s.__importDefault(i("1c76")),a=i("0bc6"),l=i("af17"),c=i("f10f"),u=i("92b1");let d=class extends n.default{constructor(){super(...arguments),this.visible=!1,this.x=0,this.y=0}get IS_DM(){return c.gameStore.IS_DM}open(e){this.visible=!0,this.x=e.pageX,this.y=e.pageY,this.$nextTick(()=>this.$children[0].$el.focus())}close(){this.visible=!1}bringPlayers(){c.gameStore.IS_DM&&(a.socket.emit("Players.Bring",{x:u.l2gx(this.x),y:u.l2gy(this.y)}),this.close())}createToken(){this.$parent.$parent.$refs.createtokendialog.open(this.x,this.y),this.close()}showInitiative(){l.EventBus.$emit("Initiative.Show"),this.close()}};d=s.__decorate([o.default({components:{ContextMenu:r.default}})],d),t.default=d},cad7:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("bc3a")),o=s.__importDefault(i("a026")),r=s.__importDefault(i("65d9")),a=i("cc67");r.default.registerHooks(["beforeRouteEnter"]);let l=class extends o.default{beforeRouteEnter(e,t,i){n.default.post("/api/logout").then(()=>{a.coreStore.setAuthenticated(!1),a.coreStore.setUsername(""),i({path:"/auth/login"})})}};l=s.__decorate([r.default({})],l),t.default=l},cc67:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=i("6fc5"),o=i("3a0b");let r=class extends n.VuexModule{constructor(){super(...arguments),this.authenticated=!1,this.initialized=!1,this.username=""}setAuthenticated(e){this.authenticated=e}setInitialized(e){this.initialized=e}setUsername(e){this.username=e}};s.__decorate([n.Mutation],r.prototype,"setAuthenticated",null),s.__decorate([n.Mutation],r.prototype,"setInitialized",null),s.__decorate([n.Mutation],r.prototype,"setUsername",null),r=s.__decorate([n.Module({dynamic:!0,store:o.rootStore,name:"core"})],r),t.coreStore=n.getModule(r)},cd49:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("3dfd")),r=i("5f86"),a=i("3a0b");n.default.config.productionTip=!1,n.default.config.devtools=!0,n.default.config.performance=!0,t.app=new n.default({router:r.router,store:a.rootStore,render:e=>e(o.default)}).$mount("#app"),window.app=t.app},cd76:function(e,t,i){},cde6:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9"));let r=class extends n.default{};r=s.__decorate([o.default({props:["visible","left","top"]})],r),t.default=r},ce4c:function(e,t,i){},ce87:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("bc3a")),o=s.__importDefault(i("a026")),r=s.__importDefault(i("65d9"));let a=class extends o.default{beforeRouteEnter(e,t,i){n.default.post("/api/invite",{code:e.params.code}).then(e=>{i({path:e.data.sessionUrl})}).catch(e=>{console.error("Invitation code could not be redeemed"),i({path:"/dashboard"})})}};a=s.__decorate([r.default({template:""})],a),t.default=a},cec2:function(e,t,i){"use strict";i.r(t);var s=i("eb57"),n=i("255e");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("0584");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"0602c2e6",null);t["default"]=a.exports},cee3:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("f10f"),n=i("1216"),o=i("d6be"),r=i("98ef"),a=i("4aee");function l(e,t,i){void 0===i&&(i=s.gameStore.drawTEContour);const r=[e.x,e.y],a=[],l=o.PA_CDT[t].locate(r,null).loc;return null===l?(console.error("Triangle not found"),[]):(a.push(l.vertices[1].point),l.isConstrained(0)||c(r,l.vertices[2].point,l.vertices[1].point,l,0,a),a.push(l.vertices[2].point),l.isConstrained(1)||c(r,l.vertices[0].point,l.vertices[2].point,l,1,a),a.push(l.vertices[0].point),l.isConstrained(2)||c(r,l.vertices[1].point,l.vertices[0].point,l,2,a),i&&n.drawPolygon(a,"red"),a)}function c(e,t,i,s,n,o){const l=s.neighbours[n],d=l.indexT(s),h=a.ccw(d),f=a.cw(d),p=l.vertices[d],g=l.vertices[f],v=l.vertices[h],m=[l,h],y=[l,f],b=a.orientation(e,i,p.point),_=a.orientation(e,t,p.point);if(b===r.Sign.COUNTERCLOCKWISE)if(m[0].isConstrained(m[1]))i!==g.point&&o.push(u(e,i,p.point,g.point)),_===r.Sign.COUNTERCLOCKWISE&&o.push(u(e,t,p.point,g.point));else{if(_===r.Sign.COUNTERCLOCKWISE)return c(e,t,i,l,h,o);c(e,p.point,i,l,h,o)}if(b!==r.Sign.CLOCKWISE&&_!==r.Sign.COUNTERCLOCKWISE&&o.push(p.point),_===r.Sign.CLOCKWISE)return y[0].isConstrained(y[1])?(b===r.Sign.CLOCKWISE&&o.push(u(e,i,p.point,v.point)),void(t!==v.point&&o.push(u(e,t,p.point,v.point)))):b===r.Sign.CLOCKWISE?c(e,t,i,l,f,o):c(e,t,p.point,l,f,o)}function u(e,t,i,s){const n=(s[1]-i[1])*(t[0]-e[0])-(s[0]-i[0])*(t[1]-e[1]),o=((s[0]-i[0])*(e[1]-i[1])-(s[1]-i[1])*(e[0]-i[0]))/n,r=e[0]+o*(t[0]-e[0]),a=e[1]+o*(t[1]-e[1]);return[r,a]}t.computeVisibility=l},cf8f:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",[e._v("#X")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.xCount,expression:"xCount"}],attrs:{type:"text"},domProps:{value:e.xCount},on:{input:function(t){t.target.composing||(e.xCount=t.target.value)}}}),i("div",[e._v("#Y")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.yCount,expression:"yCount"}],attrs:{type:"text"},domProps:{value:e.yCount},on:{input:function(t){t.target.composing||(e.yCount=t.target.value)}}})]):e._e()},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},d065:function(e,t,i){"use strict";i.r(t);var s=i("45fb"),n=i("f8b3");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("514b");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"23de098e",null);t["default"]=a.exports},d19a:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"modal"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"mask",class:{"modal-mask":e.mask,"dialog-mask":!e.mask},on:{click:e.close,dragover:function(t){return t.preventDefault(),e.dragOver(t)}}},[i("div",{ref:"container",staticClass:"modal-container",style:{"background-color":e.colour},on:{click:function(e){e.stopPropagation()}}},[e._t("header",null,{dragStart:e.dragStart,dragEnd:e.dragEnd}),e._t("default")],2)])])},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},d1ec:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{}s.angleSteps=4,s.drawAngleLines=!1,s.drawFirstLightHit=!1,s.skipPlayerFOW=!1,s.skipLightFOW=!1,s.tempFill="fog",t.Settings=s},d30b:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("bc3a")),o=s.__importDefault(i("a026")),r=s.__importDefault(i("65d9")),a=i("cc67");let l=class extends o.default{constructor(){super(...arguments),this.username="",this.password="",this.error=""}login(){n.default.post("/api/login",{username:this.username,password:this.password}).then(e=>{a.coreStore.setUsername(this.username),a.coreStore.setAuthenticated(!0),this.$router.push(this.$route.query.redirect||"/")}).catch(e=>{e.response?this.error=e.response.statusText:this.error="Unknown error occured"})}register(){n.default.post("/api/register",{username:this.username,password:this.password}).then(e=>{a.coreStore.setUsername(this.username),a.coreStore.setAuthenticated(!0),this.$router.push(this.$route.query.redirect||"/")}).catch(e=>{e.response?this.error=e.response.statusText:this.error="Unknown error occured"})}focusin(e){if(e.target&&e.target.nextElementSibling){const t=e.target.nextElementSibling;t.style.opacity="0"}}focusout(e){if(e.target&&e.target.nextElementSibling){const t=e.target.nextElementSibling;t.style.opacity="1"}}};l=s.__decorate([r.default],l),t.default=l},d320:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v("Create basic token")])}}])},[i("div",{staticClass:"modal-body"},[i("label",{attrs:{for:"createtokendialog-text"}},[e._v("Text")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"text"}],attrs:{type:"text",id:"createtokendialog-name"},domProps:{value:e.text},on:{input:function(t){t.target.composing||(e.text=t.target.value)}}}),i("label",[e._v("Colours")]),i("div",{staticClass:"colours"},[i("span",[e._v("Fill:")]),i("color-picker",{attrs:{color:e.fillColour},on:{"update:color":function(t){e.fillColour=t}}}),i("span",[e._v("Border:")]),i("color-picker",{attrs:{color:e.borderColour},on:{"update:color":function(t){e.borderColour=t}}})],1),i("canvas",{ref:"canvas",attrs:{width:"100px",height:"100px"}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.submit}},[e._v("Submit")])])])},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},d323:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div")},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},d588:function(e,t,i){"use strict";i.r(t);var s=i("91df"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},d5df:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("65d9")),o=s.__importDefault(i("ea6a")),r=i("0bc6"),a=i("8f0a"),l=i("6f92"),c=i("5e7c"),u=i("0180"),d=i("f10f"),h=i("92b1"),f=i("5a5c");let p=class extends o.default{constructor(){super(...arguments),this.name="Ruler",this.active=!1,this.startPoint=null,this.ruler=null,this.text=null}onMouseDown(e){const t=l.layerManager.getLayer("draw");void 0!==t?(this.active=!0,this.startPoint=h.l2g(f.getMouse(e)),this.ruler=new c.Line(this.startPoint,this.startPoint,3,d.gameStore.rulerColour),this.text=new u.Text(this.startPoint.clone(),"","bold 20px serif"),this.ruler.addOwner(d.gameStore.username),this.text.addOwner(d.gameStore.username),t.addShape(this.ruler,!0,!0),t.addShape(this.text,!0,!0)):console.log("No draw layer!")}onMouseMove(e){if(!this.active||null===this.ruler||null===this.startPoint||null===this.text)return;const t=l.layerManager.getLayer("draw");if(void 0===t)return void console.log("No draw layer!");const i=h.l2g(f.getMouse(e));this.ruler.endPoint=i,r.socket.emit("Shape.Update",{shape:this.ruler.asDict(),redraw:!0,temporary:!0});const s=Math.sign(i.x-this.startPoint.x)*Math.sign(i.y-this.startPoint.y),n=Math.abs(i.x-this.startPoint.x),o=Math.abs(i.y-this.startPoint.y),c=Math.round(Math.sqrt(Math.pow(n,2)+Math.pow(o,2))*d.gameStore.unitSize/d.gameStore.gridSize)+" ft",u=Math.atan2(s*o,n),p=Math.min(this.startPoint.x,i.x)+n/2,g=Math.min(this.startPoint.y,i.y)+o/2;this.text.refPoint=new a.GlobalPoint(p,g),this.text.text=c,this.text.angle=u,r.socket.emit("Shape.Update",{shape:this.text.asDict(),redraw:!0,temporary:!0}),t.invalidate(!0)}onMouseUp(e){if(!this.active||null===this.ruler||null===this.startPoint||null===this.text)return;const t=l.layerManager.getLayer("draw");void 0!==t?(this.active=!1,t.removeShape(this.ruler,!0,!0),t.removeShape(this.text,!0,!0),t.invalidate(!0),this.ruler=this.startPoint=this.text=null):console.log("No active layer!")}};p=s.__decorate([n.default],p),t.RulerTool=p},d65f:function(e,t,i){"use strict";i.r(t);var s=i("d19a"),n=i("7e15");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("9e35");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"c2851f0e",null);t["default"]=a.exports},d677:function(e,t,i){"use strict";i.r(t);var s=i("53ec"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},d6be:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("6f92"),n=i("f10f"),o=i("6e4a");function r(e,i=!1){const r=new o.CDT;let a;a="vision"===e?n.gameStore.visionBlockers:n.gameStore.movementblockers;for(const t of a){const e=s.layerManager.UUIDMap.get(t);if(!i||e.visibleInCanvas(s.layerManager.getLayer().canvas))for(let t=0;t<e.points.length;t++)r.insertConstraint(e.points[t],e.points[(t+1)%e.points.length])}r.insertConstraint([-1e8,-1e8],[-1e8,1e8]),r.insertConstraint([-1e8,1e8],[-1e11,1e8]),r.insertConstraint([-1e11,1e8],[-1e11,-1e8]),r.insertConstraint([-1e11,-1e8],[-1e8,-1e8]),r.insertConstraint([-1e8,-1e8],[1e8,-1e8]),r.insertConstraint([1e8,-1e8],[1e8,-1e11]),r.insertConstraint([1e8,-1e11],[-1e8,-1e11]),r.insertConstraint([-1e8,-1e11],[-1e8,-1e8]),r.insertConstraint([1e8,-1e8],[1e8,1e8]),r.insertConstraint([1e8,1e8],[1e11,1e8]),r.insertConstraint([1e11,1e8],[1e11,-1e8]),r.insertConstraint([1e11,-1e8],[1e8,-1e8]),r.insertConstraint([-1e8,1e8],[1e8,1e8]),r.insertConstraint([1e8,1e8],[1e8,1e11]),r.insertConstraint([1e8,1e11],[-1e8,1e11]),r.insertConstraint([-1e8,1e11],[-1e8,1e8]),t.PA_CDT[e]=r,window.CDT=t.PA_CDT}t.PA_CDT={vision:new o.CDT,movement:new o.CDT},t.triangulate=r},d75e:function(e,t,i){"use strict";var s=i("b599"),n=i.n(s);n.a},d767:function(e,t,i){"use strict";var s=i("0a75"),n=i.n(s);n.a},d8ee:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=i("60a3"),a=s.__importDefault(i("3b36")),l=s.__importDefault(i("d65f")),c=i("4a5b"),u=i("0bc6"),d=i("af17"),h=i("6f92"),f=i("f10f");let p=class extends n.default{constructor(){super(...arguments),this.visible=!1}get owned(){return this.shape.ownedBy()}mounted(){d.EventBus.$on("EditDialog.Open",e=>{this.shape=e,this.visible=!0}),d.EventBus.$on("EditDialog.AddLabel",e=>{this.visible&&(this.shape.labels.push(f.gameStore.labels[e]),this.updateShape(!0))})}beforeDestroy(){d.EventBus.$off("EditDialog.Open"),d.EventBus.$off("EditDialog.AddLabel")}updated(){this.addEmpty()}addEmpty(){""!==this.shape.owners[this.shape.owners.length-1]&&this.shape.addOwner(""),this.shape.trackers.length&&""===this.shape.trackers[this.shape.trackers.length-1].name&&0===this.shape.trackers[this.shape.trackers.length-1].value||this.shape.trackers.push({uuid:c.uuidv4(),name:"",value:0,maxvalue:0,visible:!1}),this.shape.auras.length&&""===this.shape.auras[this.shape.auras.length-1].name&&0===this.shape.auras[this.shape.auras.length-1].value||this.shape.auras.push({uuid:c.uuidv4(),name:"",value:0,dim:0,visionSource:!1,colour:"rgba(0,0,0,0)",visible:!1})}updateShape(e,t=!1){this.owned&&(u.socket.emit("Shape.Update",{shape:this.shape.asDict(),redraw:e,temporary:t}),e&&h.layerManager.invalidate(),this.addEmpty())}setToken(e){this.owned&&(this.shape.setIsToken(e.target.checked),this.updateShape(!0))}setVisionBlocker(e){this.owned&&(this.shape.checkVisionSources(),this.updateShape(!0))}setMovementBlocker(e){this.owned&&(this.shape.setMovementBlock(e.target.checked),this.updateShape(!1))}updateAnnotation(e){if(!this.owned)return;const t=""!==this.shape.annotation;this.shape.annotation=e.target.value,""===this.shape.annotation||t?""===this.shape.annotation&&t&&(f.gameStore.annotations.splice(f.gameStore.annotations.findIndex(e=>e===this.shape.uuid)),h.layerManager.hasLayer("draw")&&h.layerManager.getLayer("draw").invalidate(!0)):(f.gameStore.annotations.push(this.shape.uuid),h.layerManager.hasLayer("draw")&&h.layerManager.getLayer("draw").invalidate(!0)),this.updateShape(!1)}updateOwner(e,t){this.owned&&(this.shape.updateOwner(t,e.target.value),this.updateShape(f.gameStore.fowLOS))}removeOwner(e){this.owned&&(this.shape.removeOwner(e),this.updateShape(f.gameStore.fowLOS))}removeTracker(e){this.owned&&(this.shape.trackers=this.shape.trackers.filter(t=>t.uuid!==e),this.updateShape(!1))}removeAura(e){this.owned&&(this.shape.auras=this.shape.auras.filter(t=>t.uuid!==e),this.shape.checkVisionSources(),this.updateShape(!0))}updateAuraVisionSource(e){if(!this.owned)return;e.visionSource=!e.visionSource;const t=f.gameStore.visionSources.findIndex(t=>t.aura===e.uuid);e.visionSource&&-1===t?f.gameStore.visionSources.push({shape:this.shape.uuid,aura:e.uuid}):!e.visionSource&&t>=0&&f.gameStore.visionSources.splice(t,1),this.updateShape(!0)}updateAuraColour(e,t){if(!this.owned)return;const i=h.layerManager.getLayer(this.shape.layer);void 0!==i&&i.invalidate(!e.visionSource)}openLabelManager(){d.EventBus.$emit("LabelManager.Open")}removeLabel(e){this.owned&&(this.shape.labels=this.shape.labels.filter(t=>t.uuid!==e),this.updateShape(!0))}};s.__decorate([r.Prop()],p.prototype,"shape",void 0),p=s.__decorate([o.default({components:{Modal:l.default,"color-picker":a.default}})],p),t.default=p},da7f:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return void 0!==e.getActiveLayer()?i("ContextMenu",{attrs:{visible:e.visible,left:e.x+"px",top:e.y+"px"},on:{close:e.close}},[e.getLayers().length>1?i("li",[e._v("Layer\n        "),i("ul",e._l(e.getLayers(),function(t){return i("li",{key:t.name,style:[e.getActiveLayer().name===t.name?{"background-color":"#82c8a0"}:{}],on:{click:function(i){return e.setLayer(t.name)}}},[e._v(e._s(t.name))])}),0)]):e._e(),i("li",{on:{click:e.moveToBack}},[e._v("Move to back")]),i("li",{on:{click:e.moveToFront}},[e._v("Move to front")]),i("li",{on:{click:e.addInitiative}},[e._v(e._s(e.getInitiativeWord())+" initiative")]),i("li",{on:{click:e.openEditDialog}},[e._v("Show properties")])]):e._e()},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},dc37:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=s.__importDefault(i("d65f"));let a=class extends n.default{constructor(){super(...arguments),this.visible=!1,this.yes="Yes",this.no="No",this.title="",this.resolve=e=>{},this.reject=()=>{}}confirm(){this.resolve(!0),this.close()}deny(){this.resolve(!1),this.close()}close(){this.reject(),this.visible=!1,this.title=""}open(e,t="yes",i="no"){return this.yes=t,this.no=i,this.title=e,this.visible=!0,this.$nextTick(()=>{this.$refs.confirm.focus()}),new Promise((e,t)=>{this.resolve=e,this.reject=t})}};a=s.__decorate([o.default({components:{Modal:r.default}})],a),t.default=a},dcb4:function(e,t,i){"use strict";var s=i("ce4c"),n=i.n(s);n.a},de21:function(e,t,i){},dec1:function(e,t,i){"use strict";i.r(t);var s=i("cf8f"),n=i("3481");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,null,null);t["default"]=a.exports},df64:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"accordion"},[i("div",{attrs:{id:"header"},on:{click:function(t){return t.preventDefault(),e.toggleDisplay(t)}}},[i("input",{ref:"overall",attrs:{type:"checkbox"},on:{click:function(t){return t.stopPropagation(),e.toggleCategory(t)}}}),i("strong",[e._v(e._s(e.title))]),e.showArrow?[i("span",{directives:[{name:"show",rawName:"v-show",value:e.showArrow&&!e.active,expression:"showArrow && !active"}],staticClass:"down-Arrow"},[e._v("▼")]),i("span",{directives:[{name:"show",rawName:"v-show",value:e.showArrow&&e.active,expression:"showArrow && active"}],staticClass:"up-Arrow"},[e._v("▲")])]:e._e()],2),i("div",{directives:[{name:"show",rawName:"v-show",value:e.active,expression:"active"}],attrs:{id:"body"}},e._l(e.items,function(t){return i("div",{key:t[0],staticClass:"item",on:{click:function(i){return e.toggleSelection(t[0])}}},[i("input",{attrs:{type:"checkbox"},domProps:{checked:e.selected.includes(t[0])},on:{click:function(e){e.preventDefault()}}}),e._v(" "+e._s(t[1])+"\n      ")])}),0)])},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},e06e:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible},on:{close:e.close},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v(e._s(e.title))])}}])},[i("div",{staticClass:"modal-body"},[i("button",{ref:"confirm",on:{click:e.confirm}},[e._v(e._s(e.yes))]),e.no?i("button",{on:{click:e.deny}},[e._v(e._s(e.no))]):e._e()])])},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},e0e8:function(e,t,i){"use strict";i.r(t);var s=i("2380"),n=i("208e");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("dcb4");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"b908e87c",null);t["default"]=a.exports},e0e9:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=s.__importDefault(i("1c76")),a=i("5338"),l=i("2d5b"),c=i("4a5b");let u=class extends n.default{constructor(){super(...arguments),this.visible=!1,this.left=0,this.top=0}open(e,t){l.assetStore.selected.includes(t)||c.getComponent().select(e,t),this.visible=!0,this.left=e.pageX,this.top=e.pageY,this.$nextTick(()=>{this.$children[0].$el.focus()})}close(){this.visible=!1}rename(){if(1!==l.assetStore.selected.length)return;const e=l.assetStore.idMap.get(l.assetStore.selected[0]);c.getRef("prompt").prompt("New name:",`Renaming ${e.name}`).then(t=>{a.socket.emit("Asset.Rename",{asset:e.id,name:t}),e.name=t,c.getComponent().$forceUpdate()},()=>{}),this.close()}remove(){0!==l.assetStore.selected.length&&(c.getRef("confirm").open("Are you sure you wish to remove this?").then(e=>{if(e){for(const e of l.assetStore.selected)a.socket.emit("Asset.Remove",e),l.assetStore.files.includes(e)?l.assetStore.files.splice(l.assetStore.files.indexOf(e),1):l.assetStore.folders.splice(l.assetStore.folders.indexOf(e),1);l.assetStore.clearSelected()}},()=>{}),this.close())}};u=s.__decorate([o.default({components:{ContextMenu:r.default}})],u),t.default=u},e27a:function(e,t,i){"use strict";i.r(t);var s=i("2756"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},e3f5:function(e,t,i){"use strict";var s=i("a126"),n=i.n(s);n.a},e4b0:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=s.__importDefault(i("d65f")),a=i("4a5b"),l=i("0bc6"),c=i("af17"),u=i("f10f");let d=class extends n.default{constructor(){super(...arguments),this.visible=!1,this.newCategory="",this.newName="",this.search=""}mounted(){c.EventBus.$on("LabelManager.Open",()=>{this.visible=!0,this.newCategory="",this.newName="",this.$nextTick(()=>this.$refs.search.focus())})}beforeDestroy(){c.EventBus.$off("LabelManager.Open")}get labels(){const e={"":[]};for(const t of Object.keys(u.gameStore.labels)){const i=u.gameStore.labels[t];this.search.length&&`${i.category.toLowerCase()}${i.name.toLowerCase()}`.search(this.search.toLowerCase())<0||i.user===u.gameStore.username&&(i.category?(i.category in e||(e[i.category]=[]),e[i.category].push(i),e[i.category].sort((e,t)=>e.name.localeCompare(t.name))):e[""].push(i))}return e}get categories(){return Object.keys(this.labels).sort()}selectLabel(e){c.EventBus.$emit("EditDialog.AddLabel",e),this.visible=!1}toggleVisibility(e){e.visible=!e.visible,l.socket.emit("Label.Visibility.Set",{uuid:e.uuid,visible:e.visible})}addLabel(){if(""===this.newName)return;const e={uuid:a.uuidv4(),category:this.newCategory,name:this.newName,visible:!1,user:u.gameStore.username};u.gameStore.addLabel(e),l.socket.emit("Label.Add",e),this.newCategory="",this.newName=""}deleteLabel(e){u.gameStore.deleteLabel({uuid:e,user:u.gameStore.username}),l.socket.emit("Label.Delete",e)}};d=s.__decorate([o.default({components:{Modal:r.default}})],d),t.default=d},e4ea:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("8f0a"),n=i("92b1"),o=i("5a5c"),r=i("8db6"),a=i("2469");class l extends a.Shape{constructor(e,t=[],i,s,n){super(e,i,s,n),this.type="polygon",this._vertices=[],this._vertices=t}get refPoint(){return this._refPoint}set refPoint(e){const t=e.subtract(this._refPoint);this._refPoint=e;for(let i=0;i<this._vertices.length;i++)this._vertices[i]=this._vertices[i].add(t)}get vertices(){return[this._refPoint,...this._vertices]}asDict(){return Object.assign(this.getBaseDict(),{vertices:this._vertices.map(e=>({x:e.x,y:e.y}))})}fromDict(e){super.fromDict(e),this._vertices=e.vertices.map(e=>new s.GlobalPoint(e.x,e.y))}get points(){return this.vertices.map(e=>[e.x,e.y])}draw(e){super.draw(e),e.lineCap="round",e.lineJoin="round","fog"===this.strokeColour?e.strokeStyle=o.getFogColour():2===this.vertices.length?e.strokeStyle=this.fillColour:e.strokeStyle=this.strokeColour,"fog"===this.fillColour?e.fillStyle=o.getFogColour():e.fillStyle=this.fillColour,e.lineWidth=n.g2lz(2),e.beginPath(),e.moveTo(n.g2lx(this.vertices[0].x),n.g2ly(this.vertices[0].y));for(let t=1;t<=this.vertices.length;t++){const i=this.vertices[t%this.vertices.length];e.lineTo(n.g2lx(i.x),n.g2ly(i.y))}e.fill(),e.stroke()}contains(e){return this.getBoundingBox().contains(e)}center(e){return this.getBoundingBox().center()}visibleInCanvas(e){return this.getBoundingBox().visibleInCanvas(e)}snapToGrid(){}resizeToGrid(){}resize(e,t){0===e?this._refPoint=n.l2g(t):this._vertices[e-1]=n.l2g(t)}getBoundingBox(){let e=this.refPoint.x,t=this.refPoint.x,i=this.refPoint.y,n=this.refPoint.y;for(const s of this._vertices)s.x<e&&(e=s.x),s.x>t&&(t=s.x),s.y<i&&(i=s.y),s.y>n&&(n=s.y);return new r.BoundingRect(new s.GlobalPoint(e,i),t-e,n-i)}}t.Polygon=l},e5ca:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.IS_DM,expression:"IS_DM"}]},[e._v("Mode")]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.IS_DM,expression:"IS_DM"}],staticClass:"selectgroup"},e._l(e.modes,function(t){return i("div",{key:t,staticClass:"option",class:{"option-selected":e.modeSelect===t},on:{click:function(i){e.modeSelect=t}}},[e._v(e._s(t))])}),0),i("div",[e._v("Shape")]),i("div",{staticClass:"selectgroup"},e._l(e.shapes,function(t){return i("div",{key:t,staticClass:"option",class:{"option-selected":e.shapeSelect===t},on:{click:function(i){e.shapeSelect=t}}},[i("i",{staticClass:"fas",class:"fa-"+t})])}),0),i("div",[e._v("Colours")]),i("div",{staticClass:"selectgroup"},[i("color-picker",{staticClass:"option",attrs:{color:e.fillColour},on:{"update:color":function(t){e.fillColour=t}}}),i("color-picker",{staticClass:"option",attrs:{color:e.borderColour},on:{"update:color":function(t){e.borderColour=t}}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"paint-brush"===e.shapeSelect,expression:"shapeSelect === 'paint-brush'"}]},[e._v("Brush size")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.brushSize,expression:"brushSize"},{name:"show",rawName:"v-show",value:"paint-brush"===e.shapeSelect,expression:"shapeSelect === 'paint-brush'"}],staticStyle:{"max-width":"100px"},attrs:{type:"text"},domProps:{value:e.brushSize},on:{input:function(t){t.target.composing||(e.brushSize=t.target.value)}}})]):e._e()},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},e6c4:function(e,t,i){"use strict";var s=i("839d"),n=i.n(s);n.a},e756:function(e,t,i){},e8bb:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",{attrs:{id:"accordion-container"}},e._l(e.categories,function(t){return i("accordion",{key:t,attrs:{title:""===t?"no category":t,showArrow:!1,items:e.labels[t],initialValues:e.initalValues[t]},on:{selectionupdate:e.updateSelection}})}),1)]):e._e()},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},e914:function(e,t,i){"use strict";i.r(t);var s=i("c9a2"),n=i("aa69");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("78c7");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,null,null);t["default"]=a.exports},e94f:function(e,t,i){"use strict";i.r(t);var s=i("7aaa"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},ea6a:function(e,t,i){"use strict";i.r(t);var s=i("d323"),n=i("6465");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("12d3");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,null,null);t["default"]=a.exports},ea7c:function(e,t,i){"use strict";var s=i("2dad"),n=i.n(s);n.a},eb57:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible},on:{close:e.close},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v(e._s(e.title))])}}])},[i("div",{staticClass:"modal-body"},[e._v("\n    "+e._s(e.question)+"\n    "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.answer,expression:"answer"}],ref:"answer",attrs:{type:"text"},domProps:{value:e.answer},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)},input:function(t){t.target.composing||(e.answer=t.target.value)}}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.submit}},[e._v("Submit")])])])},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},ebb9:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=s.__importDefault(i("310e"));n.default.component("draggable",r.default);const a=s.__importDefault(i("d65f")),l=i("4a5b"),c=i("0bc6"),u=i("af17"),d=i("6f92"),h=i("f10f"),f=i("9cb7");let p=class extends n.default{constructor(){super(...arguments),this.visible=!1,this.data=[],this.currentActor=null,this.roundCounter=0,this.visionLock=!1,this.cameraLock=!1,this._activeTokens=[]}mounted(){u.EventBus.$on("Initiative.Clear",this.clear),u.EventBus.$on("Initiative.Remove",e=>this.removeInitiative(e)),u.EventBus.$on("Initiative.Show",()=>this.visible=!0),c.socket.on("Initiative.Set",e=>{this.data=e}),c.socket.on("Initiative.Turn.Set",e=>this.setTurn(e)),c.socket.on("Initiative.Turn.Update",e=>this.updateTurn(e,!1)),c.socket.on("Initiative.Round.Update",e=>this.setRound(e,!1)),c.socket.on("Initiative.Effect.New",e=>{const t=this.getActor(e.actor);void 0!==t&&this.createEffect(t,e.effect,!1)}),c.socket.on("Initiative.Effect.Update",e=>this.updateEffect(e.actor,e.effect,!1))}beforeDestroy(){u.EventBus.$off("Initiative.Clear"),u.EventBus.$off("Initiative.Remove"),u.EventBus.$off("Initiative.Show")}clear(){this.data=[],this.currentActor=null}getActor(e){return this.data.find(t=>t.uuid===e)}contains(e){return this.data.some(t=>t.uuid===e)}owns(e){if(h.gameStore.IS_DM)return!0;const t=d.layerManager.UUIDMap.get(e.uuid);return void 0!==t&&t.owners.includes(h.gameStore.username)}getDefaultEffect(){return{uuid:l.uuidv4(),name:"New Effect",turns:10}}fakeSetData(e){e.setData("Hack","")}syncInitiative(e){c.socket.emit("Initiative.Update",e)}addInitiative(e){const t=this.data.findIndex(t=>t.uuid===e.uuid);t>=0||(void 0===e.initiative&&(e.initiative=0),this.syncInitiative(e))}removeInitiative(e){const t=this.data.findIndex(t=>t.uuid===e);if(t<0||this.data[t].group)return;this.syncInitiative({uuid:e});const i=d.layerManager.UUIDMap.get(e);void 0!==i&&i.showHighlight&&(i.showHighlight=!1,d.layerManager.getLayer(i.layer).invalidate(!0))}updateOrder(){h.gameStore.IS_DM&&c.socket.emit("Initiative.Set",this.data.map(e=>e.uuid))}updateTurn(e,t){if(!h.gameStore.IS_DM&&t)return;this.currentActor=e;const i=this.data.find(t=>t.uuid===e);if(void 0!==i){if(i.effects)for(let e=i.effects.length-1;e>=0;e--)i.effects[e].turns<=0?i.effects.splice(e,1):i.effects[e].turns--;if(this.visionLock&&(null!==e&&h.gameStore.ownedtokens.includes(e)?h.gameStore.setActiveTokens([e]):h.gameStore.setActiveTokens([])),this.cameraLock&&null!==e){const t=d.layerManager.UUIDMap.get(e);void 0!==t&&t.ownedBy()&&f.gameManager.setCenterPosition(t.center())}t&&c.socket.emit("Initiative.Turn.Update",e)}}setRound(e,t){!h.gameStore.IS_DM&&t||(this.roundCounter=e,t&&c.socket.emit("Initiative.Round.Update",e))}setTurn(e){this.currentActor=e}nextTurn(){if(!h.gameStore.IS_DM)return;const e=this.data,t=e[(e.findIndex(e=>e.uuid===this.currentActor)+1)%e.length];this.data[0].uuid===t.uuid&&this.setRound(this.roundCounter+1,!0),this.updateTurn(t.uuid,!0)}toggleHighlight(e,t){const i=d.layerManager.UUIDMap.get(e.uuid);void 0!==i&&(i.showHighlight=t,d.layerManager.getLayer(i.layer).invalidate(!0))}toggleOption(e,t){this.owns(e)&&(e[t]=!e[t],this.syncInitiative(e))}createEffect(e,t,i){this.owns(e)&&(e.effects.push(t),i&&c.socket.emit("Initiative.Effect.New",{actor:e.uuid,effect:t}))}syncEffect(e,t){this.owns(e)&&c.socket.emit("Initiative.Effect.Update",{actor:e.uuid,effect:t})}updateEffect(e,t,i){const s=this.data.find(t=>t.uuid===e);if(void 0===s)return;const n=s.effects.findIndex(e=>e.uuid===t.uuid);void 0!==n&&(s.effects[n]=t,i?this.syncEffect(s,t):this.$forceUpdate())}toggleVisionLock(){this.visionLock=!this.visionLock,this.visionLock?(this._activeTokens=[...h.gameStore._activeTokens],null!==this.currentActor&&h.gameStore.ownedtokens.includes(this.currentActor)&&h.gameStore.setActiveTokens([this.currentActor])):h.gameStore.setActiveTokens(this._activeTokens)}};p=s.__decorate([o.default({components:{Modal:a.default,draggable:r.default}})],p),t.default=p},ee96:function(e,t,i){},f086:function(e,t,i){"use strict";i.r(t);var s=i("a112"),n=i("7ba5");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("01be");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"674cf937",null);t["default"]=a.exports},f10f:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=i("6fc5"),r=i("0bc6"),a=i("2b48"),l=i("6f92"),c=i("92b1"),u=i("5a5c"),d=i("99e3"),h=i("d6be"),f=i("3a0b");let p=class extends o.VuexModule{constructor(){super(...arguments),this.layers=[],this.selectedLayerIndex=-1,this.boardInitialized=!1,this.locations=[],this.assets={},this.notes=[],this.IS_DM=!1,this.FAKE_PLAYER=!1,this.isLocked=!1,this.gridSize=50,this.username="",this.roomName="",this.roomCreator="",this.invitationCode="",this.players=[],this.gridColour="rgba(0, 0, 0, 1)",this.fowColour="rgba(0, 0, 0, 1)",this.rulerColour="rgba(255, 0, 0, 1)",this.panX=0,this.panY=0,this.zoomDisplay=.5,this.unitSize=5,this.useGrid=!0,this.fullFOW=!1,this.fowOpacity=.3,this.fowLOS=!1,this.locationName="",this.visionSources=[],this.visionBlockers=[],this.annotations=[],this.movementblockers=[],this.ownedtokens=[],this._activeTokens=[],this.BV=Object.freeze(new d.BoundingVolume([])),this.visionMode="bvh",this.drawTEContour=!1,this.visionRangeMin=1640,this.visionRangeMax=3281,this.clipboard=[],this.labels={},this.filterNoLabel=!1,this.labelFilters=[],this.showUI=!0}get selectedLayer(){return this.layers[this.selectedLayerIndex]}get zoomFactor(){return u.zoomValue(this.zoomDisplay)}get activeTokens(){return 0===this._activeTokens.length?this.ownedtokens:this._activeTokens}setFakePlayer(e){this.FAKE_PLAYER=e,this.IS_DM=!e,l.layerManager.invalidate()}setZoomDisplay(e){e!==this.zoomDisplay&&(e<0&&(e=0),e>1&&(e=1),this.zoomDisplay=e,l.layerManager.invalidate())}setVisionMode(e){this.visionMode=e.mode,e.sync&&r.socket.emit("Location.Options.Set",{vision_mode:e.mode})}setBoardInitialized(e){this.boardInitialized=e}toggleUnlabeledFilter(){this.filterNoLabel=!this.filterNoLabel}addLabel(e){n.default.set(this.labels,e.uuid,e)}setLabelFilters(e){this.labelFilters=e}setLabelVisibility(e){e.uuid in this.labels&&(this.labels[e.uuid].visible=e.visible)}deleteLabel(e){if(!(e.uuid in this.labels))return;const t=this.labels[e.uuid],i=new Set;for(const s of l.layerManager.UUIDMap.values()){const e=s.labels.indexOf(t);e>=0&&(s.labels.splice(e,1),i.add(s.layer))}for(const s of i)l.layerManager.getLayer(s).invalidate(!1);n.default.delete(this.labels,e.uuid)}setDM(e){this.IS_DM=e}setUsername(e){this.username=e}setRoomName(e){this.roomName=e}setRoomCreator(e){this.roomCreator=e}setInvitationCode(e){this.invitationCode=e}addLayer(e){this.layers.push(e),-1===this.selectedLayerIndex&&(this.selectedLayerIndex=this.layers.indexOf(e))}selectLayer(e){const t=this.layers.indexOf(e.name);t>=0&&(this.selectedLayerIndex=t),e.sync&&r.socket.emit("Client.ActiveLayer.Set",e.name)}newNote(e){this.notes.push(e.note),e.sync&&r.socket.emit("Note.New",e.note)}setAssets(e){this.assets=e}setLocations(e){this.locations=e}resetLayerInfo(){this.layers=[],this.selectedLayerIndex=-1}recalculateVision(e=!1){this.boardInitialized&&("triangle"===this.visionMode?h.triangulate("vision",e):this.BV=Object.freeze(new d.BoundingVolume(this.visionBlockers)))}recalculateMovement(e=!1){this.boardInitialized&&"triangle"===this.visionMode&&h.triangulate("movement",e)}updateZoom(e){if(e.newZoomDisplay===this.zoomDisplay)return;e.newZoomDisplay<0&&(e.newZoomDisplay=0),e.newZoomDisplay>1&&(e.newZoomDisplay=1);const t=c.g2l(e.zoomLocation);this.zoomDisplay=e.newZoomDisplay;const i=c.l2g(t),s=i.subtract(e.zoomLocation);this.panX+=s.x,this.panY+=s.y,l.layerManager.invalidate(),a.sendClientOptions()}setGridColour(e){this.gridColour=e.colour,l.layerManager.getGridLayer().drawGrid(),e.sync&&r.socket.emit("Client.Options.Set",{gridColour:e.colour})}setFOWColour(e){this.fowColour=e.colour,l.layerManager.invalidate(),e.sync&&r.socket.emit("Client.Options.Set",{fowColour:e.colour})}setRulerColour(e){this.rulerColour=e.colour,e.sync&&r.socket.emit("Client.Options.Set",{rulerColour:e.colour})}setPanX(e){this.panX=e}setPanY(e){this.panY=e}increasePanX(e){this.panX+=e}increasePanY(e){this.panY+=e}setUnitSize(e){this.unitSize!==e.unitSize&&e.unitSize>0&&e.unitSize<1/0&&(this.unitSize=e.unitSize,l.layerManager.invalidate(),e.sync&&r.socket.emit("Location.Options.Set",{unit_size:e.unitSize}))}setUseGrid(e){if(this.useGrid!==e.useGrid){this.useGrid=e.useGrid;const t=l.layerManager.getGridLayer();e.useGrid?t.canvas.style.display="block":t.canvas.style.display="none",e.sync&&r.socket.emit("Location.Options.Set",{use_grid:e.useGrid})}}setGridSize(e){if(this.gridSize!==e.gridSize&&e.gridSize>0){this.gridSize=e.gridSize;const t=l.layerManager.getGridLayer();void 0!==t&&t.drawGrid(),e.sync&&r.socket.emit("Gridsize.Set",e.gridSize)}}setVisionRangeMin(e){this.visionRangeMin=e.value,l.layerManager.invalidateLight(),e.sync&&r.socket.emit("Location.Options.Set",{vision_min_range:e.value})}setVisionRangeMax(e){this.visionRangeMax=Math.max(e.value,this.visionRangeMin),l.layerManager.invalidateLight(),e.sync&&r.socket.emit("Location.Options.Set",{vision_max_range:this.visionRangeMax})}setFullFOW(e){this.fullFOW!==e.fullFOW&&(this.fullFOW=e.fullFOW,l.layerManager.invalidateLight(),e.sync&&r.socket.emit("Location.Options.Set",{full_fow:e.fullFOW}))}setFOWOpacity(e){this.fowOpacity=e.fowOpacity,l.layerManager.invalidateLight(),e.sync&&r.socket.emit("Location.Options.Set",{fow_opacity:e.fowOpacity})}setLineOfSight(e){this.fowLOS!==e.fowLOS&&(this.fowLOS=e.fowLOS,l.layerManager.invalidate(),e.sync&&r.socket.emit("Location.Options.Set",{fow_los:e.fowLOS}))}setLocationName(e){this.locationName=e}updateNote(e){const t=this.notes.find(t=>t.uuid===e.note.uuid);void 0!==t&&(t.title=e.note.title,t.text=e.note.text,e.sync&&r.socket.emit("Note.Update",t))}removeNote(e){this.notes=this.notes.filter(t=>t.uuid!==e.note.uuid),e.sync&&r.socket.emit("Note.Remove",e.note.uuid)}toggleUI(){this.showUI=!this.showUI}setClipboard(e){this.clipboard=e}setActiveTokens(e){this._activeTokens=e,l.layerManager.invalidateLight()}addActiveToken(e){this._activeTokens.push(e),l.layerManager.invalidateLight()}removeActiveToken(e){0===this._activeTokens.length&&(this._activeTokens=[...this.ownedtokens]),this._activeTokens.splice(this._activeTokens.indexOf(e),1),l.layerManager.invalidateLight()}setPlayers(e){this.players=e}addPlayer(e){this.players.push(e)}kickPlayer(e){this.players=this.players.filter(t=>t.id!==e)}setIsLocked(e){this.isLocked=e.isLocked,e.sync&&r.socket.emit("Room.Info.Set.Locked",this.isLocked)}clear(){this.context.state.visionSources=[],this.context.state.visionBlockers=[],this.context.state.ownedtokens=[],this.context.state.annotations=[],this.context.state.movementblockers=[],this.context.state.notes=[],this.context.commit("recalculateVision"),this.context.commit("recalculateMovement")}};s.__decorate([o.Mutation],p.prototype,"setFakePlayer",null),s.__decorate([o.Mutation],p.prototype,"setZoomDisplay",null),s.__decorate([o.Mutation],p.prototype,"setVisionMode",null),s.__decorate([o.Mutation],p.prototype,"setBoardInitialized",null),s.__decorate([o.Mutation],p.prototype,"toggleUnlabeledFilter",null),s.__decorate([o.Mutation],p.prototype,"addLabel",null),s.__decorate([o.Mutation],p.prototype,"setLabelFilters",null),s.__decorate([o.Mutation],p.prototype,"setLabelVisibility",null),s.__decorate([o.Mutation],p.prototype,"deleteLabel",null),s.__decorate([o.Mutation],p.prototype,"setDM",null),s.__decorate([o.Mutation],p.prototype,"setUsername",null),s.__decorate([o.Mutation],p.prototype,"setRoomName",null),s.__decorate([o.Mutation],p.prototype,"setRoomCreator",null),s.__decorate([o.Mutation],p.prototype,"setInvitationCode",null),s.__decorate([o.Mutation],p.prototype,"addLayer",null),s.__decorate([o.Mutation],p.prototype,"selectLayer",null),s.__decorate([o.Mutation],p.prototype,"newNote",null),s.__decorate([o.Mutation],p.prototype,"setAssets",null),s.__decorate([o.Mutation],p.prototype,"setLocations",null),s.__decorate([o.Mutation],p.prototype,"resetLayerInfo",null),s.__decorate([o.Mutation],p.prototype,"recalculateVision",null),s.__decorate([o.Mutation],p.prototype,"recalculateMovement",null),s.__decorate([o.Mutation],p.prototype,"updateZoom",null),s.__decorate([o.Mutation],p.prototype,"setGridColour",null),s.__decorate([o.Mutation],p.prototype,"setFOWColour",null),s.__decorate([o.Mutation],p.prototype,"setRulerColour",null),s.__decorate([o.Mutation],p.prototype,"setPanX",null),s.__decorate([o.Mutation],p.prototype,"setPanY",null),s.__decorate([o.Mutation],p.prototype,"increasePanX",null),s.__decorate([o.Mutation],p.prototype,"increasePanY",null),s.__decorate([o.Mutation],p.prototype,"setUnitSize",null),s.__decorate([o.Mutation],p.prototype,"setUseGrid",null),s.__decorate([o.Mutation],p.prototype,"setGridSize",null),s.__decorate([o.Mutation],p.prototype,"setVisionRangeMin",null),s.__decorate([o.Mutation],p.prototype,"setVisionRangeMax",null),s.__decorate([o.Mutation],p.prototype,"setFullFOW",null),s.__decorate([o.Mutation],p.prototype,"setFOWOpacity",null),s.__decorate([o.Mutation],p.prototype,"setLineOfSight",null),s.__decorate([o.Mutation],p.prototype,"setLocationName",null),s.__decorate([o.Mutation],p.prototype,"updateNote",null),s.__decorate([o.Mutation],p.prototype,"removeNote",null),s.__decorate([o.Mutation],p.prototype,"toggleUI",null),s.__decorate([o.Mutation],p.prototype,"setClipboard",null),s.__decorate([o.Mutation],p.prototype,"setActiveTokens",null),s.__decorate([o.Mutation],p.prototype,"addActiveToken",null),s.__decorate([o.Mutation],p.prototype,"removeActiveToken",null),s.__decorate([o.Mutation],p.prototype,"setPlayers",null),s.__decorate([o.Mutation],p.prototype,"addPlayer",null),s.__decorate([o.Mutation],p.prototype,"kickPlayer",null),s.__decorate([o.Mutation],p.prototype,"setIsLocked",null),s.__decorate([o.Action],p.prototype,"clear",null),p=s.__decorate([o.Module({dynamic:!0,store:f.rootStore,name:"game",namespaced:!0})],p),t.gameStore=o.getModule(p)},f30c:function(e,t,i){"use strict";i.r(t);var s=i("dc37"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},f312:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aurasFromServer=e=>{const t=[];for(const i of e)t.push({uuid:i.uuid,visionSource:i.vision_source,visible:i.visible,name:i.name,value:i.value,dim:i.dim,colour:i.colour});return t},t.aurasToServer=e=>{const t=[];for(const i of e)t.push({uuid:i.uuid,vision_source:i.visionSource,visible:i.visible,name:i.name,value:i.value,dim:i.dim,colour:i.colour});return t}},f51a:function(e,t,i){"use strict";i.r(t);var s=i("e0e9"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},f551:function(e,t,i){"use strict";i.r(t);var s=i("2686"),n=i("1dd6");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("28b6");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"7a3669fd",null);t["default"]=a.exports},f5fe:function(e,t,i){"use strict";i.r(t);var s=i("a014"),n=i("7018");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("ea7c");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"07fc8ff2",null);t["default"]=a.exports},f692:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("4185"),n=i("b906"),o=i("38c9"),r=i("bab4"),a=i("6f92"),l=i("f10f");function c(e){const t=document.createElement("canvas");let i;t.style.zIndex=a.layerManager.layers.length.toString(),t.width=window.innerWidth,t.height=window.innerHeight,i="grid"===e.type_?new o.GridLayer(t,e.name):"fow"===e.type_?new s.FOWLayer(t,e.name):"fow-players"===e.type_?new n.FOWPlayersLayer(t,e.name):new r.Layer(t,e.name),i.selectable=e.selectable,i.playerEditable=e.player_editable,a.layerManager.addLayer(i);const c=document.getElementById("layers");null!==c?("fow-players"!==e.name&&c.appendChild(t),"grid"===e.type_&&e.size&&l.gameStore.setGridSize({gridSize:e.size,sync:!1}),i.setShapes(e.shapes)):console.warn("Layers div is missing, this will prevent the main game board from loading!")}t.createLayer=c},f74c:function(e,t,i){"use strict";i.r(t);var s=i("1fd5"),n=i("29a2");for(var o in n)"default"!==o&&function(e){i.d(t,e,function(){return n[e]})}(o);i("7eb7");var r=i("2877"),a=Object(r["a"])(n["default"],s["a"],s["b"],!1,null,"e477c214",null);t["default"]=a.exports},f8b3:function(e,t,i){"use strict";i.r(t);var s=i("d8ee"),n=i.n(s);for(var o in s)"default"!==o&&function(e){i.d(t,e,function(){return s[e]})}(o);t["default"]=n.a},f974:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{attrs:{id:"toolselect"}},[i("ul",e._l(e.visibleTools,function(t){return i("li",{directives:[{name:"show",rawName:"v-show",value:e.toolVisible(t),expression:"toolVisible(tool)"}],key:t,ref:t+"-selector",refInFor:!0,class:{"tool-selected":e.currentTool===t},on:{mousedown:function(i){e.currentTool=t}}},[i("a",{attrs:{href:"#"}},[e._v(e._s(t))])])}),0)]),i("div",[[i("select-tool",{directives:[{name:"show",rawName:"v-show",value:"Select"===e.currentTool,expression:"currentTool === 'Select'"}],ref:"selectTool"}),i("pan-tool",{directives:[{name:"show",rawName:"v-show",value:"Pan"===e.currentTool,expression:"currentTool === 'Pan'"}]}),i("keep-alive",[i("draw-tool",{directives:[{name:"show",rawName:"v-show",value:"Draw"===e.currentTool,expression:"currentTool === 'Draw'"}]})],1),i("ruler-tool",{directives:[{name:"show",rawName:"v-show",value:"Ruler"===e.currentTool,expression:"currentTool === 'Ruler'"}]}),i("map-tool",{directives:[{name:"show",rawName:"v-show",value:"Map"===e.currentTool,expression:"currentTool === 'Map'"}]}),i("filter-tool",{directives:[{name:"show",rawName:"v-show",value:"Filter"===e.currentTool,expression:"currentTool === 'Filter'"}]}),i("vision-tool",{directives:[{name:"show",rawName:"v-show",value:"Vision"===e.currentTool,expression:"currentTool === 'Vision'"}]}),i("shape-menu",{ref:"shapecontext"}),i("createtoken-dialog",{ref:"createtokendialog"})]],2)])},n=[];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},f994:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("form",{on:{focusin:e.focusin,focusout:e.focusout,submit:function(t){return t.preventDefault(),e.login(t)}}},[i("fieldset",[i("legend",{staticClass:"legend"},[e._v("PlanarAlly")]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{type:"text",name:"username",placeholder:"Username",autocomplete:"username",required:""},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}}),e._m(0)]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password",name:"password",placeholder:"Password",autocomplete:"current-password",required:""},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),e._m(1)]),i("div",{staticStyle:{display:"flex"}},[i("button",{staticStyle:{visibility:"hidden",display:"none"},attrs:{type:"submit",name:"login"}}),i("button",{staticClass:"submit",attrs:{type:"button",name:"register",title:"Register"},on:{click:e.register}},[i("i",{staticClass:"fas fa-plus"})]),e._m(2)])]),e.error?i("div",{staticClass:"feedback"},[i("p",{staticClass:"error"},[i("strong",[e._v("Error:")]),e._v("\n      "+e._s(e.error)+"\n    ")])]):e._e()])},n=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fas fa-user-circle"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fas fa-lock"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("button",{staticClass:"submit",attrs:{type:"submit",name:"login",title:"Login"}},[i("i",{staticClass:"fas fa-arrow-right"})])}];i.d(t,"a",function(){return s}),i.d(t,"b",function(){return n})},fbdd:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9ab4"),n=s.__importDefault(i("a026")),o=s.__importDefault(i("65d9")),r=s.__importDefault(i("d065")),a=i("4a5b"),l=i("0bc6"),c=i("af17"),u=i("6f92");let d=class extends n.default{constructor(){super(...arguments),this.shape=null}mounted(){c.EventBus.$on("SelectionInfo.Shape.Set",e=>{this.shape=e})}beforeDestroy(){c.EventBus.$off("SelectionInfo.Shape.Set")}openEditDialog(){this.$refs.editDialog.visible=!0}changeValue(e,t){null!==this.shape&&a.getRef("prompt").prompt(`New  ${e.name} value:`,`Updating ${e.name}`).then(i=>{if(null===this.shape)return;const s=e.value;"+"===i[0]||"-"===i[0]?e.value+=parseInt(i,10):e.value=parseInt(i,10),isNaN(e.value)&&(e.value=s),l.socket.emit("Shape.Update",{shape:this.shape.asDict(),redraw:t,temporary:!1}),t&&u.layerManager.invalidate()},()=>{})}};d=s.__decorate([o.default({components:{"edit-dialog":r.default}})],d),t.default=d},fcac:function(e,t,i){},fe11:function(e,t,i){},fe80:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("0bc6"),n=i("af17"),o=i("8f0a"),r=i("6f92"),a=i("f692"),l=i("9cb7"),c=i("f10f"),u=i("5f86"),d=i("5a5c");s.socket.on("connect",()=>{console.log("Connected")}),s.socket.on("disconnect",()=>{console.log("Disconnected")}),s.socket.on("connect_error",e=>{console.error("Could not connect to game session."),u.router.push("/dashboard")}),s.socket.on("error",e=>{console.error("Game session does not exist."),u.router.push("/dashboard")}),s.socket.on("redirect",e=>{console.log("redirecting"),u.router.push(e)}),s.socket.on("Room.Info.Set",e=>{c.gameStore.setRoomName(e.name),c.gameStore.setRoomCreator(e.creator),c.gameStore.setInvitationCode(e.invitationCode),c.gameStore.setIsLocked({isLocked:e.isLocked,sync:!1}),c.gameStore.setPlayers(e.players)}),s.socket.on("Room.Info.InvitationCode.Set",e=>{c.gameStore.setInvitationCode(e),n.EventBus.$emit("DmSettings.RefreshedInviteCode")}),s.socket.on("Room.Info.Players.Add",e=>{c.gameStore.addPlayer(e)}),s.socket.on("Username.Set",e=>{c.gameStore.setUsername(e),c.gameStore.setDM(e===window.location.pathname.split("/")[2])}),s.socket.on("Client.Options.Set",e=>{c.gameStore.setGridColour({colour:e.grid_colour,sync:!1}),c.gameStore.setFOWColour({colour:e.fow_colour,sync:!1}),c.gameStore.setRulerColour({colour:e.ruler_colour,sync:!1}),c.gameStore.setPanX(e.pan_x),c.gameStore.setPanY(e.pan_y),c.gameStore.setZoomDisplay(d.zoomDisplay(e.zoom_factor)),e.active_layer&&r.layerManager.selectLayer(e.active_layer,!1),void 0!==r.layerManager.getGridLayer()&&r.layerManager.getGridLayer().invalidate()}),s.socket.on("Location.Set",e=>{void 0!==e.name&&c.gameStore.setLocationName(e.name),void 0!==e.unit_size&&c.gameStore.setUnitSize({unitSize:e.unit_size,sync:!1}),void 0!==e.use_grid&&c.gameStore.setUseGrid({useGrid:e.use_grid,sync:!1}),void 0!==e.full_fow&&c.gameStore.setFullFOW({fullFOW:e.full_fow,sync:!1}),void 0!==e.fow_opacity&&c.gameStore.setFOWOpacity({fowOpacity:e.fow_opacity,sync:!1}),void 0!==e.fow_los&&c.gameStore.setLineOfSight({fowLOS:e.fow_los,sync:!1}),void 0!==e.vision_min_range&&c.gameStore.setVisionRangeMin({value:e.vision_min_range,sync:!1}),void 0!==e.vision_max_range&&c.gameStore.setVisionRangeMax({value:e.vision_max_range,sync:!1}),void 0!==e.vision_mode&&(c.gameStore.setVisionMode({mode:e.vision_mode,sync:!1}),c.gameStore.recalculateVision(),c.gameStore.recalculateMovement())}),s.socket.on("Position.Set",e=>{l.gameManager.setCenterPosition(new o.GlobalPoint(e.x,e.y))}),s.socket.on("Notes.Set",e=>{for(const t of e)c.gameStore.newNote({note:t,sync:!1})}),s.socket.on("Asset.List.Set",e=>{c.gameStore.setAssets(e)}),s.socket.on("Board.Set",e=>{c.gameStore.clear(),c.gameStore.setLocations(e.locations),document.getElementById("layers").innerHTML="",c.gameStore.resetLayerInfo(),r.layerManager.reset();for(const t of e.layers)a.createLayer(t);r.layerManager.selectLayer(r.layerManager.getLayer().name,!1),n.EventBus.$emit("Initiative.Clear"),c.gameStore.recalculateVision(),c.gameStore.recalculateMovement(),c.gameStore.setBoardInitialized(!0)}),s.socket.on("Gridsize.Set",e=>{c.gameStore.setGridSize({gridSize:e,sync:!1})}),s.socket.on("Shape.Add",e=>{l.gameManager.addShape(e)}),s.socket.on("Shape.Remove",e=>{if(!r.layerManager.UUIDMap.has(e.uuid))return void console.log("Attempted to remove an unknown shape");if(!r.layerManager.hasLayer(e.layer))return void console.log(`Attempted to remove shape from an unknown layer ${e.layer}`);const t=r.layerManager.getLayer(e.layer);t.removeShape(r.layerManager.UUIDMap.get(e.uuid),!1),t.invalidate(!1)}),s.socket.on("Shape.Order.Set",e=>{if(!r.layerManager.UUIDMap.has(e.shape.uuid))return void console.log("Attempted to move the shape order of an unknown shape");if(!r.layerManager.hasLayer(e.shape.layer))return void console.log(`Attempted to remove shape from an unknown layer ${e.shape.layer}`);const t=r.layerManager.UUIDMap.get(e.shape.uuid),i=r.layerManager.getLayer(t.layer);i.moveShapeOrder(t,e.index,!1)}),s.socket.on("Shape.Layer.Change",e=>{const t=r.layerManager.UUIDMap.get(e.uuid);void 0!==t&&t.moveLayer(e.layer,!1)}),s.socket.on("Shape.Update",e=>{l.gameManager.updateShape(e)}),s.socket.on("Temp.Clear",e=>{e.forEach(e=>{if(!r.layerManager.UUIDMap.has(e.uuid))return void console.log("Attempted to remove an unknown temporary shape");if(!r.layerManager.hasLayer(e.layer))return void console.log(`Attempted to remove shape from an unknown layer ${e.layer}`);const t=r.layerManager.UUIDMap.get(e.uuid);r.layerManager.getLayer(e.layer).removeShape(t,!1)})}),s.socket.on("Labels.Set",e=>{for(const t of e)c.gameStore.addLabel(t)}),s.socket.on("Label.Visibility.Set",e=>{c.gameStore.setLabelVisibility(e)}),s.socket.on("Label.Add",e=>{c.gameStore.addLabel(e)}),s.socket.on("Label.Delete",e=>{c.gameStore.deleteLabel(e)}),s.socket.on("Labels.Filter.Add",e=>{c.gameStore.labelFilters.push(e),r.layerManager.invalidate()}),s.socket.on("Labels.Filter.Remove",e=>{const t=c.gameStore.labelFilters.indexOf(e);t>=0&&(c.gameStore.labelFilters.splice(t,1),r.layerManager.invalidate())}),s.socket.on("Labels.Filters.Set",e=>{c.gameStore.setLabelFilters(e)})}});
//# sourceMappingURL=app-legacy.3ba691e3.js.map