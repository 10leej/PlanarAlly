(function(e){function t(t){for(var n,r,s=t[0],l=t[1],c=t[2],h=0,d=[];h<s.length;h++)r=s[h],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&d.push(a[r][0]),a[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);u&&u(t);while(d.length)d.shift()();return o.push.apply(o,c||[]),i()}function i(){for(var e,t=0;t<o.length;t++){for(var i=o[t],n=!0,s=1;s<i.length;s++){var l=i[s];0!==a[l]&&(n=!1)}n&&(o.splice(t--,1),e=r(r.s=i[0]))}return e}var n={},a={app:0},o=[];function r(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=n,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;o.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("cd49")},"034f":function(e,t,i){"use strict";var n=i("85ec"),a=i.n(n);a.a},"0777":function(e,t,i){},"0a1c":function(e,t,i){},"0b57":function(e,t,i){"use strict";var n=i("fe8d"),a=i.n(n);a.a},"0b9a":function(e,t,i){"use strict";var n=i("cbee"),a=i.n(n);a.a},1:function(e,t){},1133:function(e,t,i){"use strict";var n=i("46cb"),a=i.n(n);a.a},"12d3":function(e,t,i){"use strict";var n=i("0777"),a=i.n(n);a.a},1397:function(e,t,i){},"1e6f":function(e,t,i){"use strict";var n=i("c302"),a=i.n(n);a.a},"223f":function(e,t,i){"use strict";var n=i("4d02"),a=i.n(n);a.a},2457:function(e,t,i){"use strict";var n=i("8d75"),a=i.n(n);a.a},"2eb7":function(e,t,i){"use strict";var n=i("1397"),a=i.n(n);a.a},"34be":function(e,t,i){"use strict";var n=i("0a1c"),a=i.n(n);a.a},"35ee":function(e,t,i){},3730:function(e,t,i){},"3abf":function(e,t,i){},"3ba3":function(e,t,i){"use strict";var n=i("a7fc"),a=i.n(n);a.a},"3cb3":function(e,t,i){"use strict";var n=i("88bf"),a=i.n(n);a.a},4122:function(e,t,i){"use strict";var n=i("de79"),a=i.n(n);a.a},"46cb":function(e,t,i){},"4a14":function(e,t,i){"use strict";var n=i("6538"),a=i.n(n);a.a},"4d02":function(e,t,i){},"561b":function(e,t,i){"use strict";var n=i("69e8"),a=i.n(n);a.a},"59fe":function(e,t,i){"use strict";var n=i("8991"),a=i.n(n);a.a},"5d8d":function(e,t,i){"use strict";var n=i("f459"),a=i.n(n);a.a},"618e":function(e,t,i){"use strict";var n=i("c58f"),a=i.n(n);a.a},6538:function(e,t,i){},"69e8":function(e,t,i){},7392:function(e,t,i){"use strict";var n=i("d4ff"),a=i.n(n);a.a},"747b":function(e,t,i){"use strict";var n=i("3abf"),a=i.n(n);a.a},"78c7":function(e,t,i){"use strict";var n=i("3730"),a=i.n(n);a.a},"7f1e":function(e,t,i){"use strict";var n=i("35ee"),a=i.n(n);a.a},"85ec":function(e,t,i){},"88bf":function(e,t,i){},8991:function(e,t,i){},"8d75":function(e,t,i){},96178:function(e,t,i){"use strict";var n=i("f0dc"),a=i.n(n);a.a},a10f:function(e,t,i){"use strict";var n=i("e7bf"),a=i.n(n);a.a},a3fa:function(e,t,i){},a7fc:function(e,t,i){},aa79:function(e,t,i){"use strict";var n=i("c76b"),a=i.n(n);a.a},ab66:function(e,t,i){"use strict";var n=i("fa96"),a=i.n(n);a.a},b831:function(e,t,i){},c302:function(e,t,i){},c58f:function(e,t,i){},c76b:function(e,t,i){},cbee:function(e,t,i){},cd49:function(e,t,i){"use strict";i.r(t);i("e623"),i("e379"),i("5dc8"),i("37e1");var n=i("a026"),a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("router-view",{ref:"activeComponent"})],1)},o=[],r=(i("034f"),i("2877")),s={},l=Object(r["a"])(s,a,o,!1,null,null,null),c=l.exports,u=(i("45fc"),i("bc3a")),h=i.n(u),d=i("8c4f"),v=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"AssetManager"}},[i("div",{attrs:{id:"titlebar"}},[e._v("Asset Manager")]),i("div",{attrs:{id:"main"}},[i("div",{attrs:{id:"assets"},on:{dragover:function(t){return t.preventDefault(),e.moveDrag(t)},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.stopDrag(t,e.currentFolder)}}},[i("div",{attrs:{id:"breadcrumbs"}},[i("div",[e._v("/")]),e._l(e.path,(function(t){return i("div",{key:t},[e._v(e._s(e.idMap.get(t).name))])}))],2),i("div",{attrs:{id:"actionbar"}},[i("input",{attrs:{id:"files",type:"file",multiple:"",hidden:""},on:{change:function(t){return e.upload()}}}),i("div",{attrs:{title:"Create folder"},on:{click:e.createDirectory}},[i("i",{staticClass:"fas fa-plus-square"})]),i("div",{attrs:{title:"Upload files"},on:{click:e.prepareUpload}},[i("i",{staticClass:"fas fa-upload"})])]),i("div",{attrs:{id:"explorer"}},[e.path.length?i("div",{staticClass:"inode folder",on:{dblclick:function(t){return e.changeDirectory(-1)},dragover:function(t){return t.preventDefault(),e.moveDrag(t)},dragleave:function(t){return t.preventDefault(),e.leaveDrag(t)},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.stopDrag(t,e.parentFolder)}}},[i("i",{staticClass:"fas fa-folder",staticStyle:{"font-size":"50px"}}),i("div",{staticClass:"title"},[e._v("..")])]):e._e(),e._l(e.folders,(function(t){return i("div",{key:t,staticClass:"inode folder",class:{"inode-selected":e.selected.includes(t)},attrs:{draggable:"true"},on:{click:function(i){return e.select(i,t)},dblclick:function(i){return e.changeDirectory(t)},contextmenu:function(i){return i.preventDefault(),e.$refs.cm.open(i,t)},dragstart:function(i){return e.startDrag(i,t)},dragover:function(t){return t.preventDefault(),e.moveDrag(t)},dragleave:function(t){return t.preventDefault(),e.leaveDrag(t)},drop:function(i){return i.preventDefault(),i.stopPropagation(),e.stopDrag(i,t)}}},[i("i",{staticClass:"fas fa-folder",staticStyle:{"font-size":"50px"}}),i("div",{staticClass:"title"},[e._v(e._s(e.idMap.get(t).name))])])})),e._l(e.files,(function(t){return i("div",{key:t,staticClass:"inode file",class:{"inode-selected":e.selected.includes(t)},attrs:{draggable:"true"},on:{click:function(i){return e.select(i,t)},contextmenu:function(i){return i.preventDefault(),e.$refs.cm.open(i,t)},dragstart:function(i){return e.startDrag(i,t)}}},[i("img",{attrs:{src:"/static/assets/"+e.idMap.get(t).file_hash,width:"50"}}),i("div",{staticClass:"title"},[e._v(e._s(e.idMap.get(t).name))])])}))],2)]),e.firstSelectedFile?i("div",{attrs:{id:"asset-details"}},[i("div",{attrs:{id:"asset-detail-title"}},[e._v(e._s(e.firstSelectedFile.name))]),i("img",{attrs:{src:"/static/assets/"+e.firstSelectedFile.file_hash}})]):e._e()]),i("AssetContextMenu",{ref:"cm"}),i("Prompt",{ref:"prompt"}),i("ConfirmDialog",{ref:"confirm"})],1)},f=[],p=(i("a4d3"),i("e01a"),i("d28b"),i("99af"),i("caad"),i("c975"),i("fb6a"),i("a434"),i("b0c0"),i("d3b7"),i("2532"),i("3ca3"),i("ddb0"),i("284c")),y=i("9f12"),g=i("53fe"),m=i("8b83"),b=i("c65a"),w=i("c03e"),k=i("9ab4"),O=i("2fe1"),x=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContextMenu",{attrs:{visible:e.visible,left:e.left+"px",top:e.top+"px"},on:{close:e.close}},[i("li",{on:{click:e.rename}},[e._v("Rename")]),i("li",{on:{click:e.remove}},[e._v("Remove")])])},S=[],_=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.visible?i("div",{staticClass:"ContextMenu",style:{left:e.left,top:e.top},attrs:{tabindex:"-1"},on:{blur:function(t){return e.$emit("close")}}},[i("ul",[e._t("default")],2)]):e._e()},C=[],j=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),t}(n["default"]);j=Object(k["a"])([Object(O["b"])({props:["visible","left","top"]})],j);var L=j,E=L,I=(i("7f1e"),Object(r["a"])(E,_,C,!1,null,null,null)),P=I.exports,M=i("8055"),T=i.n(M),A=(i("4ec9"),i("6fc5")),D=i("2f62");n["default"].use(D["a"]);var R=new D["a"].Store({}),N=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.root=-1,e.files=[],e.folders=[],e.idMap=new Map,e.selected=[],e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"clear",value:function(){this.folders=[],this.files=[]}},{key:"clearSelected",value:function(){console.log("Cleared"),this.selected=[]}},{key:"setRoot",value:function(e){this.root=e}}]),t}(A["d"]);Object(k["a"])([A["c"]],N.prototype,"clear",null),Object(k["a"])([A["c"]],N.prototype,"clearSelected",null),Object(k["a"])([A["c"]],N.prototype,"setRoot",null),N=Object(k["a"])([Object(A["b"])({dynamic:!0,store:R,name:"assets",namespaced:!0})],N);var U=Object(A["e"])(N),z=T()(location.protocol+"//"+location.host+"/pa_assetmgmt",{autoConnect:!1});z.on("connect",(function(){console.log("Connected")})),z.on("disconnect",(function(){console.log("Disconnected")})),z.on("redirect",(function(e){console.log("redirecting"),window.location.href=e})),z.on("Folder.Root.Set",(function(e){U.setRoot(e)})),z.on("Folder.Set",(function(e){if(U.clear(),e.children){var t=!0,i=!1,n=void 0;try{for(var a,o=e.children[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var r=a.value;U.idMap.set(r.id,r),r.file_hash?U.files.push(r.id):U.folders.push(r.id)}}catch(s){i=!0,n=s}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}}})),z.on("Folder.Create",(function(e){U.folders.push(e.id),U.idMap.set(e.id,e)})),z.on("Asset.Upload.Finish",(function(e){U.idMap.set(e.id,e),U.files.push(e.id)}));var $=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.left=0,e.top=0,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"open",value:function(e,t){var i=this;U.selected.includes(t)||this.parent.select(e,t),this.visible=!0,this.left=e.pageX,this.top=e.pageY,this.$nextTick((function(){i.$children[0].$el.focus()}))}},{key:"close",value:function(){this.visible=!1}},{key:"rename",value:function(){var e=this;if(1===U.selected.length){var t=U.idMap.get(U.selected[0]);this.parent.$refs.prompt.prompt("New name:","Renaming ".concat(t.name)).then((function(i){z.emit("Asset.Rename",{asset:t.id,name:i}),t.name=i,e.parent.$forceUpdate()}),(function(){})),this.close()}}},{key:"remove",value:function(){0!==U.selected.length&&(this.parent.$refs.confirm.open("Are you sure you wish to remove this?").then((function(e){if(e){var t=!0,i=!1,n=void 0;try{for(var a,o=U.selected[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var r=a.value;z.emit("Asset.Remove",r),U.files.includes(r)?U.files.splice(U.files.indexOf(r),1):U.folders.splice(U.folders.indexOf(r),1)}}catch(s){i=!0,n=s}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}U.clearSelected()}}),(function(){})),this.close())}},{key:"parent",get:function(){return this.$parent}}]),t}(n["default"]);$=Object(k["a"])([Object(O["b"])({components:{ContextMenu:P}})],$);var F=$,V=F,H=Object(r["a"])(V,x,S,!1,null,null,null),B=H.exports,G=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible},on:{close:e.close},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v(" "+e._s(e.title)+" ")])}}])},[i("div",{staticClass:"modal-body"},[i("button",{ref:"confirm",on:{click:e.confirm}},[e._v(e._s(e.yes))]),e.no?i("button",{on:{click:e.deny}},[e._v(e._s(e.no))]):e._e()])])},W=[],X=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"modal"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"mask",class:{"modal-mask":e.mask,"dialog-mask":!e.mask},on:{click:e.close,dragover:function(t){return t.preventDefault(),e.dragOver(t)}}},[i("div",{ref:"container",staticClass:"modal-container",style:{"background-color":e.colour},on:{click:function(e){e.stopPropagation()}}},[e._t("header",null,{dragStart:e.dragStart,dragEnd:e.dragEnd}),e._t("default")],2)])])},Y=[],K=(i("e25e"),i("60a3")),q=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.positioned=!1,e.offsetX=0,e.offsetY=0,e.screenX=0,e.screenY=0,e.dragging=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){this.updatePosition()}},{key:"updated",value:function(){this.updatePosition()}},{key:"close",value:function(e){this.$emit("close")}},{key:"updatePosition",value:function(){if(!this.positioned){var e=this.$refs.container;if(0===e.offsetWidth&&0===e.offsetHeight)return;this.$refs.container.style.left=(window.innerWidth-e.offsetWidth)/2+"px",this.$refs.container.style.top=(window.innerHeight-e.offsetHeight)/2+"px",this.positioned=!0}}},{key:"dragStart",value:function(e){null!==e&&null!==e.dataTransfer&&(e.dataTransfer.setData("Hack",""),e.dataTransfer.setDragImage(this.$refs.container,e.offsetX,e.offsetY),this.offsetX=e.offsetX,this.offsetY=e.offsetY,this.screenX=e.screenX,this.screenY=e.screenY,this.dragging=!0)}},{key:"dragEnd",value:function(e){this.dragging=!1;var t=e.clientX-this.offsetX,i=e.clientY-this.offsetY;0===e.clientX&&0===e.clientY&&0===e.pageX&&0===e.pageY&&(t=parseInt(this.$refs.container.style.left,10)-(this.screenX-e.screenX),i=parseInt(this.$refs.container.style.top,10)-(this.screenY-e.screenY)),t<0&&(t=0),t>window.innerWidth-100&&(t=window.innerWidth-100),i<0&&(i=0),i>window.innerHeight-100&&(i=window.innerHeight-100),this.$refs.container.style.left=t+"px",this.$refs.container.style.top=i+"px",this.$refs.container.style.display="block"}},{key:"dragOver",value:function(e){this.dragging&&(this.$refs.container.style.display="none")}}]),t}(n["default"]);Object(k["a"])([Object(K["a"])(Boolean)],q.prototype,"visible",void 0),Object(k["a"])([Object(K["a"])({type:Boolean,default:!0})],q.prototype,"mask",void 0),Object(k["a"])([Object(K["a"])({type:String,default:"white"})],q.prototype,"colour",void 0),q=Object(k["a"])([O["b"]],q);var Q=q,Z=Q,J=(i("618e"),Object(r["a"])(Z,X,Y,!1,null,"2098e4f8",null)),ee=J.exports,te=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.yes="Yes",e.no="No",e.title="",e.resolve=function(e){},e.reject=function(){},e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"confirm",value:function(){this.resolve(!0),this.close()}},{key:"deny",value:function(){this.resolve(!1),this.close()}},{key:"close",value:function(){this.reject(),this.visible=!1,this.title=""}},{key:"open",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yes",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"no";return this.yes=i,this.no=n,this.title=e,this.visible=!0,this.$nextTick((function(){t.$refs.confirm.focus()})),new Promise((function(e,i){t.resolve=e,t.reject=i}))}}]),t}(n["default"]);te=Object(k["a"])([Object(O["b"])({components:{Modal:ee}})],te);var ie=te,ne=ie,ae=(i("fb5d"),Object(r["a"])(ne,G,W,!1,null,"46dc898b",null)),oe=ae.exports,re=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible},on:{close:e.close},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v(" "+e._s(e.title)+" ")])}}])},[i("div",{staticClass:"modal-body"},[e._v(" "+e._s(e.question)+" "),i("input",{directives:[{name:"model",rawName:"v-model",value:e.answer,expression:"answer"}],ref:"answer",attrs:{type:"text"},domProps:{value:e.answer},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)},input:function(t){t.target.composing||(e.answer=t.target.value)}}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.submit}},[e._v("Submit")])])])},se=[],le=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.question="",e.answer="",e.title="",e.resolve=function(e){},e.reject=function(){},e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"submit",value:function(){this.resolve(this.answer),this.close()}},{key:"close",value:function(){this.reject(),this.visible=!1,this.question="",this.answer="",this.title=""}},{key:"prompt",value:function(e,t){var i=this;return this.question=e,this.title=t,this.visible=!0,this.$nextTick((function(){i.$refs.answer.focus()})),new Promise((function(e,t){i.resolve=e,i.reject=t}))}}]),t}(n["default"]);le=Object(k["a"])([Object(O["b"])({components:{Modal:ee}})],le);var ce=le,ue=ce,he=(i("1133"),Object(r["a"])(ue,re,se,!1,null,"391b52fc",null)),de=he.exports;i("4160"),i("0d03"),i("a9e3"),i("ac1f"),i("25f0"),i("5319"),i("1276"),i("159b");function ve(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16)}))}function fe(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1}function pe(e,t){var i=[[],[]];return e.forEach((function(e){return t(e)?i[1].push(e):i[0].push(e)})),i}function ye(e,t,i){var n=e.measureText(t).width,a=1.5*Number(e.font.split("px")[0]);return 2*Math.cos(Math.atan(a/n))*i/n}var ge=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.path=[],e.draggingSelection=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"changeDirectory",value:function(e){e<0?this.path.pop():this.path.push(e),U.clearSelected(),z.emit("Folder.Get",this.currentFolder)}},{key:"createDirectory",value:function(){var e=window.prompt("New folder name");null!==e&&z.emit("Folder.Create",{name:e,parent:this.currentFolder})}},{key:"moveInode",value:function(e,t){U.files.includes(e)?U.files.splice(U.files.indexOf(e),1):U.folders.splice(U.folders.indexOf(e),1),U.idMap.delete(e),z.emit("Inode.Move",{inode:e,target:t})}},{key:"select",value:function(e,t){if(e.shiftKey&&U.selected.length>0){for(var i=[].concat(Object(p["a"])(U.files),Object(p["a"])(U.folders)),n=i.indexOf(U.selected[U.selected.length-1]),a=i.indexOf(t),o=n;o!==a;n<a?o++:o--)o!==n&&U.selected.push(i[o]);U.selected.push(i[a])}else e.ctrlKey||U.clearSelected(),U.selected.push(t)}},{key:"startDrag",value:function(e,t){null!==e.dataTransfer&&(e.dataTransfer.setData("Hack","ittyHack"),e.dataTransfer.dropEffect="move",U.selected.includes(t)||U.selected.push(t),this.draggingSelection=!0)}},{key:"moveDrag",value:function(e){e.target.classList.contains("folder")&&e.target.classList.add("inode-selected")}},{key:"leaveDrag",value:function(e){e.target.classList.contains("folder")&&e.target.classList.remove("inode-selected")}},{key:"stopDrag",value:function(e,t){if(e.target.classList.remove("inode-selected"),this.draggingSelection){if((t===U.root||U.folders.includes(t))&&!U.selected.includes(t)){var i=!0,n=!1,a=void 0;try{for(var o,r=U.selected[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var s=o.value;this.moveInode(s,t)}}catch(l){n=!0,a=l}finally{try{i||null==r.return||r.return()}finally{if(n)throw a}}}U.clearSelected()}else e.dataTransfer&&e.dataTransfer.files.length>0&&this.upload(e.dataTransfer.files,t);this.draggingSelection=!1}},{key:"prepareUpload",value:function(){document.getElementById("files").click()}},{key:"upload",value:function(e,t){var i=document.getElementById("files").files;if(void 0===e){if(!i)return;e=i}void 0===t&&(t=this.currentFolder);var n=1e5,a=!0,o=!1,r=void 0;try{for(var s,l=function(){for(var e=s.value,i=ve(),a=Math.ceil(e.size/n),o=function(o){var r=new FileReader;r.readAsArrayBuffer(e.slice(o*n,o*n+Math.min(n,e.size-o*n))),r.onload=function(n){z.emit("Asset.Upload",{name:e.name,directory:t,data:r.result,slice:o,totalSlices:a,uuid:i})}},r=0;r<a;r++)o(r)},c=e[Symbol.iterator]();!(a=(s=c.next()).done);a=!0)l()}catch(u){o=!0,r=u}finally{try{a||null==c.return||c.return()}finally{if(o)throw r}}}},{key:"folders",get:function(){return U.folders}},{key:"files",get:function(){return U.files}},{key:"selected",get:function(){return U.selected}},{key:"idMap",get:function(){return U.idMap}},{key:"currentFolder",get:function(){return this.path.length?this.path[this.path.length-1]:U.root}},{key:"parentFolder",get:function(){var e=this.path[this.path.length-2];return void 0===e&&(e=U.root),e}},{key:"firstSelectedFile",get:function(){var e=!0,t=!1,i=void 0;try{for(var n,a=U.selected[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var o=n.value;if(U.idMap.get(o).file_hash)return U.idMap.get(o)}}catch(r){t=!0,i=r}finally{try{e||null==a.return||a.return()}finally{if(t)throw i}}return null}}]),t}(n["default"]);ge=Object(k["a"])([Object(O["b"])({components:{Prompt:de,ConfirmDialog:oe,AssetContextMenu:B},beforeRouteEnter:function(e,t,i){z.connect(),i()},beforeRouteLeave:function(e,t,i){z.disconnect(),i()}})],ge);var me=ge,be=me,we=(i("78c7"),Object(r["a"])(be,v,f,!1,null,null,null)),ke=we.exports,Oe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("form",{on:{focusin:e.focusin,focusout:e.focusout,submit:function(t){return t.preventDefault(),e.login(t)}}},[i("fieldset",[i("legend",{staticClass:"legend"},[e._v("PlanarAlly")]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{type:"text",name:"username",placeholder:"Username",autocomplete:"username",required:"",autofocus:""},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}}),e._m(0)]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password",name:"password",placeholder:"Password",autocomplete:"current-password",required:""},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),e._m(1)]),i("div",{staticStyle:{display:"flex"}},[i("button",{staticStyle:{visibility:"hidden",display:"none"},attrs:{type:"submit",name:"login"}}),i("button",{staticClass:"submit",attrs:{type:"button",name:"register",title:"Register"},on:{click:e.register}},[i("i",{staticClass:"fas fa-plus"})]),e._m(2)])]),e.error?i("div",{staticClass:"feedback"},[i("p",{staticClass:"error"},[i("strong",[e._v("Error:")]),e._v(" "+e._s(e.error)+" ")])]):e._e()])},xe=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fas fa-user-circle"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fas fa-lock"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("button",{staticClass:"submit",attrs:{type:"submit",name:"login",title:"Login"}},[i("i",{staticClass:"fas fa-arrow-right"})])}],Se=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.authenticated=!1,e.initialized=!1,e.username="",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"setAuthenticated",value:function(e){this.authenticated=e}},{key:"setInitialized",value:function(e){this.initialized=e}},{key:"setUsername",value:function(e){this.username=e}}]),t}(A["d"]);Object(k["a"])([A["c"]],Se.prototype,"setAuthenticated",null),Object(k["a"])([A["c"]],Se.prototype,"setInitialized",null),Object(k["a"])([A["c"]],Se.prototype,"setUsername",null),Se=Object(k["a"])([Object(A["b"])({dynamic:!0,store:R,name:"core"})],Se);var _e=Object(A["e"])(Se),Ce=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.username="",e.password="",e.error="",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"login",value:function(){var e=this;h.a.post("/api/login",{username:this.username,password:this.password}).then((function(t){_e.setUsername(e.username),_e.setAuthenticated(!0),e.$router.push(e.$route.query.redirect||"/")})).catch((function(t){t.response?e.error=t.response.statusText:e.error="Unknown error occured"}))}},{key:"register",value:function(){var e=this;h.a.post("/api/register",{username:this.username,password:this.password}).then((function(t){_e.setUsername(e.username),_e.setAuthenticated(!0),e.$router.push(e.$route.query.redirect||"/")})).catch((function(t){t.response?e.error=t.response.statusText:e.error="Unknown error occured"}))}},{key:"focusin",value:function(e){if(e.target&&e.target.nextElementSibling){var t=e.target.nextElementSibling;t.style.opacity="0"}}},{key:"focusout",value:function(e){if(e.target&&e.target.nextElementSibling){var t=e.target.nextElementSibling;t.style.opacity="1"}}}]),t}(n["default"]);Ce=Object(k["a"])([O["b"]],Ce);var je=Ce,Le=je,Ee=(i("3cb3"),Object(r["a"])(Le,Oe,xe,!1,null,"986db5b0",null)),Ie=Ee.exports;O["b"].registerHooks(["beforeRouteEnter"]);var Pe=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"beforeRouteEnter",value:function(e,t,i){h.a.post("/api/logout").then((function(){_e.setAuthenticated(!1),_e.setUsername(""),i({path:"/auth/login"})}))}}]),t}(n["default"]);Pe=Object(k["a"])([Object(O["b"])({})],Pe);var Me=Pe,Te=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e._v(e._s(e.message))])},Ae=[],De=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.message="Loading...",e}return Object(w["a"])(t,e),t}(n["default"]);De=Object(k["a"])([O["b"]],De);var Re=De,Ne=Re,Ue=Object(r["a"])(Ne,Te,Ae,!1,null,null,null),ze=Ue.exports,$e=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"formcontainer"}},[e.owned||e.joined?i("form",[i("fieldset",[i("legend",{staticClass:"legend"},[e._v("Your sessions")]),i("div",{staticClass:"input"},[e._l(e.owned,(function(t,n){return i("router-link",{key:"o-"+n,attrs:{to:"/game/"+encodeURIComponent(t[1])+"/"+encodeURIComponent(t[0])}},[e._v(" "+e._s(t[0])+" ")])})),e._l(e.joined,(function(t,n){return i("router-link",{key:"j-"+n,attrs:{to:"/game/"+encodeURIComponent(t[1])+"/"+encodeURIComponent(t[0])}},[e._v(" "+e._s(t[1])+"/"+e._s(t[0])+" ")])}))],2),0===e.owned.length?i("div",{staticClass:"input"},[e._v("No active sessions")]):e._e()])]):e._e(),e._m(0),i("form",{on:{submit:function(t){return t.preventDefault(),e.createRoom(t)}}},[i("fieldset",[e.owned||e.joined?i("div",{staticClass:"input"},[e._v("Create a new session")]):i("legend",{staticClass:"legend"},[e._v("Create a session")]),i("div",{staticClass:"input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.newSessionName,expression:"newSessionName"}],attrs:{type:"text",name:"room_name",placeholder:"Session Name"},domProps:{value:e.newSessionName},on:{input:function(t){t.target.composing||(e.newSessionName=t.target.value)}}}),e._m(1)]),e._m(2)])]),i("div",{attrs:{id:"account-options"}},[i("form",{on:{submit:function(e){e.preventDefault()}}},[i("router-link",{staticClass:"submit",attrs:{tag:"button",title:"Account Settings",to:"/account"}},[i("i",{staticClass:"fas fa-cog"})])],1),i("form",{on:{submit:function(e){e.preventDefault()}}},[i("router-link",{staticClass:"submit",attrs:{tag:"button",title:"Logout",to:"/auth/logout"}},[i("i",{staticClass:"fas fa-sign-out-alt"})])],1)])])},Fe=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("h4",[i("span",[e._v("OR")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",[i("i",{staticClass:"fab fa-d-and-d"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("button",{staticClass:"submit",attrs:{type:"submit",title:"Create"}},[i("i",{staticClass:"fas fa-arrow-right"})])}];O["b"].registerHooks(["beforeRouteEnter"]);var Ve=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.owned=[],e.joined=[],e.error="",e.newSessionName="",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"beforeRouteEnter",value:function(e,t,i){h.a.get("/api/rooms").then((function(e){i((function(t){t.owned=e.data.owned,t.joined=e.data.joined}))})).catch((function(e){i((function(t){t.error=e.message}))}))}},{key:"createRoom",value:function(e){var t=this;h.a.post("/api/rooms",{name:this.newSessionName}).then((function(e){t.$router.push("/game/".concat(encodeURIComponent(_e.username),"/").concat(encodeURIComponent(t.newSessionName)))})).catch((function(e){t.error=e.message}))}}]),t}(n["default"]);Ve=Object(k["a"])([O["b"]],Ve);var He=Ve,Be=He,Ge=(i("d9e0"),Object(r["a"])(Be,$e,Fe,!1,null,"f34c77ee",null)),We=Ge.exports,Xe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"main"},on:{mouseleave:e.mouseleave,wheel:e.zoom}},[e.showUI?i("menu-bar"):e._e(),i("div",{attrs:{id:"board"}},[e.ready.manager?[i("tool-bar",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],ref:"tools"})]:e._e(),i("div",{attrs:{id:"layers"},on:{mousedown:e.mousedown,mouseup:e.mouseup,mousemove:e.mousemove,contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.contextmenu(t)},dragover:function(e){e.preventDefault()},drop:function(t){return t.preventDefault(),t.stopPropagation(),e.drop(t)}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showUI&&e.layers.length>1,expression:"showUI && layers.length > 1"}],attrs:{id:"layerselect"}},[i("ul",e._l(e.layers,(function(t){return i("li",{key:t.name,class:{"layer-selected":t===e.selectedLayer},on:{mousedown:function(i){return e.selectLayer(t)}}},[i("a",{attrs:{href:"#"}},[e._v(e._s(t))])])})),0)])],2),i("selection-info",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],ref:"selectionInfo"}),i("initiative-dialog",{ref:"initiative",attrs:{id:"initiativedialog"}}),i("note-dialog",{ref:"note"}),i("label-dialog",{ref:"labels"}),e.IS_DM||e.FAKE_PLAYER?i("dm-settings",{ref:"dmsettings"}):e._e(),i("zoom-slider",{directives:[{name:"show",rawName:"v-show",value:e.showUI,expression:"showUI"}],attrs:{id:"zoomer",height:6,width:200,min:0,max:1,interval:.1,"dot-size":[8,20],"dot-options":{style:{"border-radius":"15%","z-index":11}},"tooltip-placement":"bottom",tooltip:"focus","tooltip-formatter":e.zoomDisplay.toFixed(1),"rail-style":{"background-color":"#fff","box-shadow":"0.5px 0.5px 3px 1px rgba(0, 0, 0, .36)"},"process-style":{"background-color":"#fff"}},model:{value:e.zoomDisplay,callback:function(t){e.zoomDisplay=t},expression:"zoomDisplay"}}),i("prompt-dialog",{ref:"prompt"}),i("confirm-dialog",{ref:"confirm"})],1)},Ye=[],Ke=i("0f32"),qe=i.n(Ke),Qe=i("4971"),Ze=i.n(Qe),Je=(i("24df"),T()(location.protocol+"//"+location.host+"/planarally",{autoConnect:!1}));function et(e){Je.io.opts.query="user=".concat(decodeURIComponent(e.params.creator),"&room=").concat(decodeURIComponent(e.params.room)),Je.connect()}var tt=new n["default"];var it=function(){function e(t,i){Object(y["a"])(this,e),this.x=t,this.y=i}return Object(g["a"])(e,[{key:"add",value:function(e){return new this.constructor(this.x+e.x,this.y+e.y)}},{key:"subtract",value:function(e){return new ot(this.x-e.x,this.y-e.y)}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"get",value:function(e){return 0===e?this.x:this.y}},{key:"asArray",value:function(){return[this.x,this.y]}}],[{key:"fromArray",value:function(t){return new e(t[0],t[1])}}]),e}(),nt=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),Object(g["a"])(t,null,[{key:"fromArray",value:function(e){return new t(e[0],e[1])}}]),t}(it),at=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),t}(it),ot=function(){function e(t,i){Object(y["a"])(this,e),this.x=t,this.y=i}return Object(g["a"])(e,[{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"inverse",value:function(){return new e(0===this.x?0:1/this.x,0===this.y?0:1/this.y)}},{key:"squaredLength",value:function(){return Math.pow(this.x,2)+Math.pow(this.y,2)}},{key:"length",value:function(){return Math.sqrt(this.squaredLength())}},{key:"normalize",value:function(){var t=this.length();return new e(this.x/t,this.y/t)}},{key:"reverse",value:function(){return new e(-this.x,-this.y)}},{key:"multiply",value:function(t){return new e(this.x*t,this.y*t)}},{key:"angle",value:function(){return 180*Math.atan2(this.y,this.x)/Math.PI}}]),e}(),rt=function(){function e(t,i,n){Object(y["a"])(this,e),this.direction=i,this.origin=t,void 0===n&&(n=1/0),this.tMax=n}return Object(g["a"])(e,[{key:"get",value:function(e){return new it(this.origin.x+e*this.direction.x,this.origin.y+e*this.direction.y)}},{key:"getDistance",value:function(e,t){return Math.sqrt(Math.pow(t-e,2)*(Math.pow(this.direction.x,2)+Math.pow(this.direction.y,2)))}},{key:"getT",value:function(e,t){return e+Math.sqrt(Math.pow(t,2)/(Math.pow(this.direction.x,2)+Math.pow(this.direction.y,2)))}}],[{key:"fromPoints",value:function(t,i){var n,a=new ot(i.x-t.x,i.y-t.y);return n=Math.abs(a.x)>.01?(i.x-t.x)/a.x:(i.y-t.y)/a.y,new e(t,a,n)}}]),e}();i("4de4"),i("7db0"),i("6062");function st(e){Je.emit("Client.Options.Set",{locationOptions:e})}function lt(e){var t=_t.zoomFactor,i=_t.panX,n=_t.panY;return new at((e.x+i)*t,(e.y+n)*t)}function ct(e){return lt(new nt(e,0)).x}function ut(e){return lt(new nt(0,e)).y}function ht(e){return e*_t.zoomFactor}function dt(e){return e/_t.unitSize*_t.gridSize}function vt(e){return ht(dt(e))}function ft(e){var t=_t.zoomFactor,i=_t.panX,n=_t.panY;return e instanceof at?new nt(e.x/t-i,e.y/t-n):new rt(ft(e.origin),e.direction.multiply(1/t),e.tMax)}function pt(e){return ft(new at(e,0)).x}function yt(e){return ft(new at(0,e)).y}function gt(e){return e/_t.zoomFactor}window.g2lx=ct,window.g2ly=ut;var mt=i("66cb"),bt=i.n(mt);function wt(e){return new at(e.pageX,e.pageY)}function kt(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=bt()(_t.fowColour);return _t.IS_DM?t.setAlpha(e?1:_t.fowOpacity):t.setAlpha(1),t.toRgbString()}function Ot(e){return 1/(-5/3+28/15*Math.exp(1.83*e))}function xt(e){return Math.log(15/28*(1/e+5/3))/1.83}var St=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.layers=[],e.selectedLayerIndex=-1,e.boardInitialized=!1,e.locations=[],e.assets={},e.notes=[],e.IS_DM=!1,e.FAKE_PLAYER=!1,e.isLocked=!1,e.gridSize=50,e.username="",e.roomName="",e.roomCreator="",e.invitationCode="",e.players=[],e.gridColour="rgba(0, 0, 0, 1)",e.fowColour="rgba(0, 0, 0, 1)",e.rulerColour="rgba(255, 0, 0, 1)",e.panX=0,e.panY=0,e.zoomDisplay=.5,e.unitSize=5,e.unitSizeUnit="ft",e.useGrid=!0,e.fullFOW=!1,e.fowOpacity=.3,e.fowLOS=!1,e.locationName="",e.annotations=[],e.ownedtokens=[],e._activeTokens=[],e.drawTEContour=!1,e.visionRangeMin=1640,e.visionRangeMax=3281,e.clipboard=[],e.clipboardPosition=new nt(0,0),e.labels={},e.filterNoLabel=!1,e.labelFilters=[],e.showUI=!0,e.selectionHelperID=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"setSelectionHelperId",value:function(e){this.selectionHelperID=e}},{key:"setFakePlayer",value:function(e){this.FAKE_PLAYER=e,this.IS_DM=!e,jt.invalidate()}},{key:"setZoomDisplay",value:function(e){e!==this.zoomDisplay&&(e<0&&(e=0),e>1&&(e=1),this.zoomDisplay=e,jt.invalidate())}},{key:"setBoardInitialized",value:function(e){this.boardInitialized=e}},{key:"toggleUnlabeledFilter",value:function(){this.filterNoLabel=!this.filterNoLabel}},{key:"addLabel",value:function(e){n["default"].set(this.labels,e.uuid,e)}},{key:"setLabelFilters",value:function(e){this.labelFilters=e}},{key:"setLabelVisibility",value:function(e){e.uuid in this.labels&&(this.labels[e.uuid].visible=e.visible)}},{key:"deleteLabel",value:function(e){if(e.uuid in this.labels){var t=this.labels[e.uuid],i=new Set,a=!0,o=!1,r=void 0;try{for(var s,l=jt.UUIDMap.values()[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,u=c.labels.indexOf(t);u>=0&&(c.labels.splice(u,1),i.add(c.layer))}}catch(g){o=!0,r=g}finally{try{a||null==l.return||l.return()}finally{if(o)throw r}}var h=!0,d=!1,v=void 0;try{for(var f,p=i[Symbol.iterator]();!(h=(f=p.next()).done);h=!0){var y=f.value;jt.getLayer(y).invalidate(!1)}}catch(g){d=!0,v=g}finally{try{h||null==p.return||p.return()}finally{if(d)throw v}}n["default"].delete(this.labels,e.uuid)}}},{key:"setDM",value:function(e){this.IS_DM=e}},{key:"setUsername",value:function(e){this.username=e}},{key:"setRoomName",value:function(e){this.roomName=e}},{key:"setRoomCreator",value:function(e){this.roomCreator=e}},{key:"setInvitationCode",value:function(e){this.invitationCode=e}},{key:"addLayer",value:function(e){this.layers.push(e),-1===this.selectedLayerIndex&&(this.selectedLayerIndex=this.layers.indexOf(e))}},{key:"selectLayer",value:function(e){var t=this.layers.indexOf(e.name);t>=0&&(this.selectedLayerIndex=t),e.sync&&Je.emit("Client.ActiveLayer.Set",e.name)}},{key:"newNote",value:function(e){this.notes.push(e.note),e.sync&&Je.emit("Note.New",e.note)}},{key:"setAssets",value:function(e){this.assets=e}},{key:"setLocations",value:function(e){this.locations=e}},{key:"resetLayerInfo",value:function(){this.layers=[],this.selectedLayerIndex=-1}},{key:"updateZoom",value:function(e){if(e.newZoomDisplay!==this.zoomDisplay){e.newZoomDisplay<0&&(e.newZoomDisplay=0),e.newZoomDisplay>1&&(e.newZoomDisplay=1);var t=lt(e.zoomLocation);this.zoomDisplay=e.newZoomDisplay;var i=ft(t),n=i.subtract(e.zoomLocation);this.panX+=n.x,this.panY+=n.y,jt.invalidate(),st(_t.locationOptions)}}},{key:"setGridColour",value:function(e){this.gridColour=e.colour,jt.getGridLayer().drawGrid(),e.sync&&Je.emit("Client.Options.Set",{gridColour:e.colour})}},{key:"setFOWColour",value:function(e){this.fowColour=e.colour,jt.invalidate(),e.sync&&Je.emit("Client.Options.Set",{fowColour:e.colour})}},{key:"setRulerColour",value:function(e){this.rulerColour=e.colour,e.sync&&Je.emit("Client.Options.Set",{rulerColour:e.colour})}},{key:"setPanX",value:function(e){this.panX=e}},{key:"setPanY",value:function(e){this.panY=e}},{key:"increasePanX",value:function(e){this.panX+=e}},{key:"increasePanY",value:function(e){this.panY+=e}},{key:"setUnitSize",value:function(e){this.unitSize!==e.unitSize&&e.unitSize>0&&e.unitSize<1/0&&(this.unitSize=e.unitSize,jt.invalidate(),e.sync&&Je.emit("Location.Options.Set",{unit_size:e.unitSize}))}},{key:"setUnitSizeUnit",value:function(e){this.unitSizeUnit!==e.unitSizeUnit&&(this.unitSizeUnit=e.unitSizeUnit,jt.invalidate(),e.sync&&Je.emit("Location.Options.Set",{unit_size_unit:e.unitSizeUnit}))}},{key:"setUseGrid",value:function(e){if(this.useGrid!==e.useGrid){this.useGrid=e.useGrid;var t=jt.getGridLayer();e.useGrid?t.canvas.style.display="block":t.canvas.style.display="none",e.sync&&Je.emit("Location.Options.Set",{use_grid:e.useGrid})}}},{key:"setGridSize",value:function(e){if(this.gridSize!==e.gridSize&&e.gridSize>0){this.gridSize=e.gridSize;var t=jt.getGridLayer();void 0!==t&&t.drawGrid(),e.sync&&Je.emit("Gridsize.Set",e.gridSize)}}},{key:"setVisionRangeMin",value:function(e){this.visionRangeMin=e.value,jt.invalidateLight(),e.sync&&Je.emit("Location.Options.Set",{vision_min_range:e.value})}},{key:"setVisionRangeMax",value:function(e){this.visionRangeMax=Math.max(e.value,this.visionRangeMin),jt.invalidateLight(),e.sync&&Je.emit("Location.Options.Set",{vision_max_range:this.visionRangeMax})}},{key:"setFullFOW",value:function(e){this.fullFOW!==e.fullFOW&&(this.fullFOW=e.fullFOW,jt.invalidateLight(),e.sync&&Je.emit("Location.Options.Set",{full_fow:e.fullFOW}))}},{key:"setFOWOpacity",value:function(e){this.fowOpacity=e.fowOpacity,jt.invalidateLight(),e.sync&&Je.emit("Location.Options.Set",{fow_opacity:e.fowOpacity})}},{key:"setLineOfSight",value:function(e){this.fowLOS!==e.fowLOS&&(this.fowLOS=e.fowLOS,jt.invalidate(),e.sync&&Je.emit("Location.Options.Set",{fow_los:e.fowLOS}))}},{key:"setLocationName",value:function(e){this.locationName=e}},{key:"updateNote",value:function(e){var t=this.notes.find((function(t){return t.uuid===e.note.uuid}));void 0!==t&&(t.title=e.note.title,t.text=e.note.text,e.sync&&Je.emit("Note.Update",t))}},{key:"removeNote",value:function(e){this.notes=this.notes.filter((function(t){return t.uuid!==e.note.uuid})),e.sync&&Je.emit("Note.Remove",e.note.uuid)}},{key:"toggleUI",value:function(){this.showUI=!this.showUI}},{key:"setClipboard",value:function(e){this.clipboard=e}},{key:"setClipboardPosition",value:function(e){this.clipboardPosition=e}},{key:"setActiveTokens",value:function(e){this._activeTokens=e,jt.invalidateLight()}},{key:"addActiveToken",value:function(e){this._activeTokens.push(e),jt.invalidateLight()}},{key:"removeActiveToken",value:function(e){0===this._activeTokens.length&&(this._activeTokens=Object(p["a"])(this.ownedtokens)),this._activeTokens.splice(this._activeTokens.indexOf(e),1),jt.invalidateLight()}},{key:"setPlayers",value:function(e){this.players=e}},{key:"addPlayer",value:function(e){this.players.push(e)}},{key:"kickPlayer",value:function(e){this.players=this.players.filter((function(t){return t.id!==e}))}},{key:"setIsLocked",value:function(e){this.isLocked=e.isLocked,e.sync&&Je.emit("Room.Info.Set.Locked",this.isLocked)}},{key:"clear",value:function(){this.ownedtokens=[],this.annotations=[],this.notes=[]}},{key:"selectedLayer",get:function(){return this.layers[this.selectedLayerIndex]}},{key:"zoomFactor",get:function(){return Ot(this.zoomDisplay)}},{key:"locationOptions",get:function(){return{panX:_t.panX,panY:_t.panY,zoomFactor:_t.zoomFactor}}},{key:"activeTokens",get:function(){return 0===this._activeTokens.length?this.ownedtokens:this._activeTokens}},{key:"screenTopLeft",get:function(){return new nt(-this.panX,-this.panY)}},{key:"screenCenter",get:function(){var e=new ot(window.innerWidth/2,window.innerHeight/2);return ft(lt(this.screenTopLeft).add(e))}}]),t}(A["d"]);Object(k["a"])([A["c"]],St.prototype,"setSelectionHelperId",null),Object(k["a"])([A["c"]],St.prototype,"setFakePlayer",null),Object(k["a"])([A["c"]],St.prototype,"setZoomDisplay",null),Object(k["a"])([A["c"]],St.prototype,"setBoardInitialized",null),Object(k["a"])([A["c"]],St.prototype,"toggleUnlabeledFilter",null),Object(k["a"])([A["c"]],St.prototype,"addLabel",null),Object(k["a"])([A["c"]],St.prototype,"setLabelFilters",null),Object(k["a"])([A["c"]],St.prototype,"setLabelVisibility",null),Object(k["a"])([A["c"]],St.prototype,"deleteLabel",null),Object(k["a"])([A["c"]],St.prototype,"setDM",null),Object(k["a"])([A["c"]],St.prototype,"setUsername",null),Object(k["a"])([A["c"]],St.prototype,"setRoomName",null),Object(k["a"])([A["c"]],St.prototype,"setRoomCreator",null),Object(k["a"])([A["c"]],St.prototype,"setInvitationCode",null),Object(k["a"])([A["c"]],St.prototype,"addLayer",null),Object(k["a"])([A["c"]],St.prototype,"selectLayer",null),Object(k["a"])([A["c"]],St.prototype,"newNote",null),Object(k["a"])([A["c"]],St.prototype,"setAssets",null),Object(k["a"])([A["c"]],St.prototype,"setLocations",null),Object(k["a"])([A["c"]],St.prototype,"resetLayerInfo",null),Object(k["a"])([A["c"]],St.prototype,"updateZoom",null),Object(k["a"])([A["c"]],St.prototype,"setGridColour",null),Object(k["a"])([A["c"]],St.prototype,"setFOWColour",null),Object(k["a"])([A["c"]],St.prototype,"setRulerColour",null),Object(k["a"])([A["c"]],St.prototype,"setPanX",null),Object(k["a"])([A["c"]],St.prototype,"setPanY",null),Object(k["a"])([A["c"]],St.prototype,"increasePanX",null),Object(k["a"])([A["c"]],St.prototype,"increasePanY",null),Object(k["a"])([A["c"]],St.prototype,"setUnitSize",null),Object(k["a"])([A["c"]],St.prototype,"setUnitSizeUnit",null),Object(k["a"])([A["c"]],St.prototype,"setUseGrid",null),Object(k["a"])([A["c"]],St.prototype,"setGridSize",null),Object(k["a"])([A["c"]],St.prototype,"setVisionRangeMin",null),Object(k["a"])([A["c"]],St.prototype,"setVisionRangeMax",null),Object(k["a"])([A["c"]],St.prototype,"setFullFOW",null),Object(k["a"])([A["c"]],St.prototype,"setFOWOpacity",null),Object(k["a"])([A["c"]],St.prototype,"setLineOfSight",null),Object(k["a"])([A["c"]],St.prototype,"setLocationName",null),Object(k["a"])([A["c"]],St.prototype,"updateNote",null),Object(k["a"])([A["c"]],St.prototype,"removeNote",null),Object(k["a"])([A["c"]],St.prototype,"toggleUI",null),Object(k["a"])([A["c"]],St.prototype,"setClipboard",null),Object(k["a"])([A["c"]],St.prototype,"setClipboardPosition",null),Object(k["a"])([A["c"]],St.prototype,"setActiveTokens",null),Object(k["a"])([A["c"]],St.prototype,"addActiveToken",null),Object(k["a"])([A["c"]],St.prototype,"removeActiveToken",null),Object(k["a"])([A["c"]],St.prototype,"setPlayers",null),Object(k["a"])([A["c"]],St.prototype,"addPlayer",null),Object(k["a"])([A["c"]],St.prototype,"kickPlayer",null),Object(k["a"])([A["c"]],St.prototype,"setIsLocked",null),Object(k["a"])([A["c"]],St.prototype,"clear",null),St=Object(k["a"])([Object(A["b"])({dynamic:!0,store:R,name:"game",namespaced:!0})],St);var _t=Object(A["e"])(St),Ct=function(){function e(){var t=this;Object(y["a"])(this,e),this.layers=[],this.width=window.innerWidth,this.height=window.innerHeight,this.UUIDMap=new Map,this.interval=30,this.drawLoop=function(){for(var e=t.layers.length-1;e>=0;e--)t.layers[e].draw();requestAnimationFrame(t.drawLoop)},requestAnimationFrame(this.drawLoop)}return Object(g["a"])(e,[{key:"reset",value:function(){this.layers=[],this.UUIDMap=new Map}},{key:"setWidth",value:function(e){this.width=e;var t=!0,i=!1,n=void 0;try{for(var a,o=this.layers[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var r=a.value;r.canvas.width=e,r.width=e}}catch(s){i=!0,n=s}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"setHeight",value:function(e){this.height=e;var t=!0,i=!1,n=void 0;try{for(var a,o=this.layers[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var r=a.value;r.canvas.height=e,r.height=e}}catch(s){i=!0,n=s}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"addLayer",value:function(e){this.layers.push(e),(_t.IS_DM||e.playerEditable)&&e.selectable&&_t.addLayer(e.name)}},{key:"hasLayer",value:function(e){return this.layers.some((function(t){return t.name===e}))}},{key:"getLayer",value:function(e){e=void 0===e?_t.selectedLayer:e;var t=!0,i=!1,n=void 0;try{for(var a,o=this.layers[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var r=a.value;if(r.name===e)return r}}catch(s){i=!0,n=s}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"selectLayer",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!1,n=!0,a=!1,o=void 0;try{for(var r,s=this.layers[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value;l.selectable&&(i&&"fow"!==l.name?l.ctx.globalAlpha=.3:l.ctx.globalAlpha=1,e===l.name&&(_t.selectLayer({name:e,sync:t}),i=!0),l.clearSelection(),l.invalidate(!0))}}catch(c){a=!0,o=c}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}}},{key:"getGridLayer",value:function(){return this.getLayer("grid")}},{key:"hasSelection",value:function(){var e=this.getSelection();return void 0!==e&&e.length>0}},{key:"getSelection",value:function(){var e=this.getLayer();if(void 0!==e)return e.selection}},{key:"invalidate",value:function(){for(var e=this.layers.length-1;e>=0;e--)this.layers[e].invalidate(!0)}},{key:"invalidateLight",value:function(){for(var e=this.layers.length-1;e>=0;e--)this.layers[e].isVisionLayer&&this.layers[e].invalidate(!0)}}]),e}(),jt=new Ct;window.lm=jt;i("2b3d"),i("cb29"),i("c740"),i("d81d");var Lt,Et=i("e587"),It=i("902f"),Pt=(i("2ca0"),function(){function e(t,i,n){Object(y["a"])(this,e),this.w=i,this.h=n,this.topLeft=t,this.topRight=new nt(t.x+i,t.y),this.botRight=new nt(t.x+i,t.y+n),this.botLeft=new nt(t.x,t.y+n)}return Object(g["a"])(e,[{key:"contains",value:function(e){return this.topLeft.x<=e.x&&this.topRight.x>=e.x&&this.topLeft.y<=e.y&&this.botLeft.y>=e.y}},{key:"offset",value:function(t){return new e(this.topLeft.add(t),this.w,this.h)}},{key:"union",value:function(t){var i=Math.min(this.topLeft.x,t.topLeft.x),n=Math.max(this.topRight.x,t.topRight.x),a=Math.min(this.topLeft.y,t.topLeft.y),o=Math.max(this.botLeft.y,t.botLeft.y);return new e(new nt(i,a),n-i,o-a)}},{key:"getDiagCorner",value:function(e){return e?this.botRight:this.topLeft}},{key:"intersectsWith",value:function(e){return!(e.topLeft.x>this.topRight.x||e.topRight.x<this.topLeft.x||e.topLeft.y>this.botLeft.y||e.botLeft.y<this.topLeft.y)}},{key:"intersectsWithInner",value:function(e){return!(e.topLeft.x>=this.topRight.x||e.topRight.x<=this.topLeft.x||e.topLeft.y>=this.botLeft.y||e.botLeft.y<=this.topLeft.y)}},{key:"intersectP",value:function(e,t,i){var n=t.x*(this.getDiagCorner(i[0]).x-e.origin.x),a=t.x*(this.getDiagCorner(!i[0]).x-e.origin.x),o=t.y*(this.getDiagCorner(i[1]).y-e.origin.y),r=t.y*(this.getDiagCorner(!i[1]).y-e.origin.y);return n>r||o>a?{hit:!1,min:n,max:a}:(o>n&&(n=o),r<a&&(a=r),{hit:n<e.tMax&&a>0,min:n,max:a})}},{key:"center",value:function(){return this.topLeft.add(new ot(this.w/2,this.h/2))}},{key:"getMaxExtent",value:function(){return this.w>this.h?0:1}},{key:"visibleInCanvas",value:function(e){var t=!(ct(this.topLeft.x)>e.width||ut(this.topLeft.y)>e.height||ct(this.topRight.x)<0||ut(this.botRight.y)<0);return!!t}},{key:"points",get:function(){return 0===this.w||0===this.h?[[this.topLeft.x,this.topLeft.y]]:[[this.topLeft.x,this.topLeft.y],[this.botLeft.x,this.botLeft.y],[this.botRight.x,this.botRight.y],[this.topRight.x,this.topRight.y]]}}]),e}()),Mt=(i("dca8"),function(e){var t=[],i=!0,n=!1,a=void 0;try{for(var o,r=e[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var s=o.value;t.push({uuid:s.uuid,visionSource:s.vision_source,visible:s.visible,name:s.name,value:s.value,dim:s.dim,colour:s.colour})}}catch(l){n=!0,a=l}finally{try{i||null==r.return||r.return()}finally{if(n)throw a}}return t}),Tt=function(e){var t=[],i=!0,n=!1,a=void 0;try{for(var o,r=e[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var s=o.value;t.push({uuid:s.uuid,vision_source:s.visionSource,visible:s.visible,name:s.name,value:s.value,dim:s.dim,colour:s.colour})}}catch(l){n=!0,a=l}finally{try{i||null==r.return||r.return()}finally{if(n)throw a}}return t},At=function e(t,i){Object(y["a"])(this,e),this.children=[],this.nPrimitives=t,this.bbox=i},Dt=function(e){function t(e,i,n){var a;return Object(y["a"])(this,t),a=Object(m["a"])(this,Object(b["a"])(t).call(this,i,n)),a.firstPrimOffset=e,a}return Object(w["a"])(t,e),t}(At),Rt=function(e){function t(e,i,n){var a;return Object(y["a"])(this,t),a=Object(m["a"])(this,Object(b["a"])(t).call(this,0,i.bbox.union(n.bbox))),a.dimension=e,a.children.push(i),a.children.push(n),a}return Object(w["a"])(t,e),t}(At),Nt=function(){function e(t){if(Object(y["a"])(this,e),this.totalNodes=0,this.buildData=[],this.orderedPrims=[],this.nodes=[],this.offset=0,this.shapes=t,0===this.shapes.length)return this.root=null,void(this.nodes=[]);for(var i=0;i<t.length;i++){var n=jt.UUIDMap.get(t[i]);this.buildData.push({index:i,bbox:n.getBoundingBox(),center:new Pt(n.center(),0,0)})}this.root=this.recursiveBuild(0,t.length),this.compact()}return Object(g["a"])(e,[{key:"draw",value:function(){var e=jt.getLayer("draw").ctx,t=!0,i=!1,n=void 0;try{for(var a,o=this.nodes[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var r=a.value,s=r.bbox;e.strokeRect(ct(s.topLeft.x),ut(s.topLeft.y),ht(s.w),ht(s.h))}}catch(l){i=!0,n=l}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"recursiveBuild",value:function(e,t){this.totalNodes++;for(var i=this.buildData[e].bbox,n=e+1;n<t;n++)i=i.union(this.buildData[n].bbox);var a=t-e;if(1===a)return this.createLeaf(e,t,a,i);for(var o,r=this.buildData[e].center,s=e;s<t;s++)r=r.union(this.buildData[s].center);var l=r.getMaxExtent();if(r.botRight.get(l)===r.topLeft.get(l))return this.createLeaf(e,t,a,i);var c=.5*(r.topLeft.get(l)+r.botRight.get(l)),u=pe(this.buildData.slice(e,t),(function(e){return e.center.center().get(l)<c})),h=[].concat.apply([],u);0!==u[0].length&&0!==u[1].length||console.log("EMPTY"),(o=this.buildData).splice.apply(o,[e,h.length].concat(Object(p["a"])(h)));var d=u[0].length+e;return new Rt(l,this.recursiveBuild(e,d),this.recursiveBuild(d,t))}},{key:"intersect",value:function(e,t){if(0===this.nodes.length)return{hit:!1,intersect:e.get(0),tMin:0,tMax:e.tMax};void 0===t&&(t=!1);var i=!1,n=0,a=e.tMax,o=0,r=0,s=[],l=e.direction.inverse(),c=[l.x<0,l.y<0];while(1){var u=this.nodes[r],h=u.bbox.intersectP(e,l,c);if(h.hit)if(u.nPrimitives>0){if(i=!0,n=e.tMax=h.min,a=h.max,0===o||t)break;r=s[--o]}else c[u.dimension]?(s[o++]=r+1,r=u.secondChildOffset):(s[o++]=u.secondChildOffset,r++);else{if(0===o)break;r=s[--o]}}return{hit:i,intersect:e.get(n),tMin:n,tMax:a}}},{key:"compact",value:function(){this.offset=0,null!==this.root&&this.flatten(this.root)}},{key:"flatten",value:function(e){var t=this.offset,i=this.offset++;if(0===e.nPrimitives){this.flatten(e.children[0]);var n=this.flatten(e.children[1]),a={bbox:e.bbox,dimension:e.dimension,nPrimitives:0,secondChildOffset:n};this.nodes[t]=a}else{var o={bbox:e.bbox,primitivesOffset:e.firstPrimOffset,nPrimitives:e.nPrimitives};this.nodes[t]=o}return i}},{key:"createLeaf",value:function(e,t,i,n){for(var a=this.orderedPrims.length,o=e;o<t;o++)this.orderedPrims.push(this.shapes[this.buildData[o].index]);return new Dt(a,i,n)}}]),e}();i("26e9"),i("4e82"),i("35b3");function Ut(e){return(e+2)%3}function zt(e){return(e+1)%3}function $t(e,t){var i=new yi(e,null);if(i.valid)do{var n=3-i.t.indexV(e)-i.ri,a=i.t.vertices[n];if(!a.infinite){if(a===t)return{includes:!0,vi:t,fr:i.t,i:i.ri};var o=Ht(e.point,t.point,a.point);if(o===ci.COLLINEAR&&Ft(e.point,a.point,t.point))return{includes:!0,vi:a,fr:i.t,i:i.ri}}}while(i.next());return{includes:!1}}function Ft(e,t,i){var n,a;return Vt(0,e,i)===ci.EQUAL?(n=Vt(1,e,t),a=Vt(1,t,i)):(n=Vt(0,e,t),a=Vt(0,t,i)),n===ci.SMALLER&&a===ci.SMALLER||n===ci.LARGER&&a===ci.LARGER}function Vt(e,t,i){return t[e]<i[e]?ci.SMALLER:t[e]>i[e]?ci.LARGER:ci.EQUAL}function Ht(e,t,i){var n=e[0],a=e[1],o=t[0],r=t[1],s=i[0],l=i[1],c=o-n,u=r-a,h=s-n,d=l-a,v=Bt(c,u,h,d),f=Math.abs(c),p=Math.abs(u),y=Math.abs(h),g=Math.abs(d);if(f<y&&(f=y),p<g&&(p=g),f>p){var m=[p,f];f=m[0],p=m[1]}if(f<2e-162&&0===f)return ci.ZERO;if(p<1e153){var b=Number.EPSILON*f*p;if(v>b)return ci.POSITIVE;if(v<-b)return ci.NEGATIVE}return ci.ZERO}function Bt(e,t,i,n){return e*n-t*i}function Gt(e,t,i){return Bt(t[0]-e[0],t[1]-e[1],i[0]-e[0],i[1]-e[1])<0}function Wt(e,t,i){if(!e.isInfinite())return Xt(e.vertices[0].point,e.vertices[1].point,e.vertices[2].point,t,i);throw new Error("SSS")}function Xt(e,t,i,n,a){var o=Qt(e,t,i,n);if(o!==ci.ON_ORIENTED_BOUNDARY||!a)return o;var r=[e,t,i,n];r.sort((function(e,t){return e[0]-t[0]||e[1]-t[1]}));var s=!0,l=!1,c=void 0;try{for(var u,h=r.reverse()[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=u.value;if(d===n)return ci.ON_NEGATIVE_SIDE;var v=Ht(e,t,n);if(d===i&&v!==ci.COLLINEAR)return v;if(v=Ht(e,n,i),d===t&&v!==ci.COLLINEAR)return v;if(v=Ht(n,t,i),d===e&&v!==ci.COLLINEAR)return v}}catch(f){l=!0,c=f}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}return ci.ON_NEGATIVE_SIDE}function Yt(e,t){return e[0]===t[0]&&e[1]===t[1]}function Kt(e,t){return e[0]<t[0]||e[0]===t[0]&&e[1]<t[1]}function qt(e,t){return Kt(e,t)?ci.SMALLER:Yt(e,t)?ci.EQUAL:ci.LARGER}function Qt(e,t,i,n){var a=t[0]-e[0],o=t[1]-e[1],r=i[0]-e[0],s=i[1]-e[1],l=n[0]-e[0],c=n[1]-e[1],u=n[0]-t[0],h=n[1]-t[1],d=i[0]-t[0],v=i[1]-t[1],f=Bt(a*c-o*l,l*u+c*h,a*s-o*r,r*d+s*v),p=Math.abs(a),y=Math.abs(o),g=Math.abs(r),m=Math.abs(s),b=Math.abs(u),w=Math.abs(h),k=Math.abs(l),O=Math.abs(c),x=Math.abs(d),S=Math.abs(v);if(p<g&&(p=g),p<k&&(p=k),p<b&&(p=b),p<x&&(p=x),y<m&&(y=m),y<O&&(y=O),y<w&&(y=w),y<S&&(y=S),p>y){var _=[y,p];p=_[0],y=_[1]}if(p<1e-73&&0===p)return ci.ON_ORIENTED_BOUNDARY;if(y<1e76){var C=Number.EPSILON*p*y*(y*y);if(f>C)return ci.ON_POSITIVE_SIDE;if(f<-C)return ci.ON_NEGATIVE_SIDE}return ci.ZERO}function Zt(e,t,i,n){switch(Ht(e,t,i)){case ci.LEFT_TURN:return Ht(i,n,t)!==ci.RIGHT_TURN;case ci.RIGHT_TURN:return Ht(i,n,t)!==ci.LEFT_TURN;case ci.COLLINEAR:return!0}}function Jt(e,t,i,n){switch(Ht(e,t,i)){case ci.LEFT_TURN:return Ht(e,t,n)!==ci.LEFT_TURN;case ci.RIGHT_TURN:return Ht(e,t,n)!==ci.RIGHT_TURN;case ci.COLLINEAR:return!0}}function ei(e,t,i,n){var a=ii(e,t,i,n);switch(a.intersectionType){case Lt.POINT:return a.point;case Lt.NO_INTERSECTION:return null}throw new Error("sdfgighowen")}function ti(e,t){if(e[0]===t[0])return[1,0,-e[0]];if(e[1]===t[1])return[0,1,-e[1]];var i=t[0]-e[0],n=t[1]-e[1];return[-n,i,-i*e[1]+n*e[0]]}function ii(e,t,i,n){if(!ai(e,t,i,n))return{intersectionType:Lt.NO_INTERSECTION,point:null};var a=ti(e,t),o=ti(i,n),r=ni(a,o);switch(r.intersectionType){case Lt.POINT:return r}throw new Error("gzseuihgpib")}function ni(e,t){var i=e[0]*t[1]-t[0]*e[1],n=e[1]*t[2]-t[1]*e[2],a=t[0]*e[2]-e[0]*t[2];return{intersectionType:Lt.POINT,point:[n/i,a/i]}}function ai(e,t,i,n){if(Kt(e,t)){if(Kt(i,n)){if(Kt(t,i)||Kt(n,e))return!1}else if(Kt(t,n)||Kt(i,e))return!1}else if(Kt(i,n)){if(Kt(e,i)||Kt(n,t))return!1}else if(Kt(e,n)||Kt(i,t))return!1;if(Kt(e,t))if(Kt(i,n))switch(qt(e,i)){case ci.SMALLER:switch(qt(t,i)){case ci.SMALLER:return!1;case ci.EQUAL:return!0;default:switch(qt(t,n)){case ci.SMALLER:return Zt(e,t,i,n);case ci.EQUAL:return!0;default:return Jt(e,t,i,n)}}case ci.EQUAL:return!0;default:switch(qt(n,e)){case ci.SMALLER:return!1;case ci.EQUAL:return!0;default:switch(qt(n,t)){case ci.SMALLER:return Zt(i,n,e,t);case ci.EQUAL:return!0;default:return Jt(i,n,e,t)}}}else switch(qt(e,n)){case ci.SMALLER:switch(qt(t,n)){case ci.SMALLER:return!1;case ci.EQUAL:return!0;default:switch(qt(t,i)){case ci.SMALLER:return Zt(e,t,n,i);case ci.EQUAL:return!0;default:return Jt(e,t,n,i)}}case ci.EQUAL:return!0;default:switch(qt(i,e)){case ci.SMALLER:return!1;case ci.EQUAL:return!0;default:switch(qt(i,t)){case ci.SMALLER:return Zt(n,i,e,t);case ci.EQUAL:return!0;default:return Jt(n,i,e,t)}}}else if(Kt(i,n))switch(qt(t,i)){case ci.SMALLER:switch(qt(e,i)){case ci.SMALLER:return!1;case ci.EQUAL:return!0;default:switch(qt(e,n)){case ci.SMALLER:return Zt(t,e,i,n);case ci.EQUAL:return!0;default:return Jt(t,e,i,n)}}case ci.EQUAL:return!0;default:switch(qt(n,t)){case ci.SMALLER:return!1;case ci.EQUAL:return!0;default:switch(qt(n,e)){case ci.SMALLER:return Zt(i,n,t,e);case ci.EQUAL:return!0;default:return Jt(i,n,t,e)}}}else switch(qt(t,n)){case ci.SMALLER:switch(qt(e,n)){case ci.SMALLER:return!1;case ci.EQUAL:return!0;default:switch(qt(e,i)){case ci.SMALLER:return Zt(t,e,n,i);case ci.EQUAL:return!0;default:return Jt(t,e,n,i)}}case ci.EQUAL:return!0;default:switch(qt(i,t)){case ci.SMALLER:return!1;case ci.EQUAL:return!0;default:switch(qt(i,e)){case ci.SMALLER:return Zt(n,i,t,e);case ci.EQUAL:return!0;default:return Jt(n,i,t,e)}}}}function oi(e){if(e!==e)return e;if(e===-1/0)return-Number.MAX_VALUE;if(e===1/0)return 1/0;if(e===+Number.MAX_VALUE)return 1/0;var t=e*(e<0?1-Number.EPSILON/2:1+Number.EPSILON);t===e&&(t=Number.MIN_VALUE*Number.EPSILON>0?e+Number.MIN_VALUE*Number.EPSILON:e+Number.MIN_VALUE),t===1/0&&(t=+Number.MAX_VALUE);var i=e+(t-e)/2;e<i&&i<t&&(t=i);var n=(t+e)/2;return e<n&&n<t&&(t=n),0===t?-0:t}function ri(e){return e<0?oi(e)-e:e+oi(-e)}function si(e,t,i,n){var a=rt.fromPoints(i,n),o=rt.fromPoints(e,i),r=a.direction.dot(a.direction),s=2*o.direction.dot(a.direction),l=o.direction.dot(o.direction)-Math.pow(t,2),c=Math.pow(s,2)-4*r*l;if(c<0)return[];var u=[];c=Math.sqrt(c);var h=(-s-c)/(2*r),d=(-s+c)/(2*r);return h>=0&&h<=1&&u.push(a.get(h)),d>=0&&d<=1&&u.push(a.get(d)),u}(function(e){e[e["NO_INTERSECTION"]=0]="NO_INTERSECTION",e[e["POINT"]=1]="POINT",e[e["SEGMENT"]=2]="SEGMENT"})(Lt||(Lt={}));var li,ci,ui,hi=-Infinity;function di(){return[hi,hi]}(function(e){e[e["NEGATIVE"]=-1]="NEGATIVE",e[e["ZERO"]=0]="ZERO",e[e["POSITIVE"]=1]="POSITIVE",e[e["RIGHT_TURN"]=-1]="RIGHT_TURN",e[e["LEFT_TURN"]=1]="LEFT_TURN",e[e["SMALLER"]=-1]="SMALLER",e[e["EQUAL"]=0]="EQUAL",e[e["LARGER"]=1]="LARGER",e[e["CLOCKWISE"]=-1]="CLOCKWISE",e[e["COUNTERCLOCKWISE"]=1]="COUNTERCLOCKWISE",e[e["COLLINEAR"]=0]="COLLINEAR",e[e["COPLANAR"]=0]="COPLANAR",e[e["DEGENERATE"]=0]="DEGENERATE",e[e["ON_NEGATIVE_SIDE"]=-1]="ON_NEGATIVE_SIDE",e[e["ON_ORIENTED_BOUNDARY"]=0]="ON_ORIENTED_BOUNDARY",e[e["ON_POSITIVE_SIDE"]=1]="ON_POSITIVE_SIDE"})(ci||(ci={})),function(e){e[e["UNDEFINED"]=-1]="UNDEFINED",e[e["VERTEX_VERTEX"]=0]="VERTEX_VERTEX",e[e["VERTEX_EDGE"]=1]="VERTEX_EDGE",e[e["EDGE_VERTEX"]=2]="EDGE_VERTEX",e[e["EDGE_EDGE"]=3]="EDGE_EDGE"}(ui||(ui={}));var vi=function(){function e(){Object(y["a"])(this,e),this.vertices=[],this.neighbours=[null,null,null],this.constraints=[!1,!1,!1],this.uid=e._counter++;for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];this.vertices=i}return Object(g["a"])(e,[{key:"from",value:function(e){return this.vertices=e.vertices.slice(0,e.vertices.length),this.neighbours=e.neighbours.slice(0,e.neighbours.length),this.constraints=e.constraints.slice(0,e.constraints.length),this}},{key:"addVertex",value:function(e){void 0===e&&console.log("UNDEFINED HIERE"),this.vertices.push(e),e.triangle=this}},{key:"isConstrained",value:function(e){return this.constraints[e]}},{key:"reorient",value:function(){this.vertices=[this.vertices[1],this.vertices[0],this.vertices[2]].slice(0,this.vertices.length),this.neighbours=[this.neighbours[1],this.neighbours[0],this.neighbours[2]],this.constraints=[this.constraints[1],this.constraints[0],this.constraints[2]]}},{key:"indexV",value:function(e){return this.vertices.indexOf(e)}},{key:"indexT",value:function(e){return this.neighbours.indexOf(e)}},{key:"isInfinite",value:function(e){return void 0===e?this.vertices.includes(li):this.vertices[zt(e)].infinite||this.vertices[Ut(e)].infinite}},{key:"contains",value:function(e){var t=-this.vertices[1].point[1]*this.vertices[2].point[0]+this.vertices[0].point[1]*(-this.vertices[1].point[0]+this.vertices[2].point[0])+this.vertices[0].point[0]*(this.vertices[1].point[1]-this.vertices[2].point[1])+this.vertices[1].point[0]*this.vertices[2].point[1],i=t<0?-1:1,n=(this.vertices[0].point[1]*this.vertices[2].point[0]-this.vertices[0].point[0]*this.vertices[2].point[1]+(this.vertices[2].point[1]-this.vertices[0].point[1])*e[0]+(this.vertices[0].point[0]-this.vertices[2].point[0])*e[1])*i;if(n<0)return!1;var a=(this.vertices[0].point[0]*this.vertices[1].point[1]-this.vertices[0].point[1]*this.vertices[1].point[0]+(this.vertices[0].point[1]-this.vertices[1].point[1])*e[0]+(this.vertices[1].point[0]-this.vertices[0].point[0])*e[1])*i;return a>0&&n+a<t*i}},{key:"dimension",get:function(){return this.vertices.length-1}}]),e}();vi._counter=0;var fi,pi=function(){function e(t){Object(y["a"])(this,e),this.infinite=!1,this._point=t}return Object(g["a"])(e,[{key:"point",get:function(){return this._point},set:function(e){this._point=e,this.infinite=!1}}]),e}(),yi=function(){function e(t,i){if(Object(y["a"])(this,e),this.v=t,this.t=i,null===t?this.t=null:null===i&&(this.t=t.triangle),null==this.t||this.t.dimension<1)this.ri=0,this.v=null,this.t=null;else{var n=this.t.indexV(t);2===this.t.dimension?this.ri=zt(n):this.ri=2}this._ri=this.ri,this._v=this.v,this._t=this.t}return Object(g["a"])(e,[{key:"next",value:function(){var e=this.t.indexV(this.v);return 1===this.t.dimension?this.t=this.t.neighbours[0===e?1:0]:(this.t=this.t.neighbours[zt(e)],e=this.t.indexV(this.v),this.ri=zt(e)),this.ri!==this._ri||this.v!==this._v||this.t!==this._t}},{key:"valid",get:function(){return null!==this.t&&null!==this.v}}]),e}(),gi=function(){function e(t){if(Object(y["a"])(this,e),this.i=0,this.edge=new wi,this._es=0,this.tds=t,this.edge.second=0,t.dimension<=0)this.pos=null;else{this.pos=t.triangles[0],1===t.dimension&&(this.edge.second=2);while(null!==this.pos&&!this.associatedEdge())throw new Error("[poi");1===t.dimension&&(this._es=2)}}return Object(g["a"])(e,[{key:"next",value:function(){do{this.increment()}while(null!==this.pos&&!this.associatedEdge())}},{key:"collect",value:function(){return this.edge.first=this.pos,this.edge}},{key:"associatedEdge",value:function(){return 1===this.tds.dimension||this.tds.triangles.indexOf(this.pos)<this.tds.triangles.indexOf(this.pos.neighbours[this.edge.second])}},{key:"increment",value:function(){1===this.tds.dimension?(this.i++,this.tds.triangles.length<=this.i?this.pos=null:this.pos=this.tds.triangles[this.i]):2===this.edge.second?(this.edge.second=0,this.i++,this.tds.triangles.length<=this.i?this.pos=null:this.pos=this.tds.triangles[this.i]):this.edge.second++}},{key:"valid",get:function(){return(null!==this.pos||this._es!==this.edge.second)&&this.pos.isInfinite(this.edge.second)}}]),e}(),mi=function(){function e(t,i){Object(y["a"])(this,e),this.v=t,this.t=i,null===t?this.t=null:null===i&&(this.t=t.triangle),(null==this.t||this.t.dimension<2)&&(this.v=null,this.t=null),this._v=this.v,this._t=this.t}return Object(g["a"])(e,[{key:"prev",value:function(){var e=this.t.indexV(this.v);this.t=this.t.neighbours[Ut(e)]}},{key:"next",value:function(){var e=this.t.indexV(this.v);return this.t=this.t.neighbours[zt(e)],this.v!==this._v||this.t!==this._t}},{key:"valid",get:function(){return null!==this.t&&null!==this.v}}]),e}(),bi=function(){function e(t,i,n){Object(y["a"])(this,e),this.i=0,this.pos=null,this.s=ui.UNDEFINED,this._tr=i,this.p=t.point,this.q=n;var a=new mi(t,null),o=a.t.indexV(t),r=a.t.vertices[Ut(o)];while(t===li||Ht(this.p,this.q,r.point)!==ci.LEFT_TURN)if(a.next(),o=a.t.indexV(t),r=a.t.vertices[Ut(o)],!a.valid)return;var s=a.t.vertices[zt(o)],l=ci.RIGHT_TURN;while(s!==li&&(l=Ht(this.p,this.q,s.point))===ci.LEFT_TURN)a.prev(),o=a.t.indexV(t),s=a.t.vertices[zt(o)];if(o=a.t.indexV(t),r=a.t.vertices[Ut(o)],s===li)switch(a.prev(),o=a.t.indexV(t),s=a.t.vertices[zt(o)],l=Ht(this.p,this.q,s.point),l){case ci.RIGHT_TURN:case ci.COLLINEAR:a.next(),o=a.t.indexV(li),this.pos=a.t,this.s=ui.VERTEX_VERTEX,this.i=o;break;case ci.LEFT_TURN:break}else l===ci.COLLINEAR?(this.pos=a.t,this.s=ui.VERTEX_VERTEX,this.i=zt(o)):(this.pos=a.t,this.s=ui.VERTEX_EDGE,this.i=o)}return Object(g["a"])(e,[{key:"next",value:function(){this.increment()}},{key:"increment",value:function(){var e;if(this.s===ui.VERTEX_VERTEX||this.s===ui.EDGE_VERTEX){do{var t=this.pos.neighbours[Ut(this.i)];if(this.i=t.indexT(this.pos),this.pos=t,this.pos.vertices[this.i]===li){e=ci.COLLINEAR,this.i=Ut(this.i);break}e=Ht(this.p,this.q,this.pos.vertices[this.i].point),this.i=Ut(this.i)}while(e===ci.LEFT_TURN);e===ci.COLLINEAR?(this.s=ui.VERTEX_VERTEX,this.i=zt(this.i)):this.s=ui.VERTEX_EDGE}else{var i=this.pos.neighbours[this.i],n=i.indexT(this.pos);switch(this.pos=i,e=this.pos.vertices[n]===li?ci.COLLINEAR:Ht(this.p,this.q,this.pos.vertices[n].point),e){case ci.LEFT_TURN:this.s=ui.EDGE_EDGE,this.i=zt(n);break;case ci.RIGHT_TURN:this.s=ui.EDGE_EDGE,this.i=Ut(n);break;default:this.s=ui.EDGE_VERTEX,this.i=n}}}}]),e}(),wi=function e(){Object(y["a"])(this,e),this.first=null,this.second=0};(function(e){e[e["VERTEX"]=0]="VERTEX",e[e["EDGE"]=1]="EDGE",e[e["FACE"]=2]="FACE",e[e["OUTSIDE_CONVEX_HULL"]=3]="OUTSIDE_CONVEX_HULL",e[e["OUTSIDE_AFFINE_HULL"]=4]="OUTSIDE_AFFINE_HULL"})(fi||(fi={}));var ki,Oi=function(){function e(){Object(y["a"])(this,e),this.dimension=-1,this.vertices=[],this.triangles=[],this._infinite=this.createVertex(),li=this._infinite;var t=new vi;t.addVertex(this._infinite),this.triangles.push(t)}return Object(g["a"])(e,[{key:"createVertex",value:function(){var e=this.infiniteVertex;return void 0===e&&console.log("UNDEFINED HIERE"),this.vertices.push(e),e}},{key:"createTriangle",value:function(e,t,i,n,a,o){var r=new vi(e,t,i);return r.neighbours[0]=n,r.neighbours[1]=a,r.neighbours[2]=o,this.triangles.push(r),r}},{key:"deleteTriangle",value:function(e){this.triangles=this.triangles.filter((function(t){return t!==e}))}},{key:"setAdjacency",value:function(e,t,i,n){e.neighbours[t]=i,i.neighbours[n]=e}},{key:"insertDimUp",value:function(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pi,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this.createVertex();switch(this.dimension++,this.dimension){case 0:e=this.triangles[0],t=new vi(a),this.triangles.push(t),this.setAdjacency(e,0,t,0),a.triangle=t;break;case 1:case 2:var o=[],r=this.triangles.slice(0,this.triangles.length),s=!0,l=!1,c=void 0;try{for(var u,h=r[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=u.value,v=(new vi).from(d);this.triangles.push(v),d.vertices[this.dimension]=a,v.vertices[this.dimension]=i,this.setAdjacency(d,this.dimension,v,this.dimension),d.vertices.includes(i)&&o.push(v)}}catch(D){l=!0,c=D}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}var f=!0,p=!1,y=void 0;try{for(var g,m=r[Symbol.iterator]();!(f=(g=m.next()).done);f=!0)for(var b=g.value,w=b.neighbours[this.dimension],k=0;k<this.dimension;++k)w.neighbours[k]=b.neighbours[k].neighbours[this.dimension]}catch(D){p=!0,y=D}finally{try{f||null==m.return||m.return()}finally{if(p)throw y}}var O=0;if(1===this.dimension)n?(r[O].reorient(),O++,r[O].neighbours[1].reorient()):(r[O].neighbours[1].reorient(),O++,r[O].reorient());else{var x=!0,S=!1,_=void 0;try{for(var C,j=r[Symbol.iterator]();!(x=(C=j.next()).done);x=!0){var L=C.value;n?L.neighbours[2].reorient():L.reorient()}}catch(D){S=!0,_=D}finally{try{x||null==j.return||j.return()}finally{if(S)throw _}}}for(var E=0,I=o;E<I.length;E++){var P=I[E],M=1;P.vertices[0]===i&&(M=0),e=P.neighbours[this.dimension];var T=this.mirrorIndex(P,this.dimension);t=P.neighbours[M];var A=this.mirrorIndex(P,M);this.setAdjacency(e,T,t,A),this.deleteTriangle(P)}a.triangle=r[0];break;default:throw new Error("Dimension unknown")}return a}},{key:"mirrorIndex",value:function(e,t){if(1===e.dimension){var i=e.neighbours[t].indexV(e.vertices[0===t?1:0]);return 0===i?1:0}return zt(e.neighbours[t].indexV(e.vertices[zt(t)]))}},{key:"insertInFace",value:function(e){var t=this.createVertex(),i=e.vertices[0],n=e.vertices[1],a=e.vertices[2],o=e.neighbours[1],r=e.neighbours[2],s=this.createTriangle(i,t,a,e,o,null),l=this.createTriangle(i,n,t,e,null,r);if(this.setAdjacency(s,2,l,1),null!==o){var c=this.mirrorIndex(e,1);o.neighbours[c]=s}if(null!==r){var u=this.mirrorIndex(e,2);r.neighbours[u]=l}return e.vertices[0]=t,e.neighbours[1]=s,e.neighbours[2]=l,i.triangle===e&&(i.triangle=l),t.triangle=e,t}},{key:"flip",value:function(e,t){var i=e.neighbours[t],n=this.mirrorIndex(e,t),a=e.vertices[Ut(t)],o=e.vertices[zt(t)],r=e.neighbours[zt(t)],s=this.mirrorIndex(e,zt(t)),l=i.neighbours[zt(n)],c=this.mirrorIndex(i,zt(n));e.vertices[Ut(t)]=i.vertices[n],i.vertices[Ut(n)]=e.vertices[t],this.setAdjacency(e,t,l,c),this.setAdjacency(e,zt(t),i,zt(n)),this.setAdjacency(i,n,r,s),a.triangle===e&&(a.triangle=i),o.triangle===i&&(o.triangle=e)}},{key:"insertInEdge",value:function(e,t){var i;if(1===this.dimension){i=this.createVertex();var n=e.neighbours[0],a=e.vertices[1],o=this.createTriangle(i,a,null,n,e,null);e.vertices[1]=i,e.neighbours[0]=o,n.neighbours[1]=o,i.triangle=o,a.triangle=n}else{var r=e.neighbours[t],s=this.mirrorIndex(e,t);i=this.insertInFace(e),this.flip(r,s)}return i}},{key:"finiteVertex",get:function(){return this.vertices[1]}},{key:"infiniteVertex",get:function(){var e=new pi(di());return e.infinite=!0,e}},{key:"finiteEdge",get:function(){if(this.dimension<1)throw new Error("aspo");var e=new gi(this);while(e.valid)e.next();return e.collect()}}]),e}(),xi=function(){function e(t){Object(y["a"])(this,e),this.x1=t[0],this.y1=t[1],this.x2=t[0],this.y2=t[1]}return Object(g["a"])(e,[{key:"dilate",value:function(e){this.x1-=e*ri(this.x1),this.y1-=e*ri(this.y1),this.x2+=e*ri(this.x2),this.y2+=e*ri(this.y2)}},{key:"overlaps",value:function(e){return!(this.x2<e.x1||e.x2<this.x1)&&!(this.y2<e.y1||e.y2<this.y1)}}]),e}(),Si=function(){function e(){Object(y["a"])(this,e),this.tds=new Oi}return Object(g["a"])(e,[{key:"insertConstraint",value:function(e,t){var i=this.insert(e),n=this.insert(t);i!==n&&this.insertConstraintV(i,n)}},{key:"insertConstraintV",value:function(e,t){var i=[[e,t]];while(i.length>0){var n=i.pop(),a=$t(n[0],n[1]);if(a.includes)this.markConstraint(a.fr,a.i),a.vi!==n[1]&&i.push([a.vi,n[1]]);else{var o=this.findIntersectedFaces(n[0],n[1]);o.found?o.vi!==n[0]&&o.vi!==n[1]?(i.push([n[0],o.vi]),i.push([o.vi,n[1]])):i.push(n):(this.triangulateHole(o.intersectedFaces,o.listAB,o.listBA),o.vi!==n[1]&&i.push([o.vi,n[1]]))}}}},{key:"triangulateHole",value:function(e,t,i){var n=[];this.triangulateHole2(e,t,i,n),this.propagatingFlipE(n)}},{key:"triangulateHole2",value:function(e,t,i,n){if(t.length>0){this.triangulateHalfHole(t,n),this.triangulateHalfHole(i,n);var a=t[0][0],o=i[0][0];a.neighbours[2]=o,o.neighbours[2]=a,a.constraints[2]=!0,o.constraints[2]=!0;while(e.length>0)this.tds.deleteTriangle(e.shift())}}},{key:"triangulateHalfHole",value:function(e,t){var i,n,a,o,r,s,l,c,u=0,h=function(){return e[u]},d=function(){return e[i]},v=h()[0].vertices[zt(h()[1])];i=u,++i;do{o=h()[0],l=h()[1],null!==o.neighbours[l]&&(a=o.neighbours[l],s=Ut(a.indexV(o.vertices[Ut(l)])),o=a.neighbours[s],l=this.tds.mirrorIndex(a,s)),r=d()[0],c=d()[1],null!==r.neighbours[c]&&(a=r.neighbours[c],s=Ut(a.indexV(r.vertices[Ut(c)])),r=a.neighbours[s],c=this.tds.mirrorIndex(a,s));var f=o.vertices[zt(l)],p=o.vertices[Ut(l)],y=r.vertices[Ut(c)],g=Ht(f.point,p.point,y.point);switch(g){case ci.RIGHT_TURN:var m=this.tds.createTriangle(f,y,p,null,null,null);t.push([m,2]),m.neighbours[1]=o,m.neighbours[0]=r,o.neighbours[l]=m,r.neighbours[c]=m,o.isConstrained(l)&&(m.constraints[1]=!0),r.isConstrained(c)&&(m.constraints[0]=!0),f.triangle=m,p.triangle=m,y.triangle=m,n=u+1,e.splice(u,0,[m,2]),e.splice(Math.max(n,i),1),e.splice(Math.min(n,i),1),i=u,f!==v?--u:++i;break;case ci.LEFT_TURN:case ci.COLLINEAR:++u,++i;break}}while(i<e.length)}},{key:"findIntersectedFaces",value:function(e,t){var i,n=e.point,a=t.point,o=[],r=[],s=[],l=new bi(e,this,a),c=l.pos.indexV(e);if(l.pos.isConstrained(c))return i=this.intersect(l.pos,c,e,t),{found:!0,vi:i,listAB:o,listBA:r,intersectedFaces:s};var u=l.pos.neighbours[zt(c)],h=l.pos.neighbours[Ut(c)];o.push([u,u.indexT(l.pos)]),r.unshift([h,h.indexT(l.pos)]),s.unshift(l.pos);var d=l.pos;l.next(),c=l.pos.indexT(d);var v=l.pos.vertices[c],f=!1;while(v!==t&&!f){var p=void 0,y=void 0,g=Ht(n,a,v.point);switch(g){case ci.COLLINEAR:f=!0;break;case ci.LEFT_TURN:case ci.RIGHT_TURN:if(g===ci.LEFT_TURN?(p=zt(c),y=Ut(c)):(p=Ut(c),y=zt(c)),l.pos.isConstrained(p))return i=this.intersect(l.pos,p,e,t),{found:!0,vi:i,listAB:o,listBA:r,intersectedFaces:s};u=l.pos.neighbours[y],s.unshift(l.pos),g===ci.LEFT_TURN?o.push([u,u.indexT(l.pos)]):r.unshift([u,u.indexT(l.pos)]),d=l.pos,l.next(),c=l.pos.indexT(d),v=l.pos.vertices[c];break}}return i=v,s.unshift(l.pos),u=l.pos.neighbours[Ut(c)],o.push([u,u.indexT(l.pos)]),h=l.pos.neighbours[zt(c)],r.unshift([h,h.indexT(l.pos)]),{found:!1,vi:i,listAB:o,listBA:r,intersectedFaces:s}}},{key:"intersect",value:function(e,t,i,n){var a,o=e.vertices[Ut(t)],r=e.vertices[zt(t)],s=i.point,l=n.point,c=o.point,u=r.point,h=ei(s,l,c,u);if(h!==s&&h!==l&&h!==c&&h!==u){var d=new xi(h);d.dilate(4),d.overlaps(new xi(s))&&(h=s),d.overlaps(new xi(l))&&(h=l),d.overlaps(new xi(c))&&(h=c),d.overlaps(new xi(u))&&(h=u)}if(null===h)throw new Error("what");return this.removeConstrainedEdge(e,t),a=this.insert(h,e),a!==o&&a!==r?(this.insertConstraintV(o,a),this.insertConstraintV(a,r)):this.insertConstraintV(o,r),a}},{key:"removeConstrainedEdge",value:function(e,t){e.constraints[t]=!1,2===this.tds.dimension&&(e.neighbours[t].constraints[this.tds.mirrorIndex(e,t)]=!1)}},{key:"updateConstraintsOpposite",value:function(e){var t,i=e.triangle,n=i;do{t=i.indexV(e),i.neighbours[t].constraints[this.tds.mirrorIndex(i,t)]?i.constraints[t]=!0:i.constraints[t]=!1,i=i.neighbours[zt(t)]}while(i!==n)}},{key:"markConstraint",value:function(e,t){1===this.tds.dimension?e.constraints[2]=!0:(e.constraints[t]=!0,e.neighbours[t].constraints[this.tds.mirrorIndex(e,t)]=!0)}},{key:"insert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.locate(e,this.iLocate(e,t)),n=this.insertb(e,i.loc,i.lt,i.li);return this.flipAround(n),n}},{key:"flipAround",value:function(e){if(!(this.tds.dimension<=1)){var t,i,n=e.triangle,a=n;do{t=n.indexV(e),i=n.neighbours[zt(t)],this.propagatingFlip(n,t),n=i}while(i!==a)}}},{key:"propagatingFlip",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.isFlipable(e,t)){var n=100;if(i===n)throw new Error("maxde");var a=e.neighbours[t];this.flip(e,t),this.propagatingFlip(e,t,i+1),t=a.indexV(e.vertices[t]),this.propagatingFlip(a,t,i+1)}}},{key:"lessEdge",value:function(e,t){var i=e[1],n=t[1];return e[0].uid<t[0].uid||e[0].uid===t[0].uid&&i<n}},{key:"propagatingFlipE",value:function(e){var t,i,n,a,o,r,s,l=this,c=0,u=[];while(c<e.length)t=e[c][0],i=e[c][1],this.isFlipable(t,i)&&(n=[t.neighbours[i],this.tds.mirrorIndex(t,i)],this.lessEdge(e[c],n)?u.push(e[c]):u.push(n)),++c;var h=[null,null,null,null];while(u.length>0){t=u[0][0],a=u[0][1],o=t.neighbours[a],r=this.tds.mirrorIndex(t,a),s=[t,a],u.splice(u.findIndex((function(e){return e[0]===s[0]&&e[1]===s[1]})),1),h[0]=[t,Ut(a)],h[1]=[t,zt(a)],h[2]=[o,Ut(r)],h[3]=[o,zt(r)];var d=!0,v=!1,f=void 0;try{for(var p,y=function(){var e=p.value,t=e[0],i=e[1];n=[t.neighbours[i],l.tds.mirrorIndex(t,i)],l.lessEdge(e,n)?u.splice(u.findIndex((function(t){return t[0]===e[0]&&t[1]===e[1]})),1):u.splice(u.findIndex((function(e){return e[0]===n[0]&&e[1]===n[1]})),1)},g=h[Symbol.iterator]();!(d=(p=g.next()).done);d=!0)y()}catch(C){v=!0,f=C}finally{try{d||null==g.return||g.return()}finally{if(v)throw f}}this.flip(t,a);var m=!0,b=!1,w=void 0;try{for(var k,O=h[Symbol.iterator]();!(m=(k=O.next()).done);m=!0){var x=k.value,S=x[0],_=x[1];this.isFlipable(S,_)&&(n=[S.neighbours[_],this.tds.mirrorIndex(S,_)],this.lessEdge(x,n)?u.push(x):u.push(n))}}catch(C){b=!0,w=C}finally{try{m||null==O.return||O.return()}finally{if(b)throw w}}}}},{key:"flip",value:function(e,t){var i=e.neighbours[t],n=this.tds.mirrorIndex(e,t),a=e.neighbours[Ut(t)],o=this.tds.mirrorIndex(e,Ut(t)),r=e.neighbours[zt(t)],s=this.tds.mirrorIndex(e,zt(t)),l=i.neighbours[Ut(n)],c=this.tds.mirrorIndex(i,Ut(n)),u=i.neighbours[zt(n)],h=this.tds.mirrorIndex(i,zt(n));this.tds.flip(e,t),e.constraints[e.indexT(i)]=!1,i.constraints[i.indexT(e)]=!1,a.neighbours[o].constraints[this.tds.mirrorIndex(a,o)]=a.constraints[o],r.neighbours[s].constraints[this.tds.mirrorIndex(r,s)]=r.constraints[s],l.neighbours[c].constraints[this.tds.mirrorIndex(l,c)]=l.constraints[c],u.neighbours[h].constraints[this.tds.mirrorIndex(u,h)]=u.constraints[h]}},{key:"isFlipable",value:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=e.neighbours[t];return!e.isInfinite()&&!n.isInfinite()&&(!e.constraints[t]&&Wt(n,e.vertices[t].point,i)===ci.ON_POSITIVE_SIDE)}},{key:"insertb",value:function(e,t,i,n){var a,o,r=!1;i===fi.EDGE&&t.isConstrained(n)&&(r=!0,a=t.vertices[zt(n)],o=t.vertices[Ut(n)]);var s=this.insertc(e,t,i,n);return r?this.updateConstraintsIncident(s,a,o):i!==fi.VERTEX&&this.clearConstraintsIncident(s),2===this.tds.dimension&&this.updateConstraintsOpposite(s),s}},{key:"updateConstraintsIncident",value:function(e,t,i){if(0!==this.tds.dimension)if(1===this.tds.dimension){var n=new yi(e,null);do{n.t.constraints[2]=!0}while(n.next())}else{var a=new mi(e,null);do{var o=a.t.indexV(e),r=Ut(o),s=zt(o);a.t.vertices[r]===t||a.t.vertices[r]===i?(a.t.constraints[s]=!0,a.t.constraints[r]=!1):(a.t.constraints[s]=!1,a.t.constraints[r]=!0)}while(a.next())}}},{key:"clearConstraintsIncident",value:function(e){var t=new yi(e,null);if(t.valid)do{var i=t.t,n=t.ri;i.constraints[n]=!1,2===this.tds.dimension&&(i.neighbours[n].constraints[this.tds.mirrorIndex(i,n)]=!1)}while(t.next())}},{key:"insertc",value:function(e,t,i,n){if(1===this.tds.vertices.length)return this.insertFirst(e);if(2===this.tds.vertices.length)return i===fi.VERTEX?this.tds.finiteVertex:this.insertSecond(e);switch(i){case fi.VERTEX:return t.vertices[n];case fi.OUTSIDE_AFFINE_HULL:return this.insertOutsideAffineHull(e);case fi.OUTSIDE_CONVEX_HULL:return this.insertOutsideConvexHull(e,t);case fi.EDGE:return this.insertInEdge(e,t,n);case fi.FACE:return this.insertInFace(e,t)}throw new Error("qwe")}},{key:"insertInEdge",value:function(e,t,i){var n=this.tds.insertInEdge(t,i);return n.point=e,n}},{key:"insertInFace",value:function(e,t){var i=this.tds.insertInFace(t);return i.point=e,i}},{key:"insertFirst",value:function(e){var t=this.tds.insertDimUp();return t.point=e,t}},{key:"insertSecond",value:function(e){var t=this.tds.insertDimUp(this.tds._infinite,!0);return t.point=e,t}},{key:"insertOutsideAffineHull",value:function(e){var t=!1;if(1===this.tds.dimension){var i=this.tds.finiteEdge.first,n=Ht(i.vertices[0].point,i.vertices[1].point,e);t=n===ci.COUNTERCLOCKWISE}var a=this.tds.insertDimUp(this.tds._infinite,t);return a.point=e,a}},{key:"insertOutsideConvexHull",value:function(e,t){var i;if(1===this.tds.dimension)throw new Error("sdfasdasd");return i=this.insertOutsideConvexHull2(e,t),i.point=e,i}},{key:"insertOutsideConvexHull2",value:function(e,t){var i=t.indexV(this.tds._infinite),n=[],a=[],o=new mi(this.tds._infinite,t),r=!1;while(!r){o.prev(),i=o.t.indexV(this.tds._infinite);var s=o.t.vertices[zt(i)].point,l=o.t.vertices[Ut(i)].point;Ht(e,s,l)===ci.LEFT_TURN?n.push(o.t):r=!0}o=new mi(this.tds._infinite,t),r=!1;while(!r){o.next(),i=o.t.indexV(this.tds._infinite);var c=o.t.vertices[zt(i)].point,u=o.t.vertices[Ut(i)].point;Ht(e,c,u)===ci.LEFT_TURN?a.push(o.t):r=!0}var h,d=this.tds.insertInFace(t);d.point=e;while(n.length>0)h=n[0],i=zt(h.indexV(this.tds._infinite)),this.tds.flip(h,i),n.shift();while(a.length>0)h=a[0],i=Ut(h.indexV(this.tds._infinite)),this.tds.flip(h,i),a.shift();o=new mi(d,null);while(!o.t.isInfinite())o.next();return this.tds._infinite.triangle=o.t,d}},{key:"locate",value:function(e,t){var i=0,n=0;if(this.tds.dimension<0)return i=fi.OUTSIDE_AFFINE_HULL,n=4,{loc:null,lt:i,li:n};if(0===this.tds.dimension)return i=Yt(e,this.tds.finiteVertex.triangle.vertices[0].point)?fi.VERTEX:fi.OUTSIDE_AFFINE_HULL,n=4,{loc:null,lt:i,li:n};if(1===this.tds.dimension)return this.marchLocate1D(e);if(null===t){var a=this.tds._infinite.triangle;t=a.neighbours[a.indexV(this.tds._infinite)]}else t.isInfinite()&&(t=t.neighbours[t.indexV(this.tds._infinite)]);return this.marchLocate2D(t,e)}},{key:"marchLocate1D",value:function(e){var t=this.tds._infinite.triangle,i=t.indexV(this.tds._infinite),n=t.neighbours[i],a=Ht(n.vertices[0].point,n.vertices[1].point,e);if(a===ci.RIGHT_TURN||a===ci.LEFT_TURN)return{loc:new vi,lt:fi.OUTSIDE_AFFINE_HULL,li:4};var o=n.indexT(t);if(Ft(e,n.vertices[1-o].point,n.vertices[o].point))return{loc:t,lt:fi.OUTSIDE_CONVEX_HULL,li:i};if(Yt(e,n.vertices[1-o].point))return{loc:n,lt:fi.VERTEX,li:1-o};if(t=t.neighbours[1-i],i=t.indexV(this.tds._infinite),n=t.neighbours[i],o=n.indexT(t),Ft(e,n.vertices[1-o].point,n.vertices[o].point))return{loc:t,lt:fi.OUTSIDE_CONVEX_HULL,li:i};if(Yt(e,n.vertices[1-o].point))return{loc:n,lt:fi.VERTEX,li:1-o};throw new Error("sdfsdf")}},{key:"marchLocate2D",value:function(e,t){var i,n,a=null,o=!0;while(1){if(e.isInfinite())return{loc:e,lt:fi.OUTSIDE_CONVEX_HULL,li:e.indexV(this.tds._infinite)};var r=0,s=e.vertices[0].point,l=e.vertices[1].point,c=e.vertices[2].point,u=void 0,h=void 0,d=void 0;if(o){if(a=e,o=!1,u=Ht(s,l,t),u===ci.NEGATIVE){e=e.neighbours[2];continue}if(h=Ht(l,c,t),h===ci.NEGATIVE){e=e.neighbours[0];continue}if(d=Ht(c,s,t),d===ci.NEGATIVE){e=e.neighbours[1];continue}}else if(r)if(e.neighbours[0]===a){if(a=e,u=Ht(s,l,t),u===ci.NEGATIVE){e=e.neighbours[2];continue}if(d=Ht(c,s,t),d===ci.NEGATIVE){e=e.neighbours[1];continue}h=ci.POSITIVE}else if(e.neighbours[1]===a){if(a=e,h=Ht(l,c,t),h===ci.NEGATIVE){e=e.neighbours[0];continue}if(u=Ht(s,l,t),u===ci.NEGATIVE){e=e.neighbours[2];continue}d=ci.POSITIVE}else{if(a=e,d=Ht(c,s,t),d===ci.NEGATIVE){e=e.neighbours[1];continue}if(h=Ht(l,c,t),h===ci.NEGATIVE){e=e.neighbours[0];continue}u=ci.POSITIVE}else if(e.neighbours[0]===a){if(a=e,d=Ht(c,s,t),d===ci.NEGATIVE){e=e.neighbours[1];continue}if(u=Ht(s,l,t),u===ci.NEGATIVE){e=e.neighbours[2];continue}h=ci.POSITIVE}else if(e.neighbours[1]===a){if(a=e,u=Ht(s,l,t),u===ci.NEGATIVE){e=e.neighbours[2];continue}if(h=Ht(l,c,t),h===ci.NEGATIVE){e=e.neighbours[0];continue}d=ci.POSITIVE}else{if(a=e,h=Ht(l,c,t),h===ci.NEGATIVE){e=e.neighbours[0];continue}if(d=Ht(c,s,t),d===ci.NEGATIVE){e=e.neighbours[1];continue}u=ci.POSITIVE}var v=(u===ci.COLLINEAR?1:0)+(h===ci.COLLINEAR?1:0)+(d===ci.COLLINEAR?1:0);switch(v){case 0:i=fi.FACE,n=4;break;case 1:i=fi.EDGE,n=u===ci.COLLINEAR?2:h===ci.COLLINEAR?0:1;break;case 2:i=fi.VERTEX,n=u!==ci.COLLINEAR?2:h!==ci.COLLINEAR?0:1;break}if(void 0===i||void 0===n)throw new Error("ert");return{loc:e,lt:i,li:n}}}},{key:"iLocate",value:function(e,t){if(this.tds.dimension<2)return t;if(null===t){var i=this.tds._infinite.triangle;t=i.neighbours[i.indexV(this.tds._infinite)]}else t.isInfinite()&&(t=t.neighbours[t.indexV(this.tds._infinite)]);var n=null,a=t,o=!0,r=2500;while(1){if(!r--)return a;if(a.isInfinite())return a;var s=a.vertices[0].point,l=a.vertices[1].point,c=a.vertices[2].point;if(o){if(n=a,o=!1,Gt(s,l,e)){a=a.neighbours[2];continue}if(Gt(l,c,e)){a=a.neighbours[0];continue}if(Gt(c,s,e)){a=a.neighbours[1];continue}}else if(a.neighbours[0]===n){if(n=a,Gt(s,l,e)){a=a.neighbours[2];continue}if(Gt(c,s,e)){a=a.neighbours[1];continue}}else if(a.neighbours[1]===n){if(n=a,Gt(s,l,e)){a=a.neighbours[2];continue}if(Gt(l,c,e)){a=a.neighbours[0];continue}}else{if(n=a,Gt(c,s,e)){a=a.neighbours[1];continue}if(Gt(l,c,e)){a=a.neighbours[0];continue}}break}return a}}]),e}();(function(e){e["VISION"]="vision",e["MOVEMENT"]="movement"})(ki||(ki={}));var _i={vision:new Si,movement:new Si};function Ci(e){var t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Si;_i[e]=n,t="vision"===e?Li.visionBlockers:Li.movementblockers;var a=!0,o=!1,r=void 0;try{for(var s,l=t[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,u=jt.UUIDMap.get(c);if(!i||u.visibleInCanvas(jt.getLayer().canvas))for(var h=u.isClosed?0:1,d=0;d<u.points.length-h;d++)n.insertConstraint(u.points[d],u.points[(d+1)%u.points.length])}}catch(v){o=!0,r=v}finally{try{a||null==l.return||l.return()}finally{if(o)throw r}}n.insertConstraint([-1e8,-1e8],[-1e8,1e8]),n.insertConstraint([-1e8,1e8],[-1e11,1e8]),n.insertConstraint([-1e11,1e8],[-1e11,-1e8]),n.insertConstraint([-1e11,-1e8],[-1e8,-1e8]),n.insertConstraint([-1e8,-1e8],[1e8,-1e8]),n.insertConstraint([1e8,-1e8],[1e8,-1e11]),n.insertConstraint([1e8,-1e11],[-1e8,-1e11]),n.insertConstraint([-1e8,-1e11],[-1e8,-1e8]),n.insertConstraint([1e8,-1e8],[1e8,1e8]),n.insertConstraint([1e8,1e8],[1e11,1e8]),n.insertConstraint([1e11,1e8],[1e11,-1e8]),n.insertConstraint([1e11,-1e8],[1e8,-1e8]),n.insertConstraint([-1e8,1e8],[1e8,1e8]),n.insertConstraint([1e8,1e8],[1e8,1e11]),n.insertConstraint([1e8,1e11],[-1e8,1e11]),n.insertConstraint([-1e8,1e11],[-1e8,1e8]),window.CDT=_i}var ji=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.BV=Object.freeze(new Nt([])),e.visionMode="bvh",e.visionBlockers=[],e.movementblockers=[],e.visionSources=[],e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"setVisionMode",value:function(e){this.visionMode=e.mode,e.sync&&Je.emit("Location.Options.Set",{vision_mode:e.mode})}},{key:"recalculateVision",value:function(){"triangle"===this.visionMode?Ci(ki.VISION):this.BV=Object.freeze(new Nt(this.visionBlockers))}},{key:"recalculateMovement",value:function(){"triangle"===this.visionMode&&Ci(ki.MOVEMENT)}},{key:"clear",value:function(){this.context.state.visionBlockers=[],this.context.state.visionSources=[],this.context.state.movementblockers=[],this.context.commit("recalculateVision"),this.context.commit("recalculateMovement")}}]),t}(A["d"]);Object(k["a"])([A["c"]],ji.prototype,"setVisionMode",null),Object(k["a"])([A["c"]],ji.prototype,"recalculateVision",null),Object(k["a"])([A["c"]],ji.prototype,"recalculateMovement",null),Object(k["a"])([A["a"]],ji.prototype,"clear",null),ji=Object(k["a"])([Object(A["b"])({dynamic:!0,store:R,name:"visibility",namespaced:!0})],ji);var Li=Object(A["e"])(ji),Ei=function(){function e(t,i,n,a){Object(y["a"])(this,e),this.fillColour="#000",this.strokeColour="rgba(0,0,0,0)",this.name="Unknown shape",this.nameVisible=!0,this.trackers=[],this.auras=[],this.labels=[],this._owners=[],this.visionObstruction=!1,this.movementObstruction=!1,this.isToken=!1,this.showHighlight=!1,this.annotation="",this.globalCompositeOperation="source-over",this.options=new Map,this._refPoint=t,this.uuid=a||ve(),void 0!==i&&(this.fillColour=i),void 0!==n&&(this.strokeColour=n)}return Object(g["a"])(e,[{key:"visibleInCanvas",value:function(e){return!1}},{key:"getPointIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=!0,n=!1,a=void 0;try{for(var o,r=this.points.entries()[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var s=Object(Et["a"])(o.value,2),l=s[0],c=s[1];if(Math.abs(e.x-c[0])<=t&&Math.abs(e.y-c[1])<=t)return l}}catch(u){n=!0,a=u}finally{try{i||null==r.return||r.return()}finally{if(n)throw a}}return-1}},{key:"getPointOrientation",value:function(e){var t=nt.fromArray(this.points[(this.points.length+e-1)%this.points.length]),i=nt.fromArray(this.points[e]),n=nt.fromArray(this.points[(e+1)%this.points.length]),a=n.subtract(t),o=t.add(a.multiply(.5));return i.subtract(o).normalize()}},{key:"invalidate",value:function(e){var t=jt.getLayer(this.layer);t&&t.invalidate(e)}},{key:"checkVisionSources",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this,i=Li.visionBlockers.indexOf(this.uuid),n=!1;this.visionObstruction&&-1===i?(Li.visionBlockers.push(this.uuid),n=!0):!this.visionObstruction&&i>=0&&(Li.visionBlockers.splice(i,1),n=!0),n&&e&&Li.recalculateVision();var a=!0,o=!1,r=void 0;try{for(var s,l=function(){var e=s.value,i=Li.visionSources,n=i.findIndex((function(t){return t.aura===e.uuid}));e.visionSource&&-1===n?i.push({shape:t.uuid,aura:e.uuid}):!e.visionSource&&n>=0&&i.splice(n,1)},c=this.auras[Symbol.iterator]();!(a=(s=c.next()).done);a=!0)l()}catch(d){o=!0,r=d}finally{try{a||null==c.return||c.return()}finally{if(o)throw r}}for(var u=function(e){var i=Li.visionSources[e];i.shape===t.uuid&&(t.auras.some((function(e){return e.uuid===i.aura&&e.visionSource}))||Li.visionSources.splice(e,1))},h=Li.visionSources.length-1;h>=0;h--)u(h)}},{key:"setMovementBlock",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.movementObstruction=e||!1;var i=Li.movementblockers.indexOf(this.uuid),n=!1;this.movementObstruction&&-1===i?(Li.movementblockers.push(this.uuid),n=!0):!this.movementObstruction&&i>=0&&(Li.movementblockers.splice(i,1),n=!0),n&&t&&Li.recalculateMovement()}},{key:"setIsToken",value:function(e){if(this.isToken=e,this.ownedBy()){var t=_t.ownedtokens.indexOf(this.uuid);this.isToken&&-1===t?_t.ownedtokens.push(this.uuid):!this.isToken&&t>=0&&_t.ownedtokens.splice(t,1)}}},{key:"getBaseDict",value:function(){return{type_:this.type,uuid:this.uuid,x:this.refPoint.x,y:this.refPoint.y,layer:this.layer,draw_operator:this.globalCompositeOperation,movement_obstruction:this.movementObstruction,vision_obstruction:this.visionObstruction,auras:Tt(this.auras),trackers:this.trackers,labels:this.labels,owners:this._owners,fill_colour:this.fillColour,stroke_colour:this.strokeColour,name:this.name,name_visible:this.nameVisible,annotation:this.annotation,is_token:this.isToken,options:JSON.stringify(Object(p["a"])(this.options))}}},{key:"fromDict",value:function(e){this.layer=e.layer,this.globalCompositeOperation=e.draw_operator,this.movementObstruction=e.movement_obstruction,this.visionObstruction=e.vision_obstruction,this.auras=Mt(e.auras),this.trackers=e.trackers,this.labels=e.labels,this._owners=e.owners,this.isToken=e.is_token,this.nameVisible=e.name_visible,e.annotation&&(this.annotation=e.annotation),e.name&&(this.name=e.name),e.options&&(this.options=new Map(JSON.parse(e.options)))}},{key:"draw",value:function(e){if(void 0!==this.globalCompositeOperation?e.globalCompositeOperation=this.globalCompositeOperation:e.globalCompositeOperation="source-over",this.showHighlight){var t=this.getBoundingBox();e.strokeStyle="red",e.strokeRect(ct(t.topLeft.x)-5,ut(t.topLeft.y)-5,ht(t.w)+10,ht(t.h)+10)}}},{key:"drawAuras",value:function(e){var t=!0,i=!1,n=void 0;try{for(var a,o=this.auras[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var r=a.value;if(0===r.value&&0===r.dim)return;e.beginPath();var s=lt(this.center()),l=vt(r.value+r.dim);if(0===r.dim)e.fillStyle=r.colour;else{var c=e.createRadialGradient(s.x,s.y,vt(r.value),s.x,s.y,vt(r.value+r.dim)),u=bt()(r.colour);e.fillStyle=c,c.addColorStop(0,r.colour),c.addColorStop(1,u.setAlpha(0).toRgbString())}if(r.visionSource&&void 0!==r.lastPath)try{e.fill(r.lastPath)}catch(h){e.arc(s.x,s.y,l,0,2*Math.PI),e.fill(),console.warn(h)}else e.arc(s.x,s.y,l,0,2*Math.PI),e.fill()}}catch(d){i=!0,n=d}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"drawSelection",value:function(e){e.globalCompositeOperation=this.globalCompositeOperation;var t=_t.zoomFactor,i=this.getBoundingBox();e.strokeRect(ct(i.topLeft.x),ut(i.topLeft.y),i.w*t,i.h*t);var n=!0,a=!1,o=void 0;try{for(var r,s=this.points[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value;e.beginPath(),e.arc(ct(l[0]),ut(l[1]),3,0,2*Math.PI),e.fill()}}catch(d){a=!0,o=d}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}e.beginPath(),e.moveTo(ct(this.points[0][0]),ut(this.points[0][1]));for(var c=this.isClosed?0:1,u=1;u<=this.points.length-c;u++){var h=this.points[u%this.points.length];e.lineTo(ct(h[0]),ut(h[1]))}e.stroke()}},{key:"getInitiativeRepr",value:function(){return{uuid:this.uuid,visible:!_t.IS_DM,group:!1,source:this.name,has_img:!1,effects:[],index:1/0}}},{key:"moveLayer",value:function(e,t){var i=jt.getLayer(this.layer),n=jt.getLayer(e);void 0!==i&&void 0!==n&&(this.layer=e,i.shapes.splice(i.shapes.indexOf(this),1),n.shapes.push(this),i.invalidate(!0),n.invalidate(!1),t&&Je.emit("Shape.Layer.Change",{uuid:this.uuid,layer:e}))}},{key:"ownedBy",value:function(e){return void 0===e&&(e=_t.username),_t.IS_DM||this._owners.includes(e)||_t.FAKE_PLAYER&&_t.activeTokens.includes(this.uuid)}},{key:"addOwner",value:function(e){this._owners.includes(e)||this._owners.push(e)}},{key:"updateOwner",value:function(e,t){var i=this._owners.findIndex((function(t){return t===e}));i>=0?this._owners.splice(i,1,t):this.addOwner(t)}},{key:"removeOwner",value:function(e){var t=this._owners.findIndex((function(t){return t===e}));this._owners.splice(t,1)}},{key:"isClosed",get:function(){return!0}},{key:"refPoint",get:function(){return this._refPoint},set:function(e){this._refPoint=e}},{key:"owners",get:function(){return Object.freeze(this._owners.slice())}}]),e}();function Ii(e,t,i){if(0===e.x&&0===e.y)return e;if("bvh"===Li.visionMode){void 0===i&&(i=[]);var n=t.getBoundingBox(),a=n.offset(e),o=!1,r=!0,s=!1,l=void 0;try{for(var c,u=Li.movementblockers[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var h=c.value;if(!i.includes(h)){var d=jt.UUIDMap.get(h),v=d.getBoundingBox(),f=v.intersectsWithInner(a);if(!f){var p=rt.fromPoints(n.topLeft.add(e.normalize()),a.topLeft),y=p.direction.inverse(),g=[y.x<0,y.y<0];f=v.intersectP(p,y,g).hit}if(f){var m=v.center(),b=n.center(),w=b.subtract(m),k=new ot(1,0),O=new ot(0,1),x=w.dot(k),S=w.dot(O);x>v.w/2&&(x=v.w/2),x<-v.w/2&&(x=-v.w/2),S>v.h/2&&(S=v.h/2),S<-v.h/2&&(S=-v.h/2);var _=m.add(k.multiply(x)).add(O.multiply(S));_.x===n.topLeft.x||_.x===n.topRight.x?e=new ot(0,e.y):_.y===n.topLeft.y||_.y===n.botLeft.y?e=new ot(e.x,0):_.x<n.topLeft.x?e=new ot(_.x-n.topLeft.x,e.y):_.x>n.topRight.x?e=new ot(_.x-n.topRight.x,e.y):_.y<n.topLeft.y?e=new ot(e.x,_.y-n.topLeft.y):_.y>n.botLeft.y&&(e=new ot(e.x,_.y-n.botLeft.y)),o=!0,i.push(h);break}}}}catch(D){s=!0,l=D}finally{try{r||null==u.return||u.return()}finally{if(s)throw l}}return o&&(e=Ii(e,t,i)),e}var C=_i.movement.locate(t.center().asArray(),null).loc,j=!0,L=!1,E=void 0;try{for(var I,P=t.points[Symbol.iterator]();!(j=(I=P.next()).done);j=!0){var M=I.value,T=_i.movement.locate(M,C),A=T.loc;null!==A&&(e=Pi(M,A,e))}}catch(D){L=!0,E=D}finally{try{j||null==P.return||P.return()}finally{if(L)throw E}}return e}function Pi(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=new nt(e[0],e[1]),o=a.add(i).asArray();if(t.contains(o))return i;n.push(t);for(var r=0;r<3;r++)if(!n.includes(t.neighbours[r])){var s=t.vertices[Ut(r)].point,l=t.vertices[zt(r)].point,c=ei(e,o,s,l);if(null!==c){if(!t.isConstrained(r))return Pi(e,t.neighbours[r],i,n);if(c[0]===a.x&&c[1]===a.y){var u=Ht(e,o,l);if(u===ci.LEFT_TURN)continue;if(u===ci.ZERO)continue}var h=new nt(c[0],c[1]).subtract(a).multiply(.8);h.length()<1&&(h=new ot(0,0)),h.length()<i.length()&&(i=h)}}return i}var Mi=function(e){function t(e,i,n,a,o,r){var s;return Object(y["a"])(this,t),s=Object(m["a"])(this,Object(b["a"])(t).call(this,e,a,o,r)),s.w=i,s.h=n,s}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"getBaseDict",value:function(){return Object.assign(Object(It["a"])(Object(b["a"])(t.prototype),"getBaseDict",this).call(this),{width:this.w,height:this.h})}},{key:"getBoundingBox",value:function(){return new Pt(this.refPoint,this.w,this.h)}},{key:"contains",value:function(e){return this.refPoint.x<=e.x&&this.refPoint.x+this.w>=e.x&&this.refPoint.y<=e.y&&this.refPoint.y+this.h>=e.y}},{key:"center",value:function(e){if(void 0===e)return this.refPoint.add(new ot(this.w/2,this.h/2));this.refPoint=new nt(e.x-this.w/2,e.y-this.h/2)}},{key:"visibleInCanvas",value:function(e){if(Object(It["a"])(Object(b["a"])(t.prototype),"visibleInCanvas",this).call(this,e))return!0;var i=!(ct(this.refPoint.x)>e.width||ut(this.refPoint.y)>e.height||ct(this.refPoint.x+this.w)<0||ut(this.refPoint.y+this.h)<0);return!!i}},{key:"snapToGrid",value:function(){var e,t,i=_t.gridSize,n=this.center(),a=n.x,o=n.y;e=this.w/i%2===0?Math.round(a/i)*i-this.w/2:(Math.round((a+i/2)/i)-.5)*i-this.w/2,t=this.h/i%2===0?Math.round(o/i)*i-this.h/2:(Math.round((o+i/2)/i)-.5)*i-this.h/2;var r=Ii(new ot(e-this.refPoint.x,t-this.refPoint.y),this);this.refPoint=this.refPoint.add(r),this.invalidate(!1)}},{key:"resizeToGrid",value:function(){var e=_t.gridSize;this.refPoint=new nt(Math.round(this.refPoint.x/e)*e,Math.round(this.refPoint.y/e)*e),this.w=Math.max(Math.round(this.w/e)*e,e),this.h=Math.max(Math.round(this.h/e)*e,e),this.invalidate(!1)}},{key:"resize",value:function(e,t){var i=_t.zoomFactor;switch(e){case 0:this.w=ct(this.refPoint.x)+this.w*i-t.x,this.h=ut(this.refPoint.y)+this.h*i-t.y,this.refPoint=ft(t);break;case 1:this.w=ct(this.refPoint.x)+this.w*i-t.x,this.h=t.y-ut(this.refPoint.y),this.refPoint=new nt(pt(t.x),this.refPoint.y);break;case 2:this.w=t.x-ct(this.refPoint.x),this.h=t.y-ut(this.refPoint.y);break;case 3:this.w=t.x-ct(this.refPoint.x),this.h=ut(this.refPoint.y)+this.h*i-t.y,this.refPoint=new nt(this.refPoint.x,yt(t.y));break}this.w/=i,this.h/=i,this.w<0&&(this.refPoint=this.refPoint.add(new ot(this.w,0)),this.w=Math.abs(this.w)),this.h<0&&(this.refPoint=this.refPoint.add(new ot(0,this.h)),this.h=Math.abs(this.h))}},{key:"points",get:function(){if(0===this.w||0===this.h)return[[this.refPoint.x,this.refPoint.y]];var e=this.refPoint.add(new ot(0,this.h)),t=this.refPoint.add(new ot(this.w,this.h)),i=this.refPoint.add(new ot(this.w,0));return[[this.refPoint.x,this.refPoint.y],[e.x,e.y],[t.x,t.y],[i.x,i.y]]}}]),t}(Ei),Ti=function(e){function t(e,i,n,a,o){var r;return Object(y["a"])(this,t),r=Object(m["a"])(this,Object(b["a"])(t).call(this,i,n,a,void 0,void 0,o)),r.type="assetrect",r.src="",r.img=e,r}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{src:this.src})}},{key:"fromDict",value:function(e){Object(It["a"])(Object(b["a"])(t.prototype),"fromDict",this).call(this,e),this.src=e.src}},{key:"draw",value:function(e){Object(It["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e);try{e.drawImage(this.img,ct(this.refPoint.x),ut(this.refPoint.y),ht(this.w),ht(this.h))}catch(i){console.warn("Shape ".concat(this.uuid," could not load the image ").concat(this.src))}}},{key:"getInitiativeRepr",value:function(){return{uuid:this.uuid,visible:!_t.IS_DM,group:!1,source:this.src,has_img:!0,effects:[],index:1/0}}}]),t}(Mi),Ai=function(e){function t(e,i,n,a,o){var r;return Object(y["a"])(this,t),r=Object(m["a"])(this,Object(b["a"])(t).call(this,e,n,a,o)),r.type="circle",r.r=i||1,r}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{radius:this.r})}},{key:"fromDict",value:function(e){Object(It["a"])(Object(b["a"])(t.prototype),"fromDict",this).call(this,e),this.r=e.radius}},{key:"getBoundingBox",value:function(){return new Pt(new nt(this.refPoint.x-this.r,this.refPoint.y-this.r),2*this.r,2*this.r)}},{key:"draw",value:function(e){Object(It["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.beginPath(),"fog"===this.fillColour?e.fillStyle=kt():e.fillStyle=this.fillColour;var i=lt(this.refPoint);if(e.arc(i.x,i.y,ht(this.r),0,2*Math.PI),e.fill(),"rgba(0, 0, 0, 0)"!==this.strokeColour){var n=5;e.beginPath(),e.lineWidth=ht(n),e.strokeStyle=this.strokeColour,e.arc(i.x,i.y,Math.max(n/2,ht(this.r-n/2)),0,2*Math.PI),e.stroke()}}},{key:"contains",value:function(e){return Math.pow(e.x-this.refPoint.x,2)+Math.pow(e.y-this.refPoint.y,2)<Math.pow(this.r,2)}},{key:"center",value:function(e){if(void 0===e)return this.refPoint;this.refPoint=e}},{key:"visibleInCanvas",value:function(e){return this.getBoundingBox().visibleInCanvas(e)}},{key:"snapToGrid",value:function(){var e,t,i=_t.gridSize;e=2*this.r/i%2===0?Math.round(this.refPoint.x/i)*i:Math.round((this.refPoint.x-i/2)/i)*i+this.r,t=2*this.r/i%2===0?Math.round(this.refPoint.y/i)*i:Math.round((this.refPoint.y-i/2)/i)*i+this.r;var n=Ii(new ot(e-this.refPoint.x,t-this.refPoint.y),this);this.refPoint=this.refPoint.add(n),this.invalidate(!1)}},{key:"resizeToGrid",value:function(){var e=_t.gridSize;this.r=Math.max(Math.round(this.r/e)*e,e/2),this.invalidate(!1)}},{key:"resize",value:function(e,t){var i=ft(t).subtract(this.refPoint);this.r=Math.sqrt(Math.pow(i.length(),2)/2)}},{key:"points",get:function(){return this.getBoundingBox().points}}]),t}(Ei),Di=function(e){function t(e,i,n,a,o,r,s){var l;return Object(y["a"])(this,t),l=Object(m["a"])(this,Object(b["a"])(t).call(this,e,i,o,r,s)),l.type="circulartoken",l.text=n,l.font=a,l}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{radius:this.r,text:this.text,font:this.font})}},{key:"fromDict",value:function(e){Object(It["a"])(Object(b["a"])(t.prototype),"fromDict",this).call(this,e),this.r=e.radius,this.text=e.text,this.font=e.font}},{key:"draw",value:function(e){Object(It["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.font=this.font,e.save();var i=lt(this.center());e.textAlign="center",e.textBaseline="middle";var n=ye(e,this.text,ht(this.r-5));e.setTransform(n,0,0,n,i.x,i.y),e.fillStyle=mt["mostReadable"](this.fillColour,["#000","#fff"]).toHexString(),e.fillText(this.text,0,0),e.restore()}},{key:"getInitiativeRepr",value:function(){return{uuid:this.uuid,visible:!_t.IS_DM,group:!1,source:""===this.name||"Unknown shape"===this.name?this.text:this.name,has_img:!1,effects:[],index:1/0}}}]),t}(Ai),Ri=function(e){function t(e,i,n,a,o){var r;return Object(y["a"])(this,t),r=Object(m["a"])(this,Object(b["a"])(t).call(this,e,"rgba(0, 0, 0, 0)",a||"#000",o)),r.type="line",r.endPoint=i,r.lineWidth=void 0===n?1:n,r}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{x2:this.endPoint.x,y2:this.endPoint.y,line_width:this.lineWidth})}},{key:"getBoundingBox",value:function(){return new Pt(new nt(Math.min(this.refPoint.x,this.endPoint.x),Math.min(this.refPoint.y,this.endPoint.y)),Math.abs(this.refPoint.x-this.endPoint.x),Math.abs(this.refPoint.y-this.endPoint.y))}},{key:"draw",value:function(e){Object(It["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.strokeStyle=this.strokeColour,e.beginPath(),e.moveTo(ct(this.refPoint.x),ut(this.refPoint.y)),e.lineTo(ct(this.endPoint.x),ut(this.endPoint.y)),e.lineWidth=ht(this.lineWidth),e.stroke()}},{key:"contains",value:function(e){return!1}},{key:"center",value:function(e){}},{key:"visibleInCanvas",value:function(e){return this.getBoundingBox().visibleInCanvas(e)}},{key:"snapToGrid",value:function(){}},{key:"resizeToGrid",value:function(){}},{key:"resize",value:function(e,t){0===e?this.refPoint=ft(t):this.endPoint=ft(t)}},{key:"isClosed",get:function(){return!1}},{key:"points",get:function(){return[[this.refPoint.x,this.refPoint.y],[this.endPoint.x,this.endPoint.y]]}}]),t}(Ei),Ni=function(e){function t(e,i,n,a,o,r){var s;return Object(y["a"])(this,t),s=Object(m["a"])(this,Object(b["a"])(t).call(this,e,i,n,a,o,r)),s.type="rect",s}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object(It["a"])(Object(b["a"])(t.prototype),"getBaseDict",this).call(this)}},{key:"draw",value:function(e){Object(It["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),"fog"===this.fillColour?e.fillStyle=kt():e.fillStyle=this.fillColour;var i=_t.zoomFactor,n=lt(this.refPoint);e.fillRect(n.x,n.y,this.w*i,this.h*i),"rgba(0, 0, 0, 0)"!==this.strokeColour&&(e.strokeStyle=this.strokeColour,e.lineWidth=5,e.strokeRect(n.x,n.y,this.w*i,this.h*i))}}]),t}(Mi),Ui=function(e){function t(e,i,n,a,o,r,s){var l;return Object(y["a"])(this,t),l=Object(m["a"])(this,Object(b["a"])(t).call(this,e,o,r,s)),l.type="text",l.text=i,l.font=n,l.angle=a||0,l}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{text:this.text,font:this.font,angle:this.angle})}},{key:"getBoundingBox",value:function(){return new Pt(this.refPoint,5,5)}},{key:"draw",value:function(e){Object(It["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.font=this.font,e.fillStyle=this.fillColour,e.save();var i=lt(this.refPoint);e.translate(i.x,i.y),e.rotate(this.angle),e.textAlign="center",this.getLines(e).map((function(t){return e.fillText(t.text,t.x,t.y)})),e.restore()}},{key:"contains",value:function(e){return!1}},{key:"center",value:function(e){}},{key:"visibleInCanvas",value:function(e){return this.getBoundingBox().visibleInCanvas(e)}},{key:"snapToGrid",value:function(){}},{key:"resizeToGrid",value:function(){}},{key:"resize",value:function(e,t){}},{key:"getMaxHeight",value:function(e){var t=this.getLines(e),i=30;return i*t.length}},{key:"getMaxWidth",value:function(e){var t=this.getLines(e),i=t.map((function(t){return e.measureText(t.text).width}));return Math.max.apply(Math,Object(p["a"])(i))}},{key:"getLines",value:function(e){var t=this.text.split("\n"),i=[],n=e.canvas.width,a=30,o=0,r=0,s=!0,l=!1,c=void 0;try{for(var u,h=t[Symbol.iterator]();!(s=(u=h.next()).done);s=!0){var d=u.value,v="",f=d.split(" "),p=!0,y=!1,g=void 0;try{for(var m,b=f[Symbol.iterator]();!(p=(m=b.next()).done);p=!0){var w=m.value,k=v+w+" ",O=e.measureText(k),x=O.width;x>n?(e.fillText(v,o,r),i.push({text:v,x:o,y:r}),v=w+" ",r+=a):v=k}}catch(S){y=!0,g=S}finally{try{p||null==b.return||b.return()}finally{if(y)throw g}}i.push({text:v,x:o,y:r}),r+=a}}catch(S){l=!0,c=S}finally{try{s||null==h.return||h.return()}finally{if(l)throw c}}return i}},{key:"points",get:function(){return[[this.refPoint.x,this.refPoint.y]]}}]),t}(Ei),zi=function(e){function t(e,i,n,a,o){var r,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6?arguments[6]:void 0;return Object(y["a"])(this,t),r=Object(m["a"])(this,Object(b["a"])(t).call(this,e,n,a,l)),r.type="polygon",r._vertices=[],r.openPolygon=!1,r._vertices=i||[],r.openPolygon=s,r.lineWidth=o||2,r}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"asDict",value:function(){return Object.assign(this.getBaseDict(),{vertices:this._vertices.map((function(e){return{x:e.x,y:e.y}})),open_polygon:this.openPolygon,line_width:this.lineWidth})}},{key:"fromDict",value:function(e){Object(It["a"])(Object(b["a"])(t.prototype),"fromDict",this).call(this,e),this._vertices=e.vertices.map((function(e){return new nt(e.x,e.y)})),this.openPolygon=e.open_polygon,this.lineWidth=e.line_width}},{key:"draw",value:function(e){Object(It["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,e),e.lineCap="round",e.lineJoin="round",e.lineWidth=ht(this.lineWidth),"fog"===this.strokeColour?e.strokeStyle=kt():e.strokeStyle=this.strokeColour,"fog"===this.fillColour?e.fillStyle=kt():e.fillStyle=this.fillColour,e.beginPath(),e.moveTo(ct(this.vertices[0].x),ut(this.vertices[0].y));for(var i=1;i<=this.vertices.length-(this.openPolygon?1:0);i++){var n=this.vertices[i%this.vertices.length];e.lineTo(ct(n.x),ut(n.y))}this.openPolygon||e.fill(),e.stroke()}},{key:"contains",value:function(e){return this.getBoundingBox().contains(e)}},{key:"center",value:function(e){return this.getBoundingBox().center()}},{key:"visibleInCanvas",value:function(e){return this.getBoundingBox().visibleInCanvas(e)}},{key:"snapToGrid",value:function(){}},{key:"resizeToGrid",value:function(){}},{key:"resize",value:function(e,t){0===e?this._refPoint=ft(t):this._vertices[e-1]=ft(t)}},{key:"getBoundingBox",value:function(){var e=this.refPoint.x,t=this.refPoint.x,i=this.refPoint.y,n=this.refPoint.y,a=!0,o=!1,r=void 0;try{for(var s,l=this._vertices[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;c.x<e&&(e=c.x),c.x>t&&(t=c.x),c.y<i&&(i=c.y),c.y>n&&(n=c.y)}}catch(u){o=!0,r=u}finally{try{a||null==l.return||l.return()}finally{if(o)throw r}}return new Pt(new nt(e,i),t-e,n-i)}},{key:"isClosed",get:function(){return!this.openPolygon}},{key:"refPoint",get:function(){return this._refPoint},set:function(e){var t=e.subtract(this._refPoint);this._refPoint=e;for(var i=0;i<this._vertices.length;i++)this._vertices[i]=this._vertices[i].add(t)}},{key:"vertices",get:function(){return[this._refPoint].concat(Object(p["a"])(this._vertices))}},{key:"points",get:function(){return this.vertices.map((function(e){return[e.x,e.y]}))}}]),t}(Ei);function $i(e){var t,i=new nt(e.x,e.y);if("rect"===e.type_){var n=e;t=new Ni(i,n.width,n.height,n.fill_colour,n.stroke_colour,n.uuid)}else if("circle"===e.type_){var a=e;t=new Ai(i,a.radius,a.fill_colour,a.stroke_colour,a.uuid)}else if("circulartoken"===e.type_){var o=e;t=new Di(i,o.radius,o.text,o.font,o.fill_colour,o.stroke_colour,o.uuid)}else if("line"===e.type_){var r=e;t=new Ri(i,new nt(r.x2,r.y2),r.line_width,r.stroke_colour,r.uuid)}else if("polygon"===e.type_){var s=e;t=new zi(i,s.vertices.map((function(e){return new nt(e.x,e.y)})),s.fill_colour,s.stroke_colour,s.line_width,s.open_polygon,s.uuid)}else if("text"===e.type_){var l=e;t=new Ui(i,l.text,l.font,l.angle,l.fill_colour,l.stroke_colour,l.uuid)}else{if("assetrect"!==e.type_)return;var c=e,u=new Image(c.width,c.height);c.src.startsWith("http")?u.src=new URL(c.src).pathname:u.src=c.src,t=new Ti(u,i,c.width,c.height,c.uuid),u.onload=function(){jt.getLayer(e.layer).invalidate(!1)}}return t.fromDict(e),t}function Fi(){var e=jt.getLayer();if(e&&e.selection){var t=[],i=!0,n=!1,a=void 0;try{for(var o,r=e.selection[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var s=o.value;_t.selectionHelperID!==s.uuid&&t.push(s.asDict())}}catch(l){n=!0,a=l}finally{try{i||null==r.return||r.return()}finally{if(n)throw a}}_t.setClipboard(t),_t.setClipboardPosition(_t.screenCenter)}}function Vi(e){var t=jt.getLayer(e);if(!t)return[];if(!_t.clipboard)return[];t.selection=[];var i=_t.screenCenter.subtract(_t.clipboardPosition);_t.setClipboardPosition(_t.screenCenter),i.squaredLength()<200&&(i=new ot(10,10));var n=!0,a=!1,o=void 0;try{for(var r,s=_t.clipboard[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value;l.x+=i.x,l.y+=i.y,l.uuid=ve();var c=l.trackers;l.trackers=[];var u=!0,h=!1,d=void 0;try{for(var v,f=c[Symbol.iterator]();!(u=(v=f.next()).done);u=!0){var p=v.value,y=Object.assign(Object.assign({},p),{uuid:ve()});l.trackers.push(y)}}catch(C){h=!0,d=C}finally{try{u||null==f.return||f.return()}finally{if(h)throw d}}var g=l.auras;l.auras=[];var m=!0,b=!1,w=void 0;try{for(var k,O=g[Symbol.iterator]();!(m=(k=O.next()).done);m=!0){var x=k.value,S=Object.assign(Object.assign({},x),{uuid:ve()});l.auras.push(S)}}catch(C){b=!0,w=C}finally{try{m||null==O.return||O.return()}finally{if(b)throw w}}var _=$i(l);void 0!==_&&(t.addShape(_,!0),t.selection.push(_))}}catch(C){a=!0,o=C}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}return 1===t.selection.length?tt.$emit("SelectionInfo.Shape.Set",t.selection[0]):tt.$emit("SelectionInfo.Shape.Set",null),t.invalidate(!1),t.selection}function Hi(){if(void 0!==jt.getLayer)for(var e=jt.getLayer(),t=e.selection.length-1;t>=0;t--){var i=e.selection[t];_t.selectionHelperID!==i.uuid?(e.removeShape(i,!0,!1),tt.$emit("SelectionInfo.Shape.Set",null),tt.$emit("Initiative.Remove",i.uuid)):e.selection.splice(t,1)}else console.log("No active layer selected for delete operation")}function Bi(){Fi(),Hi()}var Gi=function(){function e(t,i){Object(y["a"])(this,e),this.selectable=!1,this.playerEditable=!1,this.isVisionLayer=!1,this.valid=!1,this.shapes=[],this.selection=[],this.selectionColor="#CC0000",this.selectionWidth=2,this.canvas=t,this.name=i,this.width=t.width,this.height=t.height,this.ctx=t.getContext("2d")}return Object(g["a"])(e,[{key:"invalidate",value:function(e){this.valid=!1,e||jt.invalidateLight()}},{key:"addShape",value:function(e,t,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];void 0===i&&(i=!1),e.layer=this.name,this.shapes.push(e),jt.UUIDMap.set(e.uuid,e),e.checkVisionSources(n),e.setMovementBlock(e.movementObstruction,n),e.ownedBy(_t.username)&&e.isToken&&_t.ownedtokens.push(e.uuid),e.annotation.length&&_t.annotations.push(e.uuid),t&&Je.emit("Shape.Add",{shape:e.asDict(),temporary:i}),n&&this.invalidate(!t)}},{key:"setShapes",value:function(e){var t=!0,i=!1,n=void 0;try{for(var a,o=e[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var r=a.value,s=$i(r);if(void 0===s)return void console.log("Shape with unknown type ".concat(r.type_," could not be added"));this.addShape(s,!1,!1,!1)}}catch(l){i=!0,n=l}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}this.clearSelection(),this.invalidate(!1)}},{key:"removeShape",value:function(e,t,i){void 0===i&&(i=!1);var n=this.shapes.indexOf(e);if(n<0)console.error("attempted to remove shape not in layer.");else{this.shapes.splice(n,1),t&&Je.emit("Shape.Remove",{shape:e.asDict(),temporary:i});var a=Li.visionSources.findIndex((function(t){return t.shape===e.uuid})),o=Li.visionBlockers.findIndex((function(t){return t===e.uuid})),r=Li.movementblockers.findIndex((function(t){return t===e.uuid})),s=_t.annotations.findIndex((function(t){return t===e.uuid}));a>=0&&Li.visionSources.splice(a,1),o>=0&&Li.visionBlockers.splice(o,1),r>=0&&Li.movementblockers.splice(r,1),s>=0&&_t.annotations.splice(s,1);var l=_t.annotations.indexOf(e.uuid);l>=0&&_t.annotations.splice(l,1);var c=_t.ownedtokens.indexOf(e.uuid);c>=0&&_t.ownedtokens.splice(c,1),jt.UUIDMap.delete(e.uuid);var u=this.selection.indexOf(e);u>=0&&this.selection.splice(u,1),o>=0&&Li.recalculateVision(),r>=0&&Li.recalculateMovement(),this.invalidate(!t)}}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.width,this.height)}},{key:"clearSelection",value:function(){this.selection=[],tt.$emit("SelectionInfo.Shape.Set",null)}},{key:"draw",value:function(e){if(!this.valid){var t=this.ctx,i=t.globalCompositeOperation;e=void 0===e||e,e&&this.clear();var n=this,a=!0,o=!1,r=void 0;try{for(var s,l=this.shapes[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;c.options.has("skipDraw")&&c.options.get("skipDraw")||void 0!==jt.getLayer()&&c.visibleInCanvas(n.canvas)&&("fow"===n.name&&jt.getLayer().name!==n.name||c.drawAuras(t))}}catch(O){o=!0,r=O}finally{try{a||null==l.return||l.return()}finally{if(o)throw r}}var u=!0,h=!1,d=void 0;try{for(var v,f=this.shapes[Symbol.iterator]();!(u=(v=f.next()).done);u=!0){var p=v.value;p.options.has("skipDraw")&&p.options.get("skipDraw")||(0===p.labels.length&&_t.filterNoLabel||p.labels.length&&_t.labelFilters.length&&!p.labels.some((function(e){return _t.labelFilters.includes(e.uuid)}))||void 0!==jt.getLayer()&&p.visibleInCanvas(n.canvas)&&("fow"===n.name&&jt.getLayer().name!==n.name||p.draw(t)))}}catch(O){h=!0,d=O}finally{try{u||null==f.return||f.return()}finally{if(h)throw d}}if(null!=this.selection){t.fillStyle=this.selectionColor,t.strokeStyle=this.selectionColor,t.lineWidth=this.selectionWidth;var y=!0,g=!1,m=void 0;try{for(var b,w=this.selection[Symbol.iterator]();!(y=(b=w.next()).done);y=!0){var k=b.value;k.drawSelection(t)}}catch(O){g=!0,m=O}finally{try{y||null==w.return||w.return()}finally{if(g)throw m}}}t.globalCompositeOperation=i,this.valid=!0}}},{key:"moveShapeOrder",value:function(e,t,i){var n=this.shapes.indexOf(e);n!==t&&(this.shapes.splice(n,1),this.shapes.splice(t,0,e),i&&Je.emit("Shape.Order.Set",{shape:e.asDict(),index:t}),this.invalidate(!0))}}]),e}(),Wi=function e(){Object(y["a"])(this,e)};function Xi(e,t){var i=jt.getLayer("draw");if(void 0!==i){var n=i.ctx;n.lineJoin="round",n.lineJoin="round",n.beginPath(),n.strokeStyle=void 0===t?"rgb(".concat(255*Math.random(),", ").concat(255*Math.random(),", ").concat(255*Math.random(),")"):t,n.moveTo(ct(e[0][0]),ut(e[0][1]));var a=!0,o=!1,r=void 0;try{for(var s,l=e[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;n.lineTo(ct(c[0]),ut(c[1]))}}catch(u){o=!0,r=u}finally{try{a||null==l.return||l.return()}finally{if(o)throw r}}n.closePath(),n.stroke()}}function Yi(e,t){var i=jt.getLayer("draw");if(void 0!==i){var n=i.ctx;n.lineJoin="round",n.lineJoin="round",n.beginPath(),n.strokeStyle=void 0===t?"rgb(".concat(255*Math.random(),", ").concat(255*Math.random(),", ").concat(255*Math.random(),")"):t,n.moveTo(e[0][0],e[0][1]);var a=!0,o=!1,r=void 0;try{for(var s,l=e[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;n.lineTo(c[0],c[1])}}catch(u){o=!0,r=u}finally{try{a||null==l.return||l.return()}finally{if(o)throw r}}n.closePath(),n.stroke()}}function Ki(e,t){return t?e:ct(e)}function qi(e,t){return t?e:ut(e)}Wi.angleSteps=4,Wi.drawAngleLines=!1,Wi.drawFirstLightHit=!1,Wi.skipPlayerFOW=!1,Wi.skipLightFOW=!1,Wi.tempFill="fog";var Qi=0,Zi=0;function Ji(e,t,i,n,a){e.beginPath(),e.strokeStyle=n?"rgba(255, 0, 0, 0.30)":"rgba(0, 0, 0, 0.30)",e.moveTo(Ki(t[0],a),qi(t[1],a)),e.lineTo(Ki(i[0],a),qi(i[1],a)),e.closePath(),e.stroke()}function en(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Qi=0,Zi=0;var a=0,o=jt.getLayer("draw");if(void 0!==o){var r=o.ctx;i&&r.clearRect(0,0,2e3,1e3),r.lineJoin="round",r.lineJoin="round";var s=new gi(e);while(s.valid)s.next(),s.collect();s.collect();do{var l=s.edge.first.vertices[zt(s.edge.second)].point,c=s.edge.first.vertices[Ut(s.edge.second)].point;if(n>0){if(l[0]===-1/0||c[0]===-1/0){s.next();continue}Zi++,s.edge.first.constraints[s.edge.second]?(Qi++,2===n&&console.log("Edge: (*) ".concat(l," > ").concat(c))):2===n&&console.log("Edge: ".concat(l," > ").concat(c))}do{s.next(),s.collect()}while(s.valid)}while(null!==s.pos);var u=!0,h=!1,d=void 0;try{for(var v,f=e.triangles[Symbol.iterator]();!(u=(v=f.next()).done);u=!0){var p,y=v.value;if(!y.isInfinite()){a++;var g=[];r.fillStyle="red",void 0!==y.vertices[0]&&(g.push(y.vertices[0].point),r.beginPath(),r.arc(Ki(y.vertices[0].point[0],t),qi(y.vertices[0].point[1],t),5,0,2*Math.PI),r.closePath(),r.fill()),void 0!==y.vertices[1]&&(g.push(y.vertices[1].point),r.arc(Ki(y.vertices[1].point[0],t),qi(y.vertices[1].point[1],t),5,0,2*Math.PI),r.closePath(),r.fill()),void 0!==y.vertices[2]&&(g.push(y.vertices[2].point),r.arc(Ki(y.vertices[2].point[0],t),qi(y.vertices[2].point[1],t),5,0,2*Math.PI),r.closePath(),r.fill()),2===n&&(p=console).log.apply(p,["[T] "].concat(g,[y.constraints])),r.moveTo(Ki(y.vertices[0].point[0],t),qi(y.vertices[0].point[1],t)),void 0!==y.vertices[0]&&void 0!==y.vertices[1]&&Ji(r,y.vertices[0].point,y.vertices[1].point,y.constraints[2],t),void 0!==y.vertices[1]&&void 0!==y.vertices[2]&&Ji(r,y.vertices[1].point,y.vertices[2].point,y.constraints[0],t),void 0!==y.vertices[2]&&void 0!==y.vertices[0]&&Ji(r,y.vertices[2].point,y.vertices[0].point,y.constraints[1],t)}}}catch(m){h=!0,d=m}finally{try{u||null==f.return||f.return()}finally{if(h)throw d}}n>0&&(console.log("Edges: ".concat(Qi,"/").concat(Zi)),console.log("Faces: ".concat(a)))}}function tn(e,t,i){void 0===i&&(i=_t.drawTEContour);var n=[e.x,e.y],a=[],o=_i[t].locate(n,null).loc;return null===o?(console.error("Triangle not found"),[]):(a.push(o.vertices[1].point),o.isConstrained(0)||nn(n,o.vertices[2].point,o.vertices[1].point,o,0,a),a.push(o.vertices[2].point),o.isConstrained(1)||nn(n,o.vertices[0].point,o.vertices[2].point,o,1,a),a.push(o.vertices[0].point),o.isConstrained(2)||nn(n,o.vertices[1].point,o.vertices[0].point,o,2,a),i&&Xi(a,"red"),a)}function nn(e,t,i,n,a,o){var r=n.neighbours[a],s=r.indexT(n),l=zt(s),c=Ut(s),u=r.vertices[s],h=r.vertices[c],d=r.vertices[l],v=[r,l],f=[r,c],p=Ht(e,i,u.point),y=Ht(e,t,u.point);if(p===ci.COUNTERCLOCKWISE)if(v[0].isConstrained(v[1]))i!==h.point&&o.push(an(e,i,u.point,h.point)),y===ci.COUNTERCLOCKWISE&&o.push(an(e,t,u.point,h.point));else{if(y===ci.COUNTERCLOCKWISE)return nn(e,t,i,r,l,o);nn(e,u.point,i,r,l,o)}if(p!==ci.CLOCKWISE&&y!==ci.COUNTERCLOCKWISE&&o.push(u.point),y===ci.CLOCKWISE)return f[0].isConstrained(f[1])?(p===ci.CLOCKWISE&&o.push(an(e,i,u.point,d.point)),void(t!==d.point&&o.push(an(e,t,u.point,d.point)))):p===ci.CLOCKWISE?nn(e,t,i,r,c,o):nn(e,t,u.point,r,c,o)}function an(e,t,i,n){var a=(n[1]-i[1])*(t[0]-e[0])-(n[0]-i[0])*(t[1]-e[1]),o=((n[0]-i[0])*(e[1]-i[1])-(n[1]-i[1])*(e[0]-i[0]))/a,r=e[0]+o*(t[0]-e[0]),s=e[1]+o*(t[1]-e[1]);return[r,s]}window.DP=Xi,window.DPL=Yi,window.DPT=en;var on=function(e){function t(e,i){var n;return Object(y["a"])(this,t),n=Object(m["a"])(this,Object(b["a"])(t).call(this,e,i)),n.isVisionLayer=!0,n.preFogShapes=[],n.virtualCanvas=document.createElement("canvas"),n.virtualCanvas.width=window.innerWidth,n.virtualCanvas.height=window.innerHeight,n.vCtx=n.virtualCanvas.getContext("2d"),n}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"addShape",value:function(e,i,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];Object(It["a"])(Object(b["a"])(t.prototype),"addShape",this).call(this,e,i,n,a),e.options.has("preFogShape")&&e.options.get("preFogShape")&&this.preFogShapes.push(e)}},{key:"removeShape",value:function(e,i,n){if(e.options.has("preFogShape")&&e.options.get("preFogShape")){var a=this.preFogShapes.findIndex((function(t){return t.uuid===e.uuid}));this.preFogShapes.splice(a,1)}Object(It["a"])(Object(b["a"])(t.prototype),"removeShape",this).call(this,e,i,n)}},{key:"draw",value:function(){var e=this;if(!this.valid){var i=this.ctx;if(Wi.skipLightFOW)return i.clearRect(0,0,this.canvas.width,this.canvas.height),void(this.valid=!0);var n=i.globalCompositeOperation;i.clearRect(0,0,this.canvas.width,this.canvas.height),i.fillStyle="rgba(0, 0, 0, 1)";var a=jt.getLayer("draw").ctx;if((Wi.drawAngleLines||Wi.drawFirstLightHit)&&a.clearRect(0,0,a.canvas.width,a.canvas.height),_t.fullFOW&&jt.hasLayer("tokens")){var o=!0,r=!1,s=void 0;try{for(var l,c=jt.getLayer("tokens").shapes[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var u=l.value;if(u.ownedBy()&&u.isToken){var h=u.getBoundingBox(),d=lt(u.center()),v=.8*ht(h.w);i.beginPath(),i.arc(d.x,d.y,v,0,2*Math.PI);var f=i.createRadialGradient(d.x,d.y,v/2,d.x,d.y,v);f.addColorStop(0,"rgba(0, 0, 0, 1)"),f.addColorStop(1,"rgba(0, 0, 0, 0)"),i.fillStyle=f,i.fill()}}}catch(E){r=!0,s=E}finally{try{o||null==c.return||c.return()}finally{if(r)throw s}}}this.vCtx.clearRect(0,0,window.innerWidth,window.innerHeight);var p=!0,y=!1,g=void 0;try{for(var m,w=function(){var t=m.value,n=jt.UUIDMap.get(t.shape);if(void 0===n)return"continue";var o=n.auras.find((function(e){return e.uuid===t.aura}));if(void 0===o)return"continue";var r=dt(o.value+o.dim),s=n.center(),l=lt(s),c=new Ai(s,r);if(!c.visibleInCanvas(i.canvas))return"continue";if("bvh"===Li.visionMode){var u,h=-1,d=new Path2D;d.moveTo(l.x,l.y);for(var v=0;v<2*Math.PI;v+=Wi.angleSteps/180*Math.PI){var f=new nt(s.x+r*Math.cos(v),s.y+r*Math.sin(v));Wi.drawAngleLines&&(a.beginPath(),a.moveTo(ct(s.x),ut(s.y)),a.lineTo(ct(f.x),ut(f.y)),a.stroke());var p=rt.fromPoints(s,f),y=Li.BV.intersect(p);if(0===v&&(u=y.hit?y.intersect:f),y.hit)-1!==h&&(d.arc(l.x,l.y,vt(o.value+o.dim),h,v),h=-1),d.lineTo(ct(y.intersect.x),ut(y.intersect.y));else if(-1===h){h=v;var g=lt(f);i.lineTo(g.x,g.y)}}if(-1===h?d.lineTo(ct(u.x),ut(u.y)):d.arc(l.x,l.y,vt(o.value+o.dim),h,2*Math.PI),_t.fullFOW){if(o.dim>0){var b=i.createRadialGradient(l.x,l.y,vt(o.value),l.x,l.y,vt(o.value+o.dim));b.addColorStop(0,"rgba(0, 0, 0, 1)"),b.addColorStop(1,"rgba(0, 0, 0, 0)"),i.fillStyle=b}else i.fillStyle="rgba(0, 0, 0, 1)";i.fill(d)}o.lastPath=d}else{e.vCtx.globalCompositeOperation="source-over",e.vCtx.fillStyle="rgba(0, 0, 0, 1)";var w=tn(s,ki.VISION);e.vCtx.beginPath(),e.vCtx.moveTo(ct(w[0][0]),ut(w[0][1]));var k=!0,O=!1,x=void 0;try{for(var S,_=w[Symbol.iterator]();!(k=(S=_.next()).done);k=!0){var C=S.value;e.vCtx.lineTo(ct(C[0]),ut(C[1]))}}catch(E){O=!0,x=E}finally{try{k||null==_.return||_.return()}finally{if(O)throw x}}if(e.vCtx.closePath(),e.vCtx.fill(),o.dim>0){var j=e.vCtx.createRadialGradient(l.x,l.y,vt(o.value),l.x,l.y,vt(o.value+o.dim));j.addColorStop(0,"rgba(0, 0, 0, 1)"),j.addColorStop(1,"rgba(0, 0, 0, 0)"),e.vCtx.fillStyle=j}else e.vCtx.fillStyle="rgba(0, 0, 0, 1)";e.vCtx.globalCompositeOperation="source-in",e.vCtx.beginPath(),e.vCtx.arc(l.x,l.y,vt(o.value+o.dim),0,2*Math.PI),e.vCtx.fill(),i.drawImage(e.virtualCanvas,0,0),o.lastPath=e.updateAuraPath(w,c),n.invalidate(!0)}},k=Li.visionSources[Symbol.iterator]();!(p=(m=k.next()).done);p=!0)w()}catch(E){y=!0,g=E}finally{try{p||null==k.return||k.return()}finally{if(y)throw g}}_t.fowLOS&&(i.globalCompositeOperation="source-in",i.drawImage(jt.getLayer("fow-players").canvas,0,0));var O=!0,x=!1,S=void 0;try{for(var _,C=this.preFogShapes[Symbol.iterator]();!(O=(_=C.next()).done);O=!0){var j=_.value;if(j.visibleInCanvas(this.canvas)){var L=j.globalCompositeOperation;_t.fullFOW||("source-over"===j.globalCompositeOperation?j.globalCompositeOperation="destination-out":"destination-out"===j.globalCompositeOperation&&(j.globalCompositeOperation="source-over")),j.draw(i),j.globalCompositeOperation=L}}}catch(E){x=!0,S=E}finally{try{O||null==C.return||C.return()}finally{if(x)throw S}}_t.fullFOW&&(i.globalCompositeOperation="source-out",i.fillStyle=kt(),i.fillRect(0,0,i.canvas.width,i.canvas.height)),Object(It["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,!1),i.globalCompositeOperation=n}}},{key:"updateAuraPath",value:function(e,t){var i=new Path2D,n=lt(t.center()),a=ht(t.r),o=null,r=null,s=[],l=!0,c=!1,u=void 0;try{for(var h,d=e.map((function(e){return nt.fromArray(e)})).entries()[Symbol.iterator]();!(l=(h=d.next()).done);l=!0){var v=Object(Et["a"])(h.value,2),f=v[0],p=v[1],y=nt.fromArray(e[(f+1)%e.length]),g=lt(p),m=lt(y),b=si(t.center(),t.r,p,y).map((function(e){return lt(e)}));if(0===b.length){if(!t.contains(p))continue;b.push(g,m)}else if(1===b.length){if(Yt(b[0].asArray(),g.asArray())||Yt(b[0].asArray(),m.asArray()))continue;t.contains(p)?b.unshift(g):b.push(m)}if(s.length>0){var w=s[s.length-1];if(Yt(w[0].asArray(),b[1].asArray())&&Yt(w[1].asArray(),b[0].asArray()))continue;if(Yt(w[0].asArray(),b[0].asArray())&&Yt(w[1].asArray(),b[1].asArray()))continue}s.push(b)}}catch(_){c=!0,u=_}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}if(s.length<=1)return i.arc(n.x,n.y,a,0,2*Math.PI),i;for(var k=0,O=s;k<O.length;k++){var x=O[k],S=Math.atan2(x[0].y-n.y,x[0].x-n.x);null===r?(i.moveTo(x[0].x,x[0].y),o=Math.atan2(x[0].y-n.y,x[0].x-n.x)):r!==S&&i.arc(n.x,n.y,a,r,S),r=Math.atan2(x[1].y-n.y,x[1].x-n.x),i.lineTo(x[1].x,x[1].y)}return o&&r?o!==r&&i.arc(n.x,n.y,a,r,o):i.arc(n.x,n.y,a,0,2*Math.PI),i}}]),t}(Gi),rn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.isVisionLayer=!0,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"draw",value:function(){if(!this.valid){var e=this.ctx;if(!_t.fowLOS||Wi.skipPlayerFOW)return e.clearRect(0,0,this.canvas.width,this.canvas.height),void(this.valid=!0);e.clearRect(0,0,this.canvas.width,this.canvas.height);var i=e.globalCompositeOperation;e.fillStyle="rgba(0, 0, 0, 1)",_t.IS_DM||Object(It["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,!_t.fullFOW);var n=e.canvas.width+e.canvas.height,a=!0,o=!1,r=void 0;try{for(var s,l=_t.activeTokens[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value,u=jt.UUIDMap.get(c);if(void 0!==u){var h=u.center(),d=lt(h);if("bvh"===Li.visionMode){e.beginPath();for(var v=-1,f=0;f<2*Math.PI;f+=Wi.angleSteps/2/180*Math.PI){var p=Math.cos(f),y=Math.sin(f),g=new rt(h,new ot(p,y)),m=Li.BV.intersect(g);m.hit?(-1!==v&&(e.arc(d.x,d.y,n,v,f),v=-1),e.lineTo(ct(m.intersect.x),ut(m.intersect.y))):-1===v&&(e.lineTo(d.x+n*p,d.y+n*y),v=f)}-1!==v?e.arc(d.x,d.y,n,v,2*Math.PI):e.closePath(),e.fill()}else{var w=e.createRadialGradient(d.x,d.y,vt(_t.visionRangeMin),d.x,d.y,vt(_t.visionRangeMax));w.addColorStop(0,"rgba(0, 0, 0, 1)"),w.addColorStop(1,"rgba(0, 0, 0, 0)"),e.fillStyle=w;try{var k=tn(u.center(),ki.VISION);e.beginPath(),e.moveTo(ct(k[0][0]),ut(k[0][1]));var O=!0,x=!1,S=void 0;try{for(var _,C=k[Symbol.iterator]();!(O=(_=C.next()).done);O=!0){var j=_.value;e.lineTo(ct(j[0]),ut(j[1]))}}catch(L){x=!0,S=L}finally{try{O||null==C.return||C.return()}finally{if(x)throw S}}e.closePath(),e.fill()}catch(E){}}}}}catch(L){o=!0,r=L}finally{try{a||null==l.return||l.return()}finally{if(o)throw r}}_t.IS_DM&&Object(It["a"])(Object(b["a"])(t.prototype),"draw",this).call(this,!_t.fullFOW),e.globalCompositeOperation=i}}}]),t}(Gi),sn=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"invalidate",value:function(){this.valid=!1}},{key:"draw",value:function(e){this.valid||this.drawGrid()}},{key:"drawGrid",value:function(){var e=this.ctx;this.clear(),e.beginPath();for(var t=_t.gridSize,i=0;i<this.width;i+=t*_t.zoomFactor)e.moveTo(i+_t.panX%t*_t.zoomFactor,0),e.lineTo(i+_t.panX%t*_t.zoomFactor,this.height),e.moveTo(0,i+_t.panY%t*_t.zoomFactor),e.lineTo(this.width,i+_t.panY%t*_t.zoomFactor);e.strokeStyle=_t.gridColour,e.lineWidth=1,e.stroke(),this.valid=!0}}]),t}(Gi);function ln(e){var t,i=document.createElement("canvas");i.style.zIndex=jt.layers.length.toString(),i.width=window.innerWidth,i.height=window.innerHeight,t="grid"===e.type_?new sn(i,e.name):"fow"===e.type_?new on(i,e.name):"fow-players"===e.type_?new rn(i,e.name):new Gi(i,e.name),t.selectable=e.selectable,t.playerEditable=e.player_editable,jt.addLayer(t);var n=document.getElementById("layers");null!==n?("fow-players"!==e.name&&n.appendChild(i),"grid"===e.type_&&e.size&&_t.setGridSize({gridSize:e.size,sync:!1}),t.setShapes(e.shapes)):console.warn("Layers div is missing, this will prevent the main game board from loading!")}function cn(e){var t=jt.getLayer();if(void 0!==t&&null!==e&&null!==e.dataTransfer){var i=document.createElement("img");i.src=e.dataTransfer.getData("text/plain");var n=new Ti(i,new nt(pt(e.clientX),yt(e.clientY)),gt(i.width),gt(i.height));if(n.src=new URL(i.src).pathname,_t.useGrid){var a=_t.gridSize;n.refPoint=new nt(Math.round(n.refPoint.x/a)*a,Math.round(n.refPoint.y/a)*a),n.w=Math.max(Math.round(n.w/a)*a,a),n.h=Math.max(Math.round(n.h/a)*a,a)}t.addShape(n,!0)}}var un=function(){function e(){Object(y["a"])(this,e),this.shown=!1;var t=new nt(0,0);this.annotationText=new Ui(t,"","bold 20px serif",0,"rgba(230, 230, 230, 1)"),this.annotationRect=new Ni(t,0,0,"rgba(0, 0, 0, 0.6)")}return Object(g["a"])(e,[{key:"setActiveText",value:function(e){if(void 0===this.layer){if(!jt.hasLayer("draw"))return void console.warn("There is no draw layer to draw annotations on!");this.layer=jt.getLayer("draw"),this.layer.addShape(this.annotationRect,!1),this.layer.addShape(this.annotationText,!1)}this.shown=""!==e,this.annotationText.refPoint=ft(new at(this.layer.canvas.width/2,50)),this.annotationText.text=e;var t=this.shown?this.annotationText.getMaxWidth(this.layer.ctx)+10:0,i=this.shown?this.annotationText.getMaxHeight(this.layer.ctx)+10:0;this.annotationRect.refPoint=ft(new at(this.layer.canvas.width/2-t/2,30)),this.annotationRect.w=t/_t.zoomFactor,this.annotationRect.h=i/_t.zoomFactor,this.layer.invalidate(!0)}}]),e}(),hn=function(){function e(){Object(y["a"])(this,e),this.selectedTool=0,this.annotationManager=new un}return Object(g["a"])(e,[{key:"addShape",value:function(e){if(jt.hasLayer(e.layer)){var t=jt.getLayer(e.layer),i=$i(e);void 0!==i?(t.addShape(i,!1),t.invalidate(!1)):console.log("Shape with unknown type ".concat(e.type_," could not be added"))}else console.log("Shape with unknown layer ".concat(e.layer," could not be added"))}},{key:"updateShape",value:function(e){if(jt.hasLayer(e.shape.layer)){var t=$i(e.shape);if(void 0!==t){var i=jt.UUIDMap.get(e.shape.uuid);if(void 0!==i){var n=t.owners!==i.owners,a=Object.assign(i,t);a.checkVisionSources(),a.setMovementBlock(a.movementObstruction),a.setIsToken(a.isToken),e.redraw&&(a.visionObstruction&&Li.recalculateVision(),jt.getLayer(e.shape.layer).invalidate(!1),a.movementObstruction&&Li.recalculateMovement()),n&&tt.$emit("Initiative.ForceUpdate")}else console.log("Shape with unknown id could not be updated")}else console.log("Shape with unknown type ".concat(e.shape.type_," could not be added"))}else console.log("Shape with unknown layer ".concat(e.shape.layer," could not be added"))}},{key:"setCenterPosition",value:function(e){var t=lt(e);_t.increasePanX((window.innerWidth/2-t.x)/_t.zoomFactor),_t.increasePanY((window.innerHeight/2-t.y)/_t.zoomFactor),jt.invalidate(),st(_t.locationOptions)}}]),e}(),dn=new hn;window.gameManager=dn,Je.on("connect",(function(){console.log("Connected")})),Je.on("disconnect",(function(){console.log("Disconnected")})),Je.on("connect_error",(function(e){console.error("Could not connect to game session."),kr.push("/dashboard")})),Je.on("error",(function(e){console.error("Game session does not exist."),kr.push("/dashboard")})),Je.on("redirect",(function(e){console.log("redirecting"),kr.push(e)})),Je.on("Room.Info.Set",(function(e){_t.setRoomName(e.name),_t.setRoomCreator(e.creator),_t.setInvitationCode(e.invitationCode),_t.setIsLocked({isLocked:e.isLocked,sync:!1}),_t.setPlayers(e.players)})),Je.on("Room.Info.InvitationCode.Set",(function(e){_t.setInvitationCode(e),tt.$emit("DmSettings.RefreshedInviteCode")})),Je.on("Room.Info.Players.Add",(function(e){_t.addPlayer(e)})),Je.on("Username.Set",(function(e){_t.setUsername(e),_t.setDM(e===decodeURIComponent(window.location.pathname.split("/")[2]))})),Je.on("Client.Options.Set",(function(e){_t.setGridColour({colour:e.grid_colour,sync:!1}),_t.setFOWColour({colour:e.fow_colour,sync:!1}),_t.setRulerColour({colour:e.ruler_colour,sync:!1}),_t.setPanX(e.pan_x),_t.setPanY(e.pan_y),_t.setZoomDisplay(xt(e.zoom_factor)),e.active_layer&&jt.selectLayer(e.active_layer,!1),void 0!==jt.getGridLayer()&&jt.getGridLayer().invalidate()})),Je.on("Location.Set",(function(e){void 0!==e.name&&_t.setLocationName(e.name),void 0!==e.unit_size&&_t.setUnitSize({unitSize:e.unit_size,sync:!1}),void 0!==e.unit_size_unit&&_t.setUnitSizeUnit({unitSizeUnit:e.unit_size_unit,sync:!1}),void 0!==e.use_grid&&_t.setUseGrid({useGrid:e.use_grid,sync:!1}),void 0!==e.full_fow&&_t.setFullFOW({fullFOW:e.full_fow,sync:!1}),void 0!==e.fow_opacity&&_t.setFOWOpacity({fowOpacity:e.fow_opacity,sync:!1}),void 0!==e.fow_los&&_t.setLineOfSight({fowLOS:e.fow_los,sync:!1}),void 0!==e.vision_min_range&&_t.setVisionRangeMin({value:e.vision_min_range,sync:!1}),void 0!==e.vision_max_range&&_t.setVisionRangeMax({value:e.vision_max_range,sync:!1}),void 0!==e.vision_mode&&(Li.setVisionMode({mode:e.vision_mode,sync:!1}),Li.recalculateVision(),Li.recalculateMovement())})),Je.on("Position.Set",(function(e){_t.setZoomDisplay(e.zoom),dn.setCenterPosition(new nt(e.x,e.y))})),Je.on("Notes.Set",(function(e){var t=!0,i=!1,n=void 0;try{for(var a,o=e[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var r=a.value;_t.newNote({note:r,sync:!1})}}catch(s){i=!0,n=s}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}})),Je.on("Asset.List.Set",(function(e){_t.setAssets(e)})),Je.on("Board.Set",(function(e){_t.clear(),Li.clear(),_t.setLocations(e.locations),document.getElementById("layers").innerHTML="",_t.resetLayerInfo(),jt.reset();var t=!0,i=!1,n=void 0;try{for(var a,o=e.layers[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var r=a.value;ln(r)}}catch(s){i=!0,n=s}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}jt.selectLayer(jt.getLayer().name,!1),tt.$emit("Initiative.Clear"),Li.recalculateVision(),Li.recalculateMovement(),_t.setBoardInitialized(!0)})),Je.on("Gridsize.Set",(function(e){_t.setGridSize({gridSize:e,sync:!1})})),Je.on("Shape.Add",(function(e){dn.addShape(e)})),Je.on("Shape.Remove",(function(e){if(jt.UUIDMap.has(e.uuid))if(jt.hasLayer(e.layer)){var t=jt.getLayer(e.layer);t.removeShape(jt.UUIDMap.get(e.uuid),!1),t.invalidate(!1)}else console.log("Attempted to remove shape from an unknown layer ".concat(e.layer));else console.log("Attempted to remove an unknown shape")})),Je.on("Shape.Order.Set",(function(e){if(jt.UUIDMap.has(e.shape.uuid))if(jt.hasLayer(e.shape.layer)){var t=jt.UUIDMap.get(e.shape.uuid),i=jt.getLayer(t.layer);i.moveShapeOrder(t,e.index,!1)}else console.log("Attempted to remove shape from an unknown layer ".concat(e.shape.layer));else console.log("Attempted to move the shape order of an unknown shape")})),Je.on("Shape.Layer.Change",(function(e){var t=jt.UUIDMap.get(e.uuid);void 0!==t&&t.moveLayer(e.layer,!1)})),Je.on("Shape.Update",(function(e){dn.updateShape(e)})),Je.on("Temp.Clear",(function(e){var t=!0,i=!1,n=void 0;try{for(var a,o=e[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var r=a.value;if(jt.UUIDMap.has(r)){var s=jt.UUIDMap.get(r);if(jt.hasLayer(s.layer)){var l=jt.UUIDMap.get(s.uuid);jt.getLayer(s.layer).removeShape(l,!1)}else console.log("Attempted to remove shape from an unknown layer ".concat(s.layer))}else console.log("Attempted to remove an unknown temporary shape")}}catch(c){i=!0,n=c}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}})),Je.on("Labels.Set",(function(e){var t=!0,i=!1,n=void 0;try{for(var a,o=e[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var r=a.value;_t.addLabel(r)}}catch(s){i=!0,n=s}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}})),Je.on("Label.Visibility.Set",(function(e){_t.setLabelVisibility(e)})),Je.on("Label.Add",(function(e){_t.addLabel(e)})),Je.on("Label.Delete",(function(e){_t.deleteLabel(e)})),Je.on("Labels.Filter.Add",(function(e){_t.labelFilters.push(e),jt.invalidate()})),Je.on("Labels.Filter.Remove",(function(e){var t=_t.labelFilters.indexOf(e);t>=0&&(_t.labelFilters.splice(t,1),jt.invalidate())})),Je.on("Labels.Filters.Set",(function(e){_t.setLabelFilters(e)}));var vn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Initiative")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("draggable",{attrs:{id:"initiative-list",setData:e.fakeSetData,disabled:!e.$store.state.game.IS_DM},on:{change:e.updateOrder},model:{value:e.$store.state.initiative.data,callback:function(t){e.$set(e.$store.state.initiative,"data",t)},expression:"$store.state.initiative.data"}},[e._l(e.$store.state.initiative.data,(function(t){return[i("div",{key:t.uuid,staticStyle:{display:"flex","flex-direction":"column","align-items":"flex-end"}},[i("div",{staticClass:"initiative-actor",class:{"initiative-selected":e.$store.state.initiative.currentActor===t.uuid},style:{cursor:e.$store.state.game.IS_DM&&"move"},on:{mouseenter:function(i){return e.toggleHighlight(t,!0)},mouseleave:function(i){return e.toggleHighlight(t,!1)}}},[t.has_img?[i("img",{attrs:{src:t.source,width:"30px",height:"30px"}})]:[i("span",{staticStyle:{width:"auto"}},[e._v(e._s(t.source))])],i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:t.initiative,expression:"actor.initiative",modifiers:{lazy:!0,number:!0}}],class:{notAllowed:!e.owns(t)},attrs:{type:"text",placeholder:"value",disabled:!e.owns(t)},domProps:{value:t.initiative},on:{change:[function(i){e.$set(t,"initiative",e._n(i.target.value))},function(i){return e.syncInitiative(t)}],blur:function(t){return e.$forceUpdate()}}}),i("div",{staticClass:"initiative-effects-icon",class:{notAllowed:!e.owns(t)},staticStyle:{opacity:"0.6"},on:{click:function(i){e.createEffect(t,e.getDefaultEffect(),!0)}}},[i("i",{staticClass:"fas fa-stopwatch"}),t.effects?[e._v(" "+e._s(t.effects.length)+" ")]:[e._v(" 0 ")]],2),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:t.visible?"1.0":"0.3"},on:{click:function(i){return e.toggleOption(t,"visible")}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:t.group?"1.0":"0.3"},on:{click:function(i){return e.toggleOption(t,"group")}}},[i("i",{staticClass:"fas fa-users"})]),i("div",{class:{notAllowed:!e.owns(t)},style:{opacity:e.owns(t)?"1.0":"0.3"},on:{click:function(i){return e.removeInitiative(t.uuid,!0,!0)}}},[i("i",{staticClass:"fas fa-trash-alt"})])],2),t.effects?i("div",{staticClass:"initiative-effect"},e._l(t.effects,(function(n){return i("div",{key:n.uuid},[i("input",{directives:[{name:"model",rawName:"v-model",value:n.name,expression:"effect.name"}],attrs:{type:"text",size:n.name.length||1},domProps:{value:n.name},on:{change:function(i){return e.updateEffect(t.uuid,n,!0)},input:function(t){t.target.composing||e.$set(n,"name",t.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model",value:n.turns,expression:"effect.turns"}],attrs:{type:"text",size:n.turns.toString().length||1},domProps:{value:n.turns},on:{change:function(i){return e.updateEffect(t.uuid,n,!0)},input:function(t){t.target.composing||e.$set(n,"turns",t.target.value)}}})])})),0):e._e()])]}))],2),i("div",{attrs:{id:"initiative-bar"}},[i("div",{attrs:{id:"initiative-round"}},[e._v("Round "+e._s(e.$store.state.initiative.roundCounter))]),i("div",{staticStyle:{display:"flex"}}),i("div",{staticClass:"initiative-bar-button",style:e.visionLock?"background-color: #82c8a0":"",on:{click:e.toggleVisionLock}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{staticClass:"initiative-bar-button",style:e.cameraLock?"background-color: #82c8a0":"",on:{click:function(t){e.cameraLock=!e.cameraLock}}},[i("i",{staticClass:"fas fa-video"})]),i("div",{staticClass:"initiative-bar-button",class:{notAllowed:!e.$store.state.game.IS_DM},on:{click:function(t){e.setRound(0,!0),e.updateTurn(e.$store.state.initiative.data[0].uuid,!0)}}},[i("i",{staticClass:"fas fa-sync-alt"})]),i("div",{staticClass:"initiative-bar-button",class:{notAllowed:!e.$store.state.game.IS_DM},on:{click:e.nextTurn}},[i("i",{staticClass:"fas fa-chevron-right"})])])],1)])},fn=[],pn=i("310e"),yn=i.n(pn);function gn(e){return bn.data.some((function(t){return t.uuid===e}))}var mn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.data=[],e.currentActor=null,e.roundCounter=0,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"clear",value:function(){this.data=[],this.currentActor=null}},{key:"setCurrentActor",value:function(e){this.currentActor=e}},{key:"setData",value:function(e){this.data=e}},{key:"addInitiative",value:function(e){var t=this.data.findIndex((function(t){return t.uuid===e.uuid}));t>=0||(void 0===e.initiative&&(e.initiative=0),Je.emit("Initiative.Update",e))}},{key:"setRoundCounter",value:function(e){this.roundCounter=e}},{key:"setTurn",value:function(e){this.currentActor=e}}]),t}(A["d"]);Object(k["a"])([A["c"]],mn.prototype,"clear",null),Object(k["a"])([A["c"]],mn.prototype,"setCurrentActor",null),Object(k["a"])([A["c"]],mn.prototype,"setData",null),Object(k["a"])([A["c"]],mn.prototype,"addInitiative",null),Object(k["a"])([A["c"]],mn.prototype,"setRoundCounter",null),Object(k["a"])([A["c"]],mn.prototype,"setTurn",null),mn=Object(k["a"])([Object(A["b"])({dynamic:!0,store:R,name:"initiative",namespaced:!0})],mn);var bn=Object(A["e"])(mn);n["default"].component("draggable",yn.a);var wn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.visionLock=!1,e.cameraLock=!1,e._activeTokens=[],e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("Initiative.Clear",bn.clear),tt.$on("Initiative.Remove",(function(t){return e.removeInitiative(t)})),tt.$on("Initiative.Show",(function(){return e.visible=!0})),tt.$on("Initiative.ForceUpdate",(function(){return e.$forceUpdate()})),Je.on("Initiative.Set",bn.setData),Je.on("Initiative.Turn.Set",(function(t){return e.setTurn(t)})),Je.on("Initiative.Turn.Update",(function(t){return e.updateTurn(t,!1)})),Je.on("Initiative.Round.Update",(function(t){return e.setRound(t,!1)})),Je.on("Initiative.Effect.New",(function(t){var i=e.getActor(t.actor);void 0!==i&&e.createEffect(i,t.effect,!1)})),Je.on("Initiative.Effect.Update",(function(t){return e.updateEffect(t.actor,t.effect,!1)}))}},{key:"beforeDestroy",value:function(){tt.$off("Initiative.Clear"),tt.$off("Initiative.Remove"),tt.$off("Initiative.Show"),Je.off("Initiative.Set"),Je.off("Initiative.Turn.Set"),Je.off("Initiative.Turn.Update"),Je.off("Initiative.Round.Update"),Je.off("Initiative.Effect.New"),Je.off("Initiative.Effect.Update")}},{key:"getActor",value:function(e){return bn.data.find((function(t){return t.uuid===e}))}},{key:"owns",value:function(e){if(_t.IS_DM)return!0;var t=jt.UUIDMap.get(e.uuid);return void 0!==t&&t.owners.includes(_t.username)}},{key:"getDefaultEffect",value:function(){return{uuid:ve(),name:"New Effect",turns:10}}},{key:"fakeSetData",value:function(e){e.setData("Hack","")}},{key:"syncInitiative",value:function(e){Je.emit("Initiative.Update",e)}},{key:"removeInitiative",value:function(e){var t=bn.data.findIndex((function(t){return t.uuid===e}));if(!(t<0||bn.data[t].group)){this.syncInitiative({uuid:e});var i=jt.UUIDMap.get(e);void 0!==i&&i.showHighlight&&(i.showHighlight=!1,jt.getLayer(i.layer).invalidate(!0))}}},{key:"updateOrder",value:function(){_t.IS_DM&&Je.emit("Initiative.Set",bn.data.map((function(e){return e.uuid})))}},{key:"updateTurn",value:function(e,t){if(_t.IS_DM||!t){bn.setCurrentActor(e);var i=bn.data.find((function(t){return t.uuid===e}));if(void 0!==i){if(i.effects)for(var n=i.effects.length-1;n>=0;n--)i.effects[n].turns<=0?i.effects.splice(n,1):i.effects[n].turns--;if(this.visionLock&&(null!==e&&_t.ownedtokens.includes(e)?_t.setActiveTokens([e]):_t.setActiveTokens([])),this.cameraLock&&null!==e){var a=jt.UUIDMap.get(e);void 0!==a&&a.ownedBy()&&dn.setCenterPosition(a.center())}t&&Je.emit("Initiative.Turn.Update",e)}}}},{key:"setRound",value:function(e,t){!_t.IS_DM&&t||(bn.setRoundCounter(e),t&&Je.emit("Initiative.Round.Update",e))}},{key:"setTurn",value:function(e){bn.setTurn(e)}},{key:"nextTurn",value:function(){if(_t.IS_DM){var e=bn.data,t=e[(e.findIndex((function(e){return e.uuid===bn.currentActor}))+1)%e.length];bn.data[0].uuid===t.uuid&&this.setRound(bn.roundCounter+1,!0),this.updateTurn(t.uuid,!0)}}},{key:"toggleHighlight",value:function(e,t){var i=jt.UUIDMap.get(e.uuid);void 0!==i&&(i.showHighlight=t,jt.getLayer(i.layer).invalidate(!0))}},{key:"toggleOption",value:function(e,t){this.owns(e)&&(e[t]=!e[t],this.syncInitiative(e))}},{key:"createEffect",value:function(e,t,i){this.owns(e)&&(e.effects.push(t),i&&Je.emit("Initiative.Effect.New",{actor:e.uuid,effect:t}))}},{key:"syncEffect",value:function(e,t){this.owns(e)&&Je.emit("Initiative.Effect.Update",{actor:e.uuid,effect:t})}},{key:"updateEffect",value:function(e,t,i){var n=bn.data.find((function(t){return t.uuid===e}));if(void 0!==n){var a=n.effects.findIndex((function(e){return e.uuid===t.uuid}));void 0!==a&&(n.effects[a]=t,i?this.syncEffect(n,t):this.$forceUpdate())}}},{key:"toggleVisionLock",value:function(){this.visionLock=!this.visionLock,this.visionLock?(this._activeTokens=Object(p["a"])(_t._activeTokens),null!==bn.currentActor&&_t.ownedtokens.includes(bn.currentActor)&&_t.setActiveTokens([bn.currentActor])):_t.setActiveTokens(this._activeTokens)}}]),t}(n["default"]);wn=Object(k["a"])([Object(O["b"])({components:{Modal:ee,draggable:yn.a}})],wn);var kn=wn,On=kn,xn=(i("96178"),Object(r["a"])(On,vn,fn,!1,null,"3f1843d1",null)),Sn=xn.exports,_n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Label manager")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("div",{staticClass:"grid"},[i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Category"}},[e._v("Cat.")])]),i("div",{staticClass:"header name"},[e._v("Name")]),i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Visible"}},[e._v("Vis.")])]),i("div",{staticClass:"header"},[i("abbr",{attrs:{title:"Delete"}},[e._v("Del.")])]),i("div",{staticClass:"separator spanrow",staticStyle:{margin:"0 0 7px"}}),i("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],ref:"search",staticClass:"spanrow",attrs:{type:"text",placeholder:"search"},domProps:{value:e.search},on:{input:function(t){t.target.composing||(e.search=t.target.value)}}})]),i("div",{staticClass:"grid scroll"},[e._l(e.categories,(function(t){return[e._l(e.labels[t],(function(t){return[i("div",{key:"row-"+t.uuid,staticClass:"row",on:{click:function(i){return e.selectLabel(t.uuid)}}},[t.category?[i("div",{key:"cat-"+t.uuid},[e._v(e._s(t.category))]),i("div",{key:"name-"+t.uuid,staticClass:"name"},[e._v(e._s(t.name))])]:e._e(),t.category?e._e():[i("div",{key:"cat-"+t.uuid}),i("div",{key:"name-"+t.uuid,staticClass:"name"},[e._v(e._s(t.name))])],i("div",{key:"visible-"+t.uuid,class:{"lower-opacity":!t.visible},style:{textAlign:"center"},on:{click:function(i){return i.stopPropagation(),e.toggleVisibility(t)}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{key:"delete-"+t.uuid,on:{click:function(i){return i.stopPropagation(),e.deleteLabel(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})])],2)]}))]})),0===e.labels.length?[i("div",{attrs:{id:"no-labels"}},[e._v("No labels exist yet")])]:e._e()],2),i("div",{staticClass:"grid"},[i("div",{staticClass:"separator spanrow"}),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.newCategory,expression:"newCategory",modifiers:{trim:!0}}],attrs:{type:"text"},domProps:{value:e.newCategory},on:{input:function(t){t.target.composing||(e.newCategory=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),i("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.newName,expression:"newName",modifiers:{trim:!0}}],attrs:{type:"text"},domProps:{value:e.newName},on:{input:function(t){t.target.composing||(e.newName=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),i("button",{attrs:{id:"addLabelButton"},on:{click:function(t){return t.stopPropagation(),e.addLabel(t)}}},[e._v("Add")])])])])},Cn=[],jn=(i("b64b"),i("841c"),function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.newCategory="",e.newName="",e.search="",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("LabelManager.Open",(function(){e.visible=!0,e.newCategory="",e.newName="",e.$nextTick((function(){return e.$refs.search.focus()}))}))}},{key:"beforeDestroy",value:function(){tt.$off("LabelManager.Open")}},{key:"selectLabel",value:function(e){tt.$emit("EditDialog.AddLabel",e),this.visible=!1}},{key:"toggleVisibility",value:function(e){e.visible=!e.visible,Je.emit("Label.Visibility.Set",{uuid:e.uuid,visible:e.visible})}},{key:"addLabel",value:function(){if(""!==this.newName){var e={uuid:ve(),category:this.newCategory,name:this.newName,visible:!1,user:_t.username};_t.addLabel(e),Je.emit("Label.Add",e),this.newCategory="",this.newName=""}}},{key:"deleteLabel",value:function(e){_t.deleteLabel({uuid:e,user:_t.username}),Je.emit("Label.Delete",e)}},{key:"labels",get:function(){for(var e={"":[]},t=0,i=Object.keys(_t.labels);t<i.length;t++){var n=i[t],a=_t.labels[n];this.search.length&&"".concat(a.category.toLowerCase()).concat(a.name.toLowerCase()).search(this.search.toLowerCase())<0||a.user===_t.username&&(a.category?(a.category in e||(e[a.category]=[]),e[a.category].push(a),e[a.category].sort((function(e,t){return e.name.localeCompare(t.name)}))):e[""].push(a))}return e}},{key:"categories",get:function(){return Object.keys(this.labels).sort()}}]),t}(n["default"]));jn=Object(k["a"])([Object(O["b"])({components:{Modal:ee}})],jn);var Ln=jn,En=Ln,In=(i("ab66"),Object(r["a"])(En,_n,Cn,!1,null,"3261513c",null)),Pn=In.exports,Mn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"menuContainer"}},[i("div",{ref:"rm",style:{left:e.visible.settings?"200px":"0",top:e.visible.locations?"100px":"0"},attrs:{id:"radialmenu"}},[i("div",{staticClass:"rm-wrapper"},[i("div",{staticClass:"rm-toggler"},[i("ul",{staticClass:"rm-list",class:{"rm-list-dm":e.IS_DM}},[e.IS_DM?i("li",{staticClass:"rm-item",attrs:{id:"rm-locations"},on:{click:function(t){e.visible.locations=!e.visible.locations}}},[e._m(0)]):e._e(),i("li",{staticClass:"rm-item",attrs:{id:"rm-settings"},on:{click:function(t){e.visible.settings=!e.visible.settings}}},[e._m(1)])])]),e._m(2)])]),i("transition",{attrs:{name:"settings"},on:{enter:function(t){e.$refs.rm.style.transition="left 500ms"}}},[e.visible.settings?i("div",{ref:"settings",attrs:{id:"menu"},on:{click:e.settingsClick}},[i("div",{staticStyle:{width:"200px",height:"90%","overflow-y":"auto","overflow-x":"hidden"}},[e.IS_DM?[i("button",{staticClass:"menu-accordion"},[e._v("Assets")]),i("div",{staticClass:"menu-accordion-panel"},[i("a",{staticClass:"actionButton",attrs:{href:"/assets",target:"blank",title:"Open asset manager"}},[i("i",{staticClass:"fas fa-external-link-alt"})]),i("div",{staticClass:"directory",attrs:{id:"menu-tokens"}},[i("asset-node",{attrs:{asset:e.assets}}),e.assets?e._e():i("div",[e._v("No assets")])],1)]),i("button",{staticClass:"menu-accordion"},[e._v("Notes")]),i("div",{staticClass:"menu-accordion-panel"},[i("div",{staticClass:"menu-accordion-subpanel",attrs:{id:"menu-notes"}},[i("a",{staticClass:"actionButton",on:{click:e.createNote}},[i("i",{staticClass:"far fa-plus-square"})]),e._l(e.notes,(function(t){return i("div",{key:t.uuid,staticStyle:{cursor:"pointer"},on:{click:function(i){return e.openNote(t)}}},[e._v(" "+e._s(t.title||"[?]")+" ")])})),e.notes.length?e._e():i("div",[e._v("No notes")])],2)]),i("button",{staticClass:"menu-accordion",on:{click:e.openDmSettings}},[e._v("DM Options")])]:e._e(),i("button",{staticClass:"menu-accordion"},[e._v("Client Options")]),i("div",{staticClass:"menu-accordion-panel"},[i("div",{staticClass:"menu-accordion-subpanel"},[i("label",{attrs:{for:"gridColour"}},[e._v("Grid Colour:")]),i("color-picker",{attrs:{id:"gridColour",color:e.gridColour},on:{"update:color":function(t){e.gridColour=t}}}),i("label",{attrs:{for:"fowColour"}},[e._v("FOW Colour:")]),i("color-picker",{attrs:{id:"fowColour",color:e.fowColour},on:{"update:color":function(t){e.fowColour=t}}}),i("label",{attrs:{for:"rulerColour"}},[e._v("Ruler Colour:")]),i("color-picker",{attrs:{id:"rulerColour",color:e.rulerColour},on:{"update:color":function(t){e.rulerColour=t}}})],1)])],2),i("router-link",{staticClass:"menu-accordion",staticStyle:{"text-decoration":"none",display:"inline-block",position:"absolute",bottom:"0"},attrs:{to:"/dashboard"}},[e._v(" Exit ")])],1):e._e()]),i("transition",{attrs:{name:"locations"},on:{enter:function(t){e.$refs.rm.style.transition="top 500ms"}}},[e.IS_DM&&e.visible.locations?i("div",{attrs:{id:"locations-menu"}},[i("div",[e._l(e.locations,(function(t){return i("div",{key:t,style:[e.getCurrentLocation()===t?{"background-color":"#82c8a0"}:{}],on:{click:function(i){return e.changeLocation(t)}}},[e._v(" "+e._s(t)+" ")])})),i("div",{on:{click:e.createLocation}},[i("i",{staticClass:"fas fa-plus"})])],2)]):e._e()]),i("img",{attrs:{id:"dragImage"}})],1)},Tn=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{attrs:{href:"#"}},[i("i",{staticClass:"far fa-compass"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("a",{attrs:{href:"#"}},[i("i",{staticClass:"fas fa-cog"})])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"rm-topper"},[i("i",{staticClass:"icon-share-alt"})])}],An=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"outer",on:{click:function(t){return t.target!==t.currentTarget?null:e.open(t)}}},[i("div",{staticClass:"current-color",style:e.transparent?"background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==)":"background-color:"+e.color,on:{click:function(t){return t.target!==t.currentTarget?null:e.open(t)}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.display,expression:"display"}],staticClass:"mask",on:{click:function(t){return t.target!==t.currentTarget?null:e.closePicker(t)}}}),i("chrome-picker",{directives:[{name:"show",rawName:"v-show",value:e.display,expression:"display"}],ref:"chromePicker",style:{position:"fixed",left:e.left+"px",top:e.top+"px","z-index":9999},attrs:{value:e.color,tabindex:"-1"},on:{input:e.updateColor}})],1)},Dn=[],Rn=i("c345"),Nn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.display=!1,e.left=0,e.top=0,e.transparent=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){this.transparent=0===this.$refs.chromePicker.val.rgba.a,this.setPosition()}},{key:"open",value:function(){var e=this;this.display||this.disabled||(this.setPosition(),this.display=!0,this.$nextTick((function(){return e.$children[0].$el.focus()})))}},{key:"updateColor",value:function(e){this.transparent=0===e.rgba.a;var t=bt()(e.rgba).toRgbString();this.$emit("update:color",t),this.$emit("input",t)}},{key:"closePicker",value:function(){this.display=!1,this.$emit("change",this.color)}},{key:"setPosition",value:function(){var e=this.$el.getBoundingClientRect();e.right+224>window.innerWidth?this.left=e.left-224:this.left=e.right,e.bottom+242>window.innerHeight?this.top=e.top-242:this.top=e.bottom}}]),t}(n["default"]);Object(k["a"])([Object(K["a"])(String)],Nn.prototype,"color",void 0),Object(k["a"])([Object(K["a"])(Boolean)],Nn.prototype,"disabled",void 0),Nn=Object(k["a"])([Object(O["b"])({components:{"chrome-picker":Rn["Chrome"]}})],Nn);var Un=Nn,zn=Un,$n=(i("0b9a"),Object(r["a"])(zn,An,Dn,!1,null,"e45ccc1a",null)),Fn=$n.exports,Vn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ul",[e._l(e.folders,(function(t){return i("li",{key:t,staticClass:"folder",on:{click:function(t){return t.stopPropagation(),e.toggle(t)}}},[e._v(" "+e._s(t)+" "),i("asset-node",{attrs:{asset:e.asset[t]}})],1)})),e._l(e.files,(function(t){return i("li",{key:t.name,staticClass:"file draggable token",attrs:{draggable:"true"},on:{mouseover:function(i){e.showImage=t.hash},mouseout:function(t){e.showImage=null},dragstart:function(i){return e.dragStart(i,"/static/assets/"+t.hash)}}},[e._v(" "+e._s(t.name)+" "),e.showImage==t.hash?i("div",{staticClass:"preview"},[i("img",{staticClass:"asset-preview-image",attrs:{src:"/static/assets/"+t.hash}})]):e._e()])}))],2)},Hn=[],Bn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.showImage=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"toggle",value:function(e){for(var t=0;t<e.target.children.length;t++){var i=e.target.children[t];i.style.display=""===i.style.display?"block":""}}},{key:"dragStart",value:function(e,t){if(this.showImage=null,null!==e&&null!==e.dataTransfer){var i=e.target.querySelector(".preview");e.dataTransfer.setDragImage(i,0,0),e.dataTransfer.setData("text/plain",t)}}},{key:"folders",get:function(){return Object.keys(this.asset).filter((function(e){return!["__files"].includes(e)})).sort(fe)}},{key:"files",get:function(){return this.asset.__files?this.asset.__files.concat().sort((function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:-1})):[]}}]),t}(n["default"]);Object(k["a"])([Object(K["a"])()],Bn.prototype,"asset",void 0),Bn=Object(k["a"])([Object(O["b"])({name:"asset-node"})],Bn);var Gn=Bn,Wn=Gn,Xn=(i("3ba3"),Object(r["a"])(Wn,Vn,Hn,!1,null,"03f9ac64",null)),Yn=Xn.exports,Kn=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible={settings:!1,locations:!1},e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"settingsClick",value:function(e){if(e.target.classList.contains("menu-accordion")){e.target.classList.toggle("menu-accordion-active");var t=e.target.nextElementSibling;null!==t&&(t.style.display=""===t.style.display?"block":"")}}},{key:"getCurrentLocation",value:function(){return _t.locationName}},{key:"changeLocation",value:function(e){Je.emit("Location.Change",e)}},{key:"createLocation",value:function(){this.$parent.$refs.prompt.prompt("New location name:","Create new location").then((function(e){Je.emit("Location.New",e)}),(function(){}))}},{key:"createNote",value:function(){var e={title:"New note",text:"",uuid:ve()};_t.newNote({note:e,sync:!0}),this.openNote(e)}},{key:"openNote",value:function(e){this.$parent.$refs.note.open(e)}},{key:"openDmSettings",value:function(){tt.$emit("DmSettings.Open")}},{key:"IS_DM",get:function(){return _t.IS_DM||_t.FAKE_PLAYER}},{key:"gridColour",get:function(){return _t.gridColour},set:function(e){_t.setGridColour({colour:e,sync:!0})}},{key:"fowColour",get:function(){return _t.fowColour},set:function(e){_t.setFOWColour({colour:e,sync:!0})}},{key:"rulerColour",get:function(){return _t.rulerColour},set:function(e){_t.setRulerColour({colour:e,sync:!0})}}]),t}(n["default"]);Kn=Object(k["a"])([Object(O["b"])({components:{"color-picker":Fn,"asset-node":Yn},computed:Object.assign({},Object(D["c"])("game",["locations","assets","notes"]))})],Kn);var qn=Kn,Qn=qn,Zn=(i("747b"),Object(r["a"])(Qn,Mn,Tn,!1,null,"5fbaa291",null)),Jn=Zn.exports,ea=function(){var e=this,t=e.$createElement,i=e._self._c||t;return null!==e.note?i("modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("span",{on:{click:function(t){return e.$refs.title.select()}}},[i("i",{staticClass:"fas fa-pencil-alt",staticStyle:{"font-size":"15px"}})]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.note.title,expression:"note.title"}],ref:"title",domProps:{value:e.note.title},on:{change:e.updateNote,input:function(t){t.target.composing||e.$set(e.note,"title",t.target.value)}}}),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}],null,!1,1320213373)},[i("div",{staticClass:"modal-body"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.note.text,expression:"note.text"}],ref:"textarea",style:{height:e.calcHeight()},domProps:{value:e.note.text},on:{change:e.updateNote,input:function(t){t.target.composing||e.$set(e.note,"text",t.target.value)}}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.removeNote}},[i("i",{staticClass:"far fa-trash-alt"}),e._v(" Remove ")])])]):e._e()},ta=[],ia=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.note=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"open",value:function(e){this.visible=!0,this.note=e}},{key:"calcHeight",value:function(){if(this.$refs.textarea){var e=this.$refs.textarea;return e.style.height="auto",e.style.height=e.scrollHeight+"px",e.scrollHeight+"px"}return"100px"}},{key:"updateNote",value:function(){this.note&&_t.updateNote({note:this.note,sync:!0})}},{key:"removeNote",value:function(){var e=this;this.$parent.$refs.confirm.open("Are you sure you wish to remove this?").then((function(t){t&&e.note&&(_t.removeNote({note:e.note,sync:!0}),e.visible=!1)}),(function(){}))}}]),t}(n["default"]);ia=Object(k["a"])([Object(O["b"])({components:{Modal:ee}})],ia);var na=ia,aa=na,oa=(i("4122"),Object(r["a"])(aa,ea,ta,!1,null,"3f88adb2",null)),ra=oa.exports,sa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.shapes.length>0,expression:"shapes.length > 0"}]},e._l(e.shapes,(function(t){return i("div",{key:t.uuid},[i("div",{attrs:{id:"selection-menu"}},[i("div",{attrs:{id:"selection-edit-button"},on:{click:e.openEditDialog}},[i("i",{staticClass:"fas fa-edit"})]),i("div",{attrs:{id:"selection-name"}},[e._v(e._s(t.name))]),i("div",{attrs:{id:"selection-trackers"}},[e._l(e.visibleTrackers,(function(t){return[i("div",{key:"name-"+t.uuid},[e._v(e._s(t.name))]),i("div",{key:"value-"+t.uuid,staticClass:"selection-tracker-value",on:{click:function(i){return e.changeValue(t,!1)}}},[0===t.maxvalue?[e._v(" "+e._s(t.value)+" ")]:[e._v(e._s(t.value)+" / "+e._s(t.maxvalue))]],2)]}))],2),i("div",{attrs:{id:"selection-auras"}},[e._l(e.visibleAuras,(function(t){return[i("div",{key:"name-"+t.uuid},[e._v(e._s(t.name))]),i("div",{key:"value-"+t.uuid,staticClass:"selection-tracker-value",on:{click:function(i){return e.changeValue(t,!0)}}},[0===t.dim?[e._v(" "+e._s(t.value)+" ")]:[e._v(e._s(t.value)+" / "+e._s(t.dim))]],2)]}))],2)]),i("edit-dialog",{ref:"editDialog",refInFor:!0,attrs:{shape:t}})],1)})),0)},la=[],ca=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("Edit asset")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body"},[i("div",{staticClass:"grid"},[i("label",{attrs:{for:"shapeselectiondialog-name"}},[e._v("Name")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.shape.name,expression:"shape.name"}],staticStyle:{"grid-column":"numerator / remove"},attrs:{type:"text",id:"shapeselectiondialog-name",disabled:!e.owned},domProps:{value:e.shape.name},on:{change:function(t){return e.updateShape(!1)},input:function(t){t.target.composing||e.$set(e.shape,"name",t.target.value)}}}),i("div",{style:{opacity:e.shape.nameVisible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(t){e.shape.nameVisible=!e.shape.nameVisible,e.updateShape(!1)}}},[i("i",{staticClass:"fas fa-eye"})]),i("label",{attrs:{for:"shapeselectiondialog-istoken"}},[e._v("Is a token")]),i("input",{staticClass:"styled-checkbox",staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-istoken",disabled:!e.owned},domProps:{checked:e.shape.isToken},on:{click:e.setToken}}),i("label",{attrs:{for:"shapeselectiondialog-visionblocker"}},[e._v("Blocks vision/light")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.shape.visionObstruction,expression:"shape.visionObstruction"}],staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-visionblocker",disabled:!e.owned},domProps:{checked:Array.isArray(e.shape.visionObstruction)?e._i(e.shape.visionObstruction,null)>-1:e.shape.visionObstruction},on:{change:[function(t){var i=e.shape.visionObstruction,n=t.target,a=!!n.checked;if(Array.isArray(i)){var o=null,r=e._i(i,o);n.checked?r<0&&e.$set(e.shape,"visionObstruction",i.concat([o])):r>-1&&e.$set(e.shape,"visionObstruction",i.slice(0,r).concat(i.slice(r+1)))}else e.$set(e.shape,"visionObstruction",a)},e.setVisionBlocker]}}),i("label",{attrs:{for:"shapeselectiondialog-moveblocker"}},[e._v("Blocks movement")]),i("input",{staticStyle:{"grid-column-start":"remove"},attrs:{type:"checkbox",id:"shapeselectiondialog-moveblocker",disabled:!e.owned},domProps:{checked:e.shape.movementObstruction},on:{click:e.setMovementBlocker}}),i("label",{attrs:{for:"shapeselectiondialog-strokecolour"}},[e._v("Border colour")]),i("color-picker",{staticStyle:{"grid-column-start":"remove"},attrs:{color:e.shape.strokeColour,disabled:!e.owned},on:{"update:color":function(t){return e.$set(e.shape,"strokeColour",t)},input:function(t){return e.updateShape(!0,!0)},change:function(t){return e.updateShape(!0)}}}),i("label",{attrs:{for:"shapeselectiondialog-fillcolour"}},[e._v("Fill colour")]),i("color-picker",{staticStyle:{"grid-column-start":"remove"},attrs:{color:e.shape.fillColour,disabled:!e.owned},on:{"update:color":function(t){return e.$set(e.shape,"fillColour",t)},input:function(t){return e.updateShape(!0,!0)},change:function(t){return e.updateShape(!0)}}}),i("div",{staticClass:"spanrow header"},[e._v("Access")]),e._l(e.shape.owners,(function(t){return[i("input",{key:t,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t},on:{change:function(i){return e.updateOwner(i,t)}}}),""!==t?i("div",{key:"remove-"+t,style:{opacity:e.owned?1:.3,textAlign:"center",gridColumnStart:"remove"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeOwner(t)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]})),i("div",{staticClass:"spanrow header"},[e._v("Trackers")]),e._l(e.shape.trackers,(function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"tracker.name"}],key:"name-"+t.uuid,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t.name},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"name",i.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.value,expression:"tracker.value",modifiers:{number:!0}}],key:"value-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.value},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"value",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"fspan-"+t.uuid},[e._v("/")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.maxvalue,expression:"tracker.maxvalue",modifiers:{number:!0}}],key:"maxvalue-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.maxvalue},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"maxvalue",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"sspan-"+t.uuid}),i("div",{key:"visibility-"+t.uuid,style:{opacity:t.visible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){t.visible=!t.visible,e.updateShape(!1)}}},[i("i",{staticClass:"fas fa-eye"})]),i("span",{key:"tspan-"+t.uuid}),""!==t.name||0!==t.value?i("div",{key:"remove-"+t.uuid,style:{opacity:e.owned?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeTracker(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]})),i("div",{staticClass:"spanrow header"},[e._v("Auras")]),e._l(e.shape.auras,(function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"aura.name"}],key:"name-"+t.uuid,staticStyle:{"grid-column-start":"name"},attrs:{type:"text",placeholder:"name",disabled:!e.owned},domProps:{value:t.name},on:{change:function(t){return e.updateShape(!1)},input:function(i){i.target.composing||e.$set(t,"name",i.target.value)}}}),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.value,expression:"aura.value",modifiers:{number:!0}}],key:"value-"+t.uuid,attrs:{type:"text",title:"Current value",disabled:!e.owned},domProps:{value:t.value},on:{change:function(t){return e.updateShape(!0)},input:function(i){i.target.composing||e.$set(t,"value",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("span",{key:"fspan-"+t.uuid},[e._v("/")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.dim,expression:"aura.dim",modifiers:{number:!0}}],key:"dimvalue-"+t.uuid,attrs:{type:"text",title:"Dim value",disabled:!e.owned},domProps:{value:t.dim},on:{change:function(t){return e.updateShape(!0)},input:function(i){i.target.composing||e.$set(t,"dim",e._n(i.target.value))},blur:function(t){return e.$forceUpdate()}}}),i("color-picker",{key:"colour-"+t.uuid,attrs:{color:t.colour,disabled:!e.owned},on:{"update:color":function(i){return e.$set(t,"colour",i)},input:function(i){return e.updateAuraColour(t,i)},change:function(t){return e.updateShape(!0)}}}),i("div",{key:"visibility-"+t.uuid,style:{opacity:t.visible?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){t.visible=!t.visible,e.updateShape(!0)}}},[i("i",{staticClass:"fas fa-eye"})]),i("div",{key:"visionsource-"+t.uuid,style:{opacity:t.visionSource?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.updateAuraVisionSource(t)}}},[i("i",{staticClass:"fas fa-lightbulb"})]),""!==t.name||0!==t.value?i("div",{key:"remove-"+t.uuid,style:{opacity:e.owned?1:.3,textAlign:"center"},attrs:{disabled:!e.owned},on:{click:function(i){return e.removeAura(t.uuid)}}},[i("i",{staticClass:"fas fa-trash-alt"})]):e._e()]})),i("div",{staticClass:"spanrow header"},[e._v("Labels")]),i("div",{staticClass:"spanrow",attrs:{id:"labels"}},[e._l(e.shape.labels,(function(t){return i("div",{key:t.uuid,staticClass:"label"},[t.category?[i("div",{staticClass:"label-user"},[e._v(e._s(t.category))]),i("div",{staticClass:"label-main",on:{click:function(i){return e.removeLabel(t.uuid)}}},[e._v(e._s(t.name))])]:e._e(),t.category?e._e():[i("div",{staticClass:"label-main",on:{click:function(i){return e.removeLabel(t.uuid)}}},[e._v(e._s(t.name))])]],2)})),e.owned?i("div",{staticClass:"label",attrs:{id:"label-add"}},[i("div",{staticClass:"label-main",on:{click:e.openLabelManager}},[e._v("+")])]):e._e()],2),i("div",{staticClass:"spanrow header"},[e._v("Annotation")]),i("textarea",{staticClass:"spanrow",attrs:{disabled:!e.owned},domProps:{value:e.shape.annotation},on:{change:e.updateAnnotation}})],2)])])},ua=[],ha=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("EditDialog.Open",(function(t){e.shape=t,e.visible=!0})),tt.$on("EditDialog.AddLabel",(function(t){e.visible&&(e.shape.labels.push(_t.labels[t]),e.updateShape(!0))}))}},{key:"beforeDestroy",value:function(){tt.$off("EditDialog.Open"),tt.$off("EditDialog.AddLabel")}},{key:"updated",value:function(){this.addEmpty()}},{key:"addEmpty",value:function(){""!==this.shape.owners[this.shape.owners.length-1]&&this.shape.addOwner(""),this.shape.trackers.length&&""===this.shape.trackers[this.shape.trackers.length-1].name&&0===this.shape.trackers[this.shape.trackers.length-1].value||this.shape.trackers.push({uuid:ve(),name:"",value:0,maxvalue:0,visible:!1}),this.shape.auras.length&&""===this.shape.auras[this.shape.auras.length-1].name&&0===this.shape.auras[this.shape.auras.length-1].value||this.shape.auras.push({uuid:ve(),name:"",value:0,dim:0,visionSource:!1,colour:"rgba(0,0,0,0)",visible:!1})}},{key:"updateShape",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.owned&&(Je.emit("Shape.Update",{shape:this.shape.asDict(),redraw:e,temporary:t}),e&&jt.invalidate(),this.addEmpty())}},{key:"setToken",value:function(e){this.owned&&(this.shape.setIsToken(e.target.checked),this.updateShape(!0))}},{key:"setVisionBlocker",value:function(e){this.owned&&(this.shape.checkVisionSources(),this.updateShape(!0))}},{key:"setMovementBlocker",value:function(e){this.owned&&(this.shape.setMovementBlock(e.target.checked),this.updateShape(!1))}},{key:"updateAnnotation",value:function(e){var t=this;if(this.owned){var i=""!==this.shape.annotation;this.shape.annotation=e.target.value,""===this.shape.annotation||i?""===this.shape.annotation&&i&&(_t.annotations.splice(_t.annotations.findIndex((function(e){return e===t.shape.uuid}))),jt.hasLayer("draw")&&jt.getLayer("draw").invalidate(!0)):(_t.annotations.push(this.shape.uuid),jt.hasLayer("draw")&&jt.getLayer("draw").invalidate(!0)),this.updateShape(!1)}}},{key:"updateOwner",value:function(e,t){this.owned&&(this.shape.updateOwner(t,e.target.value),this.updateShape(_t.fowLOS))}},{key:"removeOwner",value:function(e){this.owned&&(this.shape.removeOwner(e),this.updateShape(_t.fowLOS))}},{key:"removeTracker",value:function(e){this.owned&&(this.shape.trackers=this.shape.trackers.filter((function(t){return t.uuid!==e})),this.updateShape(!1))}},{key:"removeAura",value:function(e){this.owned&&(this.shape.auras=this.shape.auras.filter((function(t){return t.uuid!==e})),this.shape.checkVisionSources(),this.updateShape(!0))}},{key:"updateAuraVisionSource",value:function(e){if(this.owned){e.visionSource=!e.visionSource;var t=Li.visionSources.findIndex((function(t){return t.aura===e.uuid}));e.visionSource&&-1===t?Li.visionSources.push({shape:this.shape.uuid,aura:e.uuid}):!e.visionSource&&t>=0&&Li.visionSources.splice(t,1),this.updateShape(!0)}}},{key:"updateAuraColour",value:function(e,t){if(this.owned){var i=jt.getLayer(this.shape.layer);void 0!==i&&i.invalidate(!e.visionSource)}}},{key:"openLabelManager",value:function(){tt.$emit("LabelManager.Open")}},{key:"removeLabel",value:function(e){this.owned&&(this.shape.labels=this.shape.labels.filter((function(t){return t.uuid!==e})),this.updateShape(!0))}},{key:"owned",get:function(){return this.shape.ownedBy()}}]),t}(n["default"]);Object(k["a"])([Object(K["a"])()],ha.prototype,"shape",void 0),ha=Object(k["a"])([Object(O["b"])({components:{Modal:ee,"color-picker":Fn}})],ha);var da=ha,va=da,fa=(i("5d8d"),Object(r["a"])(va,ca,ua,!1,null,"637f8f89",null)),pa=fa.exports,ya=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.shape=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("SelectionInfo.Shape.Set",(function(t){e.shape=t}))}},{key:"beforeDestroy",value:function(){tt.$off("SelectionInfo.Shape.Set")}},{key:"openEditDialog",value:function(){this.$refs.editDialog[0].visible=!0}},{key:"changeValue",value:function(e,t){var i=this;null!==this.shape&&this.$parent.$refs.prompt.prompt("New  ".concat(e.name," value:"),"Updating ".concat(e.name)).then((function(n){if(null!==i.shape){var a=e.value;"+"===n[0]||"-"===n[0]?e.value+=parseInt(n,10):e.value=parseInt(n,10),isNaN(e.value)&&(e.value=a),Je.emit("Shape.Update",{shape:i.shape.asDict(),redraw:t,temporary:!1}),t&&jt.invalidate()}}),(function(){}))}},{key:"shapes",get:function(){return null===this.shape?[]:[this.shape]}},{key:"visibleTrackers",get:function(){return null===this.shape?[]:this.shape.trackers.filter((function(e){return""!==e.name||0!==e.value}))}},{key:"visibleAuras",get:function(){return null===this.shape?[]:this.shape.auras.filter((function(e){return""!==e.name||0!==e.value}))}}]),t}(n["default"]);ya=Object(k["a"])([Object(O["b"])({components:{"edit-dialog":pa}})],ya);var ga=ya,ma=ga,ba=(i("2457"),Object(r["a"])(ma,sa,la,!1,null,"394cb731",null)),wa=ba.exports,ka=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{attrs:{id:"toolselect"}},[i("ul",e._l(e.visibleTools,(function(t){return i("li",{directives:[{name:"show",rawName:"v-show",value:e.toolVisible(t),expression:"toolVisible(tool)"}],key:t,ref:t+"-selector",refInFor:!0,class:{"tool-selected":e.currentTool===t},on:{mousedown:function(i){e.currentTool=t}}},[i("a",{attrs:{href:"#"}},[e._v(e._s(t))])])})),0)]),i("div",[[i("select-tool",{directives:[{name:"show",rawName:"v-show",value:"Select"===e.currentTool,expression:"currentTool === 'Select'"}],ref:"selectTool"}),i("pan-tool",{directives:[{name:"show",rawName:"v-show",value:"Pan"===e.currentTool,expression:"currentTool === 'Pan'"}]}),i("keep-alive",[i("draw-tool",{directives:[{name:"show",rawName:"v-show",value:"Draw"===e.currentTool,expression:"currentTool === 'Draw'"}]})],1),i("ruler-tool",{directives:[{name:"show",rawName:"v-show",value:"Ruler"===e.currentTool,expression:"currentTool === 'Ruler'"}]}),i("ping-tool",{directives:[{name:"show",rawName:"v-show",value:"Ping"===e.currentTool,expression:"currentTool === 'Ping'"}]}),i("map-tool",{directives:[{name:"show",rawName:"v-show",value:"Map"===e.currentTool,expression:"currentTool === 'Map'"}]}),i("filter-tool",{directives:[{name:"show",rawName:"v-show",value:"Filter"===e.currentTool,expression:"currentTool === 'Filter'"}]}),i("vision-tool",{directives:[{name:"show",rawName:"v-show",value:"Vision"===e.currentTool,expression:"currentTool === 'Vision'"}]}),i("shape-menu",{ref:"shapecontext"}),i("default-menu",{ref:"defaultcontext"}),i("createtoken-dialog",{ref:"createtokendialog"})]],2)])},Oa=[],xa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return void 0!==e.getActiveLayer()?i("ContextMenu",{attrs:{visible:e.visible,left:e.x+"px",top:e.y+"px"},on:{close:e.close}},[e.getLayers().length>1?i("li",[e._v(" Layer "),i("ul",e._l(e.getLayers(),(function(t){return i("li",{key:t.name,style:[e.getActiveLayer().name===t.name?{"background-color":"#82c8a0"}:{}],on:{click:function(i){return e.setLayer(t.name)}}},[e._v(" "+e._s(t.name)+" ")])})),0)]):e._e(),e.locations.length>1?i("li",[e._v(" Location "),i("ul",e._l(e.locations,(function(t){return i("li",{key:t,style:[e.getCurrentLocation()===t?{"background-color":"#82c8a0"}:{}],on:{click:function(i){return e.setLocation(t)}}},[e._v(" "+e._s(t)+" ")])})),0)]):e._e(),i("li",{on:{click:e.moveToBack}},[e._v("Move to back")]),i("li",{on:{click:e.moveToFront}},[e._v("Move to front")]),i("li",{on:{click:e.addInitiative}},[e._v(e._s(e.getInitiativeWord())+" initiative")]),i("li",{on:{click:e.deleteSelection}},[e._v("Delete shapes")]),e.hasSingleShape()?i("li",{on:{click:e.openEditDialog}},[e._v("Show properties")]):e._e()]):e._e()},Sa=[],_a=(i("a623"),function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.x=0,e.y=0,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"open",value:function(e){var t=this;this.visible=!0,this.x=e.pageX,this.y=e.pageY,this.$nextTick((function(){return t.$children[0].$el.focus()}))}},{key:"close",value:function(){this.visible=!1}},{key:"getLayers",value:function(){return jt.layers.filter((function(e){return e.selectable&&(_t.IS_DM||e.playerEditable)}))}},{key:"getActiveLayer",value:function(){return jt.getLayer()}},{key:"getCurrentLocation",value:function(){return _t.locationName}},{key:"getInitiativeWord",value:function(){var e=jt.getLayer();return 1===e.selection.length?gn(e.selection[0].uuid)?"Show":"Add":e.selection.every((function(e){return gn(e.uuid)}))?"Show":"Add all to"}},{key:"hasSingleShape",value:function(){var e=jt.getLayer();return 1===e.selection.length}},{key:"setLayer",value:function(e){var t=jt.getLayer();t.selection.forEach((function(t){return t.moveLayer(e,!0)})),this.close()}},{key:"setLocation",value:function(e){var t=jt.getLayer();Bi(),Je.emit("Location.Change",e),Je.once("Location.Set",(function(e){Je.once("Client.Options.Set",(function(e){t.selection=Vi(t.name),jt.selectLayer(t.name)}))})),this.close()}},{key:"moveToBack",value:function(){var e=this.getActiveLayer();e.selection.forEach((function(t){return e.moveShapeOrder(t,0,!0)})),this.close()}},{key:"moveToFront",value:function(){var e=this.getActiveLayer();e.selection.forEach((function(t){return e.moveShapeOrder(t,e.shapes.length-1,!0)})),this.close()}},{key:"addInitiative",value:function(){var e=jt.getLayer();e.selection.forEach((function(e){return bn.addInitiative(e.getInitiativeRepr())})),tt.$emit("Initiative.Show"),this.close()}},{key:"deleteSelection",value:function(){Hi(),this.close()}},{key:"openEditDialog",value:function(){var e=jt.getLayer();1===e.selection.length&&(tt.$emit("EditDialog.Open",e.selection[0]),this.close())}},{key:"activeLayer",get:function(){var e=jt.getLayer();return void 0===e?"":e.name}}]),t}(n["default"]));_a=Object(k["a"])([Object(O["b"])({components:{ContextMenu:P},computed:Object.assign({},Object(D["c"])("game",["locations","assets","notes"]))})],_a);var Ca=_a,ja=Ca,La=(i("223f"),Object(r["a"])(ja,xa,Sa,!1,null,"623db654",null)),Ea=La.exports,Ia=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("modal",{attrs:{visible:e.visible},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[e._v(" Create basic token ")])}}])},[i("div",{staticClass:"modal-body"},[i("label",{attrs:{for:"createtokendialog-text"}},[e._v("Text")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.text,expression:"text"}],attrs:{type:"text",id:"createtokendialog-name"},domProps:{value:e.text},on:{input:function(t){t.target.composing||(e.text=t.target.value)}}}),i("label",[e._v("Colours")]),i("div",{staticClass:"colours"},[i("span",[e._v("Fill:")]),i("color-picker",{attrs:{color:e.fillColour},on:{"update:color":function(t){e.fillColour=t}}}),i("span",[e._v("Border:")]),i("color-picker",{attrs:{color:e.borderColour},on:{"update:color":function(t){e.borderColour=t}}})],1),i("canvas",{ref:"canvas",attrs:{width:"100px",height:"100px"}})]),i("div",{staticClass:"modal-footer"},[i("button",{on:{click:e.submit}},[e._v("Submit")])])])},Pa=[],Ma=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.x=0,e.y=0,e.visible=!1,e.text="X",e.fillColour="rgba(255, 255, 255, 1)",e.borderColour="rgba(0, 0, 0, 1)",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){this.updatePreview()}},{key:"onTextChange",value:function(e,t){this.updatePreview()}},{key:"onFillChange",value:function(e,t){this.updatePreview()}},{key:"onBorderChange",value:function(e,t){this.updatePreview()}},{key:"open",value:function(e,t){this.visible=!0,this.x=e,this.y=t}},{key:"submit",value:function(){var e=jt.getLayer();if(void 0!==e){var t=new Di(ft(new at(this.x,this.y)),dt(_t.unitSize/2),this.text,"10px serif",this.fillColour,this.borderColour);t.addOwner(_t.username),e.addShape(t,!0),e.invalidate(!1),this.visible=!1}}},{key:"updatePreview",value:function(){var e=this.$refs.canvas.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath();var t={x:e.canvas.width/2,y:e.canvas.height/2},i=.9*Math.min(t.x,t.y);e.fillStyle=this.fillColour,e.arc(t.x,t.y,i,0,2*Math.PI),e.fill(),"rgba(0, 0, 0, 0)"!==this.borderColour&&(e.beginPath(),e.lineWidth=5,e.strokeStyle=this.borderColour,e.arc(t.x,t.y,i-2.5,0,2*Math.PI),e.stroke()),e.save(),e.textAlign="center",e.textBaseline="middle";var n=ye(e,this.text,i-2.5);e.setTransform(n,0,0,n,t.x,t.y),e.fillStyle=mt["mostReadable"](this.fillColour,["#000","#fff"]).toHexString(),e.fillText(this.text,0,0),e.restore()}}]),t}(n["default"]);Object(k["a"])([Object(K["b"])("text")],Ma.prototype,"onTextChange",null),Object(k["a"])([Object(K["b"])("fillColour")],Ma.prototype,"onFillChange",null),Object(k["a"])([Object(K["b"])("borderColour")],Ma.prototype,"onBorderChange",null),Ma=Object(k["a"])([Object(O["b"])({components:{Modal:ee,"color-picker":Fn},computed:Object.assign({},Object(D["c"])("game",["unitSize"]))})],Ma);var Ta=Ma,Aa=Ta,Da=(i("34be"),Object(r["a"])(Aa,Ia,Pa,!1,null,"b67b425c",null)),Ra=Da.exports,Na=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ContextMenu",{attrs:{visible:e.visible,left:e.x+"px",top:e.y+"px"},on:{close:e.close}},[e.IS_DM?i("li",{on:{click:e.bringPlayers}},[e._v("Bring players")]):e._e(),i("li",{on:{click:e.createToken}},[e._v("Create basic token")]),i("li",{on:{click:e.showInitiative}},[e._v("Show initiative")])])},Ua=[],za=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.x=0,e.y=0,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"open",value:function(e){var t=this;this.visible=!0,this.x=e.pageX,this.y=e.pageY,this.$nextTick((function(){return t.$children[0].$el.focus()}))}},{key:"close",value:function(){this.visible=!1}},{key:"bringPlayers",value:function(){_t.IS_DM&&(Je.emit("Players.Bring",{x:pt(this.x),y:yt(this.y),zoom:_t.zoomDisplay}),this.close())}},{key:"createToken",value:function(){this.$parent.$refs.createtokendialog.open(this.x,this.y),this.close()}},{key:"showInitiative",value:function(){tt.$emit("Initiative.Show"),this.close()}},{key:"IS_DM",get:function(){return _t.IS_DM}}]),t}(n["default"]);za=Object(k["a"])([Object(O["b"])({components:{ContextMenu:P}})],za);var $a=za,Fa=$a,Va=(i("a10f"),Object(r["a"])(Fa,Na,Ua,!1,null,"5943a1f0",null)),Ha=Va.exports,Ba=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.IS_DM,expression:"IS_DM"}]},[e._v("Mode")]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.IS_DM,expression:"IS_DM"}],staticClass:"selectgroup"},e._l(e.modes,(function(t){return i("div",{key:t,staticClass:"option",class:{"option-selected":e.modeSelect===t},on:{click:function(i){e.modeSelect=t}}},[e._v(" "+e._s(t)+" ")])})),0),i("div",[e._v("Shape")]),i("div",{staticClass:"selectgroup"},e._l(e.shapes,(function(t){return i("div",{key:t,staticClass:"option",class:{"option-selected":e.shapeSelect===t},on:{click:function(i){e.shapeSelect=t}}},[i("i",{staticClass:"fas",class:"fa-"+t})])})),0),i("div",[e._v("Colours")]),i("div",{staticClass:"selectgroup"},[i("color-picker",{staticClass:"option",class:{"radius-right":!e.showBorderColour()},attrs:{color:e.fillColour},on:{"update:color":function(t){e.fillColour=t}}}),i("color-picker",{directives:[{name:"show",rawName:"v-show",value:e.showBorderColour(),expression:"showBorderColour()"}],staticClass:"option",attrs:{color:e.borderColour},on:{"update:color":function(t){e.borderColour=t}}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"draw-polygon"===e.shapeSelect,expression:"shapeSelect === 'draw-polygon'"}],staticStyle:{display:"flex"}},[i("label",{staticStyle:{flex:"5"},attrs:{for:"polygon-close"}},[e._v("Closed polygon?")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.closedPolygon,expression:"closedPolygon"}],staticStyle:{flex:"1","align-self":"center"},attrs:{type:"checkbox",id:"polygon-close"},domProps:{checked:Array.isArray(e.closedPolygon)?e._i(e.closedPolygon,null)>-1:e.closedPolygon},on:{change:function(t){var i=e.closedPolygon,n=t.target,a=!!n.checked;if(Array.isArray(i)){var o=null,r=e._i(i,o);n.checked?r<0&&(e.closedPolygon=i.concat([o])):r>-1&&(e.closedPolygon=i.slice(0,r).concat(i.slice(r+1)))}else e.closedPolygon=a}}})]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.hasBrushSize(),expression:"hasBrushSize()"}],staticStyle:{display:"flex"}},[i("label",{staticStyle:{flex:"5"},attrs:{for:"brush-size"}},[e._v("Brush size")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.brushSize,expression:"brushSize"}],staticStyle:{flex:"4","align-self":"center","max-width":"100px"},attrs:{type:"input",id:"brush-size"},domProps:{value:e.brushSize},on:{input:function(t){t.target.composing||(e.brushSize=t.target.value)}}})])]):e._e()},Ga=[],Wa=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div")},Xa=[],Ya=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="",e.selected=!1,e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"created",value:function(){var e=this;this.$parent.$on("mousedown",(function(t,i){i===e.name&&e.onMouseDown(t)})),this.$parent.$on("mouseup",(function(t,i){i===e.name&&e.onMouseUp(t)})),this.$parent.$on("mousemove",(function(t,i){i===e.name&&e.onMouseMove(t)})),this.$parent.$on("contextmenu",(function(t,i){i===e.name&&e.onContextMenu(t)})),this.$parent.$on("tools-select-change",(function(t,i){i===e.name?(e.selected=!1,e.onDeselect()):t===e.name&&(e.selected=!0,e.onSelect())}))}},{key:"onSelect",value:function(){}},{key:"onDeselect",value:function(){}},{key:"onMouseDown",value:function(e){}},{key:"onMouseUp",value:function(e){}},{key:"onMouseMove",value:function(e){}},{key:"onContextMenu",value:function(e){this.$parent.$refs.defaultcontext.open(e)}},{key:"detailRight",get:function(){var e=this.$parent.$refs[this.name+"-selector"][0].getBoundingClientRect(),t=e.left+e.width/2;return"".concat(window.innerWidth-Math.min(window.innerWidth-25,t+75),"px")}},{key:"detailArrow",get:function(){var e=this.$parent.$refs[this.name+"-selector"][0].getBoundingClientRect(),t=e.left+e.width/2,i=Math.min(window.innerWidth-25,t+75);return"".concat(i-t-14,"px")}}]),t}(n["default"]);Ya=Object(k["a"])([O["b"]],Ya);var Ka=Ya,qa=Ka,Qa=(i("12d3"),Object(r["a"])(qa,Wa,Xa,!1,null,null,null)),Za=Qa.exports,Ja=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Draw",e.active=!1,e.startPoint=null,e.shape=null,e.brushHelper=null,e.ruler=null,e.fillColour="rgba(0, 0, 0, 1)",e.borderColour="rgba(255, 255, 255, 0)",e.shapeSelect="square",e.shapes=["square","circle","draw-polygon","paint-brush"],e.modeSelect="normal",e.modes=["normal","reveal","hide"],e.brushSize=dt(_t.unitSize),e.closedPolygon=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){window.addEventListener("keyup",this.onKeyUp)}},{key:"destroyed",value:function(){window.removeEventListener("keyup",this.onKeyUp)}},{key:"onKeyUp",value:function(e){e.defaultPrevented||("Escape"===e.key&&this.active&&(this.onDeselect(),this.onSelect()),e.preventDefault())}},{key:"hasBrushSize",value:function(){return["paint-brush","draw-polygon"].includes(this.shapeSelect)}},{key:"showBorderColour",value:function(){return"paint-brush"!==this.shapeSelect&&!("draw-polygon"===this.shapeSelect&&!this.closedPolygon)}},{key:"onChangePolygonCloseBehaviour",value:function(e){null!==this.shape&&this.active&&(this.shape.openPolygon=!e)}},{key:"onFillChange",value:function(){this.brushHelper&&(this.brushHelper.fillColour=this.fillColour)}},{key:"onModeUpdate",value:function(e,t){this.onModeChange(e,t)}},{key:"onLayerChange",value:function(e,t){this.$parent.currentTool===this.name&&(this.onDeselect(t),this.onSelect())}},{key:"setupBrush",value:function(){null!==this.brushHelper&&("reveal"===this.modeSelect||"hide"===this.modeSelect?(this.brushHelper.options.set("preFogShape",!0),this.brushHelper.options.set("skipDraw",!0),this.brushHelper.fillColour="rgba(0, 0, 0, 1)","reveal"===this.modeSelect?this.brushHelper.globalCompositeOperation="source-over":"hide"===this.modeSelect&&(this.brushHelper.globalCompositeOperation="destination-out")):(this.brushHelper.options.delete("preFogShape"),this.brushHelper.options.delete("skipDraw"),this.brushHelper.globalCompositeOperation="source-over",this.brushHelper.fillColour=this.fillColour))}},{key:"onModeChange",value:function(e,t){if(null!==this.brushHelper){var i=jt.getLayer("fow"),n=jt.getLayer();void 0!==i&&void 0!==n&&(this.setupBrush(),"normal"!==e&&"normal"===t?(n.removeShape(this.brushHelper,!1),i.addShape(this.brushHelper,!1)):"normal"===e&&"normal"!==t&&(n.addShape(this.brushHelper,!1),i.removeShape(this.brushHelper,!1)))}}},{key:"getLayer",value:function(e){return"normal"===this.modeSelect?jt.getLayer(e):jt.getLayer("fow")}},{key:"onMouseDown",value:function(e){var t=this.getLayer();if(void 0!==t){if(this.active)null!==this.shape&&"draw-polygon"===this.shapeSelect&&this.shape instanceof zi&&this.shape._vertices.push(ft(wt(e)));else{switch(this.startPoint=ft(wt(e)),this.active=!0,this.shapeSelect){case"square":this.shape=new Ni(this.startPoint.clone(),0,0,this.fillColour,this.borderColour);break;case"circle":this.shape=new Ai(this.startPoint.clone(),this.helperSize,this.fillColour,this.borderColour);break;case"paint-brush":this.shape=new zi(this.startPoint.clone(),[],void 0,this.fillColour,this.brushSize,!0),this.shape.fillColour=this.fillColour;break;case"draw-polygon":var i=this.closedPolygon?this.fillColour:void 0,n=this.closedPolygon?this.borderColour:this.fillColour;this.shape=new zi(this.startPoint.clone(),[],i,n,this.brushSize,!this.closedPolygon);break;default:return}"normal"!==this.modeSelect&&(this.shape.options.set("preFogShape",!0),this.shape.options.set("skipDraw",!0),this.shape.fillColour="rgba(0, 0, 0, 1)"),"reveal"===this.modeSelect?this.shape.globalCompositeOperation="source-over":"hide"===this.modeSelect&&(this.shape.globalCompositeOperation="destination-out"),this.shape.addOwner(_t.username),"fow"===t.name&&"normal"===this.modeSelect&&(this.shape.visionObstruction=!0,this.shape.movementObstruction=!0),t.addShape(this.shape,!0,!1,!1),this.pushBrushBack()}if(null!==this.shape&&"draw-polygon"===this.shapeSelect&&this.shape instanceof zi){var a=ft(wt(e));null===this.ruler?(this.ruler=new Ri(a,a,this.brushSize,this.fillColour),t.addShape(this.ruler,!1)):(this.ruler.refPoint=a,this.ruler.endPoint=a),this.shape.visionObstruction&&Li.recalculateVision(),t.invalidate(!1),Je.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!0})}}else console.log("No active layer!")}},{key:"onMouseMove",value:function(e){var t=ft(wt(e)),i=this.getLayer();if(void 0!==i){if(null!==this.brushHelper&&(this.brushHelper.r=this.helperSize,this.brushHelper.refPoint=t,this.active||i.invalidate(!1)),this.active&&null!==this.startPoint&&null!==this.shape){switch(this.shapeSelect){case"square":this.shape.w=Math.abs(t.x-this.startPoint.x),this.shape.h=Math.abs(t.y-this.startPoint.y),this.shape.refPoint=new nt(Math.min(this.startPoint.x,t.x),Math.min(this.startPoint.y,t.y));break;case"circle":this.shape.r=Math.abs(t.subtract(this.startPoint).length());break;case"paint-brush":this.shape._vertices.push(t);break;case"draw-polygon":this.ruler.endPoint=t;break}"draw-polygon"===this.shapeSelect&&this.shape instanceof zi||(Je.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!0}),this.shape.visionObstruction&&Li.recalculateVision()),i.invalidate(!1)}}else console.log("No active layer!")}},{key:"onMouseUp",value:function(e){!this.active||null===this.shape||this.shape instanceof zi&&"draw-polygon"===this.shapeSelect||(!e.altKey&&this.useGrid&&this.shape.resizeToGrid(),this.finaliseShape())}},{key:"onContextMenu",value:function(e){if(this.active&&null!==this.shape&&"draw-polygon"===this.shapeSelect&&this.shape instanceof zi){var t=this.getLayer();if(void 0===t)return void console.log("No active layer!");t.removeShape(this.ruler,!1),this.ruler=null,this.finaliseShape()}else this.active||this.$parent.$refs.defaultcontext.open(e)}},{key:"finaliseShape",value:function(){null!==this.shape&&(this.shape.points.length<=1?(this.onDeselect(),this.onSelect()):(this.shape.visionObstruction&&Li.recalculateVision(),this.shape.movementObstruction&&Li.recalculateMovement(),Je.emit("Shape.Update",{shape:this.shape.asDict(),redraw:!0,temporary:!1})),this.active=!1)}},{key:"onSelect",value:function(){var e=this.getLayer();void 0!==e&&(this.brushHelper=new Ai(new nt(-1e3,-1e3),this.brushSize/2,this.fillColour),this.setupBrush(),e.addShape(this.brushHelper,!1))}},{key:"onDeselect",value:function(e){var t=this.getLayer(e);null!==this.brushHelper&&void 0!==t&&(t.removeShape(this.brushHelper,!1),this.brushHelper=null),null!==this.ruler&&void 0!==t&&(t.removeShape(this.ruler,!1),this.ruler=null),this.active&&void 0!==t&&null!==this.shape&&(t.removeShape(this.shape,!0,!1),this.shape=null,this.active=!1,t.invalidate(!1))}},{key:"pushBrushBack",value:function(){var e=this.getLayer();void 0!==e?(null!==this.brushHelper&&e.removeShape(this.brushHelper,!1),this.brushHelper=new Ai(new nt(-1e3,-1e3),this.brushSize/2,this.fillColour),this.setupBrush(),e.addShape(this.brushHelper,!1)):console.log("No active layer!")}},{key:"helperSize",get:function(){return this.hasBrushSize()?this.brushSize/2:dt(this.unitSize)/8}},{key:"IS_DM",get:function(){return _t.IS_DM}},{key:"unitSize",get:function(){return _t.unitSize}},{key:"useGrid",get:function(){return _t.useGrid}}]),t}(Za);Object(k["a"])([Object(K["b"])("closedPolygon")],Ja.prototype,"onChangePolygonCloseBehaviour",null),Object(k["a"])([Object(K["b"])("fillColour")],Ja.prototype,"onFillChange",null),Object(k["a"])([Object(K["b"])("modeSelect")],Ja.prototype,"onModeUpdate",null),Object(k["a"])([Object(K["b"])("selectedLayer")],Ja.prototype,"onLayerChange",null),Ja=Object(k["a"])([Object(O["b"])({components:{"color-picker":Fn},computed:Object.assign({},Object(D["b"])("game",["selectedLayer"]))})],Ja);var eo=Ja,to=eo,io=(i("2eb7"),Object(r["a"])(to,Ba,Ga,!1,null,"790caf6c",null)),no=io.exports,ao=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",{attrs:{id:"accordion-container"}},e._l(e.categories,(function(t){return i("accordion",{key:t,attrs:{title:""===t?"no category":t,showArrow:!1,items:e.labels[t],initialValues:e.initalValues[t]},on:{selectionupdate:e.updateSelection}})})),1)]):e._e()},oo=[],ro=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"accordion"},[i("div",{attrs:{id:"header"},on:{click:function(t){return t.preventDefault(),e.toggleDisplay(t)}}},[i("input",{ref:"overall",attrs:{type:"checkbox"},on:{click:function(t){return t.stopPropagation(),e.toggleCategory(t)}}}),i("strong",[e._v(e._s(e.title))]),e.showArrow?[i("span",{directives:[{name:"show",rawName:"v-show",value:e.showArrow&&!e.active,expression:"showArrow && !active"}],staticClass:"down-Arrow"},[e._v("▼")]),i("span",{directives:[{name:"show",rawName:"v-show",value:e.showArrow&&e.active,expression:"showArrow && active"}],staticClass:"up-Arrow"},[e._v("▲")])]:e._e()],2),i("div",{directives:[{name:"show",rawName:"v-show",value:e.active,expression:"active"}],attrs:{id:"body"}},e._l(e.items,(function(t){return i("div",{key:t[0],staticClass:"item",on:{click:function(i){return e.toggleSelection(t[0])}}},[i("input",{attrs:{type:"checkbox"},domProps:{checked:e.selected.includes(t[0])},on:{click:function(e){e.preventDefault()}}}),e._v(" "+e._s(t[1])+" ")])})),0)])},so=[],lo=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.selected=[],e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){this.selected=this.initialValues,this.updateCategory()}},{key:"toggleDisplay",value:function(e){this.active=!this.active}},{key:"toggleCategory",value:function(){var e=this.$refs.overall;e.checked?this.selected=this.items.map((function(e){return e[0]})):this.selected=[],this.$emit("selectionupdate",{title:this.title,selection:this.selected})}},{key:"updateCategory",value:function(){var e=this.$refs.overall;0===this.selected.length?(e.checked=!1,e.indeterminate=!1):this.selected.length===this.items.length?(e.checked=!0,e.indeterminate=!1):(e.checked=!1,e.indeterminate=!0)}},{key:"toggleSelection",value:function(e){var t=this.selected.indexOf(e);-1===t?this.selected.push(e):this.selected.splice(t,1),this.updateCategory(),this.$emit("selectionupdate",{title:this.title,selection:this.selected})}}]),t}(n["default"]);Object(k["a"])([Object(K["a"])(String)],lo.prototype,"title",void 0),Object(k["a"])([Object(K["a"])({default:!0,type:Boolean})],lo.prototype,"showArrow",void 0),Object(k["a"])([Object(K["a"])({default:function(){return[]}})],lo.prototype,"items",void 0),Object(k["a"])([Object(K["a"])({default:function(){return[]}})],lo.prototype,"initialValues",void 0),lo=Object(k["a"])([O["b"]],lo);var co=lo,uo=co,ho=(i("aa79"),Object(r["a"])(uo,ro,so,!1,null,"32e257d0",null)),vo=ho.exports,fo=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Filter",e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"isFilter",value:function(e){return _t.labelFilters.includes(e)}},{key:"toggleFilter",value:function(e){var t=_t.labelFilters.indexOf(e);t>=0?_t.labelFilters.splice(t,1):_t.labelFilters.push(e),jt.invalidate()}},{key:"toggleUnlabeled",value:function(){_t.toggleUnlabeledFilter(),jt.invalidate()}},{key:"updateSelection",value:function(e){if(e.title in this.labels){var t=!0,i=!1,n=void 0;try{for(var a,o=this.labels[e.title][Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var r=Object(Et["a"])(a.value,2),s=r[0],l=(r[1],_t.labelFilters.indexOf(s)),c=e.selection.includes(s);l>=0&&!c?(_t.labelFilters.splice(l,1),Je.emit("Labels.Filter.Remove",s)):l<0&&c&&(_t.labelFilters.push(s),Je.emit("Labels.Filter.Add",s))}}catch(u){i=!0,n=u}finally{try{t||null==o.return||o.return()}finally{if(i)throw n}}jt.invalidate()}}},{key:"labels",get:function(){for(var e={"":[]},t=0,i=Object.keys(_t.labels);t<i.length;t++){var n=i[t],a=_t.labels[n];a.category?(a.category in e||(e[a.category]=[]),e[a.category].push([a.uuid,a.name]),e[a.category].sort((function(e,t){return e[1].localeCompare(t[1])}))):e[""].push([a.uuid,a.name])}return e}},{key:"initalValues",get:function(){for(var e=this,t={},i=function(){var i=a[n];t[i]=_t.labelFilters.filter((function(t){return e.labels[i].map((function(e){return e[0]})).includes(t)}))},n=0,a=Object.keys(this.labels);n<a.length;n++)i();return t}},{key:"categories",get:function(){return Object.keys(this.labels).sort()}}]),t}(Za);fo=Object(k["a"])([Object(O["b"])({components:{accordion:vo}})],fo);var po=fo,yo=po,go=(i("e3f5"),i("4a14"),Object(r["a"])(yo,ao,oo,!1,null,"75b63661",null)),mo=go.exports,bo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},[i("div",[e._v("#X")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.xCount,expression:"xCount"}],attrs:{type:"text"},domProps:{value:e.xCount},on:{input:function(t){t.target.composing||(e.xCount=t.target.value)}}}),i("div",[e._v("#Y")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.yCount,expression:"yCount"}],attrs:{type:"text"},domProps:{value:e.yCount},on:{input:function(t){t.target.composing||(e.yCount=t.target.value)}}})]):e._e()},wo=[],ko=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Map",e.active=!1,e.xCount=3,e.yCount=3,e.startPoint=null,e.rect=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"onMouseDown",value:function(e){var t=jt.getLayer();void 0!==t?(this.active=!0,this.startPoint=ft(wt(e)),this.rect=new Ni(this.startPoint.clone(),0,0,"rgba(0,0,0,0)","black"),t.addShape(this.rect,!1,!1)):console.log("No active layer!")}},{key:"onMouseMove",value:function(e){if(this.active&&null!==this.rect&&null!==this.startPoint){var t=jt.getLayer();if(void 0!==t){var i=ft(wt(e));this.rect.w=Math.abs(i.x-this.startPoint.x),this.rect.h=Math.abs(i.y-this.startPoint.y),this.rect.refPoint=new nt(Math.min(this.startPoint.x,i.x),Math.min(this.startPoint.y,i.y)),t.invalidate(!1)}else console.log("No active layer!")}}},{key:"onMouseUp",value:function(e){if(this.active&&null!==this.rect){var t=jt.getLayer();if(void 0!==t)if(this.active=!1,1===t.selection.length){var i=this.rect.w,n=this.rect.h,a=t.selection[0];a instanceof Mi&&(a.w*=this.xCount*_t.gridSize/i,a.h*=this.yCount*_t.gridSize/n),t.removeShape(this.rect,!1,!1)}else t.removeShape(this.rect,!1,!1);else console.log("No active layer!")}}}]),t}(Za);ko=Object(k["a"])([O["b"]],ko);var Oo=ko,xo=Oo,So=Object(r["a"])(xo,bo,wo,!1,null,null,null),_o=So.exports,Co=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Pan",e.panStart=new at(0,0),e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"onMouseDown",value:function(e){this.panStart=wt(e),this.active=!0}},{key:"onMouseMove",value:function(e){if(this.active){var t=wt(e),i=t.subtract(this.panStart).multiply(1/_t.zoomFactor);_t.increasePanX(Math.round(i.x)),_t.increasePanY(Math.round(i.y)),this.panStart=t,jt.invalidate()}}},{key:"onMouseUp",value:function(e){this.active=!1,st(_t.locationOptions)}}]),t}(Za);Co=Object(k["a"])([O["b"]],Co);var jo,Lo=Co;(function(e){e[e["Noop"]=0]="Noop",e[e["Resize"]=1]="Resize",e[e["Drag"]=2]="Drag",e[e["GroupSelect"]=3]="GroupSelect"})(jo||(jo={}));var Eo=new nt(-1e3,-1e3),Io=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Select",e.showContextMenu=!1,e.active=!1,e.mode=jo.Noop,e.resizePoint=0,e.deltaChanged=!1,e.dragRay=new rt(new at(0,0),new ot(0,0)),e.selectionStartPoint=Eo,e.selectionHelper=new Ni(Eo,0,0),e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"created",value:function(){this.selectionHelper.globalCompositeOperation="source-over",_t.setSelectionHelperId(this.selectionHelper.uuid)}},{key:"onMouseDown",value:function(e){var t=jt.getLayer();if(void 0!==t){this.selectionHelper.owners.includes(_t.username)||this.selectionHelper.addOwner(_t.username);var i,n=wt(e),a=ft(n),o=!1;i=t.selection.length?t.shapes.concat(t.selection):t.shapes;for(var r=i.length-1;r>=0;r--){var s=i[r];if(this.resizePoint=s.getPointIndex(a,gt(3)),this.resizePoint>=0){t.selection=[s],tt.$emit("SelectionInfo.Shape.Set",s),this.mode=jo.Resize,t.invalidate(!0),o=!0;break}if(s.contains(a)){var l=s;-1===t.selection.indexOf(l)&&(e.ctrlKey?t.selection.push(l):t.selection=[l],tt.$emit("SelectionInfo.Shape.Set",l)),this.mode=jo.Drag;var c=lt(l.refPoint);this.dragRay=new rt(c,n.subtract(c)),t.invalidate(!0),o=!0;break}}if(!o){this.mode=jo.GroupSelect;var u=!0,h=!1,d=void 0;try{for(var v,f=t.selection[Symbol.iterator]();!(u=(v=f.next()).done);u=!0){var p=v.value;tt.$emit("SelectionInfo.Shape.Set",p)}}catch(y){h=!0,d=y}finally{try{u||null==f.return||f.return()}finally{if(h)throw d}}this.selectionStartPoint=a,this.selectionHelper.refPoint=this.selectionStartPoint,this.selectionHelper.w=0,this.selectionHelper.h=0,e.ctrlKey?t.selection.push(this.selectionHelper):t.selection=[this.selectionHelper],t.invalidate(!0)}this.active=!0}else console.log("No active layer!")}},{key:"onMouseMove",value:function(e){var t=jt.getLayer();if(void 0!==t){var i=wt(e),n=ft(i);if(this.deltaChanged=!1,this.mode===jo.GroupSelect){var a=n;this.selectionHelper.w=Math.abs(a.x-this.selectionStartPoint.x),this.selectionHelper.h=Math.abs(a.y-this.selectionStartPoint.y),this.selectionHelper.refPoint=new nt(Math.min(this.selectionStartPoint.x,a.x),Math.min(this.selectionStartPoint.y,a.y)),t.invalidate(!0)}else if(t.selection.length){var o=lt(t.selection[t.selection.length-1].refPoint),r=o.add(this.dragRay.direction),s=i.subtract(r).multiply(1/_t.zoomFactor),l=s;if(this.mode===jo.Drag){if("tokens"===t.name&&(!e.shiftKey||!_t.IS_DM)){var c=!0,u=!1,h=void 0;try{for(var d,v=t.selection[Symbol.iterator]();!(c=(d=v.next()).done);c=!0){var f=d.value;f.ownedBy()&&(f.uuid!==this.selectionHelper.uuid&&(s=Ii(s,f),s!==l&&(this.deltaChanged=!0)))}}catch(j){u=!0,h=j}finally{try{c||null==v.return||v.return()}finally{if(u)throw h}}}var p=!0,y=!1,g=void 0;try{for(var m,b=t.selection[Symbol.iterator]();!(p=(m=b.next()).done);p=!0){var w=m.value;w.ownedBy()&&(w.refPoint=w.refPoint.add(s),w!==this.selectionHelper&&(w.visionObstruction&&Li.recalculateVision(),Je.emit("Shape.Update",{shape:w.asDict(),redraw:!0,temporary:!0})))}}catch(j){y=!0,g=j}finally{try{p||null==b.return||b.return()}finally{if(y)throw g}}t.invalidate(!1)}else if(this.mode===jo.Resize){var k=!0,O=!1,x=void 0;try{for(var S,_=t.selection[Symbol.iterator]();!(k=(S=_.next()).done);k=!0){var C=S.value;C.ownedBy()&&(C.resize(this.resizePoint,i),C!==this.selectionHelper&&(C.visionObstruction&&Li.recalculateVision(),Je.emit("Shape.Update",{shape:C.asDict(),redraw:!0,temporary:!0})),t.invalidate(!1),this.updateCursor(t,n))}}catch(j){O=!0,x=j}finally{try{k||null==_.return||_.return()}finally{if(O)throw x}}}else this.updateCursor(t,n)}else document.body.style.cursor="default"}else console.log("No active layer!")}},{key:"onMouseUp",value:function(e){var t=this;if(this.active)if(void 0!==jt.getLayer()){var i=jt.getLayer();if(this.mode===jo.GroupSelect){e.ctrlKey||i.clearSelection();var n=!0,a=!1,o=void 0;try{for(var r,s=function(){var e=r.value;if(!e.ownedBy())return"continue";if(e===t.selectionHelper)return"continue";var n=e.getBoundingBox();if(!e.ownedBy())return"continue";t.selectionHelper.refPoint.x<=n.topRight.x&&t.selectionHelper.refPoint.x+t.selectionHelper.w>=n.topLeft.x&&t.selectionHelper.refPoint.y<=n.botLeft.y&&t.selectionHelper.refPoint.y+t.selectionHelper.h>=n.topLeft.y&&void 0===i.selection.find((function(t){return t===e}))&&i.selection.push(e)},l=i.shapes[Symbol.iterator]();!(n=(r=l.next()).done);n=!0)s()}catch(p){a=!0,o=p}finally{try{n||null==l.return||l.return()}finally{if(a)throw o}}i.selection=i.selection.filter((function(e){return e!==t.selectionHelper})),i.invalidate(!0)}else if(i.selection.length){var c=!0,u=!1,h=void 0;try{for(var d,v=i.selection[Symbol.iterator]();!(c=(d=v.next()).done);c=!0){var f=d.value;if(f.ownedBy()){if(this.mode===jo.Drag){if(this.dragRay.origin.x===ct(f.refPoint.x)&&this.dragRay.origin.y===ut(f.refPoint.y))continue;!_t.useGrid||e.altKey||this.deltaChanged||f.snapToGrid(),f!==this.selectionHelper&&(f.visionObstruction&&Li.recalculateVision(),f.movementObstruction&&Li.recalculateMovement(),Je.emit("Shape.Update",{shape:f.asDict(),redraw:!0,temporary:!1})),i.invalidate(!1)}this.mode===jo.Resize&&(_t.useGrid&&!e.altKey&&f.resizeToGrid(),f!==this.selectionHelper&&(f.visionObstruction&&Li.recalculateVision(),f.movementObstruction&&Li.recalculateMovement(),Je.emit("Shape.Update",{shape:f.asDict(),redraw:!0,temporary:!1})),i.invalidate(!1))}}}catch(p){u=!0,h=p}finally{try{c||null==v.return||v.return()}finally{if(u)throw h}}}this.mode=jo.Noop,this.active=!1}else console.log("No active layer!")}},{key:"onContextMenu",value:function(e){if(void 0!==jt.getLayer()){var t=jt.getLayer(),i=wt(e),n=ft(i),a=!0,o=!1,r=void 0;try{for(var s,l=t.selection[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;if(c.contains(n))return tt.$emit("SelectionInfo.Shape.Set",c),t.invalidate(!0),void this.$parent.$refs.shapecontext.open(e)}}catch(d){o=!0,r=d}finally{try{a||null==l.return||l.return()}finally{if(o)throw r}}for(var u=t.shapes.length-1;u>=0;u--){var h=t.shapes[u];if(h.contains(n))return t.selection=[h],tt.$emit("SelectionInfo.Shape.Set",h),t.invalidate(!0),void this.$parent.$refs.shapecontext.open(e)}this.$parent.$refs.defaultcontext.open(e)}else console.log("No active layer!")}},{key:"updateCursor",value:function(e,t){var i=!0,n=!1,a=void 0;try{for(var o,r=e.selection[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var s=o.value,l=s.getPointIndex(t,gt(3));if(l<0)document.body.style.cursor="default";else{var c=s.getPointOrientation(l).angle();c<0&&(c+=360);var u=22.5;(c>=315+u||c<u||c>=135+u&&c<225-u)&&(document.body.style.cursor="ew-resize"),(c>=45+u&&c<135-u||c>=225+u&&c<315-u)&&(document.body.style.cursor="ns-resize"),(c>=u&&c<90-u||c>=180+u&&c<270-u)&&(document.body.style.cursor="nwse-resize"),(c>=90+u&&c<180-u||c>=270+u&&c<360-u)&&(document.body.style.cursor="nesw-resize")}}}catch(h){n=!0,a=h}finally{try{i||null==r.return||r.return()}finally{if(n)throw a}}}}]),t}(Za);Io=Object(k["a"])([O["b"]],Io);var Po,Mo,To=Io,Ao=To,Do=Object(r["a"])(Ao,Po,Mo,!1,null,null,null),Ro=Do.exports,No=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.selected?i("div",{staticClass:"tool-detail",style:{"--detailRight":e.detailRight,"--detailArrow":e.detailArrow}},e._l(e.tokens,(function(t){return i("div",{key:t.uuid,staticClass:"token",class:{selected:e.selection.includes(t.uuid)},on:{click:function(i){return e.toggle(t.uuid)}}},[t.src?i("img",{attrs:{src:t.src,width:"30px",height:"30px"}}):e._e(),i("div",[e._v(e._s(t.name))])])})),0):e._e()},Uo=[],zo=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Vision",e.active=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"toggle",value:function(e){this.selection.includes(e)?_t.removeActiveToken(e):_t.addActiveToken(e)}},{key:"selection",get:function(){return _t.activeTokens}},{key:"tokens",get:function(){return _t.ownedtokens.map((function(e){return jt.UUIDMap.get(e)}))}}]),t}(Za);zo=Object(k["a"])([O["b"]],zo);var $o=zo,Fo=$o,Vo=(i("7392"),Object(r["a"])(Fo,No,Uo,!1,null,"f995dfd4",null)),Ho=Vo.exports,Bo=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Ping",e.active=!1,e.startPoint=null,e.ping=null,e.border=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"onMouseDown",value:function(e){var t=jt.getLayer("draw");void 0!==t?(this.active=!0,this.startPoint=ft(wt(e)),this.ping=new Ai(this.startPoint,20,_t.rulerColour),this.border=new Ai(this.startPoint,40,"#0000",_t.rulerColour),this.ping.addOwner(_t.username),this.border.addOwner(_t.username),t.addShape(this.ping,!0,!0),t.addShape(this.border,!0,!0)):console.log("No draw layer!")}},{key:"onMouseMove",value:function(e){if(this.active&&null!==this.ping&&null!==this.border&&null!==this.startPoint){var t=jt.getLayer("draw");if(void 0!==t){var i=ft(wt(e));this.ping.center(i),this.border.center(i),Je.emit("Shape.Update",{shape:this.ping.asDict(),redraw:!0,temporary:!0}),Je.emit("Shape.Update",{shape:this.border.asDict(),redraw:!0,temporary:!0}),t.invalidate(!0)}else console.log("No draw layer!")}}},{key:"onMouseUp",value:function(e){if(this.active&&null!==this.ping&&null!==this.border&&null!==this.startPoint){var t=jt.getLayer("draw");void 0!==t?(this.active=!1,t.removeShape(this.ping,!0,!0),t.removeShape(this.border,!0,!0),t.invalidate(!0),this.ping=null,this.startPoint=null):console.log("No active layer!")}}}]),t}(Za);Bo=Object(k["a"])([O["b"]],Bo);i("2af1");var Go=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.name="Ruler",e.active=!1,e.startPoint=null,e.ruler=null,e.text=null,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"onMouseDown",value:function(e){var t=jt.getLayer("draw");void 0!==t?(this.active=!0,this.startPoint=ft(wt(e)),this.ruler=new Ri(this.startPoint,this.startPoint,gt(3),_t.rulerColour),this.text=new Ui(this.startPoint.clone(),"","bold 20px serif"),this.ruler.addOwner(_t.username),this.text.addOwner(_t.username),t.addShape(this.ruler,!0,!0),t.addShape(this.text,!0,!0)):console.log("No draw layer!")}},{key:"onMouseMove",value:function(e){if(this.active&&null!==this.ruler&&null!==this.startPoint&&null!==this.text){var t=jt.getLayer("draw");if(void 0!==t){var i=ft(wt(e));this.ruler.endPoint=i,Je.emit("Shape.Update",{shape:this.ruler.asDict(),redraw:!0,temporary:!0});var n=Math.sign(i.x-this.startPoint.x)*Math.sign(i.y-this.startPoint.y),a=Math.abs(i.x-this.startPoint.x),o=Math.abs(i.y-this.startPoint.y),r=Math.round(Math.sqrt(Math.pow(a,2)+Math.pow(o,2))*_t.unitSize/_t.gridSize)+" "+_t.unitSizeUnit,s=Math.atan2(n*o,a),l=Math.min(this.startPoint.x,i.x)+a/2,c=Math.min(this.startPoint.y,i.y)+o/2;this.text.refPoint=new nt(l,c),this.text.text=r,this.text.angle=s,Je.emit("Shape.Update",{shape:this.text.asDict(),redraw:!0,temporary:!0}),t.invalidate(!0)}else console.log("No draw layer!")}}},{key:"onMouseUp",value:function(e){if(this.active&&null!==this.ruler&&null!==this.startPoint&&null!==this.text){var t=jt.getLayer("draw");void 0!==t?(this.active=!1,t.removeShape(this.ruler,!0,!0),t.removeShape(this.text,!0,!0),t.invalidate(!0),this.ruler=this.startPoint=this.text=null):console.log("No active layer!")}}}]),t}(Za);Go=Object(k["a"])([O["b"]],Go);var Wo=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.currentTool="Select",e.tools=["Select","Pan","Draw","Ruler","Ping","Map","Filter","Vision"],e.dmTools=["Map"],e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"toolVisible",value:function(e){return"Filter"===e?Object.keys(_t.labels).length>0:"Vision"!==e||_t.ownedtokens.length>1}},{key:"mousedown",value:function(e){if("CANVAS"===e.target.tagName){var t=this.currentTool;if(1===e.button)t="Pan";else if(0!==e.button)return;this.$emit("mousedown",e,t)}}},{key:"mouseup",value:function(e){if("CANVAS"===e.target.tagName){var t=this.currentTool;if(1===e.button)t="Pan";else if(0!==e.button)return;this.$emit("mouseup",e,t)}}},{key:"mousemove",value:function(e){if("CANVAS"===e.target.tagName){var t=this.currentTool;if(0!==(4&e.buttons))t="Pan";else if((1&e.button)>1)return;this.$emit("mousemove",e,t);var i=!1,n=!0,a=!1,o=void 0;try{for(var r,s=_t.annotations[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value;if(jt.UUIDMap.has(l)&&jt.hasLayer("draw")){var c=jt.UUIDMap.get(l);c.contains(ft(wt(e)))&&(i=!0,dn.annotationManager.setActiveText(c.annotation))}}}catch(u){a=!0,o=u}finally{try{n||null==s.return||s.return()}finally{if(a)throw o}}!i&&dn.annotationManager.shown&&dn.annotationManager.setActiveText("")}}},{key:"mouseleave",value:function(e){0!==(1&e.buttons)&&this.$emit("mouseup",e,this.currentTool)}},{key:"contextmenu",value:function(e){"CANVAS"===e.target.tagName&&2===e.button&&"CANVAS"===e.target.tagName&&this.$emit("contextmenu",e,this.currentTool)}},{key:"IS_DM",get:function(){return _t.IS_DM}},{key:"currentToolComponent",get:function(){return"".concat(this.currentTool.toLowerCase(),"-tool")}},{key:"visibleTools",get:function(){var e=this;return this.tools.filter((function(t){return!e.dmTools.includes(t)||e.IS_DM}))}}]),t}(n["default"]);Wo=Object(k["a"])([Object(O["b"])({components:{"select-tool":Ro,"pan-tool":Lo,"draw-tool":no,"ruler-tool":Go,"ping-tool":Bo,"map-tool":_o,"filter-tool":mo,"vision-tool":Ho,"shape-menu":Ea,"default-menu":Ha,"createtoken-dialog":Ra},watch:{currentTool:function(e,t){this.$emit("tools-select-change",e,t)}}})],Wo);var Xo=Wo,Yo=Xo,Ko=(i("0b57"),Object(r["a"])(Yo,ka,Oa,!1,null,"5132142a",null)),qo=Ko.exports,Qo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("Modal",{attrs:{visible:e.visible,colour:"rgba(255, 255, 255, 0.8)",mask:!1},on:{close:function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(t){return i("div",{staticClass:"modal-header",attrs:{draggable:"true"},on:{dragstart:t.dragStart,dragend:t.dragEnd}},[i("div",[e._v("DM Settings")]),i("div",{staticClass:"header-close",on:{click:function(t){e.visible=!1}}},[i("i",{staticClass:"far fa-window-close"})])])}}])},[i("div",{staticClass:"modal-body",on:{click:e.handleClick}},[i("div",{attrs:{id:"categories"}},e._l(e.categories,(function(t,n){return i("div",{key:t,staticClass:"category",class:{selected:e.selection===n},on:{click:function(t){e.selection=n}}},[e._v(" "+e._s(t)+" ")])})),0),i("div",{directives:[{name:"show",rawName:"v-show",value:0===e.selection,expression:"selection === 0"}],staticClass:"panel"},[i("div",{staticClass:"spanrow header"},[e._v("Players")]),e._l(e.$store.state.game.players,(function(t){return i("div",{key:t.id,staticClass:"row smallrow"},[i("div",[e._v(e._s(t.name))]),i("div",[i("div",{on:{click:function(i){return e.kickPlayer(t.id)}}},[e._v("Kick")])])])})),0===Object.values(e.$store.state.game.players).length?i("div",{staticClass:"row smallrow"},[i("div",{staticClass:"spanrow"},[e._v("There are no players yet, invite some using the link below!")])]):e._e(),i("div",{staticClass:"spanrow header"},[e._v("Invite code")]),i("div",{staticClass:"row"},[i("div",[e._v("Invitation URL:")]),e.showRefreshState?[i("InputCopyElement",{attrs:{value:e.refreshState}})]:[i("InputCopyElement",{attrs:{value:e.invitationUrl}})]],2),i("div",{staticClass:"row",on:{click:e.refreshInviteCode}},[i("div"),i("div",[i("button",[e._v("Refresh invitation code")])])]),i("div",{staticClass:"spanrow header"},[e._v("Danger Zone")]),i("div",{staticClass:"row"},[i("div",[e.locked?[e._v(" Unlock ")]:[e._v(" Lock ")],e._v(" Session "),i("i",[e._v("(DM access only)")])],2),i("div",[i("button",{staticClass:"danger",on:{click:e.toggleSessionLock}},[e.locked?[e._v(" Unlock ")]:[e._v(" Lock ")],e._v(" this Session ")],2)])]),i("div",{staticClass:"row"},[i("div",[e._v("Remove Session")]),i("div",[i("button",{staticClass:"danger",on:{click:e.deleteSession}},[e._v("Delete this Session")])])])],2),i("div",{directives:[{name:"show",rawName:"v-show",value:1===e.selection,expression:"selection === 1"}],staticClass:"panel"},[i("div",{staticClass:"row"},[i("label",{attrs:{for:"useGridInput"}},[e._v("Use grid")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.useGrid,expression:"useGrid"}],attrs:{id:"useGridInput",type:"checkbox"},domProps:{checked:Array.isArray(e.useGrid)?e._i(e.useGrid,null)>-1:e.useGrid},on:{change:function(t){var i=e.useGrid,n=t.target,a=!!n.checked;if(Array.isArray(i)){var o=null,r=e._i(i,o);n.checked?r<0&&(e.useGrid=i.concat([o])):r>-1&&(e.useGrid=i.slice(0,r).concat(i.slice(r+1)))}else e.useGrid=a}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"gridSizeInput"}},[e._v("Grid Size (in pixels):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.gridSize,expression:"gridSize",modifiers:{number:!0}}],attrs:{id:"gridSizeInput",type:"number",min:"0"},domProps:{value:e.gridSize},on:{input:function(t){t.target.composing||(e.gridSize=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"row"},[i("div",[i("label",{attrs:{for:"unitSizeUnit"}},[e._v("Size Unit")])]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.unitSizeUnit,expression:"unitSizeUnit"}],attrs:{id:"unitSizeUnit",type:"text"},domProps:{value:e.unitSizeUnit},on:{input:function(t){t.target.composing||(e.unitSizeUnit=t.target.value)}}})])]),i("div",{staticClass:"row"},[i("div",[i("label",{attrs:{for:"unitSizeInput"}},[e._v("Unit Size (in "+e._s(e.unitSizeUnit)+")")])]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.unitSize,expression:"unitSize",modifiers:{number:!0}}],attrs:{id:"unitSizeInput",type:"number"},domProps:{value:e.unitSize},on:{input:function(t){t.target.composing||(e.unitSize=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:2===e.selection,expression:"selection === 2"}],staticClass:"panel"},[i("div",{staticClass:"spanrow header"},[e._v("Core")]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fakePlayerInput"}},[e._v("Fake player:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fakePlayer,expression:"fakePlayer"}],attrs:{id:"fakePlayerInput",type:"checkbox"},domProps:{checked:Array.isArray(e.fakePlayer)?e._i(e.fakePlayer,null)>-1:e.fakePlayer},on:{change:function(t){var i=e.fakePlayer,n=t.target,a=!!n.checked;if(Array.isArray(i)){var o=null,r=e._i(i,o);n.checked?r<0&&(e.fakePlayer=i.concat([o])):r>-1&&(e.fakePlayer=i.slice(0,r).concat(i.slice(r+1)))}else e.fakePlayer=a}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"useFOWInput"}},[e._v("Fill entire canvas with FOW:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fullFOW,expression:"fullFOW"}],attrs:{id:"useFOWInput",type:"checkbox"},domProps:{checked:Array.isArray(e.fullFOW)?e._i(e.fullFOW,null)>-1:e.fullFOW},on:{change:function(t){var i=e.fullFOW,n=t.target,a=!!n.checked;if(Array.isArray(i)){var o=null,r=e._i(i,o);n.checked?r<0&&(e.fullFOW=i.concat([o])):r>-1&&(e.fullFOW=i.slice(0,r).concat(i.slice(r+1)))}else e.fullFOW=a}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fowLOS"}},[e._v("Only show lights in LoS:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.fowLOS,expression:"fowLOS"}],attrs:{id:"fowLOS",type:"checkbox"},domProps:{checked:Array.isArray(e.fowLOS)?e._i(e.fowLOS,null)>-1:e.fowLOS},on:{change:function(t){var i=e.fowLOS,n=t.target,a=!!n.checked;if(Array.isArray(i)){var o=null,r=e._i(i,o);n.checked?r<0&&(e.fowLOS=i.concat([o])):r>-1&&(e.fowLOS=i.slice(0,r).concat(i.slice(r+1)))}else e.fowLOS=a}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"fowOpacity"}},[e._v("FOW opacity:")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.fowOpacity,expression:"fowOpacity",modifiers:{number:!0}}],attrs:{id:"fowOpacity",type:"number",min:"0",max:"1",step:"0.1"},domProps:{value:e.fowOpacity},on:{input:function(t){t.target.composing||(e.fowOpacity=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"spanrow header"},[e._v("Advanced")]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"visionMode"}},[e._v("Vision Mode:")]),i("div",[i("select",{attrs:{id:"visionMode"},on:{change:e.changeVisionMode}},[i("option",{domProps:{selected:"bvh"===e.$store.state.visibility.visionMode}},[e._v("BVH")]),i("option",{domProps:{selected:"triangle"===e.$store.state.visibility.visionMode}},[e._v("Triangle")])])])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"vmininp"}},[e._v("Minimal full vision ("+e._s(e.unitSizeUnit)+"):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:e.visionRangeMin,expression:"visionRangeMin",modifiers:{lazy:!0,number:!0}}],attrs:{id:"vmininp",type:"number",min:"0"},domProps:{value:e.visionRangeMin},on:{change:function(t){e.visionRangeMin=e._n(t.target.value)},blur:function(t){return e.$forceUpdate()}}})])]),i("div",{staticClass:"row"},[i("label",{attrs:{for:"vmaxinp"}},[e._v("Maximal vision ("+e._s(e.unitSizeUnit)+"):")]),i("div",[i("input",{directives:[{name:"model",rawName:"v-model.lazy.number",value:e.visionRangeMax,expression:"visionRangeMax",modifiers:{lazy:!0,number:!0}}],attrs:{id:"vmaxinp",type:"number",min:"0"},domProps:{value:e.visionRangeMax},on:{change:function(t){e.visionRangeMax=e._n(t.target.value)},blur:function(t){return e.$forceUpdate()}}})])])])])])},Zo=[],Jo=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"input-copy"},on:{mouseleave:function(t){e.showPopup=!1}}},[i("input",{attrs:{type:"text",disabled:"disabled",id:"input-element"},domProps:{value:e.value}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showPopup,expression:"showPopup"}],attrs:{id:"show-popup"}},[e._v(e._s(e.popupString))]),i("div",{attrs:{id:"copy-button"},on:{click:e.copy}},[i("i",{staticClass:"far fa-copy"})])])},er=[],tr=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.borderColour="lightgray",e.popupString="",e.showPopup=!1,e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"copy",value:function(){var e=this;navigator.clipboard.writeText(this.value).then((function(){e.popupString="Copied!",e.showPopup=!0}),(function(){console.log("Could not copy to clipboard :("),e.popupString="Error!",e.showPopup=!0}))}}]),t}(n["default"]);Object(k["a"])([Object(K["a"])()],tr.prototype,"value",void 0),tr=Object(k["a"])([O["b"]],tr);var ir=tr,nr=ir,ar=(i("e60f"),Object(r["a"])(nr,Jo,er,!1,null,"628dde30",null)),or=ar.exports,rr=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.visible=!1,e.categories=["Admin","Grid","Vision"],e.selection=0,e.showRefreshState=!1,e.refreshState="pending",e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){var e=this;tt.$on("DmSettings.Open",(function(){e.visible=!0})),tt.$on("DmSettings.RefreshedInviteCode",(function(){e.showRefreshState=!1}))}},{key:"beforeDestroy",value:function(){tt.$off("DmSettings.Open"),tt.$off("DmSettings.RefreshedInviteCode")}},{key:"changeVisionMode",value:function(e){var t=e.target.value.toLowerCase();"bvh"!==t&&"triangle"!==t||(Li.setVisionMode({mode:t,sync:!0}),Li.recalculateVision(),Li.recalculateMovement(),jt.invalidate())}},{key:"handleClick",value:function(e){var t=e.target.firstElementChild;t instanceof HTMLInputElement&&t.click()}},{key:"refreshInviteCode",value:function(){Je.emit("Room.Info.InviteCode.Refresh"),this.refreshState="pending",this.showRefreshState=!0}},{key:"kickPlayer",value:function(e){Je.emit("Room.Info.Players.Kick",e),_t.kickPlayer(e)}},{key:"toggleSessionLock",value:function(){_t.setIsLocked({isLocked:!_t.isLocked,sync:!0})}},{key:"deleteSession",value:function(){var e=this;this.$parent.$refs.prompt.prompt("ENTER ".concat(_t.roomCreator,"/").concat(_t.roomName," TO CONFIRM SESSION REMOVAL."),"DELETING SESSION").then((function(t){t==="".concat(_t.roomCreator,"/").concat(_t.roomName)&&(Je.emit("Room.Delete"),e.$router.push("/"))}),(function(){}))}},{key:"invitationUrl",get:function(){return window.location.protocol+"//"+window.location.host+"/invite/"+_t.invitationCode}},{key:"locked",get:function(){return _t.isLocked}},{key:"useGrid",get:function(){return _t.useGrid},set:function(e){_t.setUseGrid({useGrid:e,sync:!0})}},{key:"unitSize",get:function(){return _t.unitSize},set:function(e){"number"===typeof e&&_t.setUnitSize({unitSize:e,sync:!0})}},{key:"unitSizeUnit",get:function(){return _t.unitSizeUnit},set:function(e){_t.setUnitSizeUnit({unitSizeUnit:e,sync:!0})}},{key:"gridSize",get:function(){return _t.gridSize},set:function(e){"number"===typeof e&&_t.setGridSize({gridSize:e,sync:!0})}},{key:"fakePlayer",get:function(){return _t.FAKE_PLAYER},set:function(e){_t.setFakePlayer(e)}},{key:"fullFOW",get:function(){return _t.fullFOW},set:function(e){_t.setFullFOW({fullFOW:e,sync:!0})}},{key:"fowOpacity",get:function(){return _t.fowOpacity},set:function(e){"number"===typeof e&&_t.setFOWOpacity({fowOpacity:e,sync:!0})}},{key:"fowLOS",get:function(){return _t.fowLOS},set:function(e){_t.setLineOfSight({fowLOS:e,sync:!0})}},{key:"visionRangeMin",get:function(){return _t.visionRangeMin},set:function(e){"number"===typeof e&&_t.setVisionRangeMin({value:e,sync:!0})}},{key:"visionRangeMax",get:function(){return _t.visionRangeMax},set:function(e){"number"===typeof e&&_t.setVisionRangeMax({value:e,sync:!0})}}]),t}(n["default"]);rr=Object(k["a"])([Object(O["b"])({components:{InputCopyElement:or,Modal:ee},computed:Object.assign({},Object(D["c"])("game",["invitationCode"]))})],rr);var sr=rr,lr=sr,cr=(i("59fe"),Object(r["a"])(lr,Qo,Zo,!1,null,"61114102",null)),ur=cr.exports;function hr(e){e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||"Delete"!==e.key&&"Del"!==e.key&&"Backspace"!==e.key||Hi()}function dr(e){if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)"a"===e.key&&e.ctrlKey&&e.target.select();else if(e.keyCode>=37&&e.keyCode<=40){var t=Math.round(_t.gridSize),i=t*(e.keyCode%2),n=t*(e.keyCode%2?0:1);if(jt.hasSelection()){var a=jt.getSelection();i*=e.keyCode<=38?-1:1,n*=e.keyCode<=38?-1:1;var o=new ot(i,n);if(!e.shiftKey||!_t.IS_DM){var r=!0,s=!1,l=void 0;try{for(var c,u=a[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var h=c.value;_t.selectionHelperID!==h.uuid&&(o=Ii(o,h))}}catch(b){s=!0,l=b}finally{try{r||null==u.return||u.return()}finally{if(s)throw l}}}var d=!0,v=!1,f=void 0;try{for(var p,y=a[Symbol.iterator]();!(d=(p=y.next()).done);d=!0){var g=p.value;_t.selectionHelperID!==g.uuid&&(g.refPoint=g.refPoint.add(o),Je.emit("Shape.Position.Update",{shape:g.asDict(),redraw:!0,temporary:!1}))}}catch(b){v=!0,f=b}finally{try{d||null==y.return||y.return()}finally{if(v)throw f}}Li.recalculateVision(),jt.getLayer().invalidate(!1)}else _t.increasePanX(i*(e.keyCode<=38?1:-1)),_t.increasePanY(n*(e.keyCode<=38?1:-1)),jt.invalidate(),st(_t.locationOptions)}else if("d"===e.key){var m=jt.getLayer();m&&(m.clearSelection(),m.invalidate(!0))}else"u"===e.key&&e.ctrlKey?(e.preventDefault(),e.stopPropagation(),_t.toggleUI()):"c"===e.key&&e.ctrlKey?Fi():"v"===e.key&&e.ctrlKey&&Vi()}function vr(e){var t;e.target&&e.target.tagName&&"CANVAS"===e.target.tagName&&(t=-1*Math.sign(e.deltaY),_t.updateZoom({newZoomDisplay:_t.zoomDisplay-.1*t,zoomLocation:ft(wt(e))}))}var fr=function(e){function t(){var e;return Object(y["a"])(this,t),e=Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments)),e.ready={manager:!1,tools:!1},e.throttledmoveSet=!1,e.throttledmove=function(e){},e}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"mounted",value:function(){window.addEventListener("resize",this.resizeWindow),window.addEventListener("keyup",hr),window.addEventListener("keydown",dr),this.ready.manager=!0}},{key:"destroyed",value:function(){window.removeEventListener("resize",this.resizeWindow),window.removeEventListener("keyup",hr),window.removeEventListener("keydown",dr),this.ready.manager=!1}},{key:"zoom",value:function(e){qe()(vr)(e)}},{key:"resizeWindow",value:function(){jt.setWidth(window.innerWidth),jt.setHeight(window.innerHeight),jt.invalidate()}},{key:"mousedown",value:function(e){this.$refs.tools.mousedown(e)}},{key:"mouseup",value:function(e){this.$refs.tools.mouseup(e)}},{key:"mousemove",value:function(e){this.throttledmoveSet||(this.throttledmoveSet=!0,this.throttledmove=qe()(this.$refs.tools.mousemove,15)),this.throttledmove(e)}},{key:"mouseleave",value:function(e){this.$refs.tools.mouseleave(e)}},{key:"contextmenu",value:function(e){this.$refs.tools.contextmenu(e)}},{key:"selectLayer",value:function(e){jt.selectLayer(e)}},{key:"drop",value:function(e){if(null!==e&&null!==e.dataTransfer)if(e.dataTransfer.files.length>0)this.$refs.confirm.open("Uploading files should be done through the asset manager.","Ok","").then((function(){}),(function(){}));else{if(""===e.dataTransfer.getData("text/plain"))return;cn(e)}}},{key:"showUI",get:function(){return _t.showUI}},{key:"IS_DM",get:function(){return _t.IS_DM}},{key:"FAKE_PLAYER",get:function(){return _t.FAKE_PLAYER}},{key:"layers",get:function(){return _t.layers}},{key:"selectedLayer",get:function(){return _t.selectedLayer}},{key:"zoomDisplay",get:function(){return _t.zoomDisplay},set:function(e){_t.updateZoom({newZoomDisplay:e,zoomLocation:ft(new at(window.innerWidth/2,window.innerHeight/2))})}}]),t}(n["default"]);fr=Object(k["a"])([Object(O["b"])({components:{"tool-bar":qo,"selection-info":wa,"prompt-dialog":de,"confirm-dialog":oe,"menu-bar":Jn,"initiative-dialog":Sn,"zoom-slider":Ze.a,"note-dialog":ra,"label-dialog":Pn,"dm-settings":ur},beforeRouteEnter:function(e,t,i){et(e),i()},beforeRouteLeave:function(e,t,i){Je.disconnect(),i()}})],fr);var pr=fr,yr=pr,gr=(i("561b"),i("1e6f"),Object(r["a"])(yr,Xe,Ye,!1,null,"ec4a3cb8",null)),mr=gr.exports,br=function(e){function t(){return Object(y["a"])(this,t),Object(m["a"])(this,Object(b["a"])(t).apply(this,arguments))}return Object(w["a"])(t,e),Object(g["a"])(t,[{key:"beforeRouteEnter",value:function(e,t,i){h.a.post("/api/invite",{code:e.params.code}).then((function(e){i({path:e.data.sessionUrl})})).catch((function(e){console.error("Invitation code could not be redeemed"),i({path:"/dashboard"})}))}}]),t}(n["default"]);br=Object(k["a"])([Object(O["b"])({template:""})],br);var wr=br;n["default"].use(d["a"]);var kr=new d["a"]({mode:"history",base:"/",routes:[{path:"/",redirect:"/dashboard"},{path:"/_load",name:"load",component:ze},{path:"/assets",component:ke,meta:{auth:!0}},{path:"/auth",component:{template:"<router-view></router-view>"},children:[{path:"login",component:Ie},{path:"logout",component:Me}]},{path:"/invite/:code",component:wr,meta:{auth:!0}},{path:"/dashboard",component:We,meta:{auth:!0}},{path:"/game/:creator/:room",component:mr,meta:{auth:!0}}]});kr.beforeEach((function(e,t,i){_e.initialized||"/_load"===e.path?e.matched.some((function(e){return e.meta.auth}))&&!_e.authenticated?i({path:"/auth/login",query:{redirect:e.path}}):i():(i({path:"/_load"}),h.a.get("/api/auth").then((function(t){t.data.auth&&(_e.setAuthenticated(!0),_e.setUsername(t.data.username)),_e.setInitialized(!0),kr.push(e.path)})).catch((function(){console.error("Authentication check could not be fulfilled.")})))})),i.d(t,"app",(function(){return Or})),n["default"].config.productionTip=!1,n["default"].config.devtools=!0,n["default"].config.performance=!0;var Or=new n["default"]({router:kr,store:R,render:function(e){return e(c)}}).$mount("#app");window.app=Or},d267:function(e,t,i){},d4ff:function(e,t,i){},d9e0:function(e,t,i){"use strict";var n=i("d267"),a=i.n(n);a.a},de79:function(e,t,i){},e3f5:function(e,t,i){"use strict";var n=i("b831"),a=i.n(n);a.a},e60f:function(e,t,i){"use strict";var n=i("e9b7"),a=i.n(n);a.a},e7bf:function(e,t,i){},e9b7:function(e,t,i){},f0dc:function(e,t,i){},f459:function(e,t,i){},fa96:function(e,t,i){},fb5d:function(e,t,i){"use strict";var n=i("a3fa"),a=i.n(n);a.a},fe8d:function(e,t,i){}});
//# sourceMappingURL=app-legacy.66e77954.js.map